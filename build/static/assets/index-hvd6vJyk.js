function u6(t,e){for(var n=0;n<e.length;n++){const s=e[n];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in t)){const i=Object.getOwnPropertyDescriptor(s,r);i&&Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();var qe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function DF(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function j_(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(s){var r=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(n,s,r.get?r:{enumerable:!0,get:function(){return t[s]}})}),n}var OF={exports:{}},Qw={},PF={exports:{}},ht={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zm=Symbol.for("react.element"),c6=Symbol.for("react.portal"),h6=Symbol.for("react.fragment"),d6=Symbol.for("react.strict_mode"),f6=Symbol.for("react.profiler"),p6=Symbol.for("react.provider"),m6=Symbol.for("react.context"),g6=Symbol.for("react.forward_ref"),y6=Symbol.for("react.suspense"),v6=Symbol.for("react.memo"),w6=Symbol.for("react.lazy"),tA=Symbol.iterator;function x6(t){return t===null||typeof t!="object"?null:(t=tA&&t[tA]||t["@@iterator"],typeof t=="function"?t:null)}var FF={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},LF=Object.assign,MF={};function sd(t,e,n){this.props=t,this.context=e,this.refs=MF,this.updater=n||FF}sd.prototype.isReactComponent={};sd.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};sd.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function zF(){}zF.prototype=sd.prototype;function G_(t,e,n){this.props=t,this.context=e,this.refs=MF,this.updater=n||FF}var H_=G_.prototype=new zF;H_.constructor=G_;LF(H_,sd.prototype);H_.isPureReactComponent=!0;var nA=Array.isArray,BF=Object.prototype.hasOwnProperty,q_={current:null},VF={key:!0,ref:!0,__self:!0,__source:!0};function UF(t,e,n){var s,r={},i=null,o=null;if(e!=null)for(s in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)BF.call(e,s)&&!VF.hasOwnProperty(s)&&(r[s]=e[s]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];r.children=l}if(t&&t.defaultProps)for(s in a=t.defaultProps,a)r[s]===void 0&&(r[s]=a[s]);return{$$typeof:zm,type:t,key:i,ref:o,props:r,_owner:q_.current}}function b6(t,e){return{$$typeof:zm,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function K_(t){return typeof t=="object"&&t!==null&&t.$$typeof===zm}function S6(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var sA=/\/+/g;function vS(t,e){return typeof t=="object"&&t!==null&&t.key!=null?S6(""+t.key):e.toString(36)}function H0(t,e,n,s,r){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case zm:case c6:o=!0}}if(o)return o=t,r=r(o),t=s===""?"."+vS(o,0):s,nA(r)?(n="",t!=null&&(n=t.replace(sA,"$&/")+"/"),H0(r,e,n,"",function(u){return u})):r!=null&&(K_(r)&&(r=b6(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(sA,"$&/")+"/")+t)),e.push(r)),1;if(o=0,s=s===""?".":s+":",nA(t))for(var a=0;a<t.length;a++){i=t[a];var l=s+vS(i,a);o+=H0(i,e,n,l,r)}else if(l=x6(t),typeof l=="function")for(t=l.call(t),a=0;!(i=t.next()).done;)i=i.value,l=s+vS(i,a++),o+=H0(i,e,n,l,r);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function l0(t,e,n){if(t==null)return t;var s=[],r=0;return H0(t,s,"","",function(i){return e.call(n,i,r++)}),s}function C6(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var tr={current:null},q0={transition:null},I6={ReactCurrentDispatcher:tr,ReactCurrentBatchConfig:q0,ReactCurrentOwner:q_};function WF(){throw Error("act(...) is not supported in production builds of React.")}ht.Children={map:l0,forEach:function(t,e,n){l0(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return l0(t,function(){e++}),e},toArray:function(t){return l0(t,function(e){return e})||[]},only:function(t){if(!K_(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};ht.Component=sd;ht.Fragment=h6;ht.Profiler=f6;ht.PureComponent=G_;ht.StrictMode=d6;ht.Suspense=y6;ht.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=I6;ht.act=WF;ht.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var s=LF({},t.props),r=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=q_.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)BF.call(e,l)&&!VF.hasOwnProperty(l)&&(s[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];s.children=a}return{$$typeof:zm,type:t.type,key:r,ref:i,props:s,_owner:o}};ht.createContext=function(t){return t={$$typeof:m6,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:p6,_context:t},t.Consumer=t};ht.createElement=UF;ht.createFactory=function(t){var e=UF.bind(null,t);return e.type=t,e};ht.createRef=function(){return{current:null}};ht.forwardRef=function(t){return{$$typeof:g6,render:t}};ht.isValidElement=K_;ht.lazy=function(t){return{$$typeof:w6,_payload:{_status:-1,_result:t},_init:C6}};ht.memo=function(t,e){return{$$typeof:v6,type:t,compare:e===void 0?null:e}};ht.startTransition=function(t){var e=q0.transition;q0.transition={};try{t()}finally{q0.transition=e}};ht.unstable_act=WF;ht.useCallback=function(t,e){return tr.current.useCallback(t,e)};ht.useContext=function(t){return tr.current.useContext(t)};ht.useDebugValue=function(){};ht.useDeferredValue=function(t){return tr.current.useDeferredValue(t)};ht.useEffect=function(t,e){return tr.current.useEffect(t,e)};ht.useId=function(){return tr.current.useId()};ht.useImperativeHandle=function(t,e,n){return tr.current.useImperativeHandle(t,e,n)};ht.useInsertionEffect=function(t,e){return tr.current.useInsertionEffect(t,e)};ht.useLayoutEffect=function(t,e){return tr.current.useLayoutEffect(t,e)};ht.useMemo=function(t,e){return tr.current.useMemo(t,e)};ht.useReducer=function(t,e,n){return tr.current.useReducer(t,e,n)};ht.useRef=function(t){return tr.current.useRef(t)};ht.useState=function(t){return tr.current.useState(t)};ht.useSyncExternalStore=function(t,e,n){return tr.current.useSyncExternalStore(t,e,n)};ht.useTransition=function(){return tr.current.useTransition()};ht.version="18.3.1";PF.exports=ht;var ne=PF.exports;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _6=ne,T6=Symbol.for("react.element"),k6=Symbol.for("react.fragment"),E6=Object.prototype.hasOwnProperty,N6=_6.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,$6={key:!0,ref:!0,__self:!0,__source:!0};function jF(t,e,n){var s,r={},i=null,o=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(s in e)E6.call(e,s)&&!$6.hasOwnProperty(s)&&(r[s]=e[s]);if(t&&t.defaultProps)for(s in e=t.defaultProps,e)r[s]===void 0&&(r[s]=e[s]);return{$$typeof:T6,type:t,key:i,ref:o,props:r,_owner:N6.current}}Qw.Fragment=k6;Qw.jsx=jF;Qw.jsxs=jF;OF.exports=Qw;var j=OF.exports,GF={exports:{}},Vr={},HF={exports:{}},qF={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(z,Y){var L=z.length;z.push(Y);e:for(;0<L;){var le=L-1>>>1,Q=z[le];if(0<r(Q,Y))z[le]=Y,z[L]=Q,L=le;else break e}}function n(z){return z.length===0?null:z[0]}function s(z){if(z.length===0)return null;var Y=z[0],L=z.pop();if(L!==Y){z[0]=L;e:for(var le=0,Q=z.length,se=Q>>>1;le<se;){var de=2*(le+1)-1,ue=z[de],fe=de+1,ve=z[fe];if(0>r(ue,L))fe<Q&&0>r(ve,ue)?(z[le]=ve,z[fe]=L,le=fe):(z[le]=ue,z[de]=L,le=de);else if(fe<Q&&0>r(ve,L))z[le]=ve,z[fe]=L,le=fe;else break e}}return Y}function r(z,Y){var L=z.sortIndex-Y.sortIndex;return L!==0?L:z.id-Y.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],u=[],c=1,h=null,d=3,f=!1,p=!1,m=!1,v=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(z){for(var Y=n(u);Y!==null;){if(Y.callback===null)s(u);else if(Y.startTime<=z)s(u),Y.sortIndex=Y.expirationTime,e(l,Y);else break;Y=n(u)}}function x(z){if(m=!1,b(z),!p)if(n(l)!==null)p=!0,M(S);else{var Y=n(u);Y!==null&&X(x,Y.startTime-z)}}function S(z,Y){p=!1,m&&(m=!1,g(C),C=-1),f=!0;var L=d;try{for(b(Y),h=n(l);h!==null&&(!(h.expirationTime>Y)||z&&!A());){var le=h.callback;if(typeof le=="function"){h.callback=null,d=h.priorityLevel;var Q=le(h.expirationTime<=Y);Y=t.unstable_now(),typeof Q=="function"?h.callback=Q:h===n(l)&&s(l),b(Y)}else s(l);h=n(l)}if(h!==null)var se=!0;else{var de=n(u);de!==null&&X(x,de.startTime-Y),se=!1}return se}finally{h=null,d=L,f=!1}}var N=!1,I=null,C=-1,_=5,k=-1;function A(){return!(t.unstable_now()-k<_)}function D(){if(I!==null){var z=t.unstable_now();k=z;var Y=!0;try{Y=I(!0,z)}finally{Y?R():(N=!1,I=null)}}else N=!1}var R;if(typeof w=="function")R=function(){w(D)};else if(typeof MessageChannel<"u"){var W=new MessageChannel,B=W.port2;W.port1.onmessage=D,R=function(){B.postMessage(null)}}else R=function(){v(D,0)};function M(z){I=z,N||(N=!0,R())}function X(z,Y){C=v(function(){z(t.unstable_now())},Y)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(z){z.callback=null},t.unstable_continueExecution=function(){p||f||(p=!0,M(S))},t.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):_=0<z?Math.floor(1e3/z):5},t.unstable_getCurrentPriorityLevel=function(){return d},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(z){switch(d){case 1:case 2:case 3:var Y=3;break;default:Y=d}var L=d;d=Y;try{return z()}finally{d=L}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(z,Y){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var L=d;d=z;try{return Y()}finally{d=L}},t.unstable_scheduleCallback=function(z,Y,L){var le=t.unstable_now();switch(typeof L=="object"&&L!==null?(L=L.delay,L=typeof L=="number"&&0<L?le+L:le):L=le,z){case 1:var Q=-1;break;case 2:Q=250;break;case 5:Q=1073741823;break;case 4:Q=1e4;break;default:Q=5e3}return Q=L+Q,z={id:c++,callback:Y,priorityLevel:z,startTime:L,expirationTime:Q,sortIndex:-1},L>le?(z.sortIndex=L,e(u,z),n(l)===null&&z===n(u)&&(m?(g(C),C=-1):m=!0,X(x,L-le))):(z.sortIndex=Q,e(l,z),p||f||(p=!0,M(S))),z},t.unstable_shouldYield=A,t.unstable_wrapCallback=function(z){var Y=d;return function(){var L=d;d=Y;try{return z.apply(this,arguments)}finally{d=L}}}})(qF);HF.exports=qF;var R6=HF.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var A6=ne,Mr=R6;function me(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var KF=new Set,Vp={};function dc(t,e){Nh(t,e),Nh(t+"Capture",e)}function Nh(t,e){for(Vp[t]=e,t=0;t<e.length;t++)KF.add(e[t])}var na=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),TC=Object.prototype.hasOwnProperty,D6=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,rA={},iA={};function O6(t){return TC.call(iA,t)?!0:TC.call(rA,t)?!1:D6.test(t)?iA[t]=!0:(rA[t]=!0,!1)}function P6(t,e,n,s){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return s?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function F6(t,e,n,s){if(e===null||typeof e>"u"||P6(t,e,n,s))return!0;if(s)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function nr(t,e,n,s,r,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=s,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var bs={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){bs[t]=new nr(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];bs[e]=new nr(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){bs[t]=new nr(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){bs[t]=new nr(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){bs[t]=new nr(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){bs[t]=new nr(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){bs[t]=new nr(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){bs[t]=new nr(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){bs[t]=new nr(t,5,!1,t.toLowerCase(),null,!1,!1)});var X_=/[\-:]([a-z])/g;function Y_(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(X_,Y_);bs[e]=new nr(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(X_,Y_);bs[e]=new nr(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(X_,Y_);bs[e]=new nr(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){bs[t]=new nr(t,1,!1,t.toLowerCase(),null,!1,!1)});bs.xlinkHref=new nr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){bs[t]=new nr(t,1,!1,t.toLowerCase(),null,!0,!0)});function Q_(t,e,n,s){var r=bs.hasOwnProperty(e)?bs[e]:null;(r!==null?r.type!==0:s||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(F6(e,n,r,s)&&(n=null),s||r===null?O6(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,s=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,s?t.setAttributeNS(s,e,n):t.setAttribute(e,n))))}var ga=A6.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,u0=Symbol.for("react.element"),eh=Symbol.for("react.portal"),th=Symbol.for("react.fragment"),J_=Symbol.for("react.strict_mode"),kC=Symbol.for("react.profiler"),XF=Symbol.for("react.provider"),YF=Symbol.for("react.context"),Z_=Symbol.for("react.forward_ref"),EC=Symbol.for("react.suspense"),NC=Symbol.for("react.suspense_list"),eT=Symbol.for("react.memo"),Va=Symbol.for("react.lazy"),QF=Symbol.for("react.offscreen"),oA=Symbol.iterator;function Vf(t){return t===null||typeof t!="object"?null:(t=oA&&t[oA]||t["@@iterator"],typeof t=="function"?t:null)}var dn=Object.assign,wS;function ap(t){if(wS===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);wS=e&&e[1]||""}return`
`+wS+t}var xS=!1;function bS(t,e){if(!t||xS)return"";xS=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var s=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){s=u}t.call(e.prototype)}else{try{throw Error()}catch(u){s=u}t()}}catch(u){if(u&&s&&typeof u.stack=="string"){for(var r=u.stack.split(`
`),i=s.stack.split(`
`),o=r.length-1,a=i.length-1;1<=o&&0<=a&&r[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==i[a]){var l=`
`+r[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{xS=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?ap(t):""}function L6(t){switch(t.tag){case 5:return ap(t.type);case 16:return ap("Lazy");case 13:return ap("Suspense");case 19:return ap("SuspenseList");case 0:case 2:case 15:return t=bS(t.type,!1),t;case 11:return t=bS(t.type.render,!1),t;case 1:return t=bS(t.type,!0),t;default:return""}}function $C(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case th:return"Fragment";case eh:return"Portal";case kC:return"Profiler";case J_:return"StrictMode";case EC:return"Suspense";case NC:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case YF:return(t.displayName||"Context")+".Consumer";case XF:return(t._context.displayName||"Context")+".Provider";case Z_:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case eT:return e=t.displayName||null,e!==null?e:$C(t.type)||"Memo";case Va:e=t._payload,t=t._init;try{return $C(t(e))}catch{}}return null}function M6(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return $C(e);case 8:return e===J_?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function xl(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function JF(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function z6(t){var e=JF(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),s=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){s=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(o){s=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function c0(t){t._valueTracker||(t._valueTracker=z6(t))}function ZF(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),s="";return t&&(s=JF(t)?t.checked?"true":"false":t.value),t=s,t!==n?(e.setValue(t),!0):!1}function Sv(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function RC(t,e){var n=e.checked;return dn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function aA(t,e){var n=e.defaultValue==null?"":e.defaultValue,s=e.checked!=null?e.checked:e.defaultChecked;n=xl(e.value!=null?e.value:n),t._wrapperState={initialChecked:s,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function eL(t,e){e=e.checked,e!=null&&Q_(t,"checked",e,!1)}function AC(t,e){eL(t,e);var n=xl(e.value),s=e.type;if(n!=null)s==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(s==="submit"||s==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?DC(t,e.type,n):e.hasOwnProperty("defaultValue")&&DC(t,e.type,xl(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function lA(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var s=e.type;if(!(s!=="submit"&&s!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function DC(t,e,n){(e!=="number"||Sv(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var lp=Array.isArray;function mh(t,e,n,s){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&s&&(t[n].defaultSelected=!0)}else{for(n=""+xl(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,s&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function OC(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(me(91));return dn({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function uA(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(me(92));if(lp(n)){if(1<n.length)throw Error(me(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:xl(n)}}function tL(t,e){var n=xl(e.value),s=xl(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),s!=null&&(t.defaultValue=""+s)}function cA(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function nL(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function PC(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?nL(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var h0,sL=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,s,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,s,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(h0=h0||document.createElement("div"),h0.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=h0.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Up(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Cp={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},B6=["Webkit","ms","Moz","O"];Object.keys(Cp).forEach(function(t){B6.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Cp[e]=Cp[t]})});function rL(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Cp.hasOwnProperty(t)&&Cp[t]?(""+e).trim():e+"px"}function iL(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var s=n.indexOf("--")===0,r=rL(n,e[n],s);n==="float"&&(n="cssFloat"),s?t.setProperty(n,r):t[n]=r}}var V6=dn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function FC(t,e){if(e){if(V6[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(me(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(me(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(me(61))}if(e.style!=null&&typeof e.style!="object")throw Error(me(62))}}function LC(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var MC=null;function tT(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var zC=null,gh=null,yh=null;function hA(t){if(t=Um(t)){if(typeof zC!="function")throw Error(me(280));var e=t.stateNode;e&&(e=nx(e),zC(t.stateNode,t.type,e))}}function oL(t){gh?yh?yh.push(t):yh=[t]:gh=t}function aL(){if(gh){var t=gh,e=yh;if(yh=gh=null,hA(t),e)for(t=0;t<e.length;t++)hA(e[t])}}function lL(t,e){return t(e)}function uL(){}var SS=!1;function cL(t,e,n){if(SS)return t(e,n);SS=!0;try{return lL(t,e,n)}finally{SS=!1,(gh!==null||yh!==null)&&(uL(),aL())}}function Wp(t,e){var n=t.stateNode;if(n===null)return null;var s=nx(n);if(s===null)return null;n=s[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(t=t.type,s=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!s;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(me(231,e,typeof n));return n}var BC=!1;if(na)try{var Uf={};Object.defineProperty(Uf,"passive",{get:function(){BC=!0}}),window.addEventListener("test",Uf,Uf),window.removeEventListener("test",Uf,Uf)}catch{BC=!1}function U6(t,e,n,s,r,i,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(c){this.onError(c)}}var Ip=!1,Cv=null,Iv=!1,VC=null,W6={onError:function(t){Ip=!0,Cv=t}};function j6(t,e,n,s,r,i,o,a,l){Ip=!1,Cv=null,U6.apply(W6,arguments)}function G6(t,e,n,s,r,i,o,a,l){if(j6.apply(this,arguments),Ip){if(Ip){var u=Cv;Ip=!1,Cv=null}else throw Error(me(198));Iv||(Iv=!0,VC=u)}}function fc(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function hL(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function dA(t){if(fc(t)!==t)throw Error(me(188))}function H6(t){var e=t.alternate;if(!e){if(e=fc(t),e===null)throw Error(me(188));return e!==t?null:t}for(var n=t,s=e;;){var r=n.return;if(r===null)break;var i=r.alternate;if(i===null){if(s=r.return,s!==null){n=s;continue}break}if(r.child===i.child){for(i=r.child;i;){if(i===n)return dA(r),t;if(i===s)return dA(r),e;i=i.sibling}throw Error(me(188))}if(n.return!==s.return)n=r,s=i;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,s=i;break}if(a===s){o=!0,s=r,n=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===n){o=!0,n=i,s=r;break}if(a===s){o=!0,s=i,n=r;break}a=a.sibling}if(!o)throw Error(me(189))}}if(n.alternate!==s)throw Error(me(190))}if(n.tag!==3)throw Error(me(188));return n.stateNode.current===n?t:e}function dL(t){return t=H6(t),t!==null?fL(t):null}function fL(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=fL(t);if(e!==null)return e;t=t.sibling}return null}var pL=Mr.unstable_scheduleCallback,fA=Mr.unstable_cancelCallback,q6=Mr.unstable_shouldYield,K6=Mr.unstable_requestPaint,kn=Mr.unstable_now,X6=Mr.unstable_getCurrentPriorityLevel,nT=Mr.unstable_ImmediatePriority,mL=Mr.unstable_UserBlockingPriority,_v=Mr.unstable_NormalPriority,Y6=Mr.unstable_LowPriority,gL=Mr.unstable_IdlePriority,Jw=null,uo=null;function Q6(t){if(uo&&typeof uo.onCommitFiberRoot=="function")try{uo.onCommitFiberRoot(Jw,t,void 0,(t.current.flags&128)===128)}catch{}}var Ai=Math.clz32?Math.clz32:e5,J6=Math.log,Z6=Math.LN2;function e5(t){return t>>>=0,t===0?32:31-(J6(t)/Z6|0)|0}var d0=64,f0=4194304;function up(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Tv(t,e){var n=t.pendingLanes;if(n===0)return 0;var s=0,r=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~r;a!==0?s=up(a):(i&=o,i!==0&&(s=up(i)))}else o=n&~r,o!==0?s=up(o):i!==0&&(s=up(i));if(s===0)return 0;if(e!==0&&e!==s&&!(e&r)&&(r=s&-s,i=e&-e,r>=i||r===16&&(i&4194240)!==0))return e;if(s&4&&(s|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=s;0<e;)n=31-Ai(e),r=1<<n,s|=t[n],e&=~r;return s}function t5(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function n5(t,e){for(var n=t.suspendedLanes,s=t.pingedLanes,r=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-Ai(i),a=1<<o,l=r[o];l===-1?(!(a&n)||a&s)&&(r[o]=t5(a,e)):l<=e&&(t.expiredLanes|=a),i&=~a}}function UC(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function yL(){var t=d0;return d0<<=1,!(d0&4194240)&&(d0=64),t}function CS(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Bm(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Ai(e),t[e]=n}function s5(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var s=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-Ai(n),i=1<<r;e[r]=0,s[r]=-1,t[r]=-1,n&=~i}}function sT(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var s=31-Ai(n),r=1<<s;r&e|t[s]&e&&(t[s]|=e),n&=~r}}var Rt=0;function vL(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var wL,rT,xL,bL,SL,WC=!1,p0=[],rl=null,il=null,ol=null,jp=new Map,Gp=new Map,ja=[],r5="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function pA(t,e){switch(t){case"focusin":case"focusout":rl=null;break;case"dragenter":case"dragleave":il=null;break;case"mouseover":case"mouseout":ol=null;break;case"pointerover":case"pointerout":jp.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Gp.delete(e.pointerId)}}function Wf(t,e,n,s,r,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:s,nativeEvent:i,targetContainers:[r]},e!==null&&(e=Um(e),e!==null&&rT(e)),t):(t.eventSystemFlags|=s,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function i5(t,e,n,s,r){switch(e){case"focusin":return rl=Wf(rl,t,e,n,s,r),!0;case"dragenter":return il=Wf(il,t,e,n,s,r),!0;case"mouseover":return ol=Wf(ol,t,e,n,s,r),!0;case"pointerover":var i=r.pointerId;return jp.set(i,Wf(jp.get(i)||null,t,e,n,s,r)),!0;case"gotpointercapture":return i=r.pointerId,Gp.set(i,Wf(Gp.get(i)||null,t,e,n,s,r)),!0}return!1}function CL(t){var e=xu(t.target);if(e!==null){var n=fc(e);if(n!==null){if(e=n.tag,e===13){if(e=hL(n),e!==null){t.blockedOn=e,SL(t.priority,function(){xL(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function K0(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=jC(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var s=new n.constructor(n.type,n);MC=s,n.target.dispatchEvent(s),MC=null}else return e=Um(n),e!==null&&rT(e),t.blockedOn=n,!1;e.shift()}return!0}function mA(t,e,n){K0(t)&&n.delete(e)}function o5(){WC=!1,rl!==null&&K0(rl)&&(rl=null),il!==null&&K0(il)&&(il=null),ol!==null&&K0(ol)&&(ol=null),jp.forEach(mA),Gp.forEach(mA)}function jf(t,e){t.blockedOn===e&&(t.blockedOn=null,WC||(WC=!0,Mr.unstable_scheduleCallback(Mr.unstable_NormalPriority,o5)))}function Hp(t){function e(r){return jf(r,t)}if(0<p0.length){jf(p0[0],t);for(var n=1;n<p0.length;n++){var s=p0[n];s.blockedOn===t&&(s.blockedOn=null)}}for(rl!==null&&jf(rl,t),il!==null&&jf(il,t),ol!==null&&jf(ol,t),jp.forEach(e),Gp.forEach(e),n=0;n<ja.length;n++)s=ja[n],s.blockedOn===t&&(s.blockedOn=null);for(;0<ja.length&&(n=ja[0],n.blockedOn===null);)CL(n),n.blockedOn===null&&ja.shift()}var vh=ga.ReactCurrentBatchConfig,kv=!0;function a5(t,e,n,s){var r=Rt,i=vh.transition;vh.transition=null;try{Rt=1,iT(t,e,n,s)}finally{Rt=r,vh.transition=i}}function l5(t,e,n,s){var r=Rt,i=vh.transition;vh.transition=null;try{Rt=4,iT(t,e,n,s)}finally{Rt=r,vh.transition=i}}function iT(t,e,n,s){if(kv){var r=jC(t,e,n,s);if(r===null)DS(t,e,s,Ev,n),pA(t,s);else if(i5(r,t,e,n,s))s.stopPropagation();else if(pA(t,s),e&4&&-1<r5.indexOf(t)){for(;r!==null;){var i=Um(r);if(i!==null&&wL(i),i=jC(t,e,n,s),i===null&&DS(t,e,s,Ev,n),i===r)break;r=i}r!==null&&s.stopPropagation()}else DS(t,e,s,null,n)}}var Ev=null;function jC(t,e,n,s){if(Ev=null,t=tT(s),t=xu(t),t!==null)if(e=fc(t),e===null)t=null;else if(n=e.tag,n===13){if(t=hL(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Ev=t,null}function IL(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(X6()){case nT:return 1;case mL:return 4;case _v:case Y6:return 16;case gL:return 536870912;default:return 16}default:return 16}}var Qa=null,oT=null,X0=null;function _L(){if(X0)return X0;var t,e=oT,n=e.length,s,r="value"in Qa?Qa.value:Qa.textContent,i=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(s=1;s<=o&&e[n-s]===r[i-s];s++);return X0=r.slice(t,1<s?1-s:void 0)}function Y0(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function m0(){return!0}function gA(){return!1}function Ur(t){function e(n,s,r,i,o){this._reactName=n,this._targetInst=r,this.type=s,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?m0:gA,this.isPropagationStopped=gA,this}return dn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=m0)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=m0)},persist:function(){},isPersistent:m0}),e}var rd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},aT=Ur(rd),Vm=dn({},rd,{view:0,detail:0}),u5=Ur(Vm),IS,_S,Gf,Zw=dn({},Vm,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:lT,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Gf&&(Gf&&t.type==="mousemove"?(IS=t.screenX-Gf.screenX,_S=t.screenY-Gf.screenY):_S=IS=0,Gf=t),IS)},movementY:function(t){return"movementY"in t?t.movementY:_S}}),yA=Ur(Zw),c5=dn({},Zw,{dataTransfer:0}),h5=Ur(c5),d5=dn({},Vm,{relatedTarget:0}),TS=Ur(d5),f5=dn({},rd,{animationName:0,elapsedTime:0,pseudoElement:0}),p5=Ur(f5),m5=dn({},rd,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),g5=Ur(m5),y5=dn({},rd,{data:0}),vA=Ur(y5),v5={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},w5={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},x5={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function b5(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=x5[t])?!!e[t]:!1}function lT(){return b5}var S5=dn({},Vm,{key:function(t){if(t.key){var e=v5[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Y0(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?w5[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:lT,charCode:function(t){return t.type==="keypress"?Y0(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Y0(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),C5=Ur(S5),I5=dn({},Zw,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),wA=Ur(I5),_5=dn({},Vm,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:lT}),T5=Ur(_5),k5=dn({},rd,{propertyName:0,elapsedTime:0,pseudoElement:0}),E5=Ur(k5),N5=dn({},Zw,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),$5=Ur(N5),R5=[9,13,27,32],uT=na&&"CompositionEvent"in window,_p=null;na&&"documentMode"in document&&(_p=document.documentMode);var A5=na&&"TextEvent"in window&&!_p,TL=na&&(!uT||_p&&8<_p&&11>=_p),xA=" ",bA=!1;function kL(t,e){switch(t){case"keyup":return R5.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function EL(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var nh=!1;function D5(t,e){switch(t){case"compositionend":return EL(e);case"keypress":return e.which!==32?null:(bA=!0,xA);case"textInput":return t=e.data,t===xA&&bA?null:t;default:return null}}function O5(t,e){if(nh)return t==="compositionend"||!uT&&kL(t,e)?(t=_L(),X0=oT=Qa=null,nh=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return TL&&e.locale!=="ko"?null:e.data;default:return null}}var P5={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function SA(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!P5[t.type]:e==="textarea"}function NL(t,e,n,s){oL(s),e=Nv(e,"onChange"),0<e.length&&(n=new aT("onChange","change",null,n,s),t.push({event:n,listeners:e}))}var Tp=null,qp=null;function F5(t){BL(t,0)}function ex(t){var e=ih(t);if(ZF(e))return t}function L5(t,e){if(t==="change")return e}var $L=!1;if(na){var kS;if(na){var ES="oninput"in document;if(!ES){var CA=document.createElement("div");CA.setAttribute("oninput","return;"),ES=typeof CA.oninput=="function"}kS=ES}else kS=!1;$L=kS&&(!document.documentMode||9<document.documentMode)}function IA(){Tp&&(Tp.detachEvent("onpropertychange",RL),qp=Tp=null)}function RL(t){if(t.propertyName==="value"&&ex(qp)){var e=[];NL(e,qp,t,tT(t)),cL(F5,e)}}function M5(t,e,n){t==="focusin"?(IA(),Tp=e,qp=n,Tp.attachEvent("onpropertychange",RL)):t==="focusout"&&IA()}function z5(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return ex(qp)}function B5(t,e){if(t==="click")return ex(e)}function V5(t,e){if(t==="input"||t==="change")return ex(e)}function U5(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var zi=typeof Object.is=="function"?Object.is:U5;function Kp(t,e){if(zi(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),s=Object.keys(e);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var r=n[s];if(!TC.call(e,r)||!zi(t[r],e[r]))return!1}return!0}function _A(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function TA(t,e){var n=_A(t);t=0;for(var s;n;){if(n.nodeType===3){if(s=t+n.textContent.length,t<=e&&s>=e)return{node:n,offset:e-t};t=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=_A(n)}}function AL(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?AL(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function DL(){for(var t=window,e=Sv();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Sv(t.document)}return e}function cT(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function W5(t){var e=DL(),n=t.focusedElem,s=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&AL(n.ownerDocument.documentElement,n)){if(s!==null&&cT(n)){if(e=s.start,t=s.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,i=Math.min(s.start,r);s=s.end===void 0?i:Math.min(s.end,r),!t.extend&&i>s&&(r=s,s=i,i=r),r=TA(n,i);var o=TA(n,s);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),i>s?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var j5=na&&"documentMode"in document&&11>=document.documentMode,sh=null,GC=null,kp=null,HC=!1;function kA(t,e,n){var s=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;HC||sh==null||sh!==Sv(s)||(s=sh,"selectionStart"in s&&cT(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),kp&&Kp(kp,s)||(kp=s,s=Nv(GC,"onSelect"),0<s.length&&(e=new aT("onSelect","select",null,e,n),t.push({event:e,listeners:s}),e.target=sh)))}function g0(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var rh={animationend:g0("Animation","AnimationEnd"),animationiteration:g0("Animation","AnimationIteration"),animationstart:g0("Animation","AnimationStart"),transitionend:g0("Transition","TransitionEnd")},NS={},OL={};na&&(OL=document.createElement("div").style,"AnimationEvent"in window||(delete rh.animationend.animation,delete rh.animationiteration.animation,delete rh.animationstart.animation),"TransitionEvent"in window||delete rh.transitionend.transition);function tx(t){if(NS[t])return NS[t];if(!rh[t])return t;var e=rh[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in OL)return NS[t]=e[n];return t}var PL=tx("animationend"),FL=tx("animationiteration"),LL=tx("animationstart"),ML=tx("transitionend"),zL=new Map,EA="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ml(t,e){zL.set(t,e),dc(e,[t])}for(var $S=0;$S<EA.length;$S++){var RS=EA[$S],G5=RS.toLowerCase(),H5=RS[0].toUpperCase()+RS.slice(1);Ml(G5,"on"+H5)}Ml(PL,"onAnimationEnd");Ml(FL,"onAnimationIteration");Ml(LL,"onAnimationStart");Ml("dblclick","onDoubleClick");Ml("focusin","onFocus");Ml("focusout","onBlur");Ml(ML,"onTransitionEnd");Nh("onMouseEnter",["mouseout","mouseover"]);Nh("onMouseLeave",["mouseout","mouseover"]);Nh("onPointerEnter",["pointerout","pointerover"]);Nh("onPointerLeave",["pointerout","pointerover"]);dc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));dc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));dc("onBeforeInput",["compositionend","keypress","textInput","paste"]);dc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));dc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));dc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var cp="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),q5=new Set("cancel close invalid load scroll toggle".split(" ").concat(cp));function NA(t,e,n){var s=t.type||"unknown-event";t.currentTarget=n,G6(s,e,void 0,t),t.currentTarget=null}function BL(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var s=t[n],r=s.event;s=s.listeners;e:{var i=void 0;if(e)for(var o=s.length-1;0<=o;o--){var a=s[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==i&&r.isPropagationStopped())break e;NA(r,a,u),i=l}else for(o=0;o<s.length;o++){if(a=s[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==i&&r.isPropagationStopped())break e;NA(r,a,u),i=l}}}if(Iv)throw t=VC,Iv=!1,VC=null,t}function Yt(t,e){var n=e[QC];n===void 0&&(n=e[QC]=new Set);var s=t+"__bubble";n.has(s)||(VL(e,t,2,!1),n.add(s))}function AS(t,e,n){var s=0;e&&(s|=4),VL(n,t,s,e)}var y0="_reactListening"+Math.random().toString(36).slice(2);function Xp(t){if(!t[y0]){t[y0]=!0,KF.forEach(function(n){n!=="selectionchange"&&(q5.has(n)||AS(n,!1,t),AS(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[y0]||(e[y0]=!0,AS("selectionchange",!1,e))}}function VL(t,e,n,s){switch(IL(e)){case 1:var r=a5;break;case 4:r=l5;break;default:r=iT}n=r.bind(null,e,n,t),r=void 0,!BC||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),s?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function DS(t,e,n,s,r){var i=s;if(!(e&1)&&!(e&2)&&s!==null)e:for(;;){if(s===null)return;var o=s.tag;if(o===3||o===4){var a=s.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=s.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;o=o.return}for(;a!==null;){if(o=xu(a),o===null)return;if(l=o.tag,l===5||l===6){s=i=o;continue e}a=a.parentNode}}s=s.return}cL(function(){var u=i,c=tT(n),h=[];e:{var d=zL.get(t);if(d!==void 0){var f=aT,p=t;switch(t){case"keypress":if(Y0(n)===0)break e;case"keydown":case"keyup":f=C5;break;case"focusin":p="focus",f=TS;break;case"focusout":p="blur",f=TS;break;case"beforeblur":case"afterblur":f=TS;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=yA;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=h5;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=T5;break;case PL:case FL:case LL:f=p5;break;case ML:f=E5;break;case"scroll":f=u5;break;case"wheel":f=$5;break;case"copy":case"cut":case"paste":f=g5;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=wA}var m=(e&4)!==0,v=!m&&t==="scroll",g=m?d!==null?d+"Capture":null:d;m=[];for(var w=u,b;w!==null;){b=w;var x=b.stateNode;if(b.tag===5&&x!==null&&(b=x,g!==null&&(x=Wp(w,g),x!=null&&m.push(Yp(w,x,b)))),v)break;w=w.return}0<m.length&&(d=new f(d,p,null,n,c),h.push({event:d,listeners:m}))}}if(!(e&7)){e:{if(d=t==="mouseover"||t==="pointerover",f=t==="mouseout"||t==="pointerout",d&&n!==MC&&(p=n.relatedTarget||n.fromElement)&&(xu(p)||p[sa]))break e;if((f||d)&&(d=c.window===c?c:(d=c.ownerDocument)?d.defaultView||d.parentWindow:window,f?(p=n.relatedTarget||n.toElement,f=u,p=p?xu(p):null,p!==null&&(v=fc(p),p!==v||p.tag!==5&&p.tag!==6)&&(p=null)):(f=null,p=u),f!==p)){if(m=yA,x="onMouseLeave",g="onMouseEnter",w="mouse",(t==="pointerout"||t==="pointerover")&&(m=wA,x="onPointerLeave",g="onPointerEnter",w="pointer"),v=f==null?d:ih(f),b=p==null?d:ih(p),d=new m(x,w+"leave",f,n,c),d.target=v,d.relatedTarget=b,x=null,xu(c)===u&&(m=new m(g,w+"enter",p,n,c),m.target=b,m.relatedTarget=v,x=m),v=x,f&&p)t:{for(m=f,g=p,w=0,b=m;b;b=Hc(b))w++;for(b=0,x=g;x;x=Hc(x))b++;for(;0<w-b;)m=Hc(m),w--;for(;0<b-w;)g=Hc(g),b--;for(;w--;){if(m===g||g!==null&&m===g.alternate)break t;m=Hc(m),g=Hc(g)}m=null}else m=null;f!==null&&$A(h,d,f,m,!1),p!==null&&v!==null&&$A(h,v,p,m,!0)}}e:{if(d=u?ih(u):window,f=d.nodeName&&d.nodeName.toLowerCase(),f==="select"||f==="input"&&d.type==="file")var S=L5;else if(SA(d))if($L)S=V5;else{S=z5;var N=M5}else(f=d.nodeName)&&f.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(S=B5);if(S&&(S=S(t,u))){NL(h,S,n,c);break e}N&&N(t,d,u),t==="focusout"&&(N=d._wrapperState)&&N.controlled&&d.type==="number"&&DC(d,"number",d.value)}switch(N=u?ih(u):window,t){case"focusin":(SA(N)||N.contentEditable==="true")&&(sh=N,GC=u,kp=null);break;case"focusout":kp=GC=sh=null;break;case"mousedown":HC=!0;break;case"contextmenu":case"mouseup":case"dragend":HC=!1,kA(h,n,c);break;case"selectionchange":if(j5)break;case"keydown":case"keyup":kA(h,n,c)}var I;if(uT)e:{switch(t){case"compositionstart":var C="onCompositionStart";break e;case"compositionend":C="onCompositionEnd";break e;case"compositionupdate":C="onCompositionUpdate";break e}C=void 0}else nh?kL(t,n)&&(C="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(C="onCompositionStart");C&&(TL&&n.locale!=="ko"&&(nh||C!=="onCompositionStart"?C==="onCompositionEnd"&&nh&&(I=_L()):(Qa=c,oT="value"in Qa?Qa.value:Qa.textContent,nh=!0)),N=Nv(u,C),0<N.length&&(C=new vA(C,t,null,n,c),h.push({event:C,listeners:N}),I?C.data=I:(I=EL(n),I!==null&&(C.data=I)))),(I=A5?D5(t,n):O5(t,n))&&(u=Nv(u,"onBeforeInput"),0<u.length&&(c=new vA("onBeforeInput","beforeinput",null,n,c),h.push({event:c,listeners:u}),c.data=I))}BL(h,e)})}function Yp(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Nv(t,e){for(var n=e+"Capture",s=[];t!==null;){var r=t,i=r.stateNode;r.tag===5&&i!==null&&(r=i,i=Wp(t,n),i!=null&&s.unshift(Yp(t,i,r)),i=Wp(t,e),i!=null&&s.push(Yp(t,i,r))),t=t.return}return s}function Hc(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function $A(t,e,n,s,r){for(var i=e._reactName,o=[];n!==null&&n!==s;){var a=n,l=a.alternate,u=a.stateNode;if(l!==null&&l===s)break;a.tag===5&&u!==null&&(a=u,r?(l=Wp(n,i),l!=null&&o.unshift(Yp(n,l,a))):r||(l=Wp(n,i),l!=null&&o.push(Yp(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var K5=/\r\n?/g,X5=/\u0000|\uFFFD/g;function RA(t){return(typeof t=="string"?t:""+t).replace(K5,`
`).replace(X5,"")}function v0(t,e,n){if(e=RA(e),RA(t)!==e&&n)throw Error(me(425))}function $v(){}var qC=null,KC=null;function XC(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var YC=typeof setTimeout=="function"?setTimeout:void 0,Y5=typeof clearTimeout=="function"?clearTimeout:void 0,AA=typeof Promise=="function"?Promise:void 0,Q5=typeof queueMicrotask=="function"?queueMicrotask:typeof AA<"u"?function(t){return AA.resolve(null).then(t).catch(J5)}:YC;function J5(t){setTimeout(function(){throw t})}function OS(t,e){var n=e,s=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(s===0){t.removeChild(r),Hp(e);return}s--}else n!=="$"&&n!=="$?"&&n!=="$!"||s++;n=r}while(n);Hp(e)}function al(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function DA(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var id=Math.random().toString(36).slice(2),io="__reactFiber$"+id,Qp="__reactProps$"+id,sa="__reactContainer$"+id,QC="__reactEvents$"+id,Z5="__reactListeners$"+id,e9="__reactHandles$"+id;function xu(t){var e=t[io];if(e)return e;for(var n=t.parentNode;n;){if(e=n[sa]||n[io]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=DA(t);t!==null;){if(n=t[io])return n;t=DA(t)}return e}t=n,n=t.parentNode}return null}function Um(t){return t=t[io]||t[sa],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function ih(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(me(33))}function nx(t){return t[Qp]||null}var JC=[],oh=-1;function zl(t){return{current:t}}function Qt(t){0>oh||(t.current=JC[oh],JC[oh]=null,oh--)}function Ht(t,e){oh++,JC[oh]=t.current,t.current=e}var bl={},Os=zl(bl),fr=zl(!1),Fu=bl;function $h(t,e){var n=t.type.contextTypes;if(!n)return bl;var s=t.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===e)return s.__reactInternalMemoizedMaskedChildContext;var r={},i;for(i in n)r[i]=e[i];return s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function pr(t){return t=t.childContextTypes,t!=null}function Rv(){Qt(fr),Qt(Os)}function OA(t,e,n){if(Os.current!==bl)throw Error(me(168));Ht(Os,e),Ht(fr,n)}function UL(t,e,n){var s=t.stateNode;if(e=e.childContextTypes,typeof s.getChildContext!="function")return n;s=s.getChildContext();for(var r in s)if(!(r in e))throw Error(me(108,M6(t)||"Unknown",r));return dn({},n,s)}function Av(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||bl,Fu=Os.current,Ht(Os,t),Ht(fr,fr.current),!0}function PA(t,e,n){var s=t.stateNode;if(!s)throw Error(me(169));n?(t=UL(t,e,Fu),s.__reactInternalMemoizedMergedChildContext=t,Qt(fr),Qt(Os),Ht(Os,t)):Qt(fr),Ht(fr,n)}var Bo=null,sx=!1,PS=!1;function WL(t){Bo===null?Bo=[t]:Bo.push(t)}function t9(t){sx=!0,WL(t)}function Bl(){if(!PS&&Bo!==null){PS=!0;var t=0,e=Rt;try{var n=Bo;for(Rt=1;t<n.length;t++){var s=n[t];do s=s(!0);while(s!==null)}Bo=null,sx=!1}catch(r){throw Bo!==null&&(Bo=Bo.slice(t+1)),pL(nT,Bl),r}finally{Rt=e,PS=!1}}return null}var ah=[],lh=0,Dv=null,Ov=0,Qr=[],Jr=0,Lu=null,Ho=1,qo="";function lu(t,e){ah[lh++]=Ov,ah[lh++]=Dv,Dv=t,Ov=e}function jL(t,e,n){Qr[Jr++]=Ho,Qr[Jr++]=qo,Qr[Jr++]=Lu,Lu=t;var s=Ho;t=qo;var r=32-Ai(s)-1;s&=~(1<<r),n+=1;var i=32-Ai(e)+r;if(30<i){var o=r-r%5;i=(s&(1<<o)-1).toString(32),s>>=o,r-=o,Ho=1<<32-Ai(e)+r|n<<r|s,qo=i+t}else Ho=1<<i|n<<r|s,qo=t}function hT(t){t.return!==null&&(lu(t,1),jL(t,1,0))}function dT(t){for(;t===Dv;)Dv=ah[--lh],ah[lh]=null,Ov=ah[--lh],ah[lh]=null;for(;t===Lu;)Lu=Qr[--Jr],Qr[Jr]=null,qo=Qr[--Jr],Qr[Jr]=null,Ho=Qr[--Jr],Qr[Jr]=null}var Pr=null,Rr=null,tn=!1,Ci=null;function GL(t,e){var n=Zr(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function FA(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Pr=t,Rr=al(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Pr=t,Rr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Lu!==null?{id:Ho,overflow:qo}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Zr(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Pr=t,Rr=null,!0):!1;default:return!1}}function ZC(t){return(t.mode&1)!==0&&(t.flags&128)===0}function eI(t){if(tn){var e=Rr;if(e){var n=e;if(!FA(t,e)){if(ZC(t))throw Error(me(418));e=al(n.nextSibling);var s=Pr;e&&FA(t,e)?GL(s,n):(t.flags=t.flags&-4097|2,tn=!1,Pr=t)}}else{if(ZC(t))throw Error(me(418));t.flags=t.flags&-4097|2,tn=!1,Pr=t}}}function LA(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Pr=t}function w0(t){if(t!==Pr)return!1;if(!tn)return LA(t),tn=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!XC(t.type,t.memoizedProps)),e&&(e=Rr)){if(ZC(t))throw HL(),Error(me(418));for(;e;)GL(t,e),e=al(e.nextSibling)}if(LA(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(me(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Rr=al(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Rr=null}}else Rr=Pr?al(t.stateNode.nextSibling):null;return!0}function HL(){for(var t=Rr;t;)t=al(t.nextSibling)}function Rh(){Rr=Pr=null,tn=!1}function fT(t){Ci===null?Ci=[t]:Ci.push(t)}var n9=ga.ReactCurrentBatchConfig;function Hf(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(me(309));var s=n.stateNode}if(!s)throw Error(me(147,t));var r=s,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=r.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(me(284));if(!n._owner)throw Error(me(290,t))}return t}function x0(t,e){throw t=Object.prototype.toString.call(e),Error(me(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function MA(t){var e=t._init;return e(t._payload)}function qL(t){function e(g,w){if(t){var b=g.deletions;b===null?(g.deletions=[w],g.flags|=16):b.push(w)}}function n(g,w){if(!t)return null;for(;w!==null;)e(g,w),w=w.sibling;return null}function s(g,w){for(g=new Map;w!==null;)w.key!==null?g.set(w.key,w):g.set(w.index,w),w=w.sibling;return g}function r(g,w){return g=hl(g,w),g.index=0,g.sibling=null,g}function i(g,w,b){return g.index=b,t?(b=g.alternate,b!==null?(b=b.index,b<w?(g.flags|=2,w):b):(g.flags|=2,w)):(g.flags|=1048576,w)}function o(g){return t&&g.alternate===null&&(g.flags|=2),g}function a(g,w,b,x){return w===null||w.tag!==6?(w=US(b,g.mode,x),w.return=g,w):(w=r(w,b),w.return=g,w)}function l(g,w,b,x){var S=b.type;return S===th?c(g,w,b.props.children,x,b.key):w!==null&&(w.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Va&&MA(S)===w.type)?(x=r(w,b.props),x.ref=Hf(g,w,b),x.return=g,x):(x=sv(b.type,b.key,b.props,null,g.mode,x),x.ref=Hf(g,w,b),x.return=g,x)}function u(g,w,b,x){return w===null||w.tag!==4||w.stateNode.containerInfo!==b.containerInfo||w.stateNode.implementation!==b.implementation?(w=WS(b,g.mode,x),w.return=g,w):(w=r(w,b.children||[]),w.return=g,w)}function c(g,w,b,x,S){return w===null||w.tag!==7?(w=$u(b,g.mode,x,S),w.return=g,w):(w=r(w,b),w.return=g,w)}function h(g,w,b){if(typeof w=="string"&&w!==""||typeof w=="number")return w=US(""+w,g.mode,b),w.return=g,w;if(typeof w=="object"&&w!==null){switch(w.$$typeof){case u0:return b=sv(w.type,w.key,w.props,null,g.mode,b),b.ref=Hf(g,null,w),b.return=g,b;case eh:return w=WS(w,g.mode,b),w.return=g,w;case Va:var x=w._init;return h(g,x(w._payload),b)}if(lp(w)||Vf(w))return w=$u(w,g.mode,b,null),w.return=g,w;x0(g,w)}return null}function d(g,w,b,x){var S=w!==null?w.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return S!==null?null:a(g,w,""+b,x);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case u0:return b.key===S?l(g,w,b,x):null;case eh:return b.key===S?u(g,w,b,x):null;case Va:return S=b._init,d(g,w,S(b._payload),x)}if(lp(b)||Vf(b))return S!==null?null:c(g,w,b,x,null);x0(g,b)}return null}function f(g,w,b,x,S){if(typeof x=="string"&&x!==""||typeof x=="number")return g=g.get(b)||null,a(w,g,""+x,S);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case u0:return g=g.get(x.key===null?b:x.key)||null,l(w,g,x,S);case eh:return g=g.get(x.key===null?b:x.key)||null,u(w,g,x,S);case Va:var N=x._init;return f(g,w,b,N(x._payload),S)}if(lp(x)||Vf(x))return g=g.get(b)||null,c(w,g,x,S,null);x0(w,x)}return null}function p(g,w,b,x){for(var S=null,N=null,I=w,C=w=0,_=null;I!==null&&C<b.length;C++){I.index>C?(_=I,I=null):_=I.sibling;var k=d(g,I,b[C],x);if(k===null){I===null&&(I=_);break}t&&I&&k.alternate===null&&e(g,I),w=i(k,w,C),N===null?S=k:N.sibling=k,N=k,I=_}if(C===b.length)return n(g,I),tn&&lu(g,C),S;if(I===null){for(;C<b.length;C++)I=h(g,b[C],x),I!==null&&(w=i(I,w,C),N===null?S=I:N.sibling=I,N=I);return tn&&lu(g,C),S}for(I=s(g,I);C<b.length;C++)_=f(I,g,C,b[C],x),_!==null&&(t&&_.alternate!==null&&I.delete(_.key===null?C:_.key),w=i(_,w,C),N===null?S=_:N.sibling=_,N=_);return t&&I.forEach(function(A){return e(g,A)}),tn&&lu(g,C),S}function m(g,w,b,x){var S=Vf(b);if(typeof S!="function")throw Error(me(150));if(b=S.call(b),b==null)throw Error(me(151));for(var N=S=null,I=w,C=w=0,_=null,k=b.next();I!==null&&!k.done;C++,k=b.next()){I.index>C?(_=I,I=null):_=I.sibling;var A=d(g,I,k.value,x);if(A===null){I===null&&(I=_);break}t&&I&&A.alternate===null&&e(g,I),w=i(A,w,C),N===null?S=A:N.sibling=A,N=A,I=_}if(k.done)return n(g,I),tn&&lu(g,C),S;if(I===null){for(;!k.done;C++,k=b.next())k=h(g,k.value,x),k!==null&&(w=i(k,w,C),N===null?S=k:N.sibling=k,N=k);return tn&&lu(g,C),S}for(I=s(g,I);!k.done;C++,k=b.next())k=f(I,g,C,k.value,x),k!==null&&(t&&k.alternate!==null&&I.delete(k.key===null?C:k.key),w=i(k,w,C),N===null?S=k:N.sibling=k,N=k);return t&&I.forEach(function(D){return e(g,D)}),tn&&lu(g,C),S}function v(g,w,b,x){if(typeof b=="object"&&b!==null&&b.type===th&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case u0:e:{for(var S=b.key,N=w;N!==null;){if(N.key===S){if(S=b.type,S===th){if(N.tag===7){n(g,N.sibling),w=r(N,b.props.children),w.return=g,g=w;break e}}else if(N.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Va&&MA(S)===N.type){n(g,N.sibling),w=r(N,b.props),w.ref=Hf(g,N,b),w.return=g,g=w;break e}n(g,N);break}else e(g,N);N=N.sibling}b.type===th?(w=$u(b.props.children,g.mode,x,b.key),w.return=g,g=w):(x=sv(b.type,b.key,b.props,null,g.mode,x),x.ref=Hf(g,w,b),x.return=g,g=x)}return o(g);case eh:e:{for(N=b.key;w!==null;){if(w.key===N)if(w.tag===4&&w.stateNode.containerInfo===b.containerInfo&&w.stateNode.implementation===b.implementation){n(g,w.sibling),w=r(w,b.children||[]),w.return=g,g=w;break e}else{n(g,w);break}else e(g,w);w=w.sibling}w=WS(b,g.mode,x),w.return=g,g=w}return o(g);case Va:return N=b._init,v(g,w,N(b._payload),x)}if(lp(b))return p(g,w,b,x);if(Vf(b))return m(g,w,b,x);x0(g,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,w!==null&&w.tag===6?(n(g,w.sibling),w=r(w,b),w.return=g,g=w):(n(g,w),w=US(b,g.mode,x),w.return=g,g=w),o(g)):n(g,w)}return v}var Ah=qL(!0),KL=qL(!1),Pv=zl(null),Fv=null,uh=null,pT=null;function mT(){pT=uh=Fv=null}function gT(t){var e=Pv.current;Qt(Pv),t._currentValue=e}function tI(t,e,n){for(;t!==null;){var s=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,s!==null&&(s.childLanes|=e)):s!==null&&(s.childLanes&e)!==e&&(s.childLanes|=e),t===n)break;t=t.return}}function wh(t,e){Fv=t,pT=uh=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(cr=!0),t.firstContext=null)}function ai(t){var e=t._currentValue;if(pT!==t)if(t={context:t,memoizedValue:e,next:null},uh===null){if(Fv===null)throw Error(me(308));uh=t,Fv.dependencies={lanes:0,firstContext:t}}else uh=uh.next=t;return e}var bu=null;function yT(t){bu===null?bu=[t]:bu.push(t)}function XL(t,e,n,s){var r=e.interleaved;return r===null?(n.next=n,yT(e)):(n.next=r.next,r.next=n),e.interleaved=n,ra(t,s)}function ra(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Ua=!1;function vT(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function YL(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Jo(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function ll(t,e,n){var s=t.updateQueue;if(s===null)return null;if(s=s.shared,wt&2){var r=s.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),s.pending=e,ra(t,n)}return r=s.interleaved,r===null?(e.next=e,yT(s)):(e.next=r.next,r.next=e),s.interleaved=e,ra(t,n)}function Q0(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var s=e.lanes;s&=t.pendingLanes,n|=s,e.lanes=n,sT(t,n)}}function zA(t,e){var n=t.updateQueue,s=t.alternate;if(s!==null&&(s=s.updateQueue,n===s)){var r=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?r=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?r=i=e:i=i.next=e}else r=i=e;n={baseState:s.baseState,firstBaseUpdate:r,lastBaseUpdate:i,shared:s.shared,effects:s.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Lv(t,e,n,s){var r=t.updateQueue;Ua=!1;var i=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?i=u:o.next=u,o=l;var c=t.alternate;c!==null&&(c=c.updateQueue,a=c.lastBaseUpdate,a!==o&&(a===null?c.firstBaseUpdate=u:a.next=u,c.lastBaseUpdate=l))}if(i!==null){var h=r.baseState;o=0,c=u=l=null,a=i;do{var d=a.lane,f=a.eventTime;if((s&d)===d){c!==null&&(c=c.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=t,m=a;switch(d=e,f=n,m.tag){case 1:if(p=m.payload,typeof p=="function"){h=p.call(f,h,d);break e}h=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=m.payload,d=typeof p=="function"?p.call(f,h,d):p,d==null)break e;h=dn({},h,d);break e;case 2:Ua=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,d=r.effects,d===null?r.effects=[a]:d.push(a))}else f={eventTime:f,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},c===null?(u=c=f,l=h):c=c.next=f,o|=d;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;d=a,a=d.next,d.next=null,r.lastBaseUpdate=d,r.shared.pending=null}}while(!0);if(c===null&&(l=h),r.baseState=l,r.firstBaseUpdate=u,r.lastBaseUpdate=c,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else i===null&&(r.shared.lanes=0);zu|=o,t.lanes=o,t.memoizedState=h}}function BA(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var s=t[e],r=s.callback;if(r!==null){if(s.callback=null,s=n,typeof r!="function")throw Error(me(191,r));r.call(s)}}}var Wm={},co=zl(Wm),Jp=zl(Wm),Zp=zl(Wm);function Su(t){if(t===Wm)throw Error(me(174));return t}function wT(t,e){switch(Ht(Zp,e),Ht(Jp,t),Ht(co,Wm),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:PC(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=PC(e,t)}Qt(co),Ht(co,e)}function Dh(){Qt(co),Qt(Jp),Qt(Zp)}function QL(t){Su(Zp.current);var e=Su(co.current),n=PC(e,t.type);e!==n&&(Ht(Jp,t),Ht(co,n))}function xT(t){Jp.current===t&&(Qt(co),Qt(Jp))}var un=zl(0);function Mv(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var FS=[];function bT(){for(var t=0;t<FS.length;t++)FS[t]._workInProgressVersionPrimary=null;FS.length=0}var J0=ga.ReactCurrentDispatcher,LS=ga.ReactCurrentBatchConfig,Mu=0,hn=null,Bn=null,es=null,zv=!1,Ep=!1,em=0,s9=0;function ks(){throw Error(me(321))}function ST(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!zi(t[n],e[n]))return!1;return!0}function CT(t,e,n,s,r,i){if(Mu=i,hn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,J0.current=t===null||t.memoizedState===null?a9:l9,t=n(s,r),Ep){i=0;do{if(Ep=!1,em=0,25<=i)throw Error(me(301));i+=1,es=Bn=null,e.updateQueue=null,J0.current=u9,t=n(s,r)}while(Ep)}if(J0.current=Bv,e=Bn!==null&&Bn.next!==null,Mu=0,es=Bn=hn=null,zv=!1,e)throw Error(me(300));return t}function IT(){var t=em!==0;return em=0,t}function to(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return es===null?hn.memoizedState=es=t:es=es.next=t,es}function li(){if(Bn===null){var t=hn.alternate;t=t!==null?t.memoizedState:null}else t=Bn.next;var e=es===null?hn.memoizedState:es.next;if(e!==null)es=e,Bn=t;else{if(t===null)throw Error(me(310));Bn=t,t={memoizedState:Bn.memoizedState,baseState:Bn.baseState,baseQueue:Bn.baseQueue,queue:Bn.queue,next:null},es===null?hn.memoizedState=es=t:es=es.next=t}return es}function tm(t,e){return typeof e=="function"?e(t):e}function MS(t){var e=li(),n=e.queue;if(n===null)throw Error(me(311));n.lastRenderedReducer=t;var s=Bn,r=s.baseQueue,i=n.pending;if(i!==null){if(r!==null){var o=r.next;r.next=i.next,i.next=o}s.baseQueue=r=i,n.pending=null}if(r!==null){i=r.next,s=s.baseState;var a=o=null,l=null,u=i;do{var c=u.lane;if((Mu&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),s=u.hasEagerState?u.eagerState:t(s,u.action);else{var h={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=h,o=s):l=l.next=h,hn.lanes|=c,zu|=c}u=u.next}while(u!==null&&u!==i);l===null?o=s:l.next=a,zi(s,e.memoizedState)||(cr=!0),e.memoizedState=s,e.baseState=o,e.baseQueue=l,n.lastRenderedState=s}if(t=n.interleaved,t!==null){r=t;do i=r.lane,hn.lanes|=i,zu|=i,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function zS(t){var e=li(),n=e.queue;if(n===null)throw Error(me(311));n.lastRenderedReducer=t;var s=n.dispatch,r=n.pending,i=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do i=t(i,o.action),o=o.next;while(o!==r);zi(i,e.memoizedState)||(cr=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,s]}function JL(){}function ZL(t,e){var n=hn,s=li(),r=e(),i=!zi(s.memoizedState,r);if(i&&(s.memoizedState=r,cr=!0),s=s.queue,_T(nM.bind(null,n,s,t),[t]),s.getSnapshot!==e||i||es!==null&&es.memoizedState.tag&1){if(n.flags|=2048,nm(9,tM.bind(null,n,s,r,e),void 0,null),as===null)throw Error(me(349));Mu&30||eM(n,e,r)}return r}function eM(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=hn.updateQueue,e===null?(e={lastEffect:null,stores:null},hn.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function tM(t,e,n,s){e.value=n,e.getSnapshot=s,sM(e)&&rM(t)}function nM(t,e,n){return n(function(){sM(e)&&rM(t)})}function sM(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!zi(t,n)}catch{return!0}}function rM(t){var e=ra(t,1);e!==null&&Di(e,t,1,-1)}function VA(t){var e=to();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:tm,lastRenderedState:t},e.queue=t,t=t.dispatch=o9.bind(null,hn,t),[e.memoizedState,t]}function nm(t,e,n,s){return t={tag:t,create:e,destroy:n,deps:s,next:null},e=hn.updateQueue,e===null?(e={lastEffect:null,stores:null},hn.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(s=n.next,n.next=t,t.next=s,e.lastEffect=t)),t}function iM(){return li().memoizedState}function Z0(t,e,n,s){var r=to();hn.flags|=t,r.memoizedState=nm(1|e,n,void 0,s===void 0?null:s)}function rx(t,e,n,s){var r=li();s=s===void 0?null:s;var i=void 0;if(Bn!==null){var o=Bn.memoizedState;if(i=o.destroy,s!==null&&ST(s,o.deps)){r.memoizedState=nm(e,n,i,s);return}}hn.flags|=t,r.memoizedState=nm(1|e,n,i,s)}function UA(t,e){return Z0(8390656,8,t,e)}function _T(t,e){return rx(2048,8,t,e)}function oM(t,e){return rx(4,2,t,e)}function aM(t,e){return rx(4,4,t,e)}function lM(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function uM(t,e,n){return n=n!=null?n.concat([t]):null,rx(4,4,lM.bind(null,e,t),n)}function TT(){}function cM(t,e){var n=li();e=e===void 0?null:e;var s=n.memoizedState;return s!==null&&e!==null&&ST(e,s[1])?s[0]:(n.memoizedState=[t,e],t)}function hM(t,e){var n=li();e=e===void 0?null:e;var s=n.memoizedState;return s!==null&&e!==null&&ST(e,s[1])?s[0]:(t=t(),n.memoizedState=[t,e],t)}function dM(t,e,n){return Mu&21?(zi(n,e)||(n=yL(),hn.lanes|=n,zu|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,cr=!0),t.memoizedState=n)}function r9(t,e){var n=Rt;Rt=n!==0&&4>n?n:4,t(!0);var s=LS.transition;LS.transition={};try{t(!1),e()}finally{Rt=n,LS.transition=s}}function fM(){return li().memoizedState}function i9(t,e,n){var s=cl(t);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},pM(t))mM(e,n);else if(n=XL(t,e,n,s),n!==null){var r=Gs();Di(n,t,s,r),gM(n,e,s)}}function o9(t,e,n){var s=cl(t),r={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if(pM(t))mM(e,r);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,n);if(r.hasEagerState=!0,r.eagerState=a,zi(a,o)){var l=e.interleaved;l===null?(r.next=r,yT(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}n=XL(t,e,r,s),n!==null&&(r=Gs(),Di(n,t,s,r),gM(n,e,s))}}function pM(t){var e=t.alternate;return t===hn||e!==null&&e===hn}function mM(t,e){Ep=zv=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function gM(t,e,n){if(n&4194240){var s=e.lanes;s&=t.pendingLanes,n|=s,e.lanes=n,sT(t,n)}}var Bv={readContext:ai,useCallback:ks,useContext:ks,useEffect:ks,useImperativeHandle:ks,useInsertionEffect:ks,useLayoutEffect:ks,useMemo:ks,useReducer:ks,useRef:ks,useState:ks,useDebugValue:ks,useDeferredValue:ks,useTransition:ks,useMutableSource:ks,useSyncExternalStore:ks,useId:ks,unstable_isNewReconciler:!1},a9={readContext:ai,useCallback:function(t,e){return to().memoizedState=[t,e===void 0?null:e],t},useContext:ai,useEffect:UA,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Z0(4194308,4,lM.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Z0(4194308,4,t,e)},useInsertionEffect:function(t,e){return Z0(4,2,t,e)},useMemo:function(t,e){var n=to();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var s=to();return e=n!==void 0?n(e):e,s.memoizedState=s.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},s.queue=t,t=t.dispatch=i9.bind(null,hn,t),[s.memoizedState,t]},useRef:function(t){var e=to();return t={current:t},e.memoizedState=t},useState:VA,useDebugValue:TT,useDeferredValue:function(t){return to().memoizedState=t},useTransition:function(){var t=VA(!1),e=t[0];return t=r9.bind(null,t[1]),to().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var s=hn,r=to();if(tn){if(n===void 0)throw Error(me(407));n=n()}else{if(n=e(),as===null)throw Error(me(349));Mu&30||eM(s,e,n)}r.memoizedState=n;var i={value:n,getSnapshot:e};return r.queue=i,UA(nM.bind(null,s,i,t),[t]),s.flags|=2048,nm(9,tM.bind(null,s,i,n,e),void 0,null),n},useId:function(){var t=to(),e=as.identifierPrefix;if(tn){var n=qo,s=Ho;n=(s&~(1<<32-Ai(s)-1)).toString(32)+n,e=":"+e+"R"+n,n=em++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=s9++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},l9={readContext:ai,useCallback:cM,useContext:ai,useEffect:_T,useImperativeHandle:uM,useInsertionEffect:oM,useLayoutEffect:aM,useMemo:hM,useReducer:MS,useRef:iM,useState:function(){return MS(tm)},useDebugValue:TT,useDeferredValue:function(t){var e=li();return dM(e,Bn.memoizedState,t)},useTransition:function(){var t=MS(tm)[0],e=li().memoizedState;return[t,e]},useMutableSource:JL,useSyncExternalStore:ZL,useId:fM,unstable_isNewReconciler:!1},u9={readContext:ai,useCallback:cM,useContext:ai,useEffect:_T,useImperativeHandle:uM,useInsertionEffect:oM,useLayoutEffect:aM,useMemo:hM,useReducer:zS,useRef:iM,useState:function(){return zS(tm)},useDebugValue:TT,useDeferredValue:function(t){var e=li();return Bn===null?e.memoizedState=t:dM(e,Bn.memoizedState,t)},useTransition:function(){var t=zS(tm)[0],e=li().memoizedState;return[t,e]},useMutableSource:JL,useSyncExternalStore:ZL,useId:fM,unstable_isNewReconciler:!1};function wi(t,e){if(t&&t.defaultProps){e=dn({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function nI(t,e,n,s){e=t.memoizedState,n=n(s,e),n=n==null?e:dn({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var ix={isMounted:function(t){return(t=t._reactInternals)?fc(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var s=Gs(),r=cl(t),i=Jo(s,r);i.payload=e,n!=null&&(i.callback=n),e=ll(t,i,r),e!==null&&(Di(e,t,r,s),Q0(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var s=Gs(),r=cl(t),i=Jo(s,r);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=ll(t,i,r),e!==null&&(Di(e,t,r,s),Q0(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Gs(),s=cl(t),r=Jo(n,s);r.tag=2,e!=null&&(r.callback=e),e=ll(t,r,s),e!==null&&(Di(e,t,s,n),Q0(e,t,s))}};function WA(t,e,n,s,r,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(s,i,o):e.prototype&&e.prototype.isPureReactComponent?!Kp(n,s)||!Kp(r,i):!0}function yM(t,e,n){var s=!1,r=bl,i=e.contextType;return typeof i=="object"&&i!==null?i=ai(i):(r=pr(e)?Fu:Os.current,s=e.contextTypes,i=(s=s!=null)?$h(t,r):bl),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=ix,t.stateNode=e,e._reactInternals=t,s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=i),e}function jA(t,e,n,s){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,s),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,s),e.state!==t&&ix.enqueueReplaceState(e,e.state,null)}function sI(t,e,n,s){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs={},vT(t);var i=e.contextType;typeof i=="object"&&i!==null?r.context=ai(i):(i=pr(e)?Fu:Os.current,r.context=$h(t,i)),r.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(nI(t,e,i,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&ix.enqueueReplaceState(r,r.state,null),Lv(t,n,r,s),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function Oh(t,e){try{var n="",s=e;do n+=L6(s),s=s.return;while(s);var r=n}catch(i){r=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:r,digest:null}}function BS(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function rI(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var c9=typeof WeakMap=="function"?WeakMap:Map;function vM(t,e,n){n=Jo(-1,n),n.tag=3,n.payload={element:null};var s=e.value;return n.callback=function(){Uv||(Uv=!0,pI=s),rI(t,e)},n}function wM(t,e,n){n=Jo(-1,n),n.tag=3;var s=t.type.getDerivedStateFromError;if(typeof s=="function"){var r=e.value;n.payload=function(){return s(r)},n.callback=function(){rI(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){rI(t,e),typeof s!="function"&&(ul===null?ul=new Set([this]):ul.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function GA(t,e,n){var s=t.pingCache;if(s===null){s=t.pingCache=new c9;var r=new Set;s.set(e,r)}else r=s.get(e),r===void 0&&(r=new Set,s.set(e,r));r.has(n)||(r.add(n),t=I9.bind(null,t,e,n),e.then(t,t))}function HA(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function qA(t,e,n,s,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Jo(-1,1),e.tag=2,ll(n,e,1))),n.lanes|=1),t)}var h9=ga.ReactCurrentOwner,cr=!1;function Vs(t,e,n,s){e.child=t===null?KL(e,null,n,s):Ah(e,t.child,n,s)}function KA(t,e,n,s,r){n=n.render;var i=e.ref;return wh(e,r),s=CT(t,e,n,s,i,r),n=IT(),t!==null&&!cr?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,ia(t,e,r)):(tn&&n&&hT(e),e.flags|=1,Vs(t,e,s,r),e.child)}function XA(t,e,n,s,r){if(t===null){var i=n.type;return typeof i=="function"&&!OT(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,xM(t,e,i,s,r)):(t=sv(n.type,null,s,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&r)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:Kp,n(o,s)&&t.ref===e.ref)return ia(t,e,r)}return e.flags|=1,t=hl(i,s),t.ref=e.ref,t.return=e,e.child=t}function xM(t,e,n,s,r){if(t!==null){var i=t.memoizedProps;if(Kp(i,s)&&t.ref===e.ref)if(cr=!1,e.pendingProps=s=i,(t.lanes&r)!==0)t.flags&131072&&(cr=!0);else return e.lanes=t.lanes,ia(t,e,r)}return iI(t,e,n,s,r)}function bM(t,e,n){var s=e.pendingProps,r=s.children,i=t!==null?t.memoizedState:null;if(s.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ht(hh,Tr),Tr|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Ht(hh,Tr),Tr|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=i!==null?i.baseLanes:n,Ht(hh,Tr),Tr|=s}else i!==null?(s=i.baseLanes|n,e.memoizedState=null):s=n,Ht(hh,Tr),Tr|=s;return Vs(t,e,r,n),e.child}function SM(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function iI(t,e,n,s,r){var i=pr(n)?Fu:Os.current;return i=$h(e,i),wh(e,r),n=CT(t,e,n,s,i,r),s=IT(),t!==null&&!cr?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,ia(t,e,r)):(tn&&s&&hT(e),e.flags|=1,Vs(t,e,n,r),e.child)}function YA(t,e,n,s,r){if(pr(n)){var i=!0;Av(e)}else i=!1;if(wh(e,r),e.stateNode===null)ev(t,e),yM(e,n,s),sI(e,n,s,r),s=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=n.contextType;typeof u=="object"&&u!==null?u=ai(u):(u=pr(n)?Fu:Os.current,u=$h(e,u));var c=n.getDerivedStateFromProps,h=typeof c=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==s||l!==u)&&jA(e,o,s,u),Ua=!1;var d=e.memoizedState;o.state=d,Lv(e,s,o,r),l=e.memoizedState,a!==s||d!==l||fr.current||Ua?(typeof c=="function"&&(nI(e,n,c,s),l=e.memoizedState),(a=Ua||WA(e,n,a,s,d,l,u))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=s,e.memoizedState=l),o.props=s,o.state=l,o.context=u,s=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),s=!1)}else{o=e.stateNode,YL(t,e),a=e.memoizedProps,u=e.type===e.elementType?a:wi(e.type,a),o.props=u,h=e.pendingProps,d=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=ai(l):(l=pr(n)?Fu:Os.current,l=$h(e,l));var f=n.getDerivedStateFromProps;(c=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||d!==l)&&jA(e,o,s,l),Ua=!1,d=e.memoizedState,o.state=d,Lv(e,s,o,r);var p=e.memoizedState;a!==h||d!==p||fr.current||Ua?(typeof f=="function"&&(nI(e,n,f,s),p=e.memoizedState),(u=Ua||WA(e,n,u,s,d,p,l)||!1)?(c||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(s,p,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(s,p,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),e.memoizedProps=s,e.memoizedState=p),o.props=s,o.state=p,o.context=l,s=u):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),s=!1)}return oI(t,e,n,s,i,r)}function oI(t,e,n,s,r,i){SM(t,e);var o=(e.flags&128)!==0;if(!s&&!o)return r&&PA(e,n,!1),ia(t,e,i);s=e.stateNode,h9.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:s.render();return e.flags|=1,t!==null&&o?(e.child=Ah(e,t.child,null,i),e.child=Ah(e,null,a,i)):Vs(t,e,a,i),e.memoizedState=s.state,r&&PA(e,n,!0),e.child}function CM(t){var e=t.stateNode;e.pendingContext?OA(t,e.pendingContext,e.pendingContext!==e.context):e.context&&OA(t,e.context,!1),wT(t,e.containerInfo)}function QA(t,e,n,s,r){return Rh(),fT(r),e.flags|=256,Vs(t,e,n,s),e.child}var aI={dehydrated:null,treeContext:null,retryLane:0};function lI(t){return{baseLanes:t,cachePool:null,transitions:null}}function IM(t,e,n){var s=e.pendingProps,r=un.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),Ht(un,r&1),t===null)return eI(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=s.children,t=s.fallback,i?(s=e.mode,i=e.child,o={mode:"hidden",children:o},!(s&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=lx(o,s,0,null),t=$u(t,s,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=lI(n),e.memoizedState=aI,t):kT(e,o));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return d9(t,e,o,s,a,r,n);if(i){i=s.fallback,o=e.mode,r=t.child,a=r.sibling;var l={mode:"hidden",children:s.children};return!(o&1)&&e.child!==r?(s=e.child,s.childLanes=0,s.pendingProps=l,e.deletions=null):(s=hl(r,l),s.subtreeFlags=r.subtreeFlags&14680064),a!==null?i=hl(a,i):(i=$u(i,o,n,null),i.flags|=2),i.return=e,s.return=e,s.sibling=i,e.child=s,s=i,i=e.child,o=t.child.memoizedState,o=o===null?lI(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=aI,s}return i=t.child,t=i.sibling,s=hl(i,{mode:"visible",children:s.children}),!(e.mode&1)&&(s.lanes=n),s.return=e,s.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=s,e.memoizedState=null,s}function kT(t,e){return e=lx({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function b0(t,e,n,s){return s!==null&&fT(s),Ah(e,t.child,null,n),t=kT(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function d9(t,e,n,s,r,i,o){if(n)return e.flags&256?(e.flags&=-257,s=BS(Error(me(422))),b0(t,e,o,s)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=s.fallback,r=e.mode,s=lx({mode:"visible",children:s.children},r,0,null),i=$u(i,r,o,null),i.flags|=2,s.return=e,i.return=e,s.sibling=i,e.child=s,e.mode&1&&Ah(e,t.child,null,o),e.child.memoizedState=lI(o),e.memoizedState=aI,i);if(!(e.mode&1))return b0(t,e,o,null);if(r.data==="$!"){if(s=r.nextSibling&&r.nextSibling.dataset,s)var a=s.dgst;return s=a,i=Error(me(419)),s=BS(i,s,void 0),b0(t,e,o,s)}if(a=(o&t.childLanes)!==0,cr||a){if(s=as,s!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(s.suspendedLanes|o)?0:r,r!==0&&r!==i.retryLane&&(i.retryLane=r,ra(t,r),Di(s,t,r,-1))}return DT(),s=BS(Error(me(421))),b0(t,e,o,s)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=_9.bind(null,t),r._reactRetry=e,null):(t=i.treeContext,Rr=al(r.nextSibling),Pr=e,tn=!0,Ci=null,t!==null&&(Qr[Jr++]=Ho,Qr[Jr++]=qo,Qr[Jr++]=Lu,Ho=t.id,qo=t.overflow,Lu=e),e=kT(e,s.children),e.flags|=4096,e)}function JA(t,e,n){t.lanes|=e;var s=t.alternate;s!==null&&(s.lanes|=e),tI(t.return,e,n)}function VS(t,e,n,s,r){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:r}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=s,i.tail=n,i.tailMode=r)}function _M(t,e,n){var s=e.pendingProps,r=s.revealOrder,i=s.tail;if(Vs(t,e,s.children,n),s=un.current,s&2)s=s&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&JA(t,n,e);else if(t.tag===19)JA(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}s&=1}if(Ht(un,s),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&Mv(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),VS(e,!1,r,n,i);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&Mv(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}VS(e,!0,n,null,i);break;case"together":VS(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function ev(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function ia(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),zu|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(me(153));if(e.child!==null){for(t=e.child,n=hl(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=hl(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function f9(t,e,n){switch(e.tag){case 3:CM(e),Rh();break;case 5:QL(e);break;case 1:pr(e.type)&&Av(e);break;case 4:wT(e,e.stateNode.containerInfo);break;case 10:var s=e.type._context,r=e.memoizedProps.value;Ht(Pv,s._currentValue),s._currentValue=r;break;case 13:if(s=e.memoizedState,s!==null)return s.dehydrated!==null?(Ht(un,un.current&1),e.flags|=128,null):n&e.child.childLanes?IM(t,e,n):(Ht(un,un.current&1),t=ia(t,e,n),t!==null?t.sibling:null);Ht(un,un.current&1);break;case 19:if(s=(n&e.childLanes)!==0,t.flags&128){if(s)return _M(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),Ht(un,un.current),s)break;return null;case 22:case 23:return e.lanes=0,bM(t,e,n)}return ia(t,e,n)}var TM,uI,kM,EM;TM=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};uI=function(){};kM=function(t,e,n,s){var r=t.memoizedProps;if(r!==s){t=e.stateNode,Su(co.current);var i=null;switch(n){case"input":r=RC(t,r),s=RC(t,s),i=[];break;case"select":r=dn({},r,{value:void 0}),s=dn({},s,{value:void 0}),i=[];break;case"textarea":r=OC(t,r),s=OC(t,s),i=[];break;default:typeof r.onClick!="function"&&typeof s.onClick=="function"&&(t.onclick=$v)}FC(n,s);var o;n=null;for(u in r)if(!s.hasOwnProperty(u)&&r.hasOwnProperty(u)&&r[u]!=null)if(u==="style"){var a=r[u];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Vp.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in s){var l=s[u];if(a=r!=null?r[u]:void 0,s.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(i||(i=[]),i.push(u,n)),n=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Vp.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&Yt("scroll",t),i||a===l||(i=[])):(i=i||[]).push(u,l))}n&&(i=i||[]).push("style",n);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};EM=function(t,e,n,s){n!==s&&(e.flags|=4)};function qf(t,e){if(!tn)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:s.sibling=null}}function Es(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,s=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags&14680064,s|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags,s|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=s,t.childLanes=n,e}function p9(t,e,n){var s=e.pendingProps;switch(dT(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Es(e),null;case 1:return pr(e.type)&&Rv(),Es(e),null;case 3:return s=e.stateNode,Dh(),Qt(fr),Qt(Os),bT(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(t===null||t.child===null)&&(w0(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ci!==null&&(yI(Ci),Ci=null))),uI(t,e),Es(e),null;case 5:xT(e);var r=Su(Zp.current);if(n=e.type,t!==null&&e.stateNode!=null)kM(t,e,n,s,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!s){if(e.stateNode===null)throw Error(me(166));return Es(e),null}if(t=Su(co.current),w0(e)){s=e.stateNode,n=e.type;var i=e.memoizedProps;switch(s[io]=e,s[Qp]=i,t=(e.mode&1)!==0,n){case"dialog":Yt("cancel",s),Yt("close",s);break;case"iframe":case"object":case"embed":Yt("load",s);break;case"video":case"audio":for(r=0;r<cp.length;r++)Yt(cp[r],s);break;case"source":Yt("error",s);break;case"img":case"image":case"link":Yt("error",s),Yt("load",s);break;case"details":Yt("toggle",s);break;case"input":aA(s,i),Yt("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!i.multiple},Yt("invalid",s);break;case"textarea":uA(s,i),Yt("invalid",s)}FC(n,i),r=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?s.textContent!==a&&(i.suppressHydrationWarning!==!0&&v0(s.textContent,a,t),r=["children",a]):typeof a=="number"&&s.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&v0(s.textContent,a,t),r=["children",""+a]):Vp.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Yt("scroll",s)}switch(n){case"input":c0(s),lA(s,i,!0);break;case"textarea":c0(s),cA(s);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(s.onclick=$v)}s=r,e.updateQueue=s,s!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=nL(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof s.is=="string"?t=o.createElement(n,{is:s.is}):(t=o.createElement(n),n==="select"&&(o=t,s.multiple?o.multiple=!0:s.size&&(o.size=s.size))):t=o.createElementNS(t,n),t[io]=e,t[Qp]=s,TM(t,e,!1,!1),e.stateNode=t;e:{switch(o=LC(n,s),n){case"dialog":Yt("cancel",t),Yt("close",t),r=s;break;case"iframe":case"object":case"embed":Yt("load",t),r=s;break;case"video":case"audio":for(r=0;r<cp.length;r++)Yt(cp[r],t);r=s;break;case"source":Yt("error",t),r=s;break;case"img":case"image":case"link":Yt("error",t),Yt("load",t),r=s;break;case"details":Yt("toggle",t),r=s;break;case"input":aA(t,s),r=RC(t,s),Yt("invalid",t);break;case"option":r=s;break;case"select":t._wrapperState={wasMultiple:!!s.multiple},r=dn({},s,{value:void 0}),Yt("invalid",t);break;case"textarea":uA(t,s),r=OC(t,s),Yt("invalid",t);break;default:r=s}FC(n,r),a=r;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?iL(t,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&sL(t,l)):i==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&Up(t,l):typeof l=="number"&&Up(t,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Vp.hasOwnProperty(i)?l!=null&&i==="onScroll"&&Yt("scroll",t):l!=null&&Q_(t,i,l,o))}switch(n){case"input":c0(t),lA(t,s,!1);break;case"textarea":c0(t),cA(t);break;case"option":s.value!=null&&t.setAttribute("value",""+xl(s.value));break;case"select":t.multiple=!!s.multiple,i=s.value,i!=null?mh(t,!!s.multiple,i,!1):s.defaultValue!=null&&mh(t,!!s.multiple,s.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=$v)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Es(e),null;case 6:if(t&&e.stateNode!=null)EM(t,e,t.memoizedProps,s);else{if(typeof s!="string"&&e.stateNode===null)throw Error(me(166));if(n=Su(Zp.current),Su(co.current),w0(e)){if(s=e.stateNode,n=e.memoizedProps,s[io]=e,(i=s.nodeValue!==n)&&(t=Pr,t!==null))switch(t.tag){case 3:v0(s.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&v0(s.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else s=(n.nodeType===9?n:n.ownerDocument).createTextNode(s),s[io]=e,e.stateNode=s}return Es(e),null;case 13:if(Qt(un),s=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(tn&&Rr!==null&&e.mode&1&&!(e.flags&128))HL(),Rh(),e.flags|=98560,i=!1;else if(i=w0(e),s!==null&&s.dehydrated!==null){if(t===null){if(!i)throw Error(me(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(me(317));i[io]=e}else Rh(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Es(e),i=!1}else Ci!==null&&(yI(Ci),Ci=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(s=s!==null,s!==(t!==null&&t.memoizedState!==null)&&s&&(e.child.flags|=8192,e.mode&1&&(t===null||un.current&1?jn===0&&(jn=3):DT())),e.updateQueue!==null&&(e.flags|=4),Es(e),null);case 4:return Dh(),uI(t,e),t===null&&Xp(e.stateNode.containerInfo),Es(e),null;case 10:return gT(e.type._context),Es(e),null;case 17:return pr(e.type)&&Rv(),Es(e),null;case 19:if(Qt(un),i=e.memoizedState,i===null)return Es(e),null;if(s=(e.flags&128)!==0,o=i.rendering,o===null)if(s)qf(i,!1);else{if(jn!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Mv(t),o!==null){for(e.flags|=128,qf(i,!1),s=o.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),e.subtreeFlags=0,s=n,n=e.child;n!==null;)i=n,t=s,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Ht(un,un.current&1|2),e.child}t=t.sibling}i.tail!==null&&kn()>Ph&&(e.flags|=128,s=!0,qf(i,!1),e.lanes=4194304)}else{if(!s)if(t=Mv(o),t!==null){if(e.flags|=128,s=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),qf(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!tn)return Es(e),null}else 2*kn()-i.renderingStartTime>Ph&&n!==1073741824&&(e.flags|=128,s=!0,qf(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=kn(),e.sibling=null,n=un.current,Ht(un,s?n&1|2:n&1),e):(Es(e),null);case 22:case 23:return AT(),s=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==s&&(e.flags|=8192),s&&e.mode&1?Tr&1073741824&&(Es(e),e.subtreeFlags&6&&(e.flags|=8192)):Es(e),null;case 24:return null;case 25:return null}throw Error(me(156,e.tag))}function m9(t,e){switch(dT(e),e.tag){case 1:return pr(e.type)&&Rv(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Dh(),Qt(fr),Qt(Os),bT(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return xT(e),null;case 13:if(Qt(un),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(me(340));Rh()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Qt(un),null;case 4:return Dh(),null;case 10:return gT(e.type._context),null;case 22:case 23:return AT(),null;case 24:return null;default:return null}}var S0=!1,$s=!1,g9=typeof WeakSet=="function"?WeakSet:Set,Ee=null;function ch(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(s){gn(t,e,s)}else n.current=null}function cI(t,e,n){try{n()}catch(s){gn(t,e,s)}}var ZA=!1;function y9(t,e){if(qC=kv,t=DL(),cT(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var s=n.getSelection&&n.getSelection();if(s&&s.rangeCount!==0){n=s.anchorNode;var r=s.anchorOffset,i=s.focusNode;s=s.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,u=0,c=0,h=t,d=null;t:for(;;){for(var f;h!==n||r!==0&&h.nodeType!==3||(a=o+r),h!==i||s!==0&&h.nodeType!==3||(l=o+s),h.nodeType===3&&(o+=h.nodeValue.length),(f=h.firstChild)!==null;)d=h,h=f;for(;;){if(h===t)break t;if(d===n&&++u===r&&(a=o),d===i&&++c===s&&(l=o),(f=h.nextSibling)!==null)break;h=d,d=h.parentNode}h=f}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(KC={focusedElem:t,selectionRange:n},kv=!1,Ee=e;Ee!==null;)if(e=Ee,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Ee=t;else for(;Ee!==null;){e=Ee;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var m=p.memoizedProps,v=p.memoizedState,g=e.stateNode,w=g.getSnapshotBeforeUpdate(e.elementType===e.type?m:wi(e.type,m),v);g.__reactInternalSnapshotBeforeUpdate=w}break;case 3:var b=e.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(me(163))}}catch(x){gn(e,e.return,x)}if(t=e.sibling,t!==null){t.return=e.return,Ee=t;break}Ee=e.return}return p=ZA,ZA=!1,p}function Np(t,e,n){var s=e.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var r=s=s.next;do{if((r.tag&t)===t){var i=r.destroy;r.destroy=void 0,i!==void 0&&cI(e,n,i)}r=r.next}while(r!==s)}}function ox(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var s=n.create;n.destroy=s()}n=n.next}while(n!==e)}}function hI(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function NM(t){var e=t.alternate;e!==null&&(t.alternate=null,NM(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[io],delete e[Qp],delete e[QC],delete e[Z5],delete e[e9])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function $M(t){return t.tag===5||t.tag===3||t.tag===4}function eD(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||$M(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function dI(t,e,n){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=$v));else if(s!==4&&(t=t.child,t!==null))for(dI(t,e,n),t=t.sibling;t!==null;)dI(t,e,n),t=t.sibling}function fI(t,e,n){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(s!==4&&(t=t.child,t!==null))for(fI(t,e,n),t=t.sibling;t!==null;)fI(t,e,n),t=t.sibling}var vs=null,bi=!1;function Pa(t,e,n){for(n=n.child;n!==null;)RM(t,e,n),n=n.sibling}function RM(t,e,n){if(uo&&typeof uo.onCommitFiberUnmount=="function")try{uo.onCommitFiberUnmount(Jw,n)}catch{}switch(n.tag){case 5:$s||ch(n,e);case 6:var s=vs,r=bi;vs=null,Pa(t,e,n),vs=s,bi=r,vs!==null&&(bi?(t=vs,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):vs.removeChild(n.stateNode));break;case 18:vs!==null&&(bi?(t=vs,n=n.stateNode,t.nodeType===8?OS(t.parentNode,n):t.nodeType===1&&OS(t,n),Hp(t)):OS(vs,n.stateNode));break;case 4:s=vs,r=bi,vs=n.stateNode.containerInfo,bi=!0,Pa(t,e,n),vs=s,bi=r;break;case 0:case 11:case 14:case 15:if(!$s&&(s=n.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){r=s=s.next;do{var i=r,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&cI(n,e,o),r=r.next}while(r!==s)}Pa(t,e,n);break;case 1:if(!$s&&(ch(n,e),s=n.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(a){gn(n,e,a)}Pa(t,e,n);break;case 21:Pa(t,e,n);break;case 22:n.mode&1?($s=(s=$s)||n.memoizedState!==null,Pa(t,e,n),$s=s):Pa(t,e,n);break;default:Pa(t,e,n)}}function tD(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new g9),e.forEach(function(s){var r=T9.bind(null,t,s);n.has(s)||(n.add(s),s.then(r,r))})}}function gi(t,e){var n=e.deletions;if(n!==null)for(var s=0;s<n.length;s++){var r=n[s];try{var i=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:vs=a.stateNode,bi=!1;break e;case 3:vs=a.stateNode.containerInfo,bi=!0;break e;case 4:vs=a.stateNode.containerInfo,bi=!0;break e}a=a.return}if(vs===null)throw Error(me(160));RM(i,o,r),vs=null,bi=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(u){gn(r,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)AM(e,t),e=e.sibling}function AM(t,e){var n=t.alternate,s=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(gi(e,t),eo(t),s&4){try{Np(3,t,t.return),ox(3,t)}catch(m){gn(t,t.return,m)}try{Np(5,t,t.return)}catch(m){gn(t,t.return,m)}}break;case 1:gi(e,t),eo(t),s&512&&n!==null&&ch(n,n.return);break;case 5:if(gi(e,t),eo(t),s&512&&n!==null&&ch(n,n.return),t.flags&32){var r=t.stateNode;try{Up(r,"")}catch(m){gn(t,t.return,m)}}if(s&4&&(r=t.stateNode,r!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&eL(r,i),LC(a,o);var u=LC(a,i);for(o=0;o<l.length;o+=2){var c=l[o],h=l[o+1];c==="style"?iL(r,h):c==="dangerouslySetInnerHTML"?sL(r,h):c==="children"?Up(r,h):Q_(r,c,h,u)}switch(a){case"input":AC(r,i);break;case"textarea":tL(r,i);break;case"select":var d=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!i.multiple;var f=i.value;f!=null?mh(r,!!i.multiple,f,!1):d!==!!i.multiple&&(i.defaultValue!=null?mh(r,!!i.multiple,i.defaultValue,!0):mh(r,!!i.multiple,i.multiple?[]:"",!1))}r[Qp]=i}catch(m){gn(t,t.return,m)}}break;case 6:if(gi(e,t),eo(t),s&4){if(t.stateNode===null)throw Error(me(162));r=t.stateNode,i=t.memoizedProps;try{r.nodeValue=i}catch(m){gn(t,t.return,m)}}break;case 3:if(gi(e,t),eo(t),s&4&&n!==null&&n.memoizedState.isDehydrated)try{Hp(e.containerInfo)}catch(m){gn(t,t.return,m)}break;case 4:gi(e,t),eo(t);break;case 13:gi(e,t),eo(t),r=t.child,r.flags&8192&&(i=r.memoizedState!==null,r.stateNode.isHidden=i,!i||r.alternate!==null&&r.alternate.memoizedState!==null||($T=kn())),s&4&&tD(t);break;case 22:if(c=n!==null&&n.memoizedState!==null,t.mode&1?($s=(u=$s)||c,gi(e,t),$s=u):gi(e,t),eo(t),s&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!c&&t.mode&1)for(Ee=t,c=t.child;c!==null;){for(h=Ee=c;Ee!==null;){switch(d=Ee,f=d.child,d.tag){case 0:case 11:case 14:case 15:Np(4,d,d.return);break;case 1:ch(d,d.return);var p=d.stateNode;if(typeof p.componentWillUnmount=="function"){s=d,n=d.return;try{e=s,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(m){gn(s,n,m)}}break;case 5:ch(d,d.return);break;case 22:if(d.memoizedState!==null){sD(h);continue}}f!==null?(f.return=d,Ee=f):sD(h)}c=c.sibling}e:for(c=null,h=t;;){if(h.tag===5){if(c===null){c=h;try{r=h.stateNode,u?(i=r.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=h.stateNode,l=h.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=rL("display",o))}catch(m){gn(t,t.return,m)}}}else if(h.tag===6){if(c===null)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(m){gn(t,t.return,m)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;c===h&&(c=null),h=h.return}c===h&&(c=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:gi(e,t),eo(t),s&4&&tD(t);break;case 21:break;default:gi(e,t),eo(t)}}function eo(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if($M(n)){var s=n;break e}n=n.return}throw Error(me(160))}switch(s.tag){case 5:var r=s.stateNode;s.flags&32&&(Up(r,""),s.flags&=-33);var i=eD(t);fI(t,i,r);break;case 3:case 4:var o=s.stateNode.containerInfo,a=eD(t);dI(t,a,o);break;default:throw Error(me(161))}}catch(l){gn(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function v9(t,e,n){Ee=t,DM(t)}function DM(t,e,n){for(var s=(t.mode&1)!==0;Ee!==null;){var r=Ee,i=r.child;if(r.tag===22&&s){var o=r.memoizedState!==null||S0;if(!o){var a=r.alternate,l=a!==null&&a.memoizedState!==null||$s;a=S0;var u=$s;if(S0=o,($s=l)&&!u)for(Ee=r;Ee!==null;)o=Ee,l=o.child,o.tag===22&&o.memoizedState!==null?rD(r):l!==null?(l.return=o,Ee=l):rD(r);for(;i!==null;)Ee=i,DM(i),i=i.sibling;Ee=r,S0=a,$s=u}nD(t)}else r.subtreeFlags&8772&&i!==null?(i.return=r,Ee=i):nD(t)}}function nD(t){for(;Ee!==null;){var e=Ee;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:$s||ox(5,e);break;case 1:var s=e.stateNode;if(e.flags&4&&!$s)if(n===null)s.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:wi(e.type,n.memoizedProps);s.componentDidUpdate(r,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&BA(e,i,s);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}BA(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var h=c.dehydrated;h!==null&&Hp(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(me(163))}$s||e.flags&512&&hI(e)}catch(d){gn(e,e.return,d)}}if(e===t){Ee=null;break}if(n=e.sibling,n!==null){n.return=e.return,Ee=n;break}Ee=e.return}}function sD(t){for(;Ee!==null;){var e=Ee;if(e===t){Ee=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Ee=n;break}Ee=e.return}}function rD(t){for(;Ee!==null;){var e=Ee;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{ox(4,e)}catch(l){gn(e,n,l)}break;case 1:var s=e.stateNode;if(typeof s.componentDidMount=="function"){var r=e.return;try{s.componentDidMount()}catch(l){gn(e,r,l)}}var i=e.return;try{hI(e)}catch(l){gn(e,i,l)}break;case 5:var o=e.return;try{hI(e)}catch(l){gn(e,o,l)}}}catch(l){gn(e,e.return,l)}if(e===t){Ee=null;break}var a=e.sibling;if(a!==null){a.return=e.return,Ee=a;break}Ee=e.return}}var w9=Math.ceil,Vv=ga.ReactCurrentDispatcher,ET=ga.ReactCurrentOwner,oi=ga.ReactCurrentBatchConfig,wt=0,as=null,Dn=null,xs=0,Tr=0,hh=zl(0),jn=0,sm=null,zu=0,ax=0,NT=0,$p=null,lr=null,$T=0,Ph=1/0,zo=null,Uv=!1,pI=null,ul=null,C0=!1,Ja=null,Wv=0,Rp=0,mI=null,tv=-1,nv=0;function Gs(){return wt&6?kn():tv!==-1?tv:tv=kn()}function cl(t){return t.mode&1?wt&2&&xs!==0?xs&-xs:n9.transition!==null?(nv===0&&(nv=yL()),nv):(t=Rt,t!==0||(t=window.event,t=t===void 0?16:IL(t.type)),t):1}function Di(t,e,n,s){if(50<Rp)throw Rp=0,mI=null,Error(me(185));Bm(t,n,s),(!(wt&2)||t!==as)&&(t===as&&(!(wt&2)&&(ax|=n),jn===4&&Ga(t,xs)),mr(t,s),n===1&&wt===0&&!(e.mode&1)&&(Ph=kn()+500,sx&&Bl()))}function mr(t,e){var n=t.callbackNode;n5(t,e);var s=Tv(t,t===as?xs:0);if(s===0)n!==null&&fA(n),t.callbackNode=null,t.callbackPriority=0;else if(e=s&-s,t.callbackPriority!==e){if(n!=null&&fA(n),e===1)t.tag===0?t9(iD.bind(null,t)):WL(iD.bind(null,t)),Q5(function(){!(wt&6)&&Bl()}),n=null;else{switch(vL(s)){case 1:n=nT;break;case 4:n=mL;break;case 16:n=_v;break;case 536870912:n=gL;break;default:n=_v}n=VM(n,OM.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function OM(t,e){if(tv=-1,nv=0,wt&6)throw Error(me(327));var n=t.callbackNode;if(xh()&&t.callbackNode!==n)return null;var s=Tv(t,t===as?xs:0);if(s===0)return null;if(s&30||s&t.expiredLanes||e)e=jv(t,s);else{e=s;var r=wt;wt|=2;var i=FM();(as!==t||xs!==e)&&(zo=null,Ph=kn()+500,Nu(t,e));do try{S9();break}catch(a){PM(t,a)}while(!0);mT(),Vv.current=i,wt=r,Dn!==null?e=0:(as=null,xs=0,e=jn)}if(e!==0){if(e===2&&(r=UC(t),r!==0&&(s=r,e=gI(t,r))),e===1)throw n=sm,Nu(t,0),Ga(t,s),mr(t,kn()),n;if(e===6)Ga(t,s);else{if(r=t.current.alternate,!(s&30)&&!x9(r)&&(e=jv(t,s),e===2&&(i=UC(t),i!==0&&(s=i,e=gI(t,i))),e===1))throw n=sm,Nu(t,0),Ga(t,s),mr(t,kn()),n;switch(t.finishedWork=r,t.finishedLanes=s,e){case 0:case 1:throw Error(me(345));case 2:uu(t,lr,zo);break;case 3:if(Ga(t,s),(s&130023424)===s&&(e=$T+500-kn(),10<e)){if(Tv(t,0)!==0)break;if(r=t.suspendedLanes,(r&s)!==s){Gs(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=YC(uu.bind(null,t,lr,zo),e);break}uu(t,lr,zo);break;case 4:if(Ga(t,s),(s&4194240)===s)break;for(e=t.eventTimes,r=-1;0<s;){var o=31-Ai(s);i=1<<o,o=e[o],o>r&&(r=o),s&=~i}if(s=r,s=kn()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*w9(s/1960))-s,10<s){t.timeoutHandle=YC(uu.bind(null,t,lr,zo),s);break}uu(t,lr,zo);break;case 5:uu(t,lr,zo);break;default:throw Error(me(329))}}}return mr(t,kn()),t.callbackNode===n?OM.bind(null,t):null}function gI(t,e){var n=$p;return t.current.memoizedState.isDehydrated&&(Nu(t,e).flags|=256),t=jv(t,e),t!==2&&(e=lr,lr=n,e!==null&&yI(e)),t}function yI(t){lr===null?lr=t:lr.push.apply(lr,t)}function x9(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var s=0;s<n.length;s++){var r=n[s],i=r.getSnapshot;r=r.value;try{if(!zi(i(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ga(t,e){for(e&=~NT,e&=~ax,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Ai(e),s=1<<n;t[n]=-1,e&=~s}}function iD(t){if(wt&6)throw Error(me(327));xh();var e=Tv(t,0);if(!(e&1))return mr(t,kn()),null;var n=jv(t,e);if(t.tag!==0&&n===2){var s=UC(t);s!==0&&(e=s,n=gI(t,s))}if(n===1)throw n=sm,Nu(t,0),Ga(t,e),mr(t,kn()),n;if(n===6)throw Error(me(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,uu(t,lr,zo),mr(t,kn()),null}function RT(t,e){var n=wt;wt|=1;try{return t(e)}finally{wt=n,wt===0&&(Ph=kn()+500,sx&&Bl())}}function Bu(t){Ja!==null&&Ja.tag===0&&!(wt&6)&&xh();var e=wt;wt|=1;var n=oi.transition,s=Rt;try{if(oi.transition=null,Rt=1,t)return t()}finally{Rt=s,oi.transition=n,wt=e,!(wt&6)&&Bl()}}function AT(){Tr=hh.current,Qt(hh)}function Nu(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,Y5(n)),Dn!==null)for(n=Dn.return;n!==null;){var s=n;switch(dT(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&Rv();break;case 3:Dh(),Qt(fr),Qt(Os),bT();break;case 5:xT(s);break;case 4:Dh();break;case 13:Qt(un);break;case 19:Qt(un);break;case 10:gT(s.type._context);break;case 22:case 23:AT()}n=n.return}if(as=t,Dn=t=hl(t.current,null),xs=Tr=e,jn=0,sm=null,NT=ax=zu=0,lr=$p=null,bu!==null){for(e=0;e<bu.length;e++)if(n=bu[e],s=n.interleaved,s!==null){n.interleaved=null;var r=s.next,i=n.pending;if(i!==null){var o=i.next;i.next=r,s.next=o}n.pending=s}bu=null}return t}function PM(t,e){do{var n=Dn;try{if(mT(),J0.current=Bv,zv){for(var s=hn.memoizedState;s!==null;){var r=s.queue;r!==null&&(r.pending=null),s=s.next}zv=!1}if(Mu=0,es=Bn=hn=null,Ep=!1,em=0,ET.current=null,n===null||n.return===null){jn=1,sm=e,Dn=null;break}e:{var i=t,o=n.return,a=n,l=e;if(e=xs,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=a,h=c.tag;if(!(c.mode&1)&&(h===0||h===11||h===15)){var d=c.alternate;d?(c.updateQueue=d.updateQueue,c.memoizedState=d.memoizedState,c.lanes=d.lanes):(c.updateQueue=null,c.memoizedState=null)}var f=HA(o);if(f!==null){f.flags&=-257,qA(f,o,a,i,e),f.mode&1&&GA(i,u,e),e=f,l=u;var p=e.updateQueue;if(p===null){var m=new Set;m.add(l),e.updateQueue=m}else p.add(l);break e}else{if(!(e&1)){GA(i,u,e),DT();break e}l=Error(me(426))}}else if(tn&&a.mode&1){var v=HA(o);if(v!==null){!(v.flags&65536)&&(v.flags|=256),qA(v,o,a,i,e),fT(Oh(l,a));break e}}i=l=Oh(l,a),jn!==4&&(jn=2),$p===null?$p=[i]:$p.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var g=vM(i,l,e);zA(i,g);break e;case 1:a=l;var w=i.type,b=i.stateNode;if(!(i.flags&128)&&(typeof w.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(ul===null||!ul.has(b)))){i.flags|=65536,e&=-e,i.lanes|=e;var x=wM(i,a,e);zA(i,x);break e}}i=i.return}while(i!==null)}MM(n)}catch(S){e=S,Dn===n&&n!==null&&(Dn=n=n.return);continue}break}while(!0)}function FM(){var t=Vv.current;return Vv.current=Bv,t===null?Bv:t}function DT(){(jn===0||jn===3||jn===2)&&(jn=4),as===null||!(zu&268435455)&&!(ax&268435455)||Ga(as,xs)}function jv(t,e){var n=wt;wt|=2;var s=FM();(as!==t||xs!==e)&&(zo=null,Nu(t,e));do try{b9();break}catch(r){PM(t,r)}while(!0);if(mT(),wt=n,Vv.current=s,Dn!==null)throw Error(me(261));return as=null,xs=0,jn}function b9(){for(;Dn!==null;)LM(Dn)}function S9(){for(;Dn!==null&&!q6();)LM(Dn)}function LM(t){var e=BM(t.alternate,t,Tr);t.memoizedProps=t.pendingProps,e===null?MM(t):Dn=e,ET.current=null}function MM(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=m9(n,e),n!==null){n.flags&=32767,Dn=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{jn=6,Dn=null;return}}else if(n=p9(n,e,Tr),n!==null){Dn=n;return}if(e=e.sibling,e!==null){Dn=e;return}Dn=e=t}while(e!==null);jn===0&&(jn=5)}function uu(t,e,n){var s=Rt,r=oi.transition;try{oi.transition=null,Rt=1,C9(t,e,n,s)}finally{oi.transition=r,Rt=s}return null}function C9(t,e,n,s){do xh();while(Ja!==null);if(wt&6)throw Error(me(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(me(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(s5(t,i),t===as&&(Dn=as=null,xs=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||C0||(C0=!0,VM(_v,function(){return xh(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=oi.transition,oi.transition=null;var o=Rt;Rt=1;var a=wt;wt|=4,ET.current=null,y9(t,n),AM(n,t),W5(KC),kv=!!qC,KC=qC=null,t.current=n,v9(n),K6(),wt=a,Rt=o,oi.transition=i}else t.current=n;if(C0&&(C0=!1,Ja=t,Wv=r),i=t.pendingLanes,i===0&&(ul=null),Q6(n.stateNode),mr(t,kn()),e!==null)for(s=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],s(r.value,{componentStack:r.stack,digest:r.digest});if(Uv)throw Uv=!1,t=pI,pI=null,t;return Wv&1&&t.tag!==0&&xh(),i=t.pendingLanes,i&1?t===mI?Rp++:(Rp=0,mI=t):Rp=0,Bl(),null}function xh(){if(Ja!==null){var t=vL(Wv),e=oi.transition,n=Rt;try{if(oi.transition=null,Rt=16>t?16:t,Ja===null)var s=!1;else{if(t=Ja,Ja=null,Wv=0,wt&6)throw Error(me(331));var r=wt;for(wt|=4,Ee=t.current;Ee!==null;){var i=Ee,o=i.child;if(Ee.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(Ee=u;Ee!==null;){var c=Ee;switch(c.tag){case 0:case 11:case 15:Np(8,c,i)}var h=c.child;if(h!==null)h.return=c,Ee=h;else for(;Ee!==null;){c=Ee;var d=c.sibling,f=c.return;if(NM(c),c===u){Ee=null;break}if(d!==null){d.return=f,Ee=d;break}Ee=f}}}var p=i.alternate;if(p!==null){var m=p.child;if(m!==null){p.child=null;do{var v=m.sibling;m.sibling=null,m=v}while(m!==null)}}Ee=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,Ee=o;else e:for(;Ee!==null;){if(i=Ee,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Np(9,i,i.return)}var g=i.sibling;if(g!==null){g.return=i.return,Ee=g;break e}Ee=i.return}}var w=t.current;for(Ee=w;Ee!==null;){o=Ee;var b=o.child;if(o.subtreeFlags&2064&&b!==null)b.return=o,Ee=b;else e:for(o=w;Ee!==null;){if(a=Ee,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:ox(9,a)}}catch(S){gn(a,a.return,S)}if(a===o){Ee=null;break e}var x=a.sibling;if(x!==null){x.return=a.return,Ee=x;break e}Ee=a.return}}if(wt=r,Bl(),uo&&typeof uo.onPostCommitFiberRoot=="function")try{uo.onPostCommitFiberRoot(Jw,t)}catch{}s=!0}return s}finally{Rt=n,oi.transition=e}}return!1}function oD(t,e,n){e=Oh(n,e),e=vM(t,e,1),t=ll(t,e,1),e=Gs(),t!==null&&(Bm(t,1,e),mr(t,e))}function gn(t,e,n){if(t.tag===3)oD(t,t,n);else for(;e!==null;){if(e.tag===3){oD(e,t,n);break}else if(e.tag===1){var s=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(ul===null||!ul.has(s))){t=Oh(n,t),t=wM(e,t,1),e=ll(e,t,1),t=Gs(),e!==null&&(Bm(e,1,t),mr(e,t));break}}e=e.return}}function I9(t,e,n){var s=t.pingCache;s!==null&&s.delete(e),e=Gs(),t.pingedLanes|=t.suspendedLanes&n,as===t&&(xs&n)===n&&(jn===4||jn===3&&(xs&130023424)===xs&&500>kn()-$T?Nu(t,0):NT|=n),mr(t,e)}function zM(t,e){e===0&&(t.mode&1?(e=f0,f0<<=1,!(f0&130023424)&&(f0=4194304)):e=1);var n=Gs();t=ra(t,e),t!==null&&(Bm(t,e,n),mr(t,n))}function _9(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),zM(t,n)}function T9(t,e){var n=0;switch(t.tag){case 13:var s=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:s=t.stateNode;break;default:throw Error(me(314))}s!==null&&s.delete(e),zM(t,n)}var BM;BM=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||fr.current)cr=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return cr=!1,f9(t,e,n);cr=!!(t.flags&131072)}else cr=!1,tn&&e.flags&1048576&&jL(e,Ov,e.index);switch(e.lanes=0,e.tag){case 2:var s=e.type;ev(t,e),t=e.pendingProps;var r=$h(e,Os.current);wh(e,n),r=CT(null,e,s,t,r,n);var i=IT();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,pr(s)?(i=!0,Av(e)):i=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,vT(e),r.updater=ix,e.stateNode=r,r._reactInternals=e,sI(e,s,t,n),e=oI(null,e,s,!0,i,n)):(e.tag=0,tn&&i&&hT(e),Vs(null,e,r,n),e=e.child),e;case 16:s=e.elementType;e:{switch(ev(t,e),t=e.pendingProps,r=s._init,s=r(s._payload),e.type=s,r=e.tag=E9(s),t=wi(s,t),r){case 0:e=iI(null,e,s,t,n);break e;case 1:e=YA(null,e,s,t,n);break e;case 11:e=KA(null,e,s,t,n);break e;case 14:e=XA(null,e,s,wi(s.type,t),n);break e}throw Error(me(306,s,""))}return e;case 0:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:wi(s,r),iI(t,e,s,r,n);case 1:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:wi(s,r),YA(t,e,s,r,n);case 3:e:{if(CM(e),t===null)throw Error(me(387));s=e.pendingProps,i=e.memoizedState,r=i.element,YL(t,e),Lv(e,s,null,n);var o=e.memoizedState;if(s=o.element,i.isDehydrated)if(i={element:s,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){r=Oh(Error(me(423)),e),e=QA(t,e,s,n,r);break e}else if(s!==r){r=Oh(Error(me(424)),e),e=QA(t,e,s,n,r);break e}else for(Rr=al(e.stateNode.containerInfo.firstChild),Pr=e,tn=!0,Ci=null,n=KL(e,null,s,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Rh(),s===r){e=ia(t,e,n);break e}Vs(t,e,s,n)}e=e.child}return e;case 5:return QL(e),t===null&&eI(e),s=e.type,r=e.pendingProps,i=t!==null?t.memoizedProps:null,o=r.children,XC(s,r)?o=null:i!==null&&XC(s,i)&&(e.flags|=32),SM(t,e),Vs(t,e,o,n),e.child;case 6:return t===null&&eI(e),null;case 13:return IM(t,e,n);case 4:return wT(e,e.stateNode.containerInfo),s=e.pendingProps,t===null?e.child=Ah(e,null,s,n):Vs(t,e,s,n),e.child;case 11:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:wi(s,r),KA(t,e,s,r,n);case 7:return Vs(t,e,e.pendingProps,n),e.child;case 8:return Vs(t,e,e.pendingProps.children,n),e.child;case 12:return Vs(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(s=e.type._context,r=e.pendingProps,i=e.memoizedProps,o=r.value,Ht(Pv,s._currentValue),s._currentValue=o,i!==null)if(zi(i.value,o)){if(i.children===r.children&&!fr.current){e=ia(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===s){if(i.tag===1){l=Jo(-1,n&-n),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}i.lanes|=n,l=i.alternate,l!==null&&(l.lanes|=n),tI(i.return,n,e),a.lanes|=n;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(me(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),tI(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}Vs(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,s=e.pendingProps.children,wh(e,n),r=ai(r),s=s(r),e.flags|=1,Vs(t,e,s,n),e.child;case 14:return s=e.type,r=wi(s,e.pendingProps),r=wi(s.type,r),XA(t,e,s,r,n);case 15:return xM(t,e,e.type,e.pendingProps,n);case 17:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:wi(s,r),ev(t,e),e.tag=1,pr(s)?(t=!0,Av(e)):t=!1,wh(e,n),yM(e,s,r),sI(e,s,r,n),oI(null,e,s,!0,t,n);case 19:return _M(t,e,n);case 22:return bM(t,e,n)}throw Error(me(156,e.tag))};function VM(t,e){return pL(t,e)}function k9(t,e,n,s){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Zr(t,e,n,s){return new k9(t,e,n,s)}function OT(t){return t=t.prototype,!(!t||!t.isReactComponent)}function E9(t){if(typeof t=="function")return OT(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Z_)return 11;if(t===eT)return 14}return 2}function hl(t,e){var n=t.alternate;return n===null?(n=Zr(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function sv(t,e,n,s,r,i){var o=2;if(s=t,typeof t=="function")OT(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case th:return $u(n.children,r,i,e);case J_:o=8,r|=8;break;case kC:return t=Zr(12,n,e,r|2),t.elementType=kC,t.lanes=i,t;case EC:return t=Zr(13,n,e,r),t.elementType=EC,t.lanes=i,t;case NC:return t=Zr(19,n,e,r),t.elementType=NC,t.lanes=i,t;case QF:return lx(n,r,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case XF:o=10;break e;case YF:o=9;break e;case Z_:o=11;break e;case eT:o=14;break e;case Va:o=16,s=null;break e}throw Error(me(130,t==null?t:typeof t,""))}return e=Zr(o,n,e,r),e.elementType=t,e.type=s,e.lanes=i,e}function $u(t,e,n,s){return t=Zr(7,t,s,e),t.lanes=n,t}function lx(t,e,n,s){return t=Zr(22,t,s,e),t.elementType=QF,t.lanes=n,t.stateNode={isHidden:!1},t}function US(t,e,n){return t=Zr(6,t,null,e),t.lanes=n,t}function WS(t,e,n){return e=Zr(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function N9(t,e,n,s,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=CS(0),this.expirationTimes=CS(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=CS(0),this.identifierPrefix=s,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function PT(t,e,n,s,r,i,o,a,l){return t=new N9(t,e,n,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Zr(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},vT(i),t}function $9(t,e,n){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:eh,key:s==null?null:""+s,children:t,containerInfo:e,implementation:n}}function UM(t){if(!t)return bl;t=t._reactInternals;e:{if(fc(t)!==t||t.tag!==1)throw Error(me(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(pr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(me(171))}if(t.tag===1){var n=t.type;if(pr(n))return UL(t,n,e)}return e}function WM(t,e,n,s,r,i,o,a,l){return t=PT(n,s,!0,t,r,i,o,a,l),t.context=UM(null),n=t.current,s=Gs(),r=cl(n),i=Jo(s,r),i.callback=e??null,ll(n,i,r),t.current.lanes=r,Bm(t,r,s),mr(t,s),t}function ux(t,e,n,s){var r=e.current,i=Gs(),o=cl(r);return n=UM(n),e.context===null?e.context=n:e.pendingContext=n,e=Jo(i,o),e.payload={element:t},s=s===void 0?null:s,s!==null&&(e.callback=s),t=ll(r,e,o),t!==null&&(Di(t,r,o,i),Q0(t,r,o)),o}function Gv(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function aD(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function FT(t,e){aD(t,e),(t=t.alternate)&&aD(t,e)}function R9(){return null}var jM=typeof reportError=="function"?reportError:function(t){console.error(t)};function LT(t){this._internalRoot=t}cx.prototype.render=LT.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(me(409));ux(t,e,null,null)};cx.prototype.unmount=LT.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Bu(function(){ux(null,t,null,null)}),e[sa]=null}};function cx(t){this._internalRoot=t}cx.prototype.unstable_scheduleHydration=function(t){if(t){var e=bL();t={blockedOn:null,target:t,priority:e};for(var n=0;n<ja.length&&e!==0&&e<ja[n].priority;n++);ja.splice(n,0,t),n===0&&CL(t)}};function MT(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function hx(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function lD(){}function A9(t,e,n,s,r){if(r){if(typeof s=="function"){var i=s;s=function(){var u=Gv(o);i.call(u)}}var o=WM(e,s,t,0,null,!1,!1,"",lD);return t._reactRootContainer=o,t[sa]=o.current,Xp(t.nodeType===8?t.parentNode:t),Bu(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof s=="function"){var a=s;s=function(){var u=Gv(l);a.call(u)}}var l=PT(t,0,!1,null,null,!1,!1,"",lD);return t._reactRootContainer=l,t[sa]=l.current,Xp(t.nodeType===8?t.parentNode:t),Bu(function(){ux(e,l,n,s)}),l}function dx(t,e,n,s,r){var i=n._reactRootContainer;if(i){var o=i;if(typeof r=="function"){var a=r;r=function(){var l=Gv(o);a.call(l)}}ux(e,o,t,r)}else o=A9(n,e,t,r,s);return Gv(o)}wL=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=up(e.pendingLanes);n!==0&&(sT(e,n|1),mr(e,kn()),!(wt&6)&&(Ph=kn()+500,Bl()))}break;case 13:Bu(function(){var s=ra(t,1);if(s!==null){var r=Gs();Di(s,t,1,r)}}),FT(t,1)}};rT=function(t){if(t.tag===13){var e=ra(t,134217728);if(e!==null){var n=Gs();Di(e,t,134217728,n)}FT(t,134217728)}};xL=function(t){if(t.tag===13){var e=cl(t),n=ra(t,e);if(n!==null){var s=Gs();Di(n,t,e,s)}FT(t,e)}};bL=function(){return Rt};SL=function(t,e){var n=Rt;try{return Rt=t,e()}finally{Rt=n}};zC=function(t,e,n){switch(e){case"input":if(AC(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var s=n[e];if(s!==t&&s.form===t.form){var r=nx(s);if(!r)throw Error(me(90));ZF(s),AC(s,r)}}}break;case"textarea":tL(t,n);break;case"select":e=n.value,e!=null&&mh(t,!!n.multiple,e,!1)}};lL=RT;uL=Bu;var D9={usingClientEntryPoint:!1,Events:[Um,ih,nx,oL,aL,RT]},Kf={findFiberByHostInstance:xu,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},O9={bundleType:Kf.bundleType,version:Kf.version,rendererPackageName:Kf.rendererPackageName,rendererConfig:Kf.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ga.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=dL(t),t===null?null:t.stateNode},findFiberByHostInstance:Kf.findFiberByHostInstance||R9,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var I0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!I0.isDisabled&&I0.supportsFiber)try{Jw=I0.inject(O9),uo=I0}catch{}}Vr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=D9;Vr.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!MT(e))throw Error(me(200));return $9(t,e,null,n)};Vr.createRoot=function(t,e){if(!MT(t))throw Error(me(299));var n=!1,s="",r=jM;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(s=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=PT(t,1,!1,null,null,n,!1,s,r),t[sa]=e.current,Xp(t.nodeType===8?t.parentNode:t),new LT(e)};Vr.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(me(188)):(t=Object.keys(t).join(","),Error(me(268,t)));return t=dL(e),t=t===null?null:t.stateNode,t};Vr.flushSync=function(t){return Bu(t)};Vr.hydrate=function(t,e,n){if(!hx(e))throw Error(me(200));return dx(null,t,e,!0,n)};Vr.hydrateRoot=function(t,e,n){if(!MT(t))throw Error(me(405));var s=n!=null&&n.hydratedSources||null,r=!1,i="",o=jM;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=WM(e,null,t,1,n??null,r,!1,i,o),t[sa]=e.current,Xp(t),s)for(t=0;t<s.length;t++)n=s[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new cx(e)};Vr.render=function(t,e,n){if(!hx(e))throw Error(me(200));return dx(null,t,e,!1,n)};Vr.unmountComponentAtNode=function(t){if(!hx(t))throw Error(me(40));return t._reactRootContainer?(Bu(function(){dx(null,null,t,!1,function(){t._reactRootContainer=null,t[sa]=null})}),!0):!1};Vr.unstable_batchedUpdates=RT;Vr.unstable_renderSubtreeIntoContainer=function(t,e,n,s){if(!hx(n))throw Error(me(200));if(t==null||t._reactInternals===void 0)throw Error(me(38));return dx(t,e,n,!1,s)};Vr.version="18.3.1-next-f1338f8080-20240426";function GM(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(GM)}catch(t){console.error(t)}}GM(),GF.exports=Vr;var HM=GF.exports,qM,uD=HM;qM=uD.createRoot,uD.hydrateRoot;var zT={};Object.defineProperty(zT,"__esModule",{value:!0});zT.parse=V9;zT.serialize=U9;const P9=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,F9=/^[\u0021-\u003A\u003C-\u007E]*$/,L9=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,M9=/^[\u0020-\u003A\u003D-\u007E]*$/,z9=Object.prototype.toString,B9=(()=>{const t=function(){};return t.prototype=Object.create(null),t})();function V9(t,e){const n=new B9,s=t.length;if(s<2)return n;const r=(e==null?void 0:e.decode)||W9;let i=0;do{const o=t.indexOf("=",i);if(o===-1)break;const a=t.indexOf(";",i),l=a===-1?s:a;if(o>l){i=t.lastIndexOf(";",o-1)+1;continue}const u=cD(t,i,o),c=hD(t,o,u),h=t.slice(u,c);if(n[h]===void 0){let d=cD(t,o+1,l),f=hD(t,l,d);const p=r(t.slice(d,f));n[h]=p}i=l+1}while(i<s);return n}function cD(t,e,n){do{const s=t.charCodeAt(e);if(s!==32&&s!==9)return e}while(++e<n);return n}function hD(t,e,n){for(;e>n;){const s=t.charCodeAt(--e);if(s!==32&&s!==9)return e+1}return n}function U9(t,e,n){const s=(n==null?void 0:n.encode)||encodeURIComponent;if(!P9.test(t))throw new TypeError(`argument name is invalid: ${t}`);const r=s(e);if(!F9.test(r))throw new TypeError(`argument val is invalid: ${e}`);let i=t+"="+r;if(!n)return i;if(n.maxAge!==void 0){if(!Number.isInteger(n.maxAge))throw new TypeError(`option maxAge is invalid: ${n.maxAge}`);i+="; Max-Age="+n.maxAge}if(n.domain){if(!L9.test(n.domain))throw new TypeError(`option domain is invalid: ${n.domain}`);i+="; Domain="+n.domain}if(n.path){if(!M9.test(n.path))throw new TypeError(`option path is invalid: ${n.path}`);i+="; Path="+n.path}if(n.expires){if(!j9(n.expires)||!Number.isFinite(n.expires.valueOf()))throw new TypeError(`option expires is invalid: ${n.expires}`);i+="; Expires="+n.expires.toUTCString()}if(n.httpOnly&&(i+="; HttpOnly"),n.secure&&(i+="; Secure"),n.partitioned&&(i+="; Partitioned"),n.priority)switch(typeof n.priority=="string"?n.priority.toLowerCase():void 0){case"low":i+="; Priority=Low";break;case"medium":i+="; Priority=Medium";break;case"high":i+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${n.priority}`)}if(n.sameSite)switch(typeof n.sameSite=="string"?n.sameSite.toLowerCase():n.sameSite){case!0:case"strict":i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"none":i+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${n.sameSite}`)}return i}function W9(t){if(t.indexOf("%")===-1)return t;try{return decodeURIComponent(t)}catch{return t}}function j9(t){return z9.call(t)==="[object Date]"}/**
 * react-router v7.0.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var dD="popstate";function G9(t={}){function e(s,r){let{pathname:i,search:o,hash:a}=s.location;return rm("",{pathname:i,search:o,hash:a},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function n(s,r){return typeof r=="string"?r:Sl(r)}return q9(e,n,null,t)}function dt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function ls(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function H9(){return Math.random().toString(36).substring(2,10)}function fD(t,e){return{usr:t.state,key:t.key,idx:e}}function rm(t,e,n=null,s){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?Vl(e):e,state:n,key:e&&e.key||s||H9()}}function Sl({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Vl(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let s=t.indexOf("?");s>=0&&(e.search=t.substring(s),t=t.substring(0,s)),t&&(e.pathname=t)}return e}function q9(t,e,n,s={}){let{window:r=document.defaultView,v5Compat:i=!1}=s,o=r.history,a="POP",l=null,u=c();u==null&&(u=0,o.replaceState({...o.state,idx:u},""));function c(){return(o.state||{idx:null}).idx}function h(){a="POP";let v=c(),g=v==null?null:v-u;u=v,l&&l({action:a,location:m.location,delta:g})}function d(v,g){a="PUSH";let w=rm(m.location,v,g);u=c()+1;let b=fD(w,u),x=m.createHref(w);try{o.pushState(b,"",x)}catch(S){if(S instanceof DOMException&&S.name==="DataCloneError")throw S;r.location.assign(x)}i&&l&&l({action:a,location:m.location,delta:1})}function f(v,g){a="REPLACE";let w=rm(m.location,v,g);u=c();let b=fD(w,u),x=m.createHref(w);o.replaceState(b,"",x),i&&l&&l({action:a,location:m.location,delta:0})}function p(v){let g=r.location.origin!=="null"?r.location.origin:r.location.href,w=typeof v=="string"?v:Sl(v);return w=w.replace(/ $/,"%20"),dt(g,`No window.location.(origin|href) available to create URL for href: ${w}`),new URL(w,g)}let m={get action(){return a},get location(){return t(r,o)},listen(v){if(l)throw new Error("A history only accepts one active listener");return r.addEventListener(dD,h),l=v,()=>{r.removeEventListener(dD,h),l=null}},createHref(v){return e(r,v)},createURL:p,encodeLocation(v){let g=p(v);return{pathname:g.pathname,search:g.search,hash:g.hash}},push:d,replace:f,go(v){return o.go(v)}};return m}var K9=new Set(["lazy","caseSensitive","path","id","index","children"]);function X9(t){return t.index===!0}function Hv(t,e,n=[],s={}){return t.map((r,i)=>{let o=[...n,String(i)],a=typeof r.id=="string"?r.id:o.join("-");if(dt(r.index!==!0||!r.children,"Cannot specify children on an index route"),dt(!s[a],`Found a route id collision on id "${a}".  Route id's must be globally unique within Data Router usages`),X9(r)){let l={...r,...e(r),id:a};return s[a]=l,l}else{let l={...r,...e(r),id:a,children:void 0};return s[a]=l,r.children&&(l.children=Hv(r.children,e,o,s)),l}})}function Ha(t,e,n="/"){return rv(t,e,n,!1)}function rv(t,e,n,s){let r=typeof e=="string"?Vl(e):e,i=Bi(r.pathname||"/",n);if(i==null)return null;let o=KM(t);Q9(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let u=lq(i);a=oq(o[l],u,s)}return a}function Y9(t,e){let{route:n,pathname:s,params:r}=t;return{id:n.id,pathname:s,params:r,data:e[n.id],handle:n.handle}}function KM(t,e=[],n=[],s=""){let r=(i,o,a)=>{let l={relativePath:a===void 0?i.path||"":a,caseSensitive:i.caseSensitive===!0,childrenIndex:o,route:i};l.relativePath.startsWith("/")&&(dt(l.relativePath.startsWith(s),`Absolute route path "${l.relativePath}" nested under path "${s}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),l.relativePath=l.relativePath.slice(s.length));let u=ho([s,l.relativePath]),c=n.concat(l);i.children&&i.children.length>0&&(dt(i.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${u}".`),KM(i.children,e,c,u)),!(i.path==null&&!i.index)&&e.push({path:u,score:rq(u,i.index),routesMeta:c})};return t.forEach((i,o)=>{var a;if(i.path===""||!((a=i.path)!=null&&a.includes("?")))r(i,o);else for(let l of XM(i.path))r(i,o,l)}),e}function XM(t){let e=t.split("/");if(e.length===0)return[];let[n,...s]=e,r=n.endsWith("?"),i=n.replace(/\?$/,"");if(s.length===0)return r?[i,""]:[i];let o=XM(s.join("/")),a=[];return a.push(...o.map(l=>l===""?i:[i,l].join("/"))),r&&a.push(...o),a.map(l=>t.startsWith("/")&&l===""?"/":l)}function Q9(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:iq(e.routesMeta.map(s=>s.childrenIndex),n.routesMeta.map(s=>s.childrenIndex)))}var J9=/^:[\w-]+$/,Z9=3,eq=2,tq=1,nq=10,sq=-2,pD=t=>t==="*";function rq(t,e){let n=t.split("/"),s=n.length;return n.some(pD)&&(s+=sq),e&&(s+=eq),n.filter(r=>!pD(r)).reduce((r,i)=>r+(J9.test(i)?Z9:i===""?tq:nq),s)}function iq(t,e){return t.length===e.length&&t.slice(0,-1).every((s,r)=>s===e[r])?t[t.length-1]-e[e.length-1]:0}function oq(t,e,n=!1){let{routesMeta:s}=t,r={},i="/",o=[];for(let a=0;a<s.length;++a){let l=s[a],u=a===s.length-1,c=i==="/"?e:e.slice(i.length)||"/",h=qv({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},c),d=l.route;if(!h&&u&&n&&!s[s.length-1].route.index&&(h=qv({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},c)),!h)return null;Object.assign(r,h.params),o.push({params:r,pathname:ho([i,h.pathname]),pathnameBase:hq(ho([i,h.pathnameBase])),route:d}),h.pathnameBase!=="/"&&(i=ho([i,h.pathnameBase]))}return o}function qv(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,s]=aq(t.path,t.caseSensitive,t.end),r=e.match(n);if(!r)return null;let i=r[0],o=i.replace(/(.)\/+$/,"$1"),a=r.slice(1);return{params:s.reduce((u,{paramName:c,isOptional:h},d)=>{if(c==="*"){let p=a[d]||"";o=i.slice(0,i.length-p.length).replace(/(.)\/+$/,"$1")}const f=a[d];return h&&!f?u[c]=void 0:u[c]=(f||"").replace(/%2F/g,"/"),u},{}),pathname:i,pathnameBase:o,pattern:t}}function aq(t,e=!1,n=!0){ls(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let s=[],r="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(s.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(s.push({paramName:"*"}),r+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?r+="\\/*$":t!==""&&t!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),s]}function lq(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return ls(!1,`The URL path "${t}" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function Bi(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,s=t.charAt(n);return s&&s!=="/"?null:t.slice(n)||"/"}function uq(t,e="/"){let{pathname:n,search:s="",hash:r=""}=typeof t=="string"?Vl(t):t;return{pathname:n?n.startsWith("/")?n:cq(n,e):e,search:dq(s),hash:fq(r)}}function cq(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(r=>{r===".."?n.length>1&&n.pop():r!=="."&&n.push(r)}),n.length>1?n.join("/"):"/"}function jS(t,e,n,s){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(s)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function YM(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function fx(t){let e=YM(t);return e.map((n,s)=>s===e.length-1?n.pathname:n.pathnameBase)}function px(t,e,n,s=!1){let r;typeof t=="string"?r=Vl(t):(r={...t},dt(!r.pathname||!r.pathname.includes("?"),jS("?","pathname","search",r)),dt(!r.pathname||!r.pathname.includes("#"),jS("#","pathname","hash",r)),dt(!r.search||!r.search.includes("#"),jS("#","search","hash",r)));let i=t===""||r.pathname==="",o=i?"/":r.pathname,a;if(o==null)a=n;else{let h=e.length-1;if(!s&&o.startsWith("..")){let d=o.split("/");for(;d[0]==="..";)d.shift(),h-=1;r.pathname=d.join("/")}a=h>=0?e[h]:"/"}let l=uq(r,a),u=o&&o!=="/"&&o.endsWith("/"),c=(i||o===".")&&n.endsWith("/");return!l.pathname.endsWith("/")&&(u||c)&&(l.pathname+="/"),l}var ho=t=>t.join("/").replace(/\/\/+/g,"/"),hq=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),dq=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,fq=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,Kv=class{constructor(t,e,n,s=!1){this.status=t,this.statusText=e||"",this.internal=s,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function mx(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}var QM=["POST","PUT","PATCH","DELETE"],pq=new Set(QM),mq=["GET",...QM],gq=new Set(mq),yq=new Set([301,302,303,307,308]),vq=new Set([307,308]),GS={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},wq={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},Xf={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},BT=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,xq=t=>({hasErrorBoundary:!!t.hasErrorBoundary}),JM="remix-router-transitions",ZM=Symbol("ResetLoaderData");function bq(t){const e=t.window?t.window:typeof window<"u"?window:void 0,n=typeof e<"u"&&typeof e.document<"u"&&typeof e.document.createElement<"u";dt(t.routes.length>0,"You must provide a non-empty routes array to createRouter");let s=t.mapRouteProperties||xq,r={},i=Hv(t.routes,s,void 0,r),o,a=t.basename||"/",l=t.dataStrategy||Tq,u=t.patchRoutesOnNavigation,c={...t.future},h=null,d=new Set,f=null,p=null,m=null,v=t.hydrationData!=null,g=Ha(i,t.history.location,a),w=null;if(g==null&&!u){let K=Xr(404,{pathname:t.history.location.pathname}),{matches:ee,route:oe}=_D(i);g=ee,w={[oe.id]:K}}g&&!t.hydrationData&&$a(g,i,t.history.location.pathname).active&&(g=null);let b;if(g)if(g.some(K=>K.route.lazy))b=!1;else if(!g.some(K=>K.route.loader))b=!0;else{let K=t.hydrationData?t.hydrationData.loaderData:null,ee=t.hydrationData?t.hydrationData.errors:null;if(ee){let oe=g.findIndex(ce=>ee[ce.route.id]!==void 0);b=g.slice(0,oe+1).every(ce=>!wI(ce.route,K,ee))}else b=g.every(oe=>!wI(oe.route,K,ee))}else{b=!1,g=[];let K=$a(null,i,t.history.location.pathname);K.active&&K.matches&&(g=K.matches)}let x,S={historyAction:t.history.action,location:t.history.location,matches:g,initialized:b,navigation:GS,restoreScrollPosition:t.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:t.hydrationData&&t.hydrationData.loaderData||{},actionData:t.hydrationData&&t.hydrationData.actionData||null,errors:t.hydrationData&&t.hydrationData.errors||w,fetchers:new Map,blockers:new Map},N="POP",I=!1,C,_=!1,k=new Map,A=null,D=!1,R=!1,W=new Set,B=new Map,M=0,X=-1,z=new Map,Y=new Set,L=new Map,le=new Map,Q=new Set,se=new Map,de,ue=null;function fe(){if(h=t.history.listen(({action:K,location:ee,delta:oe})=>{if(de){de(),de=void 0;return}ls(se.size===0||oe!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let ce=qy({currentLocation:S.location,nextLocation:ee,historyAction:K});if(ce&&oe!=null){let ke=new Promise(Pe=>{de=Pe});t.history.go(oe*-1),Bc(ce,{state:"blocked",location:ee,proceed(){Bc(ce,{state:"proceeding",proceed:void 0,reset:void 0,location:ee}),ke.then(()=>t.history.go(oe))},reset(){let Pe=new Map(S.blockers);Pe.set(ce,Xf),Ie({blockers:Pe})}});return}return Qe(K,ee)}),n){Lq(e,k);let K=()=>Mq(e,k);e.addEventListener("pagehide",K),A=()=>e.removeEventListener("pagehide",K)}return S.initialized||Qe("POP",S.location,{initialHydration:!0}),x}function ve(){h&&h(),A&&A(),d.clear(),C&&C.abort(),S.fetchers.forEach((K,ee)=>fn(ee)),S.blockers.forEach((K,ee)=>Na(ee))}function De(K){return d.add(K),()=>d.delete(K)}function Ie(K,ee={}){S={...S,...K};let oe=[],ce=[];S.fetchers.forEach((ke,Pe)=>{ke.state==="idle"&&(Q.has(Pe)?oe.push(Pe):ce.push(Pe))}),[...d].forEach(ke=>ke(S,{deletedFetchers:oe,viewTransitionOpts:ee.viewTransitionOpts,flushSync:ee.flushSync===!0})),oe.forEach(ke=>fn(ke)),ce.forEach(ke=>S.fetchers.delete(ke))}function Oe(K,ee,{flushSync:oe}={}){var Ce,He;let ce=S.actionData!=null&&S.navigation.formMethod!=null&&Si(S.navigation.formMethod)&&S.navigation.state==="loading"&&((Ce=K.state)==null?void 0:Ce._isRedirect)!==!0,ke;ee.actionData?Object.keys(ee.actionData).length>0?ke=ee.actionData:ke=null:ce?ke=S.actionData:ke=null;let Pe=ee.loaderData?CD(S.loaderData,ee.loaderData,ee.matches||[],ee.errors):S.loaderData,Be=S.blockers;Be.size>0&&(Be=new Map(Be),Be.forEach((tt,Dt)=>Be.set(Dt,Xf)));let $e=I===!0||S.navigation.formMethod!=null&&Si(S.navigation.formMethod)&&((He=K.state)==null?void 0:He._isRedirect)!==!0;o&&(i=o,o=void 0),D||N==="POP"||(N==="PUSH"?t.history.push(K,K.state):N==="REPLACE"&&t.history.replace(K,K.state));let Fe;if(N==="POP"){let tt=k.get(S.location.pathname);tt&&tt.has(K.pathname)?Fe={currentLocation:S.location,nextLocation:K}:k.has(K.pathname)&&(Fe={currentLocation:K,nextLocation:S.location})}else if(_){let tt=k.get(S.location.pathname);tt?tt.add(K.pathname):(tt=new Set([K.pathname]),k.set(S.location.pathname,tt)),Fe={currentLocation:S.location,nextLocation:K}}Ie({...ee,actionData:ke,loaderData:Pe,historyAction:N,location:K,initialized:!0,navigation:GS,revalidation:"idle",restoreScrollPosition:Vc(K,ee.matches||S.matches),preventScrollReset:$e,blockers:Be},{viewTransitionOpts:Fe,flushSync:oe===!0}),N="POP",I=!1,_=!1,D=!1,R=!1,ue==null||ue.resolve(),ue=null}async function ze(K,ee){if(typeof K=="number"){t.history.go(K);return}let oe=vI(S.location,S.matches,a,K,ee==null?void 0:ee.fromRouteId,ee==null?void 0:ee.relative),{path:ce,submission:ke,error:Pe}=mD(!1,oe,ee),Be=S.location,$e=rm(S.location,ce,ee&&ee.state);$e={...$e,...t.history.encodeLocation($e)};let Fe=ee&&ee.replace!=null?ee.replace:void 0,Ce="PUSH";Fe===!0?Ce="REPLACE":Fe===!1||ke!=null&&Si(ke.formMethod)&&ke.formAction===S.location.pathname+S.location.search&&(Ce="REPLACE");let He=ee&&"preventScrollReset"in ee?ee.preventScrollReset===!0:void 0,tt=(ee&&ee.flushSync)===!0,Dt=qy({currentLocation:Be,nextLocation:$e,historyAction:Ce});if(Dt){Bc(Dt,{state:"blocked",location:$e,proceed(){Bc(Dt,{state:"proceeding",proceed:void 0,reset:void 0,location:$e}),ze(K,ee)},reset(){let zn=new Map(S.blockers);zn.set(Dt,Xf),Ie({blockers:zn})}});return}await Qe(Ce,$e,{submission:ke,pendingError:Pe,preventScrollReset:He,replace:ee&&ee.replace,enableViewTransition:ee&&ee.viewTransition,flushSync:tt})}function Ye(){ue||(ue=zq()),In(),Ie({revalidation:"loading"});let K=ue.promise;return S.navigation.state==="submitting"?K:S.navigation.state==="idle"?(Qe(S.historyAction,S.location,{startUninterruptedRevalidation:!0}),K):(Qe(N||S.historyAction,S.navigation.location,{overrideNavigation:S.navigation,enableViewTransition:_===!0}),K)}async function Qe(K,ee,oe){C&&C.abort(),C=null,N=K,D=(oe&&oe.startUninterruptedRevalidation)===!0,nu(S.location,S.matches),I=(oe&&oe.preventScrollReset)===!0,_=(oe&&oe.enableViewTransition)===!0;let ce=o||i,ke=oe&&oe.overrideNavigation,Pe=Ha(ce,ee,a),Be=(oe&&oe.flushSync)===!0,$e=$a(Pe,ce,ee.pathname);if($e.active&&$e.matches&&(Pe=$e.matches),!Pe){let{error:Lt,notFoundMatches:It,route:Ot}=tu(ee.pathname);Oe(ee,{matches:It,loaderData:{},errors:{[Ot.id]:Lt}},{flushSync:Be});return}if(S.initialized&&!R&&Aq(S.location,ee)&&!(oe&&oe.submission&&Si(oe.submission.formMethod))){Oe(ee,{matches:Pe},{flushSync:Be});return}C=new AbortController;let Fe=qc(t.history,ee,C.signal,oe&&oe.submission),Ce;if(oe&&oe.pendingError)Ce=[pu(Pe).route.id,{type:"error",error:oe.pendingError}];else if(oe&&oe.submission&&Si(oe.submission.formMethod)){let Lt=await xt(Fe,ee,oe.submission,Pe,$e.active,{replace:oe.replace,flushSync:Be});if(Lt.shortCircuited)return;if(Lt.pendingActionResult){let[It,Ot]=Lt.pendingActionResult;if(Er(Ot)&&mx(Ot.error)&&Ot.error.status===404){C=null,Oe(ee,{matches:Lt.matches,loaderData:{},errors:{[It]:Ot.error}});return}}Pe=Lt.matches||Pe,Ce=Lt.pendingActionResult,ke=HS(ee,oe.submission),Be=!1,$e.active=!1,Fe=qc(t.history,Fe.url,Fe.signal)}let{shortCircuited:He,matches:tt,loaderData:Dt,errors:zn}=await ft(Fe,ee,Pe,$e.active,ke,oe&&oe.submission,oe&&oe.fetcherSubmission,oe&&oe.replace,oe&&oe.initialHydration===!0,Be,Ce);He||(C=null,Oe(ee,{matches:tt||Pe,...ID(Ce),loaderData:Dt,errors:zn}))}async function xt(K,ee,oe,ce,ke,Pe={}){In();let Be=Pq(ee,oe);if(Ie({navigation:Be},{flushSync:Pe.flushSync===!0}),ke){let Ce=await pi(ce,ee.pathname,K.signal);if(Ce.type==="aborted")return{shortCircuited:!0};if(Ce.type==="error"){let He=pu(Ce.partialMatches).route.id;return{matches:Ce.partialMatches,pendingActionResult:[He,{type:"error",error:Ce.error}]}}else if(Ce.matches)ce=Ce.matches;else{let{notFoundMatches:He,error:tt,route:Dt}=tu(ee.pathname);return{matches:He,pendingActionResult:[Dt.id,{type:"error",error:tt}]}}}let $e,Fe=hp(ce,ee);if(!Fe.route.action&&!Fe.route.lazy)$e={type:"error",error:Xr(405,{method:K.method,pathname:ee.pathname,routeId:Fe.route.id})};else if($e=(await Wt("action",S,K,[Fe],ce,null))[Fe.route.id],K.signal.aborted)return{shortCircuited:!0};if(Cu($e)){let Ce;return Pe&&Pe.replace!=null?Ce=Pe.replace:Ce=xD($e.response.headers.get("Location"),new URL(K.url),a)===S.location.pathname+S.location.search,await an(K,$e,!0,{submission:oe,replace:Ce}),{shortCircuited:!0}}if(Er($e)){let Ce=pu(ce,Fe.route.id);return(Pe&&Pe.replace)!==!0&&(N="PUSH"),{matches:ce,pendingActionResult:[Ce.route.id,$e]}}return{matches:ce,pendingActionResult:[Fe.route.id,$e]}}async function ft(K,ee,oe,ce,ke,Pe,Be,$e,Fe,Ce,He){let tt=ke||HS(ee,Pe),Dt=Pe||Be||kD(tt),zn=!D&&!Fe;if(ce){if(zn){let pn=at(He);Ie({navigation:tt,...pn!==void 0?{actionData:pn}:{}},{flushSync:Ce})}let _t=await pi(oe,ee.pathname,K.signal);if(_t.type==="aborted")return{shortCircuited:!0};if(_t.type==="error"){let pn=pu(_t.partialMatches).route.id;return{matches:_t.partialMatches,loaderData:{},errors:{[pn]:_t.error}}}else if(_t.matches)oe=_t.matches;else{let{error:pn,notFoundMatches:Gr,route:Do}=tu(ee.pathname);return{matches:Gr,loaderData:{},errors:{[Do.id]:pn}}}}let Lt=o||i,[It,Ot]=yD(t.history,S,oe,Dt,ee,Fe===!0,R,W,Q,L,Y,Lt,a,He);if(X=++M,It.length===0&&Ot.length===0){let _t=Ji();return Oe(ee,{matches:oe,loaderData:{},errors:He&&Er(He[1])?{[He[0]]:He[1].error}:null,...ID(He),..._t?{fetchers:new Map(S.fetchers)}:{}},{flushSync:Ce}),{shortCircuited:!0}}if(zn){let _t={};if(!ce){_t.navigation=tt;let pn=at(He);pn!==void 0&&(_t.actionData=pn)}Ot.length>0&&(_t.fetchers=Ct(Ot)),Ie(_t,{flushSync:Ce})}Ot.forEach(_t=>{Bs(_t.key),_t.controller&&B.set(_t.key,_t.controller)});let $o=()=>Ot.forEach(_t=>Bs(_t.key));C&&C.signal.addEventListener("abort",$o);let{loaderResults:Ra,fetcherResults:Ir}=await ms(S,oe,It,Ot,K);if(K.signal.aborted)return{shortCircuited:!0};C&&C.signal.removeEventListener("abort",$o),Ot.forEach(_t=>B.delete(_t.key));let sr=_0(Ra);if(sr)return await an(K,sr.result,!0,{replace:$e}),{shortCircuited:!0};if(sr=_0(Ir),sr)return Y.add(sr.key),await an(K,sr.result,!0,{replace:$e}),{shortCircuited:!0};let{loaderData:Uc,errors:Aa}=SD(S,oe,Ra,He,Ot,Ir);Fe&&S.errors&&(Aa={...S.errors,...Aa});let Ro=Ji(),Ao=Zi(X),su=Ro||Ao||Ot.length>0;return{matches:oe,loaderData:Uc,errors:Aa,...su?{fetchers:new Map(S.fetchers)}:{}}}function at(K){if(K&&!Er(K[1]))return{[K[0]]:K[1].data};if(S.actionData)return Object.keys(S.actionData).length===0?null:S.actionData}function Ct(K){return K.forEach(ee=>{let oe=S.fetchers.get(ee.key),ce=Yf(void 0,oe?oe.data:void 0);S.fetchers.set(ee.key,ce)}),new Map(S.fetchers)}async function vt(K,ee,oe,ce){Bs(K);let ke=(ce&&ce.flushSync)===!0,Pe=o||i,Be=vI(S.location,S.matches,a,oe,ee,ce==null?void 0:ce.relative),$e=Ha(Pe,Be,a),Fe=$a($e,Pe,Be);if(Fe.active&&Fe.matches&&($e=Fe.matches),!$e){nt(K,ee,Xr(404,{pathname:Be}),{flushSync:ke});return}let{path:Ce,submission:He,error:tt}=mD(!0,Be,ce);if(tt){nt(K,ee,tt,{flushSync:ke});return}let Dt=hp($e,Ce),zn=(ce&&ce.preventScrollReset)===!0;if(He&&Si(He.formMethod)){await Jn(K,ee,Ce,Dt,$e,Fe.active,ke,zn,He);return}L.set(K,{routeId:ee,path:Ce}),await Ut(K,ee,Ce,Dt,$e,Fe.active,ke,zn,He)}async function Jn(K,ee,oe,ce,ke,Pe,Be,$e,Fe){In(),L.delete(K);function Ce(mn){if(!mn.route.action&&!mn.route.lazy){let Oo=Xr(405,{method:Fe.formMethod,pathname:oe,routeId:ee});return nt(K,ee,Oo,{flushSync:Be}),!0}return!1}if(!Pe&&Ce(ce))return;let He=S.fetchers.get(K);ln(K,Fq(Fe,He),{flushSync:Be});let tt=new AbortController,Dt=qc(t.history,oe,tt.signal,Fe);if(Pe){let mn=await pi(ke,oe,Dt.signal);if(mn.type==="aborted")return;if(mn.type==="error"){nt(K,ee,mn.error,{flushSync:Be});return}else if(mn.matches){if(ke=mn.matches,ce=hp(ke,oe),Ce(ce))return}else{nt(K,ee,Xr(404,{pathname:oe}),{flushSync:Be});return}}B.set(K,tt);let zn=M,It=(await Wt("action",S,Dt,[ce],ke,K))[ce.route.id];if(Dt.signal.aborted){B.get(K)===tt&&B.delete(K);return}if(Q.has(K)){if(Cu(It)||Er(It)){ln(K,za(void 0));return}}else{if(Cu(It))if(B.delete(K),X>zn){ln(K,za(void 0));return}else return Y.add(K),ln(K,Yf(Fe)),an(Dt,It,!1,{fetcherSubmission:Fe,preventScrollReset:$e});if(Er(It)){nt(K,ee,It.error);return}}let Ot=S.navigation.location||S.location,$o=qc(t.history,Ot,tt.signal),Ra=o||i,Ir=S.navigation.state!=="idle"?Ha(Ra,S.navigation.location,a):S.matches;dt(Ir,"Didn't find any matches after fetcher action");let sr=++M;z.set(K,sr);let Uc=Yf(Fe,It.data);S.fetchers.set(K,Uc);let[Aa,Ro]=yD(t.history,S,Ir,Fe,Ot,!1,R,W,Q,L,Y,Ra,a,[ce.route.id,It]);Ro.filter(mn=>mn.key!==K).forEach(mn=>{let Oo=mn.key,Df=S.fetchers.get(Oo),Qy=Yf(void 0,Df?Df.data:void 0);S.fetchers.set(Oo,Qy),Bs(Oo),mn.controller&&B.set(Oo,mn.controller)}),Ie({fetchers:new Map(S.fetchers)});let Ao=()=>Ro.forEach(mn=>Bs(mn.key));tt.signal.addEventListener("abort",Ao);let{loaderResults:su,fetcherResults:_t}=await ms(S,Ir,Aa,Ro,$o);if(tt.signal.aborted)return;tt.signal.removeEventListener("abort",Ao),z.delete(K),B.delete(K),Ro.forEach(mn=>B.delete(mn.key));let pn=_0(su);if(pn)return an($o,pn.result,!1,{preventScrollReset:$e});if(pn=_0(_t),pn)return Y.add(pn.key),an($o,pn.result,!1,{preventScrollReset:$e});let{loaderData:Gr,errors:Do}=SD(S,Ir,su,void 0,Ro,_t);if(S.fetchers.has(K)){let mn=za(It.data);S.fetchers.set(K,mn)}Zi(sr),S.navigation.state==="loading"&&sr>X?(dt(N,"Expected pending action"),C&&C.abort(),Oe(S.navigation.location,{matches:Ir,loaderData:Gr,errors:Do,fetchers:new Map(S.fetchers)})):(Ie({errors:Do,loaderData:CD(S.loaderData,Gr,Ir,Do),fetchers:new Map(S.fetchers)}),R=!1)}async function Ut(K,ee,oe,ce,ke,Pe,Be,$e,Fe){let Ce=S.fetchers.get(K);ln(K,Yf(Fe,Ce?Ce.data:void 0),{flushSync:Be});let He=new AbortController,tt=qc(t.history,oe,He.signal);if(Pe){let It=await pi(ke,oe,tt.signal);if(It.type==="aborted")return;if(It.type==="error"){nt(K,ee,It.error,{flushSync:Be});return}else if(It.matches)ke=It.matches,ce=hp(ke,oe);else{nt(K,ee,Xr(404,{pathname:oe}),{flushSync:Be});return}}B.set(K,He);let Dt=M,Lt=(await Wt("loader",S,tt,[ce],ke,K))[ce.route.id];if(B.get(K)===He&&B.delete(K),!tt.signal.aborted){if(Q.has(K)){ln(K,za(void 0));return}if(Cu(Lt))if(X>Dt){ln(K,za(void 0));return}else{Y.add(K),await an(tt,Lt,!1,{preventScrollReset:$e});return}if(Er(Lt)){nt(K,ee,Lt.error);return}ln(K,za(Lt.data))}}async function an(K,ee,oe,{submission:ce,fetcherSubmission:ke,preventScrollReset:Pe,replace:Be}={}){ee.response.headers.has("X-Remix-Revalidate")&&(R=!0);let $e=ee.response.headers.get("Location");dt($e,"Expected a Location header on the redirect Response"),$e=xD($e,new URL(K.url),a);let Fe=rm(S.location,$e,{_isRedirect:!0});if(n){let Lt=!1;if(ee.response.headers.has("X-Remix-Reload-Document"))Lt=!0;else if(BT.test($e)){const It=t.history.createURL($e);Lt=It.origin!==e.location.origin||Bi(It.pathname,a)==null}if(Lt){Be?e.location.replace($e):e.location.assign($e);return}}C=null;let Ce=Be===!0||ee.response.headers.has("X-Remix-Replace")?"REPLACE":"PUSH",{formMethod:He,formAction:tt,formEncType:Dt}=S.navigation;!ce&&!ke&&He&&tt&&Dt&&(ce=kD(S.navigation));let zn=ce||ke;if(vq.has(ee.response.status)&&zn&&Si(zn.formMethod))await Qe(Ce,Fe,{submission:{...zn,formAction:$e},preventScrollReset:Pe||I,enableViewTransition:oe?_:void 0});else{let Lt=HS(Fe,ce);await Qe(Ce,Fe,{overrideNavigation:Lt,fetcherSubmission:ke,preventScrollReset:Pe||I,enableViewTransition:oe?_:void 0})}}async function Wt(K,ee,oe,ce,ke,Pe){let Be,$e={};try{Be=await kq(l,K,ee,oe,ce,ke,Pe,r,s)}catch(Fe){return ce.forEach(Ce=>{$e[Ce.route.id]={type:"error",error:Fe}}),$e}for(let[Fe,Ce]of Object.entries(Be))if(Dq(Ce)){let He=Ce.result;$e[Fe]={type:"redirect",response:$q(He,oe,Fe,ke,a)}}else $e[Fe]=await Nq(Ce);return $e}async function ms(K,ee,oe,ce,ke){let Pe=Wt("loader",K,ke,oe,ee,null),Be=Promise.all(ce.map(async Ce=>{if(Ce.matches&&Ce.match&&Ce.controller){let tt=(await Wt("loader",K,qc(t.history,Ce.path,Ce.controller.signal),[Ce.match],Ce.matches,Ce.key))[Ce.match.route.id];return{[Ce.key]:tt}}else return Promise.resolve({[Ce.key]:{type:"error",error:Xr(404,{pathname:Ce.path})}})})),$e=await Pe,Fe=(await Be).reduce((Ce,He)=>Object.assign(Ce,He),{});return{loaderResults:$e,fetcherResults:Fe}}function In(){R=!0,L.forEach((K,ee)=>{B.has(ee)&&W.add(ee),Bs(ee)})}function ln(K,ee,oe={}){S.fetchers.set(K,ee),Ie({fetchers:new Map(S.fetchers)},{flushSync:(oe&&oe.flushSync)===!0})}function nt(K,ee,oe,ce={}){let ke=pu(S.matches,ee);fn(K),Ie({errors:{[ke.route.id]:oe},fetchers:new Map(S.fetchers)},{flushSync:(ce&&ce.flushSync)===!0})}function Nt(K){return le.set(K,(le.get(K)||0)+1),Q.has(K)&&Q.delete(K),S.fetchers.get(K)||wq}function fn(K){let ee=S.fetchers.get(K);B.has(K)&&!(ee&&ee.state==="loading"&&z.has(K))&&Bs(K),L.delete(K),z.delete(K),Y.delete(K),Q.delete(K),W.delete(K),S.fetchers.delete(K)}function jr(K){let ee=(le.get(K)||0)-1;ee<=0?(le.delete(K),Q.add(K)):le.set(K,ee),Ie({fetchers:new Map(S.fetchers)})}function Bs(K){let ee=B.get(K);ee&&(ee.abort(),B.delete(K))}function Ea(K){for(let ee of K){let oe=Nt(ee),ce=za(oe.data);S.fetchers.set(ee,ce)}}function Ji(){let K=[],ee=!1;for(let oe of Y){let ce=S.fetchers.get(oe);dt(ce,`Expected fetcher: ${oe}`),ce.state==="loading"&&(Y.delete(oe),K.push(oe),ee=!0)}return Ea(K),ee}function Zi(K){let ee=[];for(let[oe,ce]of z)if(ce<K){let ke=S.fetchers.get(oe);dt(ke,`Expected fetcher: ${oe}`),ke.state==="loading"&&(Bs(oe),z.delete(oe),ee.push(oe))}return Ea(ee),ee.length>0}function zc(K,ee){let oe=S.blockers.get(K)||Xf;return se.get(K)!==ee&&se.set(K,ee),oe}function Na(K){S.blockers.delete(K),se.delete(K)}function Bc(K,ee){let oe=S.blockers.get(K)||Xf;dt(oe.state==="unblocked"&&ee.state==="blocked"||oe.state==="blocked"&&ee.state==="blocked"||oe.state==="blocked"&&ee.state==="proceeding"||oe.state==="blocked"&&ee.state==="unblocked"||oe.state==="proceeding"&&ee.state==="unblocked",`Invalid blocker state transition: ${oe.state} -> ${ee.state}`);let ce=new Map(S.blockers);ce.set(K,ee),Ie({blockers:ce})}function qy({currentLocation:K,nextLocation:ee,historyAction:oe}){if(se.size===0)return;se.size>1&&ls(!1,"A router only supports one blocker at a time");let ce=Array.from(se.entries()),[ke,Pe]=ce[ce.length-1],Be=S.blockers.get(ke);if(!(Be&&Be.state==="proceeding")&&Pe({currentLocation:K,nextLocation:ee,historyAction:oe}))return ke}function tu(K){let ee=Xr(404,{pathname:K}),oe=o||i,{matches:ce,route:ke}=_D(oe);return{notFoundMatches:ce,route:ke,error:ee}}function Ky(K,ee,oe){if(f=K,m=ee,p=oe||null,!v&&S.navigation===GS){v=!0;let ce=Vc(S.location,S.matches);ce!=null&&Ie({restoreScrollPosition:ce})}return()=>{f=null,m=null,p=null}}function Xy(K,ee){return p&&p(K,ee.map(ce=>Y9(ce,S.loaderData)))||K.key}function nu(K,ee){if(f&&m){let oe=Xy(K,ee);f[oe]=m()}}function Vc(K,ee){if(f){let oe=Xy(K,ee),ce=f[oe];if(typeof ce=="number")return ce}return null}function $a(K,ee,oe){if(u)if(K){if(Object.keys(K[0].params).length>0)return{active:!0,matches:rv(ee,oe,a,!0)}}else return{active:!0,matches:rv(ee,oe,a,!0)||[]};return{active:!1,matches:null}}async function pi(K,ee,oe){if(!u)return{type:"success",matches:K};let ce=K;for(;;){let ke=o==null,Pe=o||i,Be=r;try{await u({path:ee,matches:ce,patch:(Ce,He)=>{oe.aborted||wD(Ce,He,Pe,Be,s)}})}catch(Ce){return{type:"error",error:Ce,partialMatches:ce}}finally{ke&&!oe.aborted&&(i=[...i])}if(oe.aborted)return{type:"aborted"};let $e=Ha(Pe,ee,a);if($e)return{type:"success",matches:$e};let Fe=rv(Pe,ee,a,!0);if(!Fe||ce.length===Fe.length&&ce.every((Ce,He)=>Ce.route.id===Fe[He].route.id))return{type:"success",matches:null};ce=Fe}}function Yy(K){r={},o=Hv(K,s,void 0,r)}function Af(K,ee){let oe=o==null;wD(K,ee,o||i,r,s),oe&&(i=[...i],Ie({}))}return x={get basename(){return a},get future(){return c},get state(){return S},get routes(){return i},get window(){return e},initialize:fe,subscribe:De,enableScrollRestoration:Ky,navigate:ze,fetch:vt,revalidate:Ye,createHref:K=>t.history.createHref(K),encodeLocation:K=>t.history.encodeLocation(K),getFetcher:Nt,deleteFetcher:jr,dispose:ve,getBlocker:zc,deleteBlocker:Na,patchRoutes:Af,_internalFetchControllers:B,_internalSetRoutes:Yy},x}function Sq(t){return t!=null&&("formData"in t&&t.formData!=null||"body"in t&&t.body!==void 0)}function vI(t,e,n,s,r,i){let o,a;if(r){o=[];for(let u of e)if(o.push(u),u.route.id===r){a=u;break}}else o=e,a=e[e.length-1];let l=px(s||".",fx(o),Bi(t.pathname,n)||t.pathname,i==="path");if(s==null&&(l.search=t.search,l.hash=t.hash),(s==null||s===""||s===".")&&a){let u=VT(l.search);if(a.route.index&&!u)l.search=l.search?l.search.replace(/^\?/,"?index&"):"?index";else if(!a.route.index&&u){let c=new URLSearchParams(l.search),h=c.getAll("index");c.delete("index"),h.filter(f=>f).forEach(f=>c.append("index",f));let d=c.toString();l.search=d?`?${d}`:""}}return n!=="/"&&(l.pathname=l.pathname==="/"?n:ho([n,l.pathname])),Sl(l)}function mD(t,e,n){if(!n||!Sq(n))return{path:e};if(n.formMethod&&!Oq(n.formMethod))return{path:e,error:Xr(405,{method:n.formMethod})};let s=()=>({path:e,error:Xr(400,{type:"invalid-body"})}),i=(n.formMethod||"get").toUpperCase(),o=t3(e);if(n.body!==void 0){if(n.formEncType==="text/plain"){if(!Si(i))return s();let h=typeof n.body=="string"?n.body:n.body instanceof FormData||n.body instanceof URLSearchParams?Array.from(n.body.entries()).reduce((d,[f,p])=>`${d}${f}=${p}
`,""):String(n.body);return{path:e,submission:{formMethod:i,formAction:o,formEncType:n.formEncType,formData:void 0,json:void 0,text:h}}}else if(n.formEncType==="application/json"){if(!Si(i))return s();try{let h=typeof n.body=="string"?JSON.parse(n.body):n.body;return{path:e,submission:{formMethod:i,formAction:o,formEncType:n.formEncType,formData:void 0,json:h,text:void 0}}}catch{return s()}}}dt(typeof FormData=="function","FormData is not available in this environment");let a,l;if(n.formData)a=xI(n.formData),l=n.formData;else if(n.body instanceof FormData)a=xI(n.body),l=n.body;else if(n.body instanceof URLSearchParams)a=n.body,l=bD(a);else if(n.body==null)a=new URLSearchParams,l=new FormData;else try{a=new URLSearchParams(n.body),l=bD(a)}catch{return s()}let u={formMethod:i,formAction:o,formEncType:n&&n.formEncType||"application/x-www-form-urlencoded",formData:l,json:void 0,text:void 0};if(Si(u.formMethod))return{path:e,submission:u};let c=Vl(e);return t&&c.search&&VT(c.search)&&a.append("index",""),c.search=`?${a}`,{path:Sl(c),submission:u}}function gD(t,e,n=!1){let s=t.findIndex(r=>r.route.id===e);return s>=0?t.slice(0,n?s+1:s):t}function yD(t,e,n,s,r,i,o,a,l,u,c,h,d,f){let p=f?Er(f[1])?f[1].error:f[1].data:void 0,m=t.createURL(e.location),v=t.createURL(r),g=n;i&&e.errors?g=gD(n,Object.keys(e.errors)[0],!0):f&&Er(f[1])&&(g=gD(n,f[0]));let w=f?f[1].statusCode:void 0,b=w&&w>=400,x=g.filter((N,I)=>{let{route:C}=N;if(C.lazy)return!0;if(C.loader==null)return!1;if(i)return wI(C,e.loaderData,e.errors);if(Cq(e.loaderData,e.matches[I],N))return!0;let _=e.matches[I],k=N;return vD(N,{currentUrl:m,currentParams:_.params,nextUrl:v,nextParams:k.params,...s,actionResult:p,actionStatus:w,defaultShouldRevalidate:b?!1:o||m.pathname+m.search===v.pathname+v.search||m.search!==v.search||Iq(_,k)})}),S=[];return u.forEach((N,I)=>{if(i||!n.some(D=>D.route.id===N.routeId)||l.has(I))return;let C=Ha(h,N.path,d);if(!C){S.push({key:I,routeId:N.routeId,path:N.path,matches:null,match:null,controller:null});return}let _=e.fetchers.get(I),k=hp(C,N.path),A=!1;c.has(I)?A=!1:a.has(I)?(a.delete(I),A=!0):_&&_.state!=="idle"&&_.data===void 0?A=o:A=vD(k,{currentUrl:m,currentParams:e.matches[e.matches.length-1].params,nextUrl:v,nextParams:n[n.length-1].params,...s,actionResult:p,actionStatus:w,defaultShouldRevalidate:b?!1:o}),A&&S.push({key:I,routeId:N.routeId,path:N.path,matches:C,match:k,controller:new AbortController})}),[x,S]}function wI(t,e,n){if(t.lazy)return!0;if(!t.loader)return!1;let s=e!=null&&e[t.id]!==void 0,r=n!=null&&n[t.id]!==void 0;return!s&&r?!1:typeof t.loader=="function"&&t.loader.hydrate===!0?!0:!s&&!r}function Cq(t,e,n){let s=!e||n.route.id!==e.route.id,r=!t.hasOwnProperty(n.route.id);return s||r}function Iq(t,e){let n=t.route.path;return t.pathname!==e.pathname||n!=null&&n.endsWith("*")&&t.params["*"]!==e.params["*"]}function vD(t,e){if(t.route.shouldRevalidate){let n=t.route.shouldRevalidate(e);if(typeof n=="boolean")return n}return e.defaultShouldRevalidate}function wD(t,e,n,s,r){let i;if(t){let l=s[t];dt(l,`No route found to patch children into: routeId = ${t}`),l.children||(l.children=[]),i=l.children}else i=n;let o=e.filter(l=>!i.some(u=>e3(l,u))),a=Hv(o,r,[t||"_","patch",String((i==null?void 0:i.length)||"0")],s);i.push(...a)}function e3(t,e){return"id"in t&&"id"in e&&t.id===e.id?!0:t.index===e.index&&t.path===e.path&&t.caseSensitive===e.caseSensitive?(!t.children||t.children.length===0)&&(!e.children||e.children.length===0)?!0:t.children.every((n,s)=>{var r;return(r=e.children)==null?void 0:r.some(i=>e3(n,i))}):!1}async function _q(t,e,n){if(!t.lazy)return;let s=await t.lazy();if(!t.lazy)return;let r=n[t.id];dt(r,"No route found in manifest");let i={};for(let o in s){let l=r[o]!==void 0&&o!=="hasErrorBoundary";ls(!l,`Route "${r.id}" has a static property "${o}" defined but its lazy function is also returning a value for this property. The lazy route property "${o}" will be ignored.`),!l&&!K9.has(o)&&(i[o]=s[o])}Object.assign(r,i),Object.assign(r,{...e(r),lazy:void 0})}async function Tq({matches:t}){let e=t.filter(s=>s.shouldLoad);return(await Promise.all(e.map(s=>s.resolve()))).reduce((s,r,i)=>Object.assign(s,{[e[i].route.id]:r}),{})}async function kq(t,e,n,s,r,i,o,a,l,u){let c=i.map(f=>f.route.lazy?_q(f.route,l,a):void 0),h=i.map((f,p)=>{let m=c[p],v=r.some(w=>w.route.id===f.route.id);return{...f,shouldLoad:v,resolve:async w=>(w&&s.method==="GET"&&(f.route.lazy||f.route.loader)&&(v=!0),v?Eq(e,s,f,m,w,u):Promise.resolve({type:"data",result:void 0}))}}),d=await t({matches:h,request:s,params:i[0].params,fetcherKey:o,context:u});try{await Promise.all(c)}catch{}return d}async function Eq(t,e,n,s,r,i){let o,a,l=u=>{let c,h=new Promise((p,m)=>c=m);a=()=>c(),e.signal.addEventListener("abort",a);let d=p=>typeof u!="function"?Promise.reject(new Error(`You cannot call the handler for a route which defines a boolean "${t}" [routeId: ${n.route.id}]`)):u({request:e,params:n.params,context:i},...p!==void 0?[p]:[]),f=(async()=>{try{return{type:"data",result:await(r?r(m=>d(m)):d())}}catch(p){return{type:"error",result:p}}})();return Promise.race([f,h])};try{let u=n.route[t];if(s)if(u){let c,[h]=await Promise.all([l(u).catch(d=>{c=d}),s]);if(c!==void 0)throw c;o=h}else if(await s,u=n.route[t],u)o=await l(u);else if(t==="action"){let c=new URL(e.url),h=c.pathname+c.search;throw Xr(405,{method:e.method,pathname:h,routeId:n.route.id})}else return{type:"data",result:void 0};else if(u)o=await l(u);else{let c=new URL(e.url),h=c.pathname+c.search;throw Xr(404,{pathname:h})}}catch(u){return{type:"error",result:u}}finally{a&&e.signal.removeEventListener("abort",a)}return o}async function Nq(t){var s,r,i,o;let{result:e,type:n}=t;if(n3(e)){let a;try{let l=e.headers.get("Content-Type");l&&/\bapplication\/json\b/.test(l)?e.body==null?a=null:a=await e.json():a=await e.text()}catch(l){return{type:"error",error:l}}return n==="error"?{type:"error",error:new Kv(e.status,e.statusText,a),statusCode:e.status,headers:e.headers}:{type:"data",data:a,statusCode:e.status,headers:e.headers}}if(n==="error"){if(TD(e)){if(e.data instanceof Error)return{type:"error",error:e.data,statusCode:(s=e.init)==null?void 0:s.status};e=new Kv(((r=e.init)==null?void 0:r.status)||500,void 0,e.data)}return{type:"error",error:e,statusCode:mx(e)?e.status:void 0}}return TD(e)?{type:"data",data:e.data,statusCode:(i=e.init)==null?void 0:i.status,headers:(o=e.init)!=null&&o.headers?new Headers(e.init.headers):void 0}:{type:"data",data:e}}function $q(t,e,n,s,r){let i=t.headers.get("Location");if(dt(i,"Redirects returned/thrown from loaders/actions must have a Location header"),!BT.test(i)){let o=s.slice(0,s.findIndex(a=>a.route.id===n)+1);i=vI(new URL(e.url),o,r,i),t.headers.set("Location",i)}return t}function xD(t,e,n){if(BT.test(t)){let s=t,r=s.startsWith("//")?new URL(e.protocol+s):new URL(s),i=Bi(r.pathname,n)!=null;if(r.origin===e.origin&&i)return r.pathname+r.search+r.hash}return t}function qc(t,e,n,s){let r=t.createURL(t3(e)).toString(),i={signal:n};if(s&&Si(s.formMethod)){let{formMethod:o,formEncType:a}=s;i.method=o.toUpperCase(),a==="application/json"?(i.headers=new Headers({"Content-Type":a}),i.body=JSON.stringify(s.json)):a==="text/plain"?i.body=s.text:a==="application/x-www-form-urlencoded"&&s.formData?i.body=xI(s.formData):i.body=s.formData}return new Request(r,i)}function xI(t){let e=new URLSearchParams;for(let[n,s]of t.entries())e.append(n,typeof s=="string"?s:s.name);return e}function bD(t){let e=new FormData;for(let[n,s]of t.entries())e.append(n,s);return e}function Rq(t,e,n,s=!1,r=!1){let i={},o=null,a,l=!1,u={},c=n&&Er(n[1])?n[1].error:void 0;return t.forEach(h=>{if(!(h.route.id in e))return;let d=h.route.id,f=e[d];if(dt(!Cu(f),"Cannot handle redirect results in processLoaderData"),Er(f)){let p=f.error;if(c!==void 0&&(p=c,c=void 0),o=o||{},r)o[d]=p;else{let m=pu(t,d);o[m.route.id]==null&&(o[m.route.id]=p)}s||(i[d]=ZM),l||(l=!0,a=mx(f.error)?f.error.status:500),f.headers&&(u[d]=f.headers)}else i[d]=f.data,f.statusCode&&f.statusCode!==200&&!l&&(a=f.statusCode),f.headers&&(u[d]=f.headers)}),c!==void 0&&n&&(o={[n[0]]:c},i[n[0]]=void 0),{loaderData:i,errors:o,statusCode:a||200,loaderHeaders:u}}function SD(t,e,n,s,r,i){let{loaderData:o,errors:a}=Rq(e,n,s);return r.forEach(l=>{let{key:u,match:c,controller:h}=l,d=i[u];if(dt(d,"Did not find corresponding fetcher result"),!(h&&h.signal.aborted))if(Er(d)){let f=pu(t.matches,c==null?void 0:c.route.id);a&&a[f.route.id]||(a={...a,[f.route.id]:d.error}),t.fetchers.delete(u)}else if(Cu(d))dt(!1,"Unhandled fetcher revalidation redirect");else{let f=za(d.data);t.fetchers.set(u,f)}}),{loaderData:o,errors:a}}function CD(t,e,n,s){let r=Object.entries(e).filter(([,i])=>i!==ZM).reduce((i,[o,a])=>(i[o]=a,i),{});for(let i of n){let o=i.route.id;if(!e.hasOwnProperty(o)&&t.hasOwnProperty(o)&&i.route.loader&&(r[o]=t[o]),s&&s.hasOwnProperty(o))break}return r}function ID(t){return t?Er(t[1])?{actionData:{}}:{actionData:{[t[0]]:t[1].data}}:{}}function pu(t,e){return(e?t.slice(0,t.findIndex(s=>s.route.id===e)+1):[...t]).reverse().find(s=>s.route.hasErrorBoundary===!0)||t[0]}function _D(t){let e=t.length===1?t[0]:t.find(n=>n.index||!n.path||n.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:e}],route:e}}function Xr(t,{pathname:e,routeId:n,method:s,type:r,message:i}={}){let o="Unknown Server Error",a="Unknown @remix-run/router error";return t===400?(o="Bad Request",s&&e&&n?a=`You made a ${s} request to "${e}" but did not provide a \`loader\` for route "${n}", so there is no way to handle the request.`:r==="invalid-body"&&(a="Unable to encode submission body")):t===403?(o="Forbidden",a=`Route "${n}" does not match URL "${e}"`):t===404?(o="Not Found",a=`No route matches URL "${e}"`):t===405&&(o="Method Not Allowed",s&&e&&n?a=`You made a ${s.toUpperCase()} request to "${e}" but did not provide an \`action\` for route "${n}", so there is no way to handle the request.`:s&&(a=`Invalid request method "${s.toUpperCase()}"`)),new Kv(t||500,o,new Error(a),!0)}function _0(t){let e=Object.entries(t);for(let n=e.length-1;n>=0;n--){let[s,r]=e[n];if(Cu(r))return{key:s,result:r}}}function t3(t){let e=typeof t=="string"?Vl(t):t;return Sl({...e,hash:""})}function Aq(t,e){return t.pathname!==e.pathname||t.search!==e.search?!1:t.hash===""?e.hash!=="":t.hash===e.hash?!0:e.hash!==""}function Dq(t){return n3(t.result)&&yq.has(t.result.status)}function Er(t){return t.type==="error"}function Cu(t){return(t&&t.type)==="redirect"}function TD(t){return typeof t=="object"&&t!=null&&"type"in t&&"data"in t&&"init"in t&&t.type==="DataWithResponseInit"}function n3(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.headers=="object"&&typeof t.body<"u"}function Oq(t){return gq.has(t.toUpperCase())}function Si(t){return pq.has(t.toUpperCase())}function VT(t){return new URLSearchParams(t).getAll("index").some(e=>e==="")}function hp(t,e){let n=typeof e=="string"?Vl(e).search:e.search;if(t[t.length-1].route.index&&VT(n||""))return t[t.length-1];let s=YM(t);return s[s.length-1]}function kD(t){let{formMethod:e,formAction:n,formEncType:s,text:r,formData:i,json:o}=t;if(!(!e||!n||!s)){if(r!=null)return{formMethod:e,formAction:n,formEncType:s,formData:void 0,json:void 0,text:r};if(i!=null)return{formMethod:e,formAction:n,formEncType:s,formData:i,json:void 0,text:void 0};if(o!==void 0)return{formMethod:e,formAction:n,formEncType:s,formData:void 0,json:o,text:void 0}}}function HS(t,e){return e?{state:"loading",location:t,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}:{state:"loading",location:t,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function Pq(t,e){return{state:"submitting",location:t,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}}function Yf(t,e){return t?{state:"loading",formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text,data:e}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:e}}function Fq(t,e){return{state:"submitting",formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text,data:e?e.data:void 0}}function za(t){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:t}}function Lq(t,e){try{let n=t.sessionStorage.getItem(JM);if(n){let s=JSON.parse(n);for(let[r,i]of Object.entries(s||{}))i&&Array.isArray(i)&&e.set(r,new Set(i||[]))}}catch{}}function Mq(t,e){if(e.size>0){let n={};for(let[s,r]of e)n[s]=[...r];try{t.sessionStorage.setItem(JM,JSON.stringify(n))}catch(s){ls(!1,`Failed to save applied view transitions in sessionStorage (${s}).`)}}}function zq(){let t,e,n=new Promise((s,r)=>{t=async i=>{s(i);try{await n}catch{}},e=async i=>{r(i);try{await n}catch{}}});return{promise:n,resolve:t,reject:e}}var pc=ne.createContext(null);pc.displayName="DataRouter";var jm=ne.createContext(null);jm.displayName="DataRouterState";var UT=ne.createContext({isTransitioning:!1});UT.displayName="ViewTransition";var s3=ne.createContext(new Map);s3.displayName="Fetchers";var Bq=ne.createContext(null);Bq.displayName="Await";var Hi=ne.createContext(null);Hi.displayName="Navigation";var gx=ne.createContext(null);gx.displayName="Location";var To=ne.createContext({outlet:null,matches:[],isDataRoute:!1});To.displayName="Route";var WT=ne.createContext(null);WT.displayName="RouteError";function Vq(t,{relative:e}={}){dt(od(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:s}=ne.useContext(Hi),{hash:r,pathname:i,search:o}=Gm(t,{relative:e}),a=i;return n!=="/"&&(a=i==="/"?n:ho([n,i])),s.createHref({pathname:a,search:o,hash:r})}function od(){return ne.useContext(gx)!=null}function Ul(){return dt(od(),"useLocation() may be used only in the context of a <Router> component."),ne.useContext(gx).location}var r3="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function i3(t){ne.useContext(Hi).static||ne.useLayoutEffect(t)}function ad(){let{isDataRoute:t}=ne.useContext(To);return t?e8():Uq()}function Uq(){dt(od(),"useNavigate() may be used only in the context of a <Router> component.");let t=ne.useContext(pc),{basename:e,navigator:n}=ne.useContext(Hi),{matches:s}=ne.useContext(To),{pathname:r}=Ul(),i=JSON.stringify(fx(s)),o=ne.useRef(!1);return i3(()=>{o.current=!0}),ne.useCallback((l,u={})=>{if(ls(o.current,r3),!o.current)return;if(typeof l=="number"){n.go(l);return}let c=px(l,JSON.parse(i),r,u.relative==="path");t==null&&e!=="/"&&(c.pathname=c.pathname==="/"?e:ho([e,c.pathname])),(u.replace?n.replace:n.push)(c,u.state,u)},[e,n,i,r,t])}ne.createContext(null);function Gm(t,{relative:e}={}){let{matches:n}=ne.useContext(To),{pathname:s}=Ul(),r=JSON.stringify(fx(n));return ne.useMemo(()=>px(t,JSON.parse(r),s,e==="path"),[t,r,s,e])}function Wq(t,e,n,s){dt(od(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:r}=ne.useContext(Hi),{matches:i}=ne.useContext(To),o=i[i.length-1],a=o?o.params:{},l=o?o.pathname:"/",u=o?o.pathnameBase:"/",c=o&&o.route;{let g=c&&c.path||"";o3(l,!c||g.endsWith("*")||g.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${l}" (under <Route path="${g}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${g}"> to <Route path="${g==="/"?"*":`${g}/*`}">.`)}let h=Ul(),d;d=h;let f=d.pathname||"/",p=f;if(u!=="/"){let g=u.replace(/^\//,"").split("/");p="/"+f.replace(/^\//,"").split("/").slice(g.length).join("/")}let m=Ha(t,{pathname:p});return ls(c||m!=null,`No routes matched location "${d.pathname}${d.search}${d.hash}" `),ls(m==null||m[m.length-1].route.element!==void 0||m[m.length-1].route.Component!==void 0||m[m.length-1].route.lazy!==void 0,`Matched leaf route at location "${d.pathname}${d.search}${d.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),Kq(m&&m.map(g=>Object.assign({},g,{params:Object.assign({},a,g.params),pathname:ho([u,r.encodeLocation?r.encodeLocation(g.pathname).pathname:g.pathname]),pathnameBase:g.pathnameBase==="/"?u:ho([u,r.encodeLocation?r.encodeLocation(g.pathnameBase).pathname:g.pathnameBase])})),i,n,s)}function jq(){let t=Zq(),e=mx(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,s="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:s},i={padding:"2px 4px",backgroundColor:s},o=null;return console.error("Error handled by React Router default ErrorBoundary:",t),o=ne.createElement(ne.Fragment,null,ne.createElement("p",null,"💿 Hey developer 👋"),ne.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",ne.createElement("code",{style:i},"ErrorBoundary")," or"," ",ne.createElement("code",{style:i},"errorElement")," prop on your route.")),ne.createElement(ne.Fragment,null,ne.createElement("h2",null,"Unexpected Application Error!"),ne.createElement("h3",{style:{fontStyle:"italic"}},e),n?ne.createElement("pre",{style:r},n):null,o)}var Gq=ne.createElement(jq,null),Hq=class extends ne.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){console.error("React Router caught the following error during render",t,e)}render(){return this.state.error!==void 0?ne.createElement(To.Provider,{value:this.props.routeContext},ne.createElement(WT.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function qq({routeContext:t,match:e,children:n}){let s=ne.useContext(pc);return s&&s.static&&s.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=e.route.id),ne.createElement(To.Provider,{value:t},n)}function Kq(t,e=[],n=null,s=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let r=t,i=n==null?void 0:n.errors;if(i!=null){let l=r.findIndex(u=>u.route.id&&(i==null?void 0:i[u.route.id])!==void 0);dt(l>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(i).join(",")}`),r=r.slice(0,Math.min(r.length,l+1))}let o=!1,a=-1;if(n)for(let l=0;l<r.length;l++){let u=r[l];if((u.route.HydrateFallback||u.route.hydrateFallbackElement)&&(a=l),u.route.id){let{loaderData:c,errors:h}=n,d=u.route.loader&&!c.hasOwnProperty(u.route.id)&&(!h||h[u.route.id]===void 0);if(u.route.lazy||d){o=!0,a>=0?r=r.slice(0,a+1):r=[r[0]];break}}}return r.reduceRight((l,u,c)=>{let h,d=!1,f=null,p=null;n&&(h=i&&u.route.id?i[u.route.id]:void 0,f=u.route.errorElement||Gq,o&&(a<0&&c===0?(o3("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),d=!0,p=null):a===c&&(d=!0,p=u.route.hydrateFallbackElement||null)));let m=e.concat(r.slice(0,c+1)),v=()=>{let g;return h?g=f:d?g=p:u.route.Component?g=ne.createElement(u.route.Component,null):u.route.element?g=u.route.element:g=l,ne.createElement(qq,{match:u,routeContext:{outlet:l,matches:m,isDataRoute:n!=null},children:g})};return n&&(u.route.ErrorBoundary||u.route.errorElement||c===0)?ne.createElement(Hq,{location:n.location,revalidation:n.revalidation,component:f,error:h,children:v(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):v()},null)}function jT(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Xq(t){let e=ne.useContext(pc);return dt(e,jT(t)),e}function Yq(t){let e=ne.useContext(jm);return dt(e,jT(t)),e}function Qq(t){let e=ne.useContext(To);return dt(e,jT(t)),e}function GT(t){let e=Qq(t),n=e.matches[e.matches.length-1];return dt(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function Jq(){return GT("useRouteId")}function Zq(){var s;let t=ne.useContext(WT),e=Yq("useRouteError"),n=GT("useRouteError");return t!==void 0?t:(s=e.errors)==null?void 0:s[n]}function e8(){let{router:t}=Xq("useNavigate"),e=GT("useNavigate"),n=ne.useRef(!1);return i3(()=>{n.current=!0}),ne.useCallback(async(r,i={})=>{ls(n.current,r3),n.current&&(typeof r=="number"?t.navigate(r):await t.navigate(r,{fromRouteId:e,...i}))},[t,e])}var ED={};function o3(t,e,n){!e&&!ED[t]&&(ED[t]=!0,ls(!1,n))}var ND={};function $D(t,e){!t&&!ND[e]&&(ND[e]=!0,console.warn(e))}function t8(t){let e={hasErrorBoundary:t.hasErrorBoundary||t.ErrorBoundary!=null||t.errorElement!=null};return t.Component&&(t.element&&ls(!1,"You should not include both `Component` and `element` on your route - `Component` will be used."),Object.assign(e,{element:ne.createElement(t.Component),Component:void 0})),t.HydrateFallback&&(t.hydrateFallbackElement&&ls(!1,"You should not include both `HydrateFallback` and `hydrateFallbackElement` on your route - `HydrateFallback` will be used."),Object.assign(e,{hydrateFallbackElement:ne.createElement(t.HydrateFallback),HydrateFallback:void 0})),t.ErrorBoundary&&(t.errorElement&&ls(!1,"You should not include both `ErrorBoundary` and `errorElement` on your route - `ErrorBoundary` will be used."),Object.assign(e,{errorElement:ne.createElement(t.ErrorBoundary),ErrorBoundary:void 0})),e}var n8=class{constructor(){this.status="pending",this.promise=new Promise((e,n)=>{this.resolve=s=>{this.status==="pending"&&(this.status="resolved",e(s))},this.reject=s=>{this.status==="pending"&&(this.status="rejected",n(s))}})}};function s8({router:t,flushSync:e}){let[n,s]=ne.useState(t.state),[r,i]=ne.useState(),[o,a]=ne.useState({isTransitioning:!1}),[l,u]=ne.useState(),[c,h]=ne.useState(),[d,f]=ne.useState(),p=ne.useRef(new Map),m=ne.useCallback((b,{deletedFetchers:x,flushSync:S,viewTransitionOpts:N})=>{x.forEach(C=>p.current.delete(C)),b.fetchers.forEach((C,_)=>{C.data!==void 0&&p.current.set(_,C.data)}),$D(S===!1||e!=null,'You provided the `flushSync` option to a router update, but you are not using the `<RouterProvider>` from `react-router/dom` so `ReactDOM.flushSync()` is unavailable.  Please update your app to `import { RouterProvider } from "react-router/dom"` and ensure you have `react-dom` installed as a dependency to use the `flushSync` option.');let I=t.window!=null&&t.window.document!=null&&typeof t.window.document.startViewTransition=="function";if($D(N==null||I,"You provided the `viewTransition` option to a router update, but you do not appear to be running in a DOM environment as `window.startViewTransition` is not available."),!N||!I){e&&S?e(()=>s(b)):ne.startTransition(()=>s(b));return}if(e&&S){e(()=>{c&&(l&&l.resolve(),c.skipTransition()),a({isTransitioning:!0,flushSync:!0,currentLocation:N.currentLocation,nextLocation:N.nextLocation})});let C=t.window.document.startViewTransition(()=>{e(()=>s(b))});C.finished.finally(()=>{e(()=>{u(void 0),h(void 0),i(void 0),a({isTransitioning:!1})})}),e(()=>h(C));return}c?(l&&l.resolve(),c.skipTransition(),f({state:b,currentLocation:N.currentLocation,nextLocation:N.nextLocation})):(i(b),a({isTransitioning:!0,flushSync:!1,currentLocation:N.currentLocation,nextLocation:N.nextLocation}))},[t.window,e,c,l]);ne.useLayoutEffect(()=>t.subscribe(m),[t,m]),ne.useEffect(()=>{o.isTransitioning&&!o.flushSync&&u(new n8)},[o]),ne.useEffect(()=>{if(l&&r&&t.window){let b=r,x=l.promise,S=t.window.document.startViewTransition(async()=>{ne.startTransition(()=>s(b)),await x});S.finished.finally(()=>{u(void 0),h(void 0),i(void 0),a({isTransitioning:!1})}),h(S)}},[r,l,t.window]),ne.useEffect(()=>{l&&r&&n.location.key===r.location.key&&l.resolve()},[l,c,n.location,r]),ne.useEffect(()=>{!o.isTransitioning&&d&&(i(d.state),a({isTransitioning:!0,flushSync:!1,currentLocation:d.currentLocation,nextLocation:d.nextLocation}),f(void 0))},[o.isTransitioning,d]);let v=ne.useMemo(()=>({createHref:t.createHref,encodeLocation:t.encodeLocation,go:b=>t.navigate(b),push:(b,x,S)=>t.navigate(b,{state:x,preventScrollReset:S==null?void 0:S.preventScrollReset}),replace:(b,x,S)=>t.navigate(b,{replace:!0,state:x,preventScrollReset:S==null?void 0:S.preventScrollReset})}),[t]),g=t.basename||"/",w=ne.useMemo(()=>({router:t,navigator:v,static:!1,basename:g}),[t,v,g]);return ne.createElement(ne.Fragment,null,ne.createElement(pc.Provider,{value:w},ne.createElement(jm.Provider,{value:n},ne.createElement(s3.Provider,{value:p.current},ne.createElement(UT.Provider,{value:o},ne.createElement(a8,{basename:g,location:n.location,navigationType:n.historyAction,navigator:v},ne.createElement(r8,{routes:t.routes,future:t.future,state:n})))))),null)}var r8=ne.memo(i8);function i8({routes:t,future:e,state:n}){return Wq(t,void 0,n,e)}function o8({to:t,replace:e,state:n,relative:s}){dt(od(),"<Navigate> may be used only in the context of a <Router> component.");let{static:r}=ne.useContext(Hi);ls(!r,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:i}=ne.useContext(To),{pathname:o}=Ul(),a=ad(),l=px(t,fx(i),o,s==="path"),u=JSON.stringify(l);return ne.useEffect(()=>{a(JSON.parse(u),{replace:e,state:n,relative:s})},[a,u,s,e,n]),null}function a8({basename:t="/",children:e=null,location:n,navigationType:s="POP",navigator:r,static:i=!1}){dt(!od(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=t.replace(/^\/*/,"/"),a=ne.useMemo(()=>({basename:o,navigator:r,static:i,future:{}}),[o,r,i]);typeof n=="string"&&(n=Vl(n));let{pathname:l="/",search:u="",hash:c="",state:h=null,key:d="default"}=n,f=ne.useMemo(()=>{let p=Bi(l,o);return p==null?null:{location:{pathname:p,search:u,hash:c,state:h,key:d},navigationType:s}},[o,l,u,c,h,d,s]);return ls(f!=null,`<Router basename="${o}"> is not able to match the URL "${l}${u}${c}" because it does not start with the basename, so the <Router> won't render anything.`),f==null?null:ne.createElement(Hi.Provider,{value:a},ne.createElement(gx.Provider,{children:e,value:f}))}var iv="get",ov="application/x-www-form-urlencoded";function yx(t){return t!=null&&typeof t.tagName=="string"}function l8(t){return yx(t)&&t.tagName.toLowerCase()==="button"}function u8(t){return yx(t)&&t.tagName.toLowerCase()==="form"}function c8(t){return yx(t)&&t.tagName.toLowerCase()==="input"}function h8(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function d8(t,e){return t.button===0&&(!e||e==="_self")&&!h8(t)}var T0=null;function f8(){if(T0===null)try{new FormData(document.createElement("form"),0),T0=!1}catch{T0=!0}return T0}var p8=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function qS(t){return t!=null&&!p8.has(t)?(ls(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${ov}"`),null):t}function m8(t,e){let n,s,r,i,o;if(u8(t)){let a=t.getAttribute("action");s=a?Bi(a,e):null,n=t.getAttribute("method")||iv,r=qS(t.getAttribute("enctype"))||ov,i=new FormData(t)}else if(l8(t)||c8(t)&&(t.type==="submit"||t.type==="image")){let a=t.form;if(a==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=t.getAttribute("formaction")||a.getAttribute("action");if(s=l?Bi(l,e):null,n=t.getAttribute("formmethod")||a.getAttribute("method")||iv,r=qS(t.getAttribute("formenctype"))||qS(a.getAttribute("enctype"))||ov,i=new FormData(a,t),!f8()){let{name:u,type:c,value:h}=t;if(c==="image"){let d=u?`${u}.`:"";i.append(`${d}x`,"0"),i.append(`${d}y`,"0")}else u&&i.append(u,h)}}else{if(yx(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=iv,s=null,r=ov,o=t}return i&&r==="text/plain"&&(o=i,i=void 0),{action:s,method:n.toLowerCase(),encType:r,formData:i,body:o}}function HT(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}async function g8(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function y8(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function v8(t,e,n){let s=await Promise.all(t.map(async r=>{let i=e.routes[r.route.id];if(i){let o=await g8(i,n);return o.links?o.links():[]}return[]}));return S8(s.flat(1).filter(y8).filter(r=>r.rel==="stylesheet"||r.rel==="preload").map(r=>r.rel==="stylesheet"?{...r,rel:"prefetch",as:"style"}:{...r,rel:"prefetch"}))}function RD(t,e,n,s,r,i){let o=(l,u)=>n[u]?l.route.id!==n[u].route.id:!0,a=(l,u)=>{var c;return n[u].pathname!==l.pathname||((c=n[u].route.path)==null?void 0:c.endsWith("*"))&&n[u].params["*"]!==l.params["*"]};return i==="assets"?e.filter((l,u)=>o(l,u)||a(l,u)):i==="data"?e.filter((l,u)=>{var h;let c=s.routes[l.route.id];if(!c||!c.hasLoader)return!1;if(o(l,u)||a(l,u))return!0;if(l.route.shouldRevalidate){let d=l.route.shouldRevalidate({currentUrl:new URL(r.pathname+r.search+r.hash,window.origin),currentParams:((h=n[0])==null?void 0:h.params)||{},nextUrl:new URL(t,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof d=="boolean")return d}return!0}):[]}function w8(t,e){return x8(t.map(n=>{let s=e.routes[n.route.id];if(!s)return[];let r=[s.module];return s.imports&&(r=r.concat(s.imports)),r}).flat(1))}function x8(t){return[...new Set(t)]}function b8(t){let e={},n=Object.keys(t).sort();for(let s of n)e[s]=t[s];return e}function S8(t,e){let n=new Set;return new Set(e),t.reduce((s,r)=>{let i=JSON.stringify(b8(r));return n.has(i)||(n.add(i),s.push({key:i,link:r})),s},[])}function C8(t){let e=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return e.pathname==="/"?e.pathname="_root.data":e.pathname=`${e.pathname.replace(/\/$/,"")}.data`,e}function I8(){let t=ne.useContext(pc);return HT(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function _8(){let t=ne.useContext(jm);return HT(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var qT=ne.createContext(void 0);qT.displayName="FrameworkContext";function a3(){let t=ne.useContext(qT);return HT(t,"You must render this element inside a <HydratedRouter> element"),t}function T8(t,e){let n=ne.useContext(qT),[s,r]=ne.useState(!1),[i,o]=ne.useState(!1),{onFocus:a,onBlur:l,onMouseEnter:u,onMouseLeave:c,onTouchStart:h}=e,d=ne.useRef(null);ne.useEffect(()=>{if(t==="render"&&o(!0),t==="viewport"){let m=g=>{g.forEach(w=>{o(w.isIntersecting)})},v=new IntersectionObserver(m,{threshold:.5});return d.current&&v.observe(d.current),()=>{v.disconnect()}}},[t]),ne.useEffect(()=>{if(s){let m=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(m)}}},[s]);let f=()=>{r(!0)},p=()=>{r(!1),o(!1)};return n?t!=="intent"?[i,d,{}]:[i,d,{onFocus:Qf(a,f),onBlur:Qf(l,p),onMouseEnter:Qf(u,f),onMouseLeave:Qf(c,p),onTouchStart:Qf(h,f)}]:[!1,d,{}]}function Qf(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function k8({page:t,...e}){let{router:n}=I8(),s=ne.useMemo(()=>Ha(n.routes,t,n.basename),[n.routes,t,n.basename]);return s?ne.createElement(N8,{page:t,matches:s,...e}):(console.warn(`Tried to prefetch ${t} but no routes matched.`),null)}function E8(t){let{manifest:e,routeModules:n}=a3(),[s,r]=ne.useState([]);return ne.useEffect(()=>{let i=!1;return v8(t,e,n).then(o=>{i||r(o)}),()=>{i=!0}},[t,e,n]),s}function N8({page:t,matches:e,...n}){let s=Ul(),{manifest:r,routeModules:i}=a3(),{loaderData:o,matches:a}=_8(),l=ne.useMemo(()=>RD(t,e,a,r,s,"data"),[t,e,a,r,s]),u=ne.useMemo(()=>RD(t,e,a,r,s,"assets"),[t,e,a,r,s]),c=ne.useMemo(()=>{if(t===s.pathname+s.search+s.hash)return[];let f=new Set,p=!1;if(e.forEach(v=>{var w;let g=r.routes[v.route.id];!g||!g.hasLoader||(!l.some(b=>b.route.id===v.route.id)&&v.route.id in o&&((w=i[v.route.id])!=null&&w.shouldRevalidate)||g.hasClientLoader?p=!0:f.add(v.route.id))}),f.size===0)return[];let m=C8(t);return p&&f.size>0&&m.searchParams.set("_routes",e.filter(v=>f.has(v.route.id)).map(v=>v.route.id).join(",")),[m.pathname+m.search]},[o,s,r,l,e,t,i]),h=ne.useMemo(()=>w8(u,r),[u,r]),d=E8(u);return ne.createElement(ne.Fragment,null,c.map(f=>ne.createElement("link",{key:f,rel:"prefetch",as:"fetch",href:f,...n})),h.map(f=>ne.createElement("link",{key:f,rel:"modulepreload",href:f,...n})),d.map(({key:f,link:p})=>ne.createElement("link",{key:f,...p})))}function $8(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var l3=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{l3&&(window.__reactRouterVersion="7.0.2")}catch{}function R8(t,e){return bq({basename:e==null?void 0:e.basename,future:e==null?void 0:e.future,history:G9({window:e==null?void 0:e.window}),hydrationData:A8(),routes:t,mapRouteProperties:t8,dataStrategy:e==null?void 0:e.dataStrategy,patchRoutesOnNavigation:e==null?void 0:e.patchRoutesOnNavigation,window:e==null?void 0:e.window}).initialize()}function A8(){let t=window==null?void 0:window.__staticRouterHydrationData;return t&&t.errors&&(t={...t,errors:D8(t.errors)}),t}function D8(t){if(!t)return null;let e=Object.entries(t),n={};for(let[s,r]of e)if(r&&r.__type==="RouteErrorResponse")n[s]=new Kv(r.status,r.statusText,r.data,r.internal===!0);else if(r&&r.__type==="Error"){if(r.__subType){let i=window[r.__subType];if(typeof i=="function")try{let o=new i(r.message);o.stack="",n[s]=o}catch{}}if(n[s]==null){let i=new Error(r.message);i.stack="",n[s]=i}}else n[s]=r;return n}var u3=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,c3=ne.forwardRef(function({onClick:e,discover:n="render",prefetch:s="none",relative:r,reloadDocument:i,replace:o,state:a,target:l,to:u,preventScrollReset:c,viewTransition:h,...d},f){let{basename:p}=ne.useContext(Hi),m=typeof u=="string"&&u3.test(u),v,g=!1;if(typeof u=="string"&&m&&(v=u,l3))try{let _=new URL(window.location.href),k=u.startsWith("//")?new URL(_.protocol+u):new URL(u),A=Bi(k.pathname,p);k.origin===_.origin&&A!=null?u=A+k.search+k.hash:g=!0}catch{ls(!1,`<Link to="${u}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let w=Vq(u,{relative:r}),[b,x,S]=T8(s,d),N=L8(u,{replace:o,state:a,target:l,preventScrollReset:c,relative:r,viewTransition:h});function I(_){e&&e(_),_.defaultPrevented||N(_)}let C=ne.createElement("a",{...d,...S,href:v||w,onClick:g||i?e:I,ref:$8(f,x),target:l,"data-discover":!m&&n==="render"?"true":void 0});return b&&!m?ne.createElement(ne.Fragment,null,C,ne.createElement(k8,{page:w})):C});c3.displayName="Link";var O8=ne.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:s="",end:r=!1,style:i,to:o,viewTransition:a,children:l,...u},c){let h=Gm(o,{relative:u.relative}),d=Ul(),f=ne.useContext(jm),{navigator:p,basename:m}=ne.useContext(Hi),v=f!=null&&U8(h)&&a===!0,g=p.encodeLocation?p.encodeLocation(h).pathname:h.pathname,w=d.pathname,b=f&&f.navigation&&f.navigation.location?f.navigation.location.pathname:null;n||(w=w.toLowerCase(),b=b?b.toLowerCase():null,g=g.toLowerCase()),b&&m&&(b=Bi(b,m)||b);const x=g!=="/"&&g.endsWith("/")?g.length-1:g.length;let S=w===g||!r&&w.startsWith(g)&&w.charAt(x)==="/",N=b!=null&&(b===g||!r&&b.startsWith(g)&&b.charAt(g.length)==="/"),I={isActive:S,isPending:N,isTransitioning:v},C=S?e:void 0,_;typeof s=="function"?_=s(I):_=[s,S?"active":null,N?"pending":null,v?"transitioning":null].filter(Boolean).join(" ");let k=typeof i=="function"?i(I):i;return ne.createElement(c3,{...u,"aria-current":C,className:_,ref:c,style:k,to:o,viewTransition:a},typeof l=="function"?l(I):l)});O8.displayName="NavLink";var P8=ne.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:s,replace:r,state:i,method:o=iv,action:a,onSubmit:l,relative:u,preventScrollReset:c,viewTransition:h,...d},f)=>{let p=B8(),m=V8(a,{relative:u}),v=o.toLowerCase()==="get"?"get":"post",g=typeof a=="string"&&u3.test(a),w=b=>{if(l&&l(b),b.defaultPrevented)return;b.preventDefault();let x=b.nativeEvent.submitter,S=(x==null?void 0:x.getAttribute("formmethod"))||o;p(x||b.currentTarget,{fetcherKey:e,method:S,navigate:n,replace:r,state:i,relative:u,preventScrollReset:c,viewTransition:h})};return ne.createElement("form",{ref:f,method:v,action:m,onSubmit:s?l:w,...d,"data-discover":!g&&t==="render"?"true":void 0})});P8.displayName="Form";function F8(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function h3(t){let e=ne.useContext(pc);return dt(e,F8(t)),e}function L8(t,{target:e,replace:n,state:s,preventScrollReset:r,relative:i,viewTransition:o}={}){let a=ad(),l=Ul(),u=Gm(t,{relative:i});return ne.useCallback(c=>{if(d8(c,e)){c.preventDefault();let h=n!==void 0?n:Sl(l)===Sl(u);a(t,{replace:h,state:s,preventScrollReset:r,relative:i,viewTransition:o})}},[l,a,u,n,s,e,t,r,i,o])}var M8=0,z8=()=>`__${String(++M8)}__`;function B8(){let{router:t}=h3("useSubmit"),{basename:e}=ne.useContext(Hi),n=Jq();return ne.useCallback(async(s,r={})=>{let{action:i,method:o,encType:a,formData:l,body:u}=m8(s,e);if(r.navigate===!1){let c=r.fetcherKey||z8();await t.fetch(c,n,r.action||i,{preventScrollReset:r.preventScrollReset,formData:l,body:u,formMethod:r.method||o,formEncType:r.encType||a,flushSync:r.flushSync})}else await t.navigate(r.action||i,{preventScrollReset:r.preventScrollReset,formData:l,body:u,formMethod:r.method||o,formEncType:r.encType||a,replace:r.replace,state:r.state,fromRouteId:n,flushSync:r.flushSync,viewTransition:r.viewTransition})},[t,e,n])}function V8(t,{relative:e}={}){let{basename:n}=ne.useContext(Hi),s=ne.useContext(To);dt(s,"useFormAction must be used inside a RouteContext");let[r]=s.matches.slice(-1),i={...Gm(t||".",{relative:e})},o=Ul();if(t==null){i.search=o.search;let a=new URLSearchParams(i.search),l=a.getAll("index");if(l.some(c=>c==="")){a.delete("index"),l.filter(h=>h).forEach(h=>a.append("index",h));let c=a.toString();i.search=c?`?${c}`:""}}return(!t||t===".")&&r.route.index&&(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(i.pathname=i.pathname==="/"?n:ho([n,i.pathname])),Sl(i)}function U8(t,e={}){let n=ne.useContext(UT);dt(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:s}=h3("useViewTransitionState"),r=Gm(t,{relative:e.relative});if(!n.isTransitioning)return!1;let i=Bi(n.currentLocation.pathname,s)||n.currentLocation.pathname,o=Bi(n.nextLocation.pathname,s)||n.nextLocation.pathname;return qv(r.pathname,o)!=null||qv(r.pathname,i)!=null}new TextEncoder;/**
 * react-router v7.0.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function W8(t){return ne.createElement(s8,{flushSync:HM.flushSync,...t})}var AD={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d3={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ye=function(t,e){if(!t)throw ld(e)},ld=function(t){return new Error("Firebase Database ("+d3.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f3=function(t){const e=[];let n=0;for(let s=0;s<t.length;s++){let r=t.charCodeAt(s);r<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=r&63|128):(r&64512)===55296&&s+1<t.length&&(t.charCodeAt(s+1)&64512)===56320?(r=65536+((r&1023)<<10)+(t.charCodeAt(++s)&1023),e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=r&63|128):(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=r&63|128)}return e},j8=function(t){const e=[];let n=0,s=0;for(;n<t.length;){const r=t[n++];if(r<128)e[s++]=String.fromCharCode(r);else if(r>191&&r<224){const i=t[n++];e[s++]=String.fromCharCode((r&31)<<6|i&63)}else if(r>239&&r<365){const i=t[n++],o=t[n++],a=t[n++],l=((r&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[s++]=String.fromCharCode(55296+(l>>10)),e[s++]=String.fromCharCode(56320+(l&1023))}else{const i=t[n++],o=t[n++];e[s++]=String.fromCharCode((r&15)<<12|(i&63)<<6|o&63)}}return e.join("")},KT={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let r=0;r<t.length;r+=3){const i=t[r],o=r+1<t.length,a=o?t[r+1]:0,l=r+2<t.length,u=l?t[r+2]:0,c=i>>2,h=(i&3)<<4|a>>4;let d=(a&15)<<2|u>>6,f=u&63;l||(f=64,o||(d=64)),s.push(n[c],n[h],n[d],n[f])}return s.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(f3(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):j8(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let r=0;r<t.length;){const i=n[t.charAt(r++)],a=r<t.length?n[t.charAt(r)]:0;++r;const u=r<t.length?n[t.charAt(r)]:64;++r;const h=r<t.length?n[t.charAt(r)]:64;if(++r,i==null||a==null||u==null||h==null)throw new G8;const d=i<<2|a>>4;if(s.push(d),u!==64){const f=a<<4&240|u>>2;if(s.push(f),h!==64){const p=u<<6&192|h;s.push(p)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class G8 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const p3=function(t){const e=f3(t);return KT.encodeByteArray(e,!0)},Xv=function(t){return p3(t).replace(/\./g,"")},Yv=function(t){try{return KT.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function H8(t){return m3(void 0,t)}function m3(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)!e.hasOwnProperty(n)||!q8(n)||(t[n]=m3(t[n],e[n]));return t}function q8(t){return t!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K8(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X8=()=>K8().__FIREBASE_DEFAULTS__,Y8=()=>{if(typeof process>"u"||typeof AD>"u")return;const t=AD.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},Q8=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Yv(t[1]);return e&&JSON.parse(e)},XT=()=>{try{return X8()||Y8()||Q8()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},g3=t=>{var e,n;return(n=(e=XT())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},J8=t=>{const e=g3(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),s]:[e.substring(0,n),s]},y3=()=>{var t;return(t=XT())===null||t===void 0?void 0:t.config},v3=t=>{var e;return(e=XT())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hm{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,s)=>{n?this.reject(n):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,s))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z8(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},s=e||"demo-project",r=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${s}`,aud:s,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},t);return[Xv(JSON.stringify(n)),Xv(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ks(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function YT(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ks())}function eK(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function tK(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function w3(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function nK(){const t=Ks();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function x3(){return d3.NODE_ADMIN===!0}function sK(){try{return typeof indexedDB=="object"}catch{return!1}}function rK(){return new Promise((t,e)=>{try{let n=!0;const s="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(s);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(s),t(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var i;e(((i=r.error)===null||i===void 0?void 0:i.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iK="FirebaseError";class ya extends Error{constructor(e,n,s){super(n),this.code=e,this.customData=s,this.name=iK,Object.setPrototypeOf(this,ya.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,qm.prototype.create)}}class qm{constructor(e,n,s){this.service=e,this.serviceName=n,this.errors=s}create(e,...n){const s=n[0]||{},r=`${this.service}/${e}`,i=this.errors[e],o=i?oK(i,s):"Error",a=`${this.serviceName}: ${o} (${r}).`;return new ya(r,a,s)}}function oK(t,e){return t.replace(aK,(n,s)=>{const r=e[s];return r!=null?String(r):`<${s}?>`})}const aK=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function im(t){return JSON.parse(t)}function Wn(t){return JSON.stringify(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b3=function(t){let e={},n={},s={},r="";try{const i=t.split(".");e=im(Yv(i[0])||""),n=im(Yv(i[1])||""),r=i[2],s=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:s,signature:r}},lK=function(t){const e=b3(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},uK=function(t){const e=b3(t).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ko(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Fh(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function bI(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Qv(t,e,n){const s={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(s[r]=e.call(n,t[r],r,t));return s}function Jv(t,e){if(t===e)return!0;const n=Object.keys(t),s=Object.keys(e);for(const r of n){if(!s.includes(r))return!1;const i=t[r],o=e[r];if(DD(i)&&DD(o)){if(!Jv(i,o))return!1}else if(i!==o)return!1}for(const r of s)if(!n.includes(r))return!1;return!0}function DD(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ud(t){const e=[];for(const[n,s]of Object.entries(t))Array.isArray(s)?s.forEach(r=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}function dp(t){const e={};return t.replace(/^\?/,"").split("&").forEach(s=>{if(s){const[r,i]=s.split("=");e[decodeURIComponent(r)]=decodeURIComponent(i)}}),e}function fp(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cK{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);const s=this.W_;if(typeof e=="string")for(let h=0;h<16;h++)s[h]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let h=0;h<16;h++)s[h]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let h=16;h<80;h++){const d=s[h-3]^s[h-8]^s[h-14]^s[h-16];s[h]=(d<<1|d>>>31)&4294967295}let r=this.chain_[0],i=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4],u,c;for(let h=0;h<80;h++){h<40?h<20?(u=a^i&(o^a),c=1518500249):(u=i^o^a,c=1859775393):h<60?(u=i&o|a&(i|o),c=2400959708):(u=i^o^a,c=3395469782);const d=(r<<5|r>>>27)+u+l+c+s[h]&4294967295;l=a,a=o,o=(i<<30|i>>>2)&4294967295,i=r,r=d}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);const s=n-this.blockSize;let r=0;const i=this.buf_;let o=this.inbuf_;for(;r<n;){if(o===0)for(;r<=s;)this.compress_(e,r),r+=this.blockSize;if(typeof e=="string"){for(;r<n;)if(i[o]=e.charCodeAt(r),++o,++r,o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<n;)if(i[o]=e[r],++o,++r,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=n}digest(){const e=[];let n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;r>=56;r--)this.buf_[r]=n&255,n/=256;this.compress_(this.buf_);let s=0;for(let r=0;r<5;r++)for(let i=24;i>=0;i-=8)e[s]=this.chain_[r]>>i&255,++s;return e}}function hK(t,e){const n=new dK(t,e);return n.subscribe.bind(n)}class dK{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,s){let r;if(e===void 0&&n===void 0&&s===void 0)throw new Error("Missing Observer.");fK(e,["next","error","complete"])?r=e:r={next:e,error:n,complete:s},r.next===void 0&&(r.next=KS),r.error===void 0&&(r.error=KS),r.complete===void 0&&(r.complete=KS);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function fK(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function KS(){}function vx(t,e){return`${t} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pK=function(t){const e=[];let n=0;for(let s=0;s<t.length;s++){let r=t.charCodeAt(s);if(r>=55296&&r<=56319){const i=r-55296;s++,ye(s<t.length,"Surrogate pair missing trail surrogate.");const o=t.charCodeAt(s)-56320;r=65536+(i<<10)+o}r<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=r&63|128):r<65536?(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=r&63|128):(e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=r&63|128)}return e},wx=function(t){let e=0;for(let n=0;n<t.length;n++){const s=t.charCodeAt(n);s<128?e++:s<2048?e+=2:s>=55296&&s<=56319?(e+=4,n++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function br(t){return t&&t._delegate?t._delegate:t}class Cl{constructor(e,n,s){this.name=e,this.instanceFactory=n,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cu="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mK{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const s=new Hm;if(this.instancesDeferred.set(n,s),this.isInitialized(n)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:n});r&&s.resolve(r)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const s=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(yK(e))try{this.getOrInitializeService({instanceIdentifier:cu})}catch{}for(const[n,s]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:r});s.resolve(i)}catch{}}}}clearInstance(e=cu){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=cu){return this.instances.has(e)}getOptions(e=cu){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:s,options:n});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);s===a&&o.resolve(r)}return r}onInit(e,n){var s;const r=this.normalizeInstanceIdentifier(n),i=(s=this.onInitCallbacks.get(r))!==null&&s!==void 0?s:new Set;i.add(e),this.onInitCallbacks.set(r,i);const o=this.instances.get(r);return o&&e(o,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,n){const s=this.onInitCallbacks.get(n);if(s)for(const r of s)try{r(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:gK(e),options:n}),this.instances.set(e,s),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=cu){return this.component?this.component.multipleInstances?e:cu:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function gK(t){return t===cu?void 0:t}function yK(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vK{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new mK(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var kt;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(kt||(kt={}));const wK={debug:kt.DEBUG,verbose:kt.VERBOSE,info:kt.INFO,warn:kt.WARN,error:kt.ERROR,silent:kt.SILENT},xK=kt.INFO,bK={[kt.DEBUG]:"log",[kt.VERBOSE]:"log",[kt.INFO]:"info",[kt.WARN]:"warn",[kt.ERROR]:"error"},SK=(t,e,...n)=>{if(e<t.logLevel)return;const s=new Date().toISOString(),r=bK[e];if(r)console[r](`[${s}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};let xx=class{constructor(e){this.name=e,this._logLevel=xK,this._logHandler=SK,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in kt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?wK[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,kt.DEBUG,...e),this._logHandler(this,kt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,kt.VERBOSE,...e),this._logHandler(this,kt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,kt.INFO,...e),this._logHandler(this,kt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,kt.WARN,...e),this._logHandler(this,kt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,kt.ERROR,...e),this._logHandler(this,kt.ERROR,...e)}};const CK=(t,e)=>e.some(n=>t instanceof n);let OD,PD;function IK(){return OD||(OD=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function _K(){return PD||(PD=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const S3=new WeakMap,SI=new WeakMap,C3=new WeakMap,XS=new WeakMap,QT=new WeakMap;function TK(t){const e=new Promise((n,s)=>{const r=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{n(dl(t.result)),r()},o=()=>{s(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&S3.set(n,t)}).catch(()=>{}),QT.set(e,t),e}function kK(t){if(SI.has(t))return;const e=new Promise((n,s)=>{const r=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{n(),r()},o=()=>{s(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});SI.set(t,e)}let CI={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return SI.get(t);if(e==="objectStoreNames")return t.objectStoreNames||C3.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return dl(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function EK(t){CI=t(CI)}function NK(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const s=t.call(YS(this),e,...n);return C3.set(s,e.sort?e.sort():[e]),dl(s)}:_K().includes(t)?function(...e){return t.apply(YS(this),e),dl(S3.get(this))}:function(...e){return dl(t.apply(YS(this),e))}}function $K(t){return typeof t=="function"?NK(t):(t instanceof IDBTransaction&&kK(t),CK(t,IK())?new Proxy(t,CI):t)}function dl(t){if(t instanceof IDBRequest)return TK(t);if(XS.has(t))return XS.get(t);const e=$K(t);return e!==t&&(XS.set(t,e),QT.set(e,t)),e}const YS=t=>QT.get(t);function RK(t,e,{blocked:n,upgrade:s,blocking:r,terminated:i}={}){const o=indexedDB.open(t,e),a=dl(o);return s&&o.addEventListener("upgradeneeded",l=>{s(dl(o.result),l.oldVersion,l.newVersion,dl(o.transaction),l)}),n&&o.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),r&&l.addEventListener("versionchange",u=>r(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const AK=["get","getKey","getAll","getAllKeys","count"],DK=["put","add","delete","clear"],QS=new Map;function FD(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(QS.get(e))return QS.get(e);const n=e.replace(/FromIndex$/,""),s=e!==n,r=DK.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!(r||AK.includes(n)))return;const i=async function(o,...a){const l=this.transaction(o,r?"readwrite":"readonly");let u=l.store;return s&&(u=u.index(a.shift())),(await Promise.all([u[n](...a),r&&l.done]))[0]};return QS.set(e,i),i}EK(t=>({...t,get:(e,n,s)=>FD(e,n)||t.get(e,n,s),has:(e,n)=>!!FD(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OK{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(PK(n)){const s=n.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(n=>n).join(" ")}}function PK(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const II="@firebase/app",LD="0.10.17";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oa=new xx("@firebase/app"),FK="@firebase/app-compat",LK="@firebase/analytics-compat",MK="@firebase/analytics",zK="@firebase/app-check-compat",BK="@firebase/app-check",VK="@firebase/auth",UK="@firebase/auth-compat",WK="@firebase/database",jK="@firebase/data-connect",GK="@firebase/database-compat",HK="@firebase/functions",qK="@firebase/functions-compat",KK="@firebase/installations",XK="@firebase/installations-compat",YK="@firebase/messaging",QK="@firebase/messaging-compat",JK="@firebase/performance",ZK="@firebase/performance-compat",e7="@firebase/remote-config",t7="@firebase/remote-config-compat",n7="@firebase/storage",s7="@firebase/storage-compat",r7="@firebase/firestore",i7="@firebase/vertexai",o7="@firebase/firestore-compat",a7="firebase",l7="11.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _I="[DEFAULT]",u7={[II]:"fire-core",[FK]:"fire-core-compat",[MK]:"fire-analytics",[LK]:"fire-analytics-compat",[BK]:"fire-app-check",[zK]:"fire-app-check-compat",[VK]:"fire-auth",[UK]:"fire-auth-compat",[WK]:"fire-rtdb",[jK]:"fire-data-connect",[GK]:"fire-rtdb-compat",[HK]:"fire-fn",[qK]:"fire-fn-compat",[KK]:"fire-iid",[XK]:"fire-iid-compat",[YK]:"fire-fcm",[QK]:"fire-fcm-compat",[JK]:"fire-perf",[ZK]:"fire-perf-compat",[e7]:"fire-rc",[t7]:"fire-rc-compat",[n7]:"fire-gcs",[s7]:"fire-gcs-compat",[r7]:"fire-fst",[o7]:"fire-fst-compat",[i7]:"fire-vertex","fire-js":"fire-js",[a7]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zv=new Map,c7=new Map,TI=new Map;function MD(t,e){try{t.container.addComponent(e)}catch(n){oa.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Vu(t){const e=t.name;if(TI.has(e))return oa.debug(`There were multiple attempts to register component ${e}.`),!1;TI.set(e,t);for(const n of Zv.values())MD(n,t);for(const n of c7.values())MD(n,t);return!0}function JT(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function oo(t){return t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h7={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},fl=new qm("app","Firebase",h7);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d7{constructor(e,n,s){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new Cl("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw fl.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mc=l7;function I3(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const s=Object.assign({name:_I,automaticDataCollectionEnabled:!1},e),r=s.name;if(typeof r!="string"||!r)throw fl.create("bad-app-name",{appName:String(r)});if(n||(n=y3()),!n)throw fl.create("no-options");const i=Zv.get(r);if(i){if(Jv(n,i.options)&&Jv(s,i.config))return i;throw fl.create("duplicate-app",{appName:r})}const o=new vK(r);for(const l of TI.values())o.addComponent(l);const a=new d7(n,s,o);return Zv.set(r,a),a}function _3(t=_I){const e=Zv.get(t);if(!e&&t===_I&&y3())return I3();if(!e)throw fl.create("no-app",{appName:t});return e}function fo(t,e,n){var s;let r=(s=u7[t])!==null&&s!==void 0?s:t;n&&(r+=`-${n}`);const i=r.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${r}" with version "${e}":`];i&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),oa.warn(a.join(" "));return}Vu(new Cl(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f7="firebase-heartbeat-database",p7=1,om="firebase-heartbeat-store";let JS=null;function T3(){return JS||(JS=RK(f7,p7,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(om)}catch(n){console.warn(n)}}}}).catch(t=>{throw fl.create("idb-open",{originalErrorMessage:t.message})})),JS}async function m7(t){try{const n=(await T3()).transaction(om),s=await n.objectStore(om).get(k3(t));return await n.done,s}catch(e){if(e instanceof ya)oa.warn(e.message);else{const n=fl.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});oa.warn(n.message)}}}async function zD(t,e){try{const s=(await T3()).transaction(om,"readwrite");await s.objectStore(om).put(e,k3(t)),await s.done}catch(n){if(n instanceof ya)oa.warn(n.message);else{const s=fl.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});oa.warn(s.message)}}}function k3(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g7=1024,y7=30*24*60*60*1e3;class v7{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new x7(n),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){var e,n;try{const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=BD();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:r}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=y7}),this._storage.overwrite(this._heartbeatsCache))}catch(s){oa.warn(s)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=BD(),{heartbeatsToSend:s,unsentEntries:r}=w7(this._heartbeatsCache.heartbeats),i=Xv(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=n,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return oa.warn(n),""}}}function BD(){return new Date().toISOString().substring(0,10)}function w7(t,e=g7){const n=[];let s=t.slice();for(const r of t){const i=n.find(o=>o.agent===r.agent);if(i){if(i.dates.push(r.date),VD(n)>e){i.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),VD(n)>e){n.pop();break}s=s.slice(1)}return{heartbeatsToSend:n,unsentEntries:s}}class x7{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return sK()?rK().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await m7(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const r=await this.read();return zD(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const r=await this.read();return zD(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function VD(t){return Xv(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b7(t){Vu(new Cl("platform-logger",e=>new OK(e),"PRIVATE")),Vu(new Cl("heartbeat",e=>new v7(e),"PRIVATE")),fo(II,LD,t),fo(II,LD,"esm2017"),fo("fire-js","")}b7("");function ZT(t,e){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(t);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(t,s[r])&&(n[s[r]]=t[s[r]]);return n}function E3(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const S7=E3,N3=new qm("auth","Firebase",E3());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ew=new xx("@firebase/auth");function C7(t,...e){ew.logLevel<=kt.WARN&&ew.warn(`Auth (${mc}): ${t}`,...e)}function av(t,...e){ew.logLevel<=kt.ERROR&&ew.error(`Auth (${mc}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vi(t,...e){throw ek(t,...e)}function po(t,...e){return ek(t,...e)}function $3(t,e,n){const s=Object.assign(Object.assign({},S7()),{[e]:n});return new qm("auth","Firebase",s).create(e,{appName:t.name})}function Zo(t){return $3(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function ek(t,...e){if(typeof t!="string"){const n=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=t.name),t._errorFactory.create(n,...s)}return N3.create(t,...e)}function We(t,e,...n){if(!t)throw ek(e,...n)}function Ko(t){const e="INTERNAL ASSERTION FAILED: "+t;throw av(e),new Error(e)}function aa(t,e){t||Ko(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kI(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function I7(){return UD()==="http:"||UD()==="https:"}function UD(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _7(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(I7()||tK()||"connection"in navigator)?navigator.onLine:!0}function T7(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Km{constructor(e,n){this.shortDelay=e,this.longDelay=n,aa(n>e,"Short delay should be less than long delay!"),this.isMobile=YT()||w3()}get(){return _7()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tk(t,e){aa(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R3{static initialize(e,n,s){this.fetchImpl=e,n&&(this.headersImpl=n),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Ko("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Ko("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Ko("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k7={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E7=new Km(3e4,6e4);function Wl(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function jl(t,e,n,s,r={}){return A3(t,r,async()=>{let i={},o={};s&&(e==="GET"?o=s:i={body:JSON.stringify(s)});const a=ud(Object.assign({key:t.config.apiKey},o)).slice(1),l=await t._getAdditionalHeaders();l["Content-Type"]="application/json",t.languageCode&&(l["X-Firebase-Locale"]=t.languageCode);const u=Object.assign({method:e,headers:l},i);return eK()||(u.referrerPolicy="no-referrer"),R3.fetch()(D3(t,t.config.apiHost,n,a),u)})}async function A3(t,e,n){t._canInitEmulator=!1;const s=Object.assign(Object.assign({},k7),e);try{const r=new $7(t),i=await Promise.race([n(),r.promise]);r.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw k0(t,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,u]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw k0(t,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw k0(t,"email-already-in-use",o);if(l==="USER_DISABLED")throw k0(t,"user-disabled",o);const c=s[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw $3(t,c,u);Vi(t,c)}}catch(r){if(r instanceof ya)throw r;Vi(t,"network-request-failed",{message:String(r)})}}async function Xm(t,e,n,s,r={}){const i=await jl(t,e,n,s,r);return"mfaPendingCredential"in i&&Vi(t,"multi-factor-auth-required",{_serverResponse:i}),i}function D3(t,e,n,s){const r=`${e}${n}?${s}`;return t.config.emulator?tk(t.config,r):`${t.config.apiScheme}://${r}`}function N7(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class $7{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,s)=>{this.timer=setTimeout(()=>s(po(this.auth,"network-request-failed")),E7.get())})}}function k0(t,e,n){const s={appName:t.name};n.email&&(s.email=n.email),n.phoneNumber&&(s.phoneNumber=n.phoneNumber);const r=po(t,e,s);return r.customData._tokenResponse=n,r}function WD(t){return t!==void 0&&t.enterprise!==void 0}class R7{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return N7(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function A7(t,e){return jl(t,"GET","/v2/recaptchaConfig",Wl(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function D7(t,e){return jl(t,"POST","/v1/accounts:delete",e)}async function O3(t,e){return jl(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ap(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function O7(t,e=!1){const n=br(t),s=await n.getIdToken(e),r=nk(s);We(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");const i=typeof r.firebase=="object"?r.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:r,token:s,authTime:Ap(ZS(r.auth_time)),issuedAtTime:Ap(ZS(r.iat)),expirationTime:Ap(ZS(r.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function ZS(t){return Number(t)*1e3}function nk(t){const[e,n,s]=t.split(".");if(e===void 0||n===void 0||s===void 0)return av("JWT malformed, contained fewer than 3 sections"),null;try{const r=Yv(n);return r?JSON.parse(r):(av("Failed to decode base64 JWT payload"),null)}catch(r){return av("Caught error parsing JWT payload as JSON",r==null?void 0:r.toString()),null}}function jD(t){const e=nk(t);return We(e,"internal-error"),We(typeof e.exp<"u","internal-error"),We(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function am(t,e,n=!1){if(n)return e;try{return await e}catch(s){throw s instanceof ya&&P7(s)&&t.auth.currentUser===t&&await t.auth.signOut(),s}}function P7({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F7{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){const s=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),s}else{this.errorBackoff=3e4;const r=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EI{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ap(this.lastLoginAt),this.creationTime=Ap(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tw(t){var e;const n=t.auth,s=await t.getIdToken(),r=await am(t,O3(n,{idToken:s}));We(r==null?void 0:r.users.length,n,"internal-error");const i=r.users[0];t._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?P3(i.providerUserInfo):[],a=M7(t.providerData,o),l=t.isAnonymous,u=!(t.email&&i.passwordHash)&&!(a!=null&&a.length),c=l?u:!1,h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new EI(i.createdAt,i.lastLoginAt),isAnonymous:c};Object.assign(t,h)}async function L7(t){const e=br(t);await tw(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function M7(t,e){return[...t.filter(s=>!e.some(r=>r.providerId===s.providerId)),...e]}function P3(t){return t.map(e=>{var{providerId:n}=e,s=ZT(e,["providerId"]);return{providerId:n,uid:s.rawId||"",displayName:s.displayName||null,email:s.email||null,phoneNumber:s.phoneNumber||null,photoURL:s.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function z7(t,e){const n=await A3(t,{},async()=>{const s=ud({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:i}=t.config,o=D3(t,r,"/v1/token",`key=${i}`),a=await t._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",R3.fetch()(o,{method:"POST",headers:a,body:s})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function B7(t,e){return jl(t,"POST","/v2/accounts:revokeToken",Wl(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bh{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){We(e.idToken,"internal-error"),We(typeof e.idToken<"u","internal-error"),We(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):jD(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){We(e.length!==0,"internal-error");const n=jD(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(We(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:s,refreshToken:r,expiresIn:i}=await z7(e,n);this.updateTokensAndExpiration(s,r,Number(i))}updateTokensAndExpiration(e,n,s){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,n){const{refreshToken:s,accessToken:r,expirationTime:i}=n,o=new bh;return s&&(We(typeof s=="string","internal-error",{appName:e}),o.refreshToken=s),r&&(We(typeof r=="string","internal-error",{appName:e}),o.accessToken=r),i&&(We(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new bh,this.toJSON())}_performRefresh(){return Ko("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fa(t,e){We(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Xo{constructor(e){var{uid:n,auth:s,stsTokenManager:r}=e,i=ZT(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new F7(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=s,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new EI(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const n=await am(this,this.stsTokenManager.getToken(this.auth,e));return We(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return O7(this,e)}reload(){return L7(this)}_assign(e){this!==e&&(We(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new Xo(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(e){We(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),n&&await tw(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(oo(this.auth.app))return Promise.reject(Zo(this.auth));const e=await this.getIdToken();return await am(this,D7(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var s,r,i,o,a,l,u,c;const h=(s=n.displayName)!==null&&s!==void 0?s:void 0,d=(r=n.email)!==null&&r!==void 0?r:void 0,f=(i=n.phoneNumber)!==null&&i!==void 0?i:void 0,p=(o=n.photoURL)!==null&&o!==void 0?o:void 0,m=(a=n.tenantId)!==null&&a!==void 0?a:void 0,v=(l=n._redirectEventId)!==null&&l!==void 0?l:void 0,g=(u=n.createdAt)!==null&&u!==void 0?u:void 0,w=(c=n.lastLoginAt)!==null&&c!==void 0?c:void 0,{uid:b,emailVerified:x,isAnonymous:S,providerData:N,stsTokenManager:I}=n;We(b&&I,e,"internal-error");const C=bh.fromJSON(this.name,I);We(typeof b=="string",e,"internal-error"),Fa(h,e.name),Fa(d,e.name),We(typeof x=="boolean",e,"internal-error"),We(typeof S=="boolean",e,"internal-error"),Fa(f,e.name),Fa(p,e.name),Fa(m,e.name),Fa(v,e.name),Fa(g,e.name),Fa(w,e.name);const _=new Xo({uid:b,auth:e,email:d,emailVerified:x,displayName:h,isAnonymous:S,photoURL:p,phoneNumber:f,tenantId:m,stsTokenManager:C,createdAt:g,lastLoginAt:w});return N&&Array.isArray(N)&&(_.providerData=N.map(k=>Object.assign({},k))),v&&(_._redirectEventId=v),_}static async _fromIdTokenResponse(e,n,s=!1){const r=new bh;r.updateFromServerResponse(n);const i=new Xo({uid:n.localId,auth:e,stsTokenManager:r,isAnonymous:s});return await tw(i),i}static async _fromGetAccountInfoResponse(e,n,s){const r=n.users[0];We(r.localId!==void 0,"internal-error");const i=r.providerUserInfo!==void 0?P3(r.providerUserInfo):[],o=!(r.email&&r.passwordHash)&&!(i!=null&&i.length),a=new bh;a.updateFromIdToken(s);const l=new Xo({uid:r.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new EI(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,u),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GD=new Map;function Yo(t){aa(t instanceof Function,"Expected a class definition");let e=GD.get(t);return e?(aa(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,GD.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F3{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}F3.type="NONE";const HD=F3;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lv(t,e,n){return`firebase:${t}:${e}:${n}`}class Sh{constructor(e,n,s){this.persistence=e,this.auth=n,this.userKey=s;const{config:r,name:i}=this.auth;this.fullUserKey=lv(this.userKey,r.apiKey,i),this.fullPersistenceKey=lv("persistence",r.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Xo._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,s="authUser"){if(!n.length)return new Sh(Yo(HD),e,s);const r=(await Promise.all(n.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=r[0]||Yo(HD);const o=lv(s,e.config.apiKey,e.name);let a=null;for(const u of n)try{const c=await u._get(o);if(c){const h=Xo._fromJSON(e,c);u!==i&&(a=h),i=u;break}}catch{}const l=r.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new Sh(i,e,s):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(n.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new Sh(i,e,s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qD(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(B3(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(L3(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(U3(e))return"Blackberry";if(W3(e))return"Webos";if(M3(e))return"Safari";if((e.includes("chrome/")||z3(e))&&!e.includes("edge/"))return"Chrome";if(V3(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=t.match(n);if((s==null?void 0:s.length)===2)return s[1]}return"Other"}function L3(t=Ks()){return/firefox\//i.test(t)}function M3(t=Ks()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function z3(t=Ks()){return/crios\//i.test(t)}function B3(t=Ks()){return/iemobile/i.test(t)}function V3(t=Ks()){return/android/i.test(t)}function U3(t=Ks()){return/blackberry/i.test(t)}function W3(t=Ks()){return/webos/i.test(t)}function sk(t=Ks()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function V7(t=Ks()){var e;return sk(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function U7(){return nK()&&document.documentMode===10}function j3(t=Ks()){return sk(t)||V3(t)||W3(t)||U3(t)||/windows phone/i.test(t)||B3(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G3(t,e=[]){let n;switch(t){case"Browser":n=qD(Ks());break;case"Worker":n=`${qD(Ks())}-${t}`;break;default:n=t}const s=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${mc}/${s}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W7{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const s=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});s.onAbort=n,this.queue.push(s);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const s of this.queue)await s(e),s.onAbort&&n.push(s.onAbort)}catch(s){n.reverse();for(const r of n)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s==null?void 0:s.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function j7(t,e={}){return jl(t,"GET","/v2/passwordPolicy",Wl(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G7=6;class H7{constructor(e){var n,s,r,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(n=o.minPasswordLength)!==null&&n!==void 0?n:G7,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(r=(s=e.allowedNonAlphanumericCharacters)===null||s===void 0?void 0:s.join(""))!==null&&r!==void 0?r:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var n,s,r,i,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(n=l.meetsMinPasswordLength)!==null&&n!==void 0?n:!0),l.isValid&&(l.isValid=(s=l.meetsMaxPasswordLength)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(r=l.containsLowercaseLetter)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,n){const s=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;s&&(n.meetsMinPasswordLength=e.length>=s),r&&(n.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let s;for(let r=0;r<e.length;r++)s=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(n,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,n,s,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q7{constructor(e,n,s,r){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=s,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new KD(this),this.idTokenSubscription=new KD(this),this.beforeStateQueue=new W7(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=N3,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=Yo(n)),this._initializationPromise=this.queue(async()=>{var s,r;if(!this._deleted&&(this.persistenceManager=await Sh.create(this,e),!this._deleted)){if(!((s=this._popupRedirectResolver)===null||s===void 0)&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((r=this.currentUser)===null||r===void 0?void 0:r.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await O3(this,{idToken:e}),s=await Xo._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(s)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var n;if(oo(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const s=await this.assertedPersistence.getCurrentUser();let r=s,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,a=r==null?void 0:r._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(r=l.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=s,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return We(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await tw(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=T7()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(oo(this.app))return Promise.reject(Zo(this));const n=e?br(e):null;return n&&We(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&We(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return oo(this.app)?Promise.reject(Zo(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return oo(this.app)?Promise.reject(Zo(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Yo(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await j7(this),n=new H7(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new qm("auth","Firebase",e())}onAuthStateChanged(e,n,s){return this.registerStateListener(this.authStateSubscription,e,n,s)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,s){return this.registerStateListener(this.idTokenSubscription,e,n,s)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(s.tenantId=this.tenantId),await B7(this,s)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,n){const s=await this.getOrInitRedirectPersistenceManager(n);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&Yo(e)||this._popupRedirectResolver;We(n,this,"argument-error"),this.redirectPersistenceManager=await Sh.create(this,[Yo(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,s;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const s=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==s&&(this.lastNotifiedUid=s,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,s,r){if(this._deleted)return()=>{};const i=typeof n=="function"?n:n.next.bind(n);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(We(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof n=="function"){const l=e.addObserver(n,s,r);return()=>{o=!0,l()}}else{const l=e.addObserver(n);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return We(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=G3(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const s=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());s&&(n["X-Firebase-Client"]=s);const r=await this._getAppCheckToken();return r&&(n["X-Firebase-AppCheck"]=r),n}async _getAppCheckToken(){var e;const n=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return n!=null&&n.error&&C7(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function gc(t){return br(t)}class KD{constructor(e){this.auth=e,this.observer=null,this.addObserver=hK(n=>this.observer=n)}get next(){return We(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let bx={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function K7(t){bx=t}function H3(t){return bx.loadJS(t)}function X7(){return bx.recaptchaEnterpriseScript}function Y7(){return bx.gapiScript}function Q7(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class J7{constructor(){this.enterprise=new Z7}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class Z7{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const eX="recaptcha-enterprise",q3="NO_RECAPTCHA";class tX{constructor(e){this.type=eX,this.auth=gc(e)}async verify(e="verify",n=!1){async function s(i){if(!n){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{A7(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const u=new R7(l);return i.tenantId==null?i._agentRecaptchaConfig=u:i._tenantRecaptchaConfigs[i.tenantId]=u,o(u.siteKey)}}).catch(l=>{a(l)})})}function r(i,o,a){const l=window.grecaptcha;WD(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(u=>{o(u)}).catch(()=>{o(q3)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new J7().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{s(this.auth).then(a=>{if(!n&&WD(window.grecaptcha))r(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=X7();l.length!==0&&(l+=a),H3(l).then(()=>{r(a,i,o)}).catch(u=>{o(u)})}}).catch(a=>{o(a)})})}}async function XD(t,e,n,s=!1,r=!1){const i=new tX(t);let o;if(r)o=q3;else try{o=await i.verify(n)}catch{o=await i.verify(n,!0)}const a=Object.assign({},e);if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const l=a.phoneEnrollmentInfo.phoneNumber,u=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:u,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const l=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return s?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function NI(t,e,n,s,r){var i;if(!((i=t._getRecaptchaConfig())===null||i===void 0)&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await XD(t,e,n,n==="getOobCode");return s(t,o)}else return s(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await XD(t,e,n,n==="getOobCode");return s(t,a)}else return Promise.reject(o)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nX(t,e){const n=JT(t,"auth");if(n.isInitialized()){const r=n.getImmediate(),i=n.getOptions();if(Jv(i,e??{}))return r;Vi(r,"already-initialized")}return n.initialize({options:e})}function sX(t,e){const n=(e==null?void 0:e.persistence)||[],s=(Array.isArray(n)?n:[n]).map(Yo);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(s,e==null?void 0:e.popupRedirectResolver)}function rX(t,e,n){const s=gc(t);We(s._canInitEmulator,s,"emulator-config-failed"),We(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const r=!1,i=K3(e),{host:o,port:a}=iX(e),l=a===null?"":`:${a}`;s.config.emulator={url:`${i}//${o}${l}/`},s.settings.appVerificationDisabledForTesting=!0,s.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:r})}),oX()}function K3(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function iX(t){const e=K3(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const s=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(s);if(r){const i=r[1];return{host:i,port:YD(s.substr(i.length+1))}}else{const[i,o]=s.split(":");return{host:i,port:YD(o)}}}function YD(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function oX(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rk{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return Ko("not implemented")}_getIdTokenResponse(e){return Ko("not implemented")}_linkToIdToken(e,n){return Ko("not implemented")}_getReauthenticationResolver(e){return Ko("not implemented")}}async function aX(t,e){return jl(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lX(t,e){return Xm(t,"POST","/v1/accounts:signInWithPassword",Wl(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uX(t,e){return Xm(t,"POST","/v1/accounts:signInWithEmailLink",Wl(t,e))}async function cX(t,e){return Xm(t,"POST","/v1/accounts:signInWithEmailLink",Wl(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lm extends rk{constructor(e,n,s,r=null){super("password",s),this._email=e,this._password=n,this._tenantId=r}static _fromEmailAndPassword(e,n){return new lm(e,n,"password")}static _fromEmailAndCode(e,n,s=null){return new lm(e,n,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return NI(e,n,"signInWithPassword",lX);case"emailLink":return uX(e,{email:this._email,oobCode:this._password});default:Vi(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const s={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return NI(e,s,"signUpPassword",aX);case"emailLink":return cX(e,{idToken:n,email:this._email,oobCode:this._password});default:Vi(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ch(t,e){return Xm(t,"POST","/v1/accounts:signInWithIdp",Wl(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hX="http://localhost";class Uu extends rk{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Uu(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):Vi("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:r}=n,i=ZT(n,["providerId","signInMethod"]);if(!s||!r)return null;const o=new Uu(s,r);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return Ch(e,n)}_linkToIdToken(e,n){const s=this.buildRequest();return s.idToken=n,Ch(e,s)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Ch(e,n)}buildRequest(){const e={requestUri:hX,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=ud(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dX(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function fX(t){const e=dp(fp(t)).link,n=e?dp(fp(e)).deep_link_id:null,s=dp(fp(t)).deep_link_id;return(s?dp(fp(s)).link:null)||s||n||e||t}class ik{constructor(e){var n,s,r,i,o,a;const l=dp(fp(e)),u=(n=l.apiKey)!==null&&n!==void 0?n:null,c=(s=l.oobCode)!==null&&s!==void 0?s:null,h=dX((r=l.mode)!==null&&r!==void 0?r:null);We(u&&c&&h,"argument-error"),this.apiKey=u,this.operation=h,this.code=c,this.continueUrl=(i=l.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const n=fX(e);try{return new ik(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cd{constructor(){this.providerId=cd.PROVIDER_ID}static credential(e,n){return lm._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const s=ik.parseLink(n);return We(s,"argument-error"),lm._fromEmailAndCode(e,s.code,s.tenantId)}}cd.PROVIDER_ID="password";cd.EMAIL_PASSWORD_SIGN_IN_METHOD="password";cd.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X3{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ym extends X3{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qa extends Ym{constructor(){super("facebook.com")}static credential(e){return Uu._fromParams({providerId:qa.PROVIDER_ID,signInMethod:qa.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return qa.credentialFromTaggedObject(e)}static credentialFromError(e){return qa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return qa.credential(e.oauthAccessToken)}catch{return null}}}qa.FACEBOOK_SIGN_IN_METHOD="facebook.com";qa.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ka extends Ym{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Uu._fromParams({providerId:Ka.PROVIDER_ID,signInMethod:Ka.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Ka.credentialFromTaggedObject(e)}static credentialFromError(e){return Ka.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:s}=e;if(!n&&!s)return null;try{return Ka.credential(n,s)}catch{return null}}}Ka.GOOGLE_SIGN_IN_METHOD="google.com";Ka.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xa extends Ym{constructor(){super("github.com")}static credential(e){return Uu._fromParams({providerId:Xa.PROVIDER_ID,signInMethod:Xa.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Xa.credentialFromTaggedObject(e)}static credentialFromError(e){return Xa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Xa.credential(e.oauthAccessToken)}catch{return null}}}Xa.GITHUB_SIGN_IN_METHOD="github.com";Xa.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ya extends Ym{constructor(){super("twitter.com")}static credential(e,n){return Uu._fromParams({providerId:Ya.PROVIDER_ID,signInMethod:Ya.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Ya.credentialFromTaggedObject(e)}static credentialFromError(e){return Ya.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:s}=e;if(!n||!s)return null;try{return Ya.credential(n,s)}catch{return null}}}Ya.TWITTER_SIGN_IN_METHOD="twitter.com";Ya.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pX(t,e){return Xm(t,"POST","/v1/accounts:signUp",Wl(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wu{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,s,r=!1){const i=await Xo._fromIdTokenResponse(e,s,r),o=QD(s);return new Wu({user:i,providerId:o,_tokenResponse:s,operationType:n})}static async _forOperation(e,n,s){await e._updateTokensIfNecessary(s,!0);const r=QD(s);return new Wu({user:e,providerId:r,_tokenResponse:s,operationType:n})}}function QD(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nw extends ya{constructor(e,n,s,r){var i;super(n.code,n.message),this.operationType=s,this.user=r,Object.setPrototypeOf(this,nw.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:n.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,n,s,r){return new nw(e,n,s,r)}}function Y3(t,e,n,s){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?nw._fromErrorAndOperation(t,i,e,s):i})}async function mX(t,e,n=!1){const s=await am(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Wu._forOperation(t,"link",s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gX(t,e,n=!1){const{auth:s}=t;if(oo(s.app))return Promise.reject(Zo(s));const r="reauthenticate";try{const i=await am(t,Y3(s,r,e,t),n);We(i.idToken,s,"internal-error");const o=nk(i.idToken);We(o,s,"internal-error");const{sub:a}=o;return We(t.uid===a,s,"user-mismatch"),Wu._forOperation(t,r,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Vi(s,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Q3(t,e,n=!1){if(oo(t.app))return Promise.reject(Zo(t));const s="signIn",r=await Y3(t,s,e),i=await Wu._fromIdTokenResponse(t,s,r);return n||await t._updateCurrentUser(i.user),i}async function yX(t,e){return Q3(gc(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function J3(t){const e=gc(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function vX(t,e,n){if(oo(t.app))return Promise.reject(Zo(t));const s=gc(t),o=await NI(s,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",pX).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&J3(t),l}),a=await Wu._fromIdTokenResponse(s,"signIn",o);return await s._updateCurrentUser(a.user),a}function wX(t,e,n){return oo(t.app)?Promise.reject(Zo(t)):yX(br(t),cd.credential(e,n)).catch(async s=>{throw s.code==="auth/password-does-not-meet-requirements"&&J3(t),s})}function xX(t,e,n,s){return br(t).onIdTokenChanged(e,n,s)}function bX(t,e,n){return br(t).beforeAuthStateChanged(e,n)}function SX(t){return br(t).signOut()}const sw="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z3{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(sw,"1"),this.storage.removeItem(sw),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CX=1e3,IX=10;class ez extends Z3{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=j3(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const s=this.storage.getItem(n),r=this.localCache[n];s!==r&&e(n,r,s)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const s=e.key;n?this.detachListener():this.stopPolling();const r=()=>{const o=this.storage.getItem(s);!n&&this.localCache[s]===o||this.notifyListeners(s,o)},i=this.storage.getItem(s);U7()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,IX):r()}notifyListeners(e,n){this.localCache[e]=n;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:s}),!0)})},CX)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}ez.type="LOCAL";const _X=ez;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tz extends Z3{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}tz.type="SESSION";const nz=tz;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TX(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sx{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(r=>r.isListeningto(e));if(n)return n;const s=new Sx(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:s,eventType:r,data:i}=n.data,o=this.handlersMap[r];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:s,eventType:r});const a=Array.from(o).map(async u=>u(n.origin,i)),l=await TX(a);n.ports[0].postMessage({status:"done",eventId:s,eventType:r,response:l})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Sx.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ok(t="",e=10){let n="";for(let s=0;s<e;s++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kX{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,s=50){const r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const u=ok("",20);r.port1.start();const c=setTimeout(()=>{l(new Error("unsupported_event"))},s);o={messageChannel:r,onMessage(h){const d=h;if(d.data.eventId===u)switch(d.data.status){case"ack":clearTimeout(c),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(d.data.response);break;default:clearTimeout(c),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),r.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:n},[r.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mo(){return window}function EX(t){mo().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sz(){return typeof mo().WorkerGlobalScope<"u"&&typeof mo().importScripts=="function"}async function NX(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function $X(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function RX(){return sz()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rz="firebaseLocalStorageDb",AX=1,rw="firebaseLocalStorage",iz="fbase_key";class Qm{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Cx(t,e){return t.transaction([rw],e?"readwrite":"readonly").objectStore(rw)}function DX(){const t=indexedDB.deleteDatabase(rz);return new Qm(t).toPromise()}function $I(){const t=indexedDB.open(rz,AX);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const s=t.result;try{s.createObjectStore(rw,{keyPath:iz})}catch(r){n(r)}}),t.addEventListener("success",async()=>{const s=t.result;s.objectStoreNames.contains(rw)?e(s):(s.close(),await DX(),e(await $I()))})})}async function JD(t,e,n){const s=Cx(t,!0).put({[iz]:e,value:n});return new Qm(s).toPromise()}async function OX(t,e){const n=Cx(t,!1).get(e),s=await new Qm(n).toPromise();return s===void 0?null:s.value}function ZD(t,e){const n=Cx(t,!0).delete(e);return new Qm(n).toPromise()}const PX=800,FX=3;class oz{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await $I(),this.db)}async _withRetries(e){let n=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(n++>FX)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return sz()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Sx._getInstance(RX()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var e,n;if(this.activeServiceWorker=await NX(),!this.activeServiceWorker)return;this.sender=new kX(this.activeServiceWorker);const s=await this.sender._send("ping",{},800);s&&!((e=s[0])===null||e===void 0)&&e.fulfilled&&!((n=s[0])===null||n===void 0)&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||$X()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await $I();return await JD(e,sw,"1"),await ZD(e,sw),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(s=>JD(s,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(s=>OX(s,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>ZD(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(r=>{const i=Cx(r,!1).getAll();return new Qm(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],s=new Set;if(e.length!==0)for(const{fbase_key:r,value:i}of e)s.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),n.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!s.has(r)&&(this.notifyListeners(r,null),n.push(r));return n}notifyListeners(e,n){this.localCache[e]=n;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),PX)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}oz.type="LOCAL";const LX=oz;new Km(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MX(t,e){return e?Yo(e):(We(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ak extends rk{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ch(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Ch(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Ch(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function zX(t){return Q3(t.auth,new ak(t),t.bypassAuthState)}function BX(t){const{auth:e,user:n}=t;return We(n,e,"internal-error"),gX(n,new ak(t),t.bypassAuthState)}async function VX(t){const{auth:e,user:n}=t;return We(n,e,"internal-error"),mX(n,new ak(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class az{constructor(e,n,s,r,i=!1){this.auth=e,this.resolver=s,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:s,postBody:r,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:n,sessionId:s,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return zX;case"linkViaPopup":case"linkViaRedirect":return VX;case"reauthViaPopup":case"reauthViaRedirect":return BX;default:Vi(this.auth,"internal-error")}}resolve(e){aa(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){aa(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UX=new Km(2e3,1e4);class dh extends az{constructor(e,n,s,r,i){super(e,n,r,i),this.provider=s,this.authWindow=null,this.pollId=null,dh.currentPopupAction&&dh.currentPopupAction.cancel(),dh.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return We(e,this.auth,"internal-error"),e}async onExecution(){aa(this.filter.length===1,"Popup operations only handle one event");const e=ok();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(po(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(po(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,dh.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,s;if(!((s=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||s===void 0)&&s.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(po(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,UX.get())};e()}}dh.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WX="pendingRedirect",uv=new Map;class jX extends az{constructor(e,n,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,s),this.eventId=null}async execute(){let e=uv.get(this.auth._key());if(!e){try{const s=await GX(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(n){e=()=>Promise.reject(n)}uv.set(this.auth._key(),e)}return this.bypassAuthState||uv.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function GX(t,e){const n=KX(e),s=qX(t);if(!await s._isAvailable())return!1;const r=await s._get(n)==="true";return await s._remove(n),r}function HX(t,e){uv.set(t._key(),e)}function qX(t){return Yo(t._redirectPersistence)}function KX(t){return lv(WX,t.config.apiKey,t.name)}async function XX(t,e,n=!1){if(oo(t.app))return Promise.reject(Zo(t));const s=gc(t),r=MX(s,e),o=await new jX(s,r,n).execute();return o&&!n&&(delete o.user._redirectEventId,await s._persistUserIfCurrent(o.user),await s._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YX=10*60*1e3;class QX{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(n=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!JX(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var s;if(e.error&&!lz(e)){const r=((s=e.error.code)===null||s===void 0?void 0:s.split("auth/")[1])||"internal-error";n.onError(po(this.auth,r))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const s=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=YX&&this.cachedEventUids.clear(),this.cachedEventUids.has(eO(e))}saveEventToCache(e){this.cachedEventUids.add(eO(e)),this.lastProcessedEventTime=Date.now()}}function eO(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function lz({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function JX(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return lz(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ZX(t,e={}){return jl(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eY=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,tY=/^https?/;async function nY(t){if(t.config.emulator)return;const{authorizedDomains:e}=await ZX(t);for(const n of e)try{if(sY(n))return}catch{}Vi(t,"unauthorized-domain")}function sY(t){const e=kI(),{protocol:n,hostname:s}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&s===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===s}if(!tY.test(n))return!1;if(eY.test(t))return s===t;const r=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(s)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rY=new Km(3e4,6e4);function tO(){const t=mo().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function iY(t){return new Promise((e,n)=>{var s,r,i;function o(){tO(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{tO(),n(po(t,"network-request-failed"))},timeout:rY.get()})}if(!((r=(s=mo().gapi)===null||s===void 0?void 0:s.iframes)===null||r===void 0)&&r.Iframe)e(gapi.iframes.getContext());else if(!((i=mo().gapi)===null||i===void 0)&&i.load)o();else{const a=Q7("iframefcb");return mo()[a]=()=>{gapi.load?o():n(po(t,"network-request-failed"))},H3(`${Y7()}?onload=${a}`).catch(l=>n(l))}}).catch(e=>{throw cv=null,e})}let cv=null;function oY(t){return cv=cv||iY(t),cv}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aY=new Km(5e3,15e3),lY="__/auth/iframe",uY="emulator/auth/iframe",cY={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},hY=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function dY(t){const e=t.config;We(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?tk(e,uY):`https://${t.config.authDomain}/${lY}`,s={apiKey:e.apiKey,appName:t.name,v:mc},r=hY.get(t.config.apiHost);r&&(s.eid=r);const i=t._getFrameworks();return i.length&&(s.fw=i.join(",")),`${n}?${ud(s).slice(1)}`}async function fY(t){const e=await oY(t),n=mo().gapi;return We(n,t,"internal-error"),e.open({where:document.body,url:dY(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:cY,dontclear:!0},s=>new Promise(async(r,i)=>{await s.restyle({setHideOnLeave:!1});const o=po(t,"network-request-failed"),a=mo().setTimeout(()=>{i(o)},aY.get());function l(){mo().clearTimeout(a),r(s)}s.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pY={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},mY=500,gY=600,yY="_blank",vY="http://localhost";class nO{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function wY(t,e,n,s=mY,r=gY){const i=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-s)/2,0).toString();let a="";const l=Object.assign(Object.assign({},pY),{width:s.toString(),height:r.toString(),top:i,left:o}),u=Ks().toLowerCase();n&&(a=z3(u)?yY:n),L3(u)&&(e=e||vY,l.scrollbars="yes");const c=Object.entries(l).reduce((d,[f,p])=>`${d}${f}=${p},`,"");if(V7(u)&&a!=="_self")return xY(e||"",a),new nO(null);const h=window.open(e||"",a,c);We(h,t,"popup-blocked");try{h.focus()}catch{}return new nO(h)}function xY(t,e){const n=document.createElement("a");n.href=t,n.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bY="__/auth/handler",SY="emulator/auth/handler",CY=encodeURIComponent("fac");async function sO(t,e,n,s,r,i){We(t.config.authDomain,t,"auth-domain-config-required"),We(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:s,v:mc,eventId:r};if(e instanceof X3){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",bI(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[c,h]of Object.entries({}))o[c]=h}if(e instanceof Ym){const c=e.getScopes().filter(h=>h!=="");c.length>0&&(o.scopes=c.join(","))}t.tenantId&&(o.tid=t.tenantId);const a=o;for(const c of Object.keys(a))a[c]===void 0&&delete a[c];const l=await t._getAppCheckToken(),u=l?`#${CY}=${encodeURIComponent(l)}`:"";return`${IY(t)}?${ud(a).slice(1)}${u}`}function IY({config:t}){return t.emulator?tk(t,SY):`https://${t.authDomain}/${bY}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eC="webStorageSupport";class _Y{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=nz,this._completeRedirectFn=XX,this._overrideRedirectResult=HX}async _openPopup(e,n,s,r){var i;aa((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await sO(e,n,s,kI(),r);return wY(e,o,ok())}async _openRedirect(e,n,s,r){await this._originValidation(e);const i=await sO(e,n,s,kI(),r);return EX(i),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:r,promise:i}=this.eventManagers[n];return r?Promise.resolve(r):(aa(i,"If manager is not set, promise should be"),i)}const s=this.initAndGetManager(e);return this.eventManagers[n]={promise:s},s.catch(()=>{delete this.eventManagers[n]}),s}async initAndGetManager(e){const n=await fY(e),s=new QX(e);return n.register("authEvent",r=>(We(r==null?void 0:r.authEvent,e,"invalid-auth-event"),{status:s.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=n,s}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(eC,{type:eC},r=>{var i;const o=(i=r==null?void 0:r[0])===null||i===void 0?void 0:i[eC];o!==void 0&&n(!!o),Vi(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=nY(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return j3()||M3()||sk()}}const TY=_Y;var rO="@firebase/auth",iO="1.8.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kY{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(s=>{e((s==null?void 0:s.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){We(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EY(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function NY(t){Vu(new Cl("auth",(e,{options:n})=>{const s=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=s.options;We(o&&!o.includes(":"),"invalid-api-key",{appName:s.name});const l={apiKey:o,authDomain:a,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:G3(t)},u=new q7(s,r,i,l);return sX(u,n),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,s)=>{e.getProvider("auth-internal").initialize()})),Vu(new Cl("auth-internal",e=>{const n=gc(e.getProvider("auth").getImmediate());return(s=>new kY(s))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),fo(rO,iO,EY(t)),fo(rO,iO,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $Y=5*60,RY=v3("authIdTokenMaxAge")||$Y;let oO=null;const AY=t=>async e=>{const n=e&&await e.getIdTokenResult(),s=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(s&&s>RY)return;const r=n==null?void 0:n.token;oO!==r&&(oO=r,await fetch(t,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function Ix(t=_3()){const e=JT(t,"auth");if(e.isInitialized())return e.getImmediate();const n=nX(t,{popupRedirectResolver:TY,persistence:[LX,_X,nz]}),s=v3("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(s,location.origin);if(location.origin===i.origin){const o=AY(i.toString());bX(n,o,()=>o(n.currentUser)),xX(n,a=>o(a))}}const r=g3("auth");return r&&rX(n,`http://${r}`),n}function DY(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}K7({loadJS(t){return new Promise((e,n)=>{const s=document.createElement("script");s.setAttribute("src",t),s.onload=e,s.onerror=r=>{const i=po("internal-error");i.customData=r,n(i)},s.type="text/javascript",s.charset="UTF-8",DY().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});NY("Browser");var OY="firebase",PY="11.1.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */fo(OY,PY,"app");var aO={};const lO="@firebase/database",uO="1.0.10";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let uz="";function FY(t){uz=t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LY{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Wn(n))}get(e){const n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:im(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MY{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return ko(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cz=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new LY(e)}}catch{}return new MY},Iu=cz("localStorage"),zY=cz("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ih=new xx("@firebase/database"),BY=function(){let t=1;return function(){return t++}}(),hz=function(t){const e=pK(t),n=new cK;n.update(e);const s=n.digest();return KT.encodeByteArray(s)},Jm=function(...t){let e="";for(let n=0;n<t.length;n++){const s=t[n];Array.isArray(s)||s&&typeof s=="object"&&typeof s.length=="number"?e+=Jm.apply(null,s):typeof s=="object"?e+=Wn(s):e+=s,e+=" "}return e};let Dp=null,cO=!0;const VY=function(t,e){ye(!e,"Can't turn on custom loggers persistently."),Ih.logLevel=kt.VERBOSE,Dp=Ih.log.bind(Ih)},ws=function(...t){if(cO===!0&&(cO=!1,Dp===null&&zY.get("logging_enabled")===!0&&VY()),Dp){const e=Jm.apply(null,t);Dp(e)}},Zm=function(t){return function(...e){ws(t,...e)}},RI=function(...t){const e="FIREBASE INTERNAL ERROR: "+Jm(...t);Ih.error(e)},la=function(...t){const e=`FIREBASE FATAL ERROR: ${Jm(...t)}`;throw Ih.error(e),new Error(e)},Hs=function(...t){const e="FIREBASE WARNING: "+Jm(...t);Ih.warn(e)},UY=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Hs("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},lk=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},WY=function(t){if(document.readyState==="complete")t();else{let e=!1;const n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},Lh="[MIN_NAME]",ju="[MAX_NAME]",yc=function(t,e){if(t===e)return 0;if(t===Lh||e===ju)return-1;if(e===Lh||t===ju)return 1;{const n=hO(t),s=hO(e);return n!==null?s!==null?n-s===0?t.length-e.length:n-s:-1:s!==null?1:t<e?-1:1}},jY=function(t,e){return t===e?0:t<e?-1:1},Jf=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Wn(e))},uk=function(t){if(typeof t!="object"||t===null)return Wn(t);const e=[];for(const s in t)e.push(s);e.sort();let n="{";for(let s=0;s<e.length;s++)s!==0&&(n+=","),n+=Wn(e[s]),n+=":",n+=uk(t[e[s]]);return n+="}",n},dz=function(t,e){const n=t.length;if(n<=e)return[t];const s=[];for(let r=0;r<n;r+=e)r+e>n?s.push(t.substring(r,n)):s.push(t.substring(r,r+e));return s};function Ss(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const fz=function(t){ye(!lk(t),"Invalid JSON number");const e=11,n=52,s=(1<<e-1)-1;let r,i,o,a,l;t===0?(i=0,o=0,r=1/t===-1/0?1:0):(r=t<0,t=Math.abs(t),t>=Math.pow(2,1-s)?(a=Math.min(Math.floor(Math.log(t)/Math.LN2),s),i=a+s,o=Math.round(t*Math.pow(2,n-a)-Math.pow(2,n))):(i=0,o=Math.round(t/Math.pow(2,1-s-n))));const u=[];for(l=n;l;l-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)u.push(i%2?1:0),i=Math.floor(i/2);u.push(r?1:0),u.reverse();const c=u.join("");let h="";for(l=0;l<64;l+=8){let d=parseInt(c.substr(l,8),2).toString(16);d.length===1&&(d="0"+d),h=h+d}return h.toLowerCase()},GY=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},HY=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function qY(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");const s=new Error(t+" at "+e._path.toString()+": "+n);return s.code=t.toUpperCase(),s}const KY=new RegExp("^-?(0*)\\d{1,10}$"),XY=-2147483648,YY=2147483647,hO=function(t){if(KY.test(t)){const e=Number(t);if(e>=XY&&e<=YY)return e}return null},hd=function(t){try{t()}catch(e){setTimeout(()=>{const n=e.stack||"";throw Hs("Exception was thrown by user callback.",n),e},Math.floor(0))}},QY=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Op=function(t,e){const n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JY{constructor(e,n){this.appName_=e,this.appCheckProvider=n,this.appCheck=n==null?void 0:n.getImmediate({optional:!0}),this.appCheck||n==null||n.get().then(s=>this.appCheck=s)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((n,s)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,s):n(null)},0)})}addTokenChangeListener(e){var n;(n=this.appCheckProvider)===null||n===void 0||n.get().then(s=>s.addTokenListener(e))}notifyForInvalidToken(){Hs(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZY{constructor(e,n,s){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit(r=>this.auth_=r)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(ws("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,s)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,s):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Hs(e)}}class hv{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}hv.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ck="5",pz="v",mz="s",gz="r",yz="f",vz=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,wz="ls",xz="p",AI="ac",bz="websocket",Sz="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cz{constructor(e,n,s,r,i=!1,o="",a=!1,l=!1){this.secure=n,this.namespace=s,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Iu.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Iu.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}}function eQ(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function Iz(t,e,n){ye(typeof e=="string","typeof type must == string"),ye(typeof n=="object","typeof params must == object");let s;if(e===bz)s=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===Sz)s=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);eQ(t)&&(n.ns=t.namespace);const r=[];return Ss(n,(i,o)=>{r.push(i+"="+o)}),s+r.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tQ{constructor(){this.counters_={}}incrementCounter(e,n=1){ko(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return H8(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tC={},nC={};function hk(t){const e=t.toString();return tC[e]||(tC[e]=new tQ),tC[e]}function nQ(t,e){const n=t.toString();return nC[n]||(nC[n]=e()),nC[n]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sQ{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){const s=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let r=0;r<s.length;++r)s[r]&&hd(()=>{this.onMessage_(s[r])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dO="start",rQ="close",iQ="pLPCommand",oQ="pRTLPCB",_z="id",Tz="pw",kz="ser",aQ="cb",lQ="seg",uQ="ts",cQ="d",hQ="dframe",Ez=1870,Nz=30,dQ=Ez-Nz,fQ=25e3,pQ=3e4;class fh{constructor(e,n,s,r,i,o,a){this.connId=e,this.repoInfo=n,this.applicationId=s,this.appCheckToken=r,this.authToken=i,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Zm(e),this.stats_=hk(n),this.urlFn=l=>(this.appCheckToken&&(l[AI]=this.appCheckToken),Iz(n,Sz,l))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new sQ(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(pQ)),WY(()=>{if(this.isClosed_)return;this.scriptTagHolder=new dk((...i)=>{const[o,a,l,u,c]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===dO)this.id=a,this.password=l;else if(o===rQ)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,a]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const s={};s[dO]="t",s[kz]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(s[aQ]=this.scriptTagHolder.uniqueCallbackIdentifier),s[pz]=ck,this.transportSessionId&&(s[mz]=this.transportSessionId),this.lastSessionId&&(s[wz]=this.lastSessionId),this.applicationId&&(s[xz]=this.applicationId),this.appCheckToken&&(s[AI]=this.appCheckToken),typeof location<"u"&&location.hostname&&vz.test(location.hostname)&&(s[gz]=yz);const r=this.urlFn(s);this.log_("Connecting via long-poll to "+r),this.scriptTagHolder.addTag(r,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){fh.forceAllow_=!0}static forceDisallow(){fh.forceDisallow_=!0}static isAvailable(){return fh.forceAllow_?!0:!fh.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!GY()&&!HY()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const n=Wn(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const s=p3(n),r=dz(s,dQ);for(let i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++}addDisconnectPingFrame(e,n){this.myDisconnFrame=document.createElement("iframe");const s={};s[hQ]="t",s[_z]=e,s[Tz]=n,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const n=Wn(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}}class dk{constructor(e,n,s,r){this.onDisconnect=s,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=BY(),window[iQ+this.uniqueCallbackIdentifier]=e,window[oQ+this.uniqueCallbackIdentifier]=n,this.myIFrame=dk.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){ws("frame writing exception"),a.stack&&ws(a.stack),ws(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||ws("No IE domain setting required")}catch{const s=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[_z]=this.myID,e[Tz]=this.myPW,e[kz]=this.currentSerial;let n=this.urlFn(e),s="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Nz+s.length<=Ez;){const o=this.pendingSegs.shift();s=s+"&"+lQ+r+"="+o.seg+"&"+uQ+r+"="+o.ts+"&"+cQ+r+"="+o.d,r++}return n=n+s,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,s){this.pendingSegs.push({seg:e,ts:n,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);const s=()=>{this.outstandingRequests.delete(n),this.newRequest_()},r=setTimeout(s,Math.floor(fQ)),i=()=>{clearTimeout(r),s()};this.addTag(e,i)}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=e,s.onload=s.onreadystatechange=function(){const r=s.readyState;(!r||r==="loaded"||r==="complete")&&(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),n())},s.onerror=()=>{ws("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mQ=16384,gQ=45e3;let iw=null;typeof MozWebSocket<"u"?iw=MozWebSocket:typeof WebSocket<"u"&&(iw=WebSocket);class Ti{constructor(e,n,s,r,i,o,a){this.connId=e,this.applicationId=s,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Zm(this.connId),this.stats_=hk(n),this.connURL=Ti.connectionURL_(n,o,a,r,s),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,n,s,r,i){const o={};return o[pz]=ck,typeof location<"u"&&location.hostname&&vz.test(location.hostname)&&(o[gz]=yz),n&&(o[mz]=n),s&&(o[wz]=s),r&&(o[AI]=r),i&&(o[xz]=i),Iz(e,bz,o)}open(e,n){this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Iu.set("previous_websocket_failure",!0);try{let s;x3(),this.mySock=new iw(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");const r=s.message||s.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");const r=s.message||s.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){Ti.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const n=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(n);s&&s.length>1&&parseFloat(s[1])<4.4&&(e=!0)}return!e&&iw!==null&&!Ti.forceDisallow_}static previouslyFailed(){return Iu.isInMemoryStorage||Iu.get("previous_websocket_failure")===!0}markConnectionHealthy(){Iu.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const n=this.frames.join("");this.frames=null;const s=im(n);this.onMessage(s)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(ye(this.frames===null,"We already have a frame buffer"),e.length<=6){const n=Number(e);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const n=e.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{const s=this.extractFrameCount_(n);s!==null&&this.appendFrame_(s)}}send(e){this.resetKeepAlive();const n=Wn(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const s=dz(n,mQ);s.length>1&&this.sendString_(String(s.length));for(let r=0;r<s.length;r++)this.sendString_(s[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(gQ))}sendString_(e){try{this.mySock.send(e)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Ti.responsesRequiredToBeHealthy=2;Ti.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class um{static get ALL_TRANSPORTS(){return[fh,Ti]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const n=Ti&&Ti.isAvailable();let s=n&&!Ti.previouslyFailed();if(e.webSocketOnly&&(n||Hs("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[Ti];else{const r=this.transports_=[];for(const i of um.ALL_TRANSPORTS)i&&i.isAvailable()&&r.push(i);um.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}um.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yQ=6e4,vQ=5e3,wQ=10*1024,xQ=100*1024,sC="t",fO="d",bQ="s",pO="r",SQ="e",mO="o",gO="a",yO="n",vO="p",CQ="h";class IQ{constructor(e,n,s,r,i,o,a,l,u,c){this.id=e,this.repoInfo_=n,this.applicationId_=s,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=u,this.lastSessionId=c,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Zm("c:"+this.id+":"),this.transportManager_=new um(n),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,s)},Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=Op(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>xQ?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>wQ?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){const n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(sC in e){const n=e[sC];n===gO?this.upgradeIfSecondaryHealthy_():n===pO?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===mO&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const n=Jf("t",e),s=Jf("d",e);if(n==="c")this.onSecondaryControl_(s);else if(n==="d")this.pendingDataMessages.push(s);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:vO,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:gO,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:yO,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const n=Jf("t",e),s=Jf("d",e);n==="c"?this.onControl_(s):n==="d"&&this.onDataMessage_(s)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const n=Jf(sC,e);if(fO in e){const s=e[fO];if(n===CQ){const r=Object.assign({},s);this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if(n===yO){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===bQ?this.onConnectionShutdown_(s):n===pO?this.onReset_(s):n===SQ?RI("Server Error: "+s):n===mO?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):RI("Unknown control packet command: "+n)}}onHandshake_(e){const n=e.ts,s=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),ck!==s&&Hs("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,s),Op(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(yQ))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Op(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(vQ))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:vO,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Iu.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $z{put(e,n,s,r){}merge(e,n,s,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,s){}onDisconnectMerge(e,n,s){}onDisconnectCancel(e,n){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rz{constructor(e){this.allowedEvents_=e,this.listeners_={},ye(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){const s=[...this.listeners_[e]];for(let r=0;r<s.length;r++)s[r].callback.apply(s[r].context,n)}}on(e,n,s){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:s});const r=this.getInitialEvent(e);r&&n.apply(s,r)}off(e,n,s){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let i=0;i<r.length;i++)if(r[i].callback===n&&(!s||s===r[i].context)){r.splice(i,1);return}}validateEventType_(e){ye(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ow extends Rz{static getInstance(){return new ow}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!YT()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return ye(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wO=32,xO=768;class Ft{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let s=0;for(let r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[s]=this.pieces_[r],s++);this.pieces_.length=s,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}}function St(){return new Ft("")}function rt(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function Il(t){return t.pieces_.length-t.pieceNum_}function Gt(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new Ft(t.pieces_,e)}function fk(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function _Q(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function cm(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function Az(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new Ft(e,0)}function yn(t,e){const n=[];for(let s=t.pieceNum_;s<t.pieces_.length;s++)n.push(t.pieces_[s]);if(e instanceof Ft)for(let s=e.pieceNum_;s<e.pieces_.length;s++)n.push(e.pieces_[s]);else{const s=e.split("/");for(let r=0;r<s.length;r++)s[r].length>0&&n.push(s[r])}return new Ft(n,0)}function ut(t){return t.pieceNum_>=t.pieces_.length}function Ws(t,e){const n=rt(t),s=rt(e);if(n===null)return e;if(n===s)return Ws(Gt(t),Gt(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function TQ(t,e){const n=cm(t,0),s=cm(e,0);for(let r=0;r<n.length&&r<s.length;r++){const i=yc(n[r],s[r]);if(i!==0)return i}return n.length===s.length?0:n.length<s.length?-1:1}function pk(t,e){if(Il(t)!==Il(e))return!1;for(let n=t.pieceNum_,s=e.pieceNum_;n<=t.pieces_.length;n++,s++)if(t.pieces_[n]!==e.pieces_[s])return!1;return!0}function ei(t,e){let n=t.pieceNum_,s=e.pieceNum_;if(Il(t)>Il(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[s])return!1;++n,++s}return!0}class kQ{constructor(e,n){this.errorPrefix_=n,this.parts_=cm(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=wx(this.parts_[s]);Dz(this)}}function EQ(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=wx(e),Dz(t)}function NQ(t){const e=t.parts_.pop();t.byteLength_-=wx(e),t.parts_.length>0&&(t.byteLength_-=1)}function Dz(t){if(t.byteLength_>xO)throw new Error(t.errorPrefix_+"has a key path longer than "+xO+" bytes ("+t.byteLength_+").");if(t.parts_.length>wO)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+wO+") or object contains a cycle "+hu(t))}function hu(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mk extends Rz{static getInstance(){return new mk}constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{const s=!document[e];s!==this.visible_&&(this.visible_=s,this.trigger("visible",s))},!1)}getInitialEvent(e){return ye(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zf=1e3,$Q=60*5*1e3,bO=30*1e3,RQ=1.3,AQ=3e4,DQ="server_kill",SO=3;class ea extends $z{constructor(e,n,s,r,i,o,a,l){if(super(),this.repoInfo_=e,this.applicationId_=n,this.onDataUpdate_=s,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=ea.nextPersistentConnectionId_++,this.log_=Zm("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Zf,this.maxReconnectDelay_=$Q,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l&&!x3())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");mk.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&ow.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,s){const r=++this.requestNumber_,i={r,a:e,b:n};this.log_(Wn(i)),ye(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),s&&(this.requestCBHash_[r]=s)}get(e){this.initConnection_();const n=new Hm,r={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?n.resolve(a):n.reject(a)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),n.promise}listen(e,n,s,r){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),ye(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),ye(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const a={onComplete:r,hashFn:n,query:e,tag:s};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const n=this.outstandingGets_[e];this.sendRequest("g",n.request,s=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(s)})}sendListen_(e){const n=e.query,s=n._path.toString(),r=n._queryIdentifier;this.log_("Listen on "+s+" for "+r);const i={p:s},o="q";e.tag&&(i.q=n._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,a=>{const l=a.d,u=a.s;ea.warnOnListenWarnings_(l,n),(this.listens.get(s)&&this.listens.get(s).get(r))===e&&(this.log_("listen response",a),u!=="ok"&&this.removeListen_(s,r),e.onComplete&&e.onComplete(u,l))})}static warnOnListenWarnings_(e,n){if(e&&typeof e=="object"&&ko(e,"w")){const s=Fh(e,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const r='".indexOn": "'+n._queryParams.getIndex().toString()+'"',i=n._path.toString();Hs(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||uK(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=bO)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,n=lK(e)?"auth":"gauth",s={cred:e};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(n,s,r=>{const i=r.s,o=r.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const n=e.s,s=e.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,s)})}unlisten(e,n){const s=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+s+" "+r),ye(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,r)&&this.connected_&&this.sendUnlisten_(s,r,e._queryObject,n)}sendUnlisten_(e,n,s,r){this.log_("Unlisten on "+e+" for "+n);const i={p:e},o="n";r&&(i.q=s,i.t=r),this.sendRequest(o,i)}onDisconnectPut(e,n,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,n,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:n,onComplete:s})}onDisconnectMerge(e,n,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,n,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:n,onComplete:s})}onDisconnectCancel(e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(e,n,s,r){const i={p:n,d:s};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{r&&setTimeout(()=>{r(o.s,o.d)},Math.floor(0))})}put(e,n,s,r){this.putInternal("p",e,n,s,r)}merge(e,n,s,r){this.putInternal("m",e,n,s,r)}putInternal(e,n,s,r,i){this.initConnection_();const o={p:n,d:s};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:r}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+n)}sendPut_(e){const n=this.outstandingPuts_[e].action,s=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,s,i=>{this.log_(n+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(i.s,i.d)})}reportStats(e){if(this.connected_){const n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,s=>{if(s.s!=="ok"){const i=s.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Wn(e));const n=e.r,s=this.requestCBHash_[n];s&&(delete this.requestCBHash_[n],s(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,n){this.log_("handleServerMessage",e,n),e==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):e==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):e==="c"?this.onListenRevoked_(n.p,n.q):e==="ac"?this.onAuthRevoked_(n.s,n.d):e==="apc"?this.onAppCheckRevoked_(n.s,n.d):e==="sd"?this.onSecurityDebugPacket_(n):RI("Unrecognized action received from server: "+Wn(e)+`
Are you using the latest client?`)}onReady_(e,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){ye(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Zf,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Zf,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>AQ&&(this.reconnectDelay_=Zf),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=new Date().getTime()-this.lastConnectionAttemptTime_;let n=Math.max(0,this.reconnectDelay_-e);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*RQ)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+ea.nextConnectionId_++,i=this.lastSessionId;let o=!1,a=null;const l=function(){a?a.close():(o=!0,s())},u=function(h){ye(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(h)};this.realtime_={close:l,sendRequest:u};const c=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[h,d]=await Promise.all([this.authTokenProvider_.getToken(c),this.appCheckTokenProvider_.getToken(c)]);o?ws("getToken() completed but was canceled"):(ws("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=d&&d.token,a=new IQ(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,s,f=>{Hs(f+" ("+this.repoInfo_.toString()+")"),this.interrupt(DQ)},i))}catch(h){this.log_("Failed to get token: "+h),o||(this.repoInfo_.nodeAdmin&&Hs(h),l())}}}interrupt(e){ws("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){ws("Resuming connection for reason: "+e),delete this.interruptReasons_[e],bI(this.interruptReasons_)&&(this.reconnectDelay_=Zf,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const n=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const n=this.outstandingPuts_[e];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,n){let s;n?s=n.map(i=>uk(i)).join("$"):s="default";const r=this.removeListen_(e,s);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,n){const s=new Ft(e).toString();let r;if(this.listens.has(s)){const i=this.listens.get(s);r=i.get(n),i.delete(n),i.size===0&&this.listens.delete(s)}else r=void 0;return r}onAuthRevoked_(e,n){ws("Auth token revoked: "+e+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=SO&&(this.reconnectDelay_=bO,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,n){ws("App check token revoked: "+e+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=SO&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const n of e.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let n="js";e["sdk."+n+"."+uz.replace(/\./g,"-")]=1,YT()?e["framework.cordova"]=1:w3()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=ow.getInstance().currentlyOnline();return bI(this.interruptReasons_)&&e}}ea.nextPersistentConnectionId_=0;ea.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class it{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new it(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _x{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){const s=new it(Lh,e),r=new it(Lh,n);return this.compare(s,r)!==0}minPost(){return it.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let E0;class Oz extends _x{static get __EMPTY_NODE(){return E0}static set __EMPTY_NODE(e){E0=e}compare(e,n){return yc(e.name,n.name)}isDefinedOn(e){throw ld("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return it.MIN}maxPost(){return new it(ju,E0)}makePost(e,n){return ye(typeof e=="string","KeyIndex indexValue must always be a string."),new it(e,E0)}toString(){return".key"}}const _h=new Oz;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N0{constructor(e,n,s,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=n?s(e.key,n):1,r&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class ts{constructor(e,n,s,r,i){this.key=e,this.value=n,this.color=s??ts.RED,this.left=r??hr.EMPTY_NODE,this.right=i??hr.EMPTY_NODE}copy(e,n,s,r,i){return new ts(e??this.key,n??this.value,s??this.color,r??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,s){let r=this;const i=s(e,r.key);return i<0?r=r.copy(null,null,null,r.left.insert(e,n,s),null):i===0?r=r.copy(null,n,null,null,null):r=r.copy(null,null,null,null,r.right.insert(e,n,s)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return hr.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,n){let s,r;if(s=this,n(e,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(e,n),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),n(e,s.key)===0){if(s.right.isEmpty())return hr.EMPTY_NODE;r=s.right.min_(),s=s.copy(r.key,r.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(e,n))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,ts.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,ts.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}ts.RED=!0;ts.BLACK=!1;class OQ{copy(e,n,s,r,i){return this}insert(e,n,s){return new ts(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class hr{constructor(e,n=hr.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new hr(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,ts.BLACK,null,null))}remove(e){return new hr(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,ts.BLACK,null,null))}get(e){let n,s=this.root_;for(;!s.isEmpty();){if(n=this.comparator_(e,s.key),n===0)return s.value;n<0?s=s.left:n>0&&(s=s.right)}return null}getPredecessorKey(e){let n,s=this.root_,r=null;for(;!s.isEmpty();)if(n=this.comparator_(e,s.key),n===0){if(s.left.isEmpty())return r?r.key:null;for(s=s.left;!s.right.isEmpty();)s=s.right;return s.key}else n<0?s=s.left:n>0&&(r=s,s=s.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new N0(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new N0(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new N0(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new N0(this.root_,null,this.comparator_,!0,e)}}hr.EMPTY_NODE=new OQ;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PQ(t,e){return yc(t.name,e.name)}function gk(t,e){return yc(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let DI;function FQ(t){DI=t}const Pz=function(t){return typeof t=="number"?"number:"+fz(t):"string:"+t},Fz=function(t){if(t.isLeafNode()){const e=t.val();ye(typeof e=="string"||typeof e=="number"||typeof e=="object"&&ko(e,".sv"),"Priority must be a string or number.")}else ye(t===DI||t.isEmpty(),"priority of unexpected type.");ye(t===DI||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let CO;class Zn{static set __childrenNodeConstructor(e){CO=e}static get __childrenNodeConstructor(){return CO}constructor(e,n=Zn.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,ye(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Fz(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Zn(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Zn.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return ut(e)?this:rt(e)===".priority"?this.priorityNode_:Zn.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,n){return null}updateImmediateChild(e,n){return e===".priority"?this.updatePriority(n):n.isEmpty()&&e!==".priority"?this:Zn.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)}updateChild(e,n){const s=rt(e);return s===null?n:n.isEmpty()&&s!==".priority"?this:(ye(s!==".priority"||Il(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,Zn.__childrenNodeConstructor.EMPTY_NODE.updateChild(Gt(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,n){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Pz(this.priorityNode_.val())+":");const n=typeof this.value_;e+=n+":",n==="number"?e+=fz(this.value_):e+=this.value_,this.lazyHash_=hz(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Zn.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Zn.__childrenNodeConstructor?-1:(ye(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const n=typeof e.value_,s=typeof this.value_,r=Zn.VALUE_TYPE_ORDER.indexOf(n),i=Zn.VALUE_TYPE_ORDER.indexOf(s);return ye(r>=0,"Unknown leaf type: "+n),ye(i>=0,"Unknown leaf type: "+s),r===i?s==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const n=e;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}Zn.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Lz,Mz;function LQ(t){Lz=t}function MQ(t){Mz=t}class zQ extends _x{compare(e,n){const s=e.node.getPriority(),r=n.node.getPriority(),i=s.compareTo(r);return i===0?yc(e.name,n.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return it.MIN}maxPost(){return new it(ju,new Zn("[PRIORITY-POST]",Mz))}makePost(e,n){const s=Lz(e);return new it(n,new Zn("[PRIORITY-POST]",s))}toString(){return".priority"}}const vn=new zQ;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BQ=Math.log(2);class VQ{constructor(e){const n=i=>parseInt(Math.log(i)/BQ,10),s=i=>parseInt(Array(i+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;const r=s(this.count);this.bits_=e+1&r}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const aw=function(t,e,n,s){t.sort(e);const r=function(l,u){const c=u-l;let h,d;if(c===0)return null;if(c===1)return h=t[l],d=n?n(h):h,new ts(d,h.node,ts.BLACK,null,null);{const f=parseInt(c/2,10)+l,p=r(l,f),m=r(f+1,u);return h=t[f],d=n?n(h):h,new ts(d,h.node,ts.BLACK,p,m)}},i=function(l){let u=null,c=null,h=t.length;const d=function(p,m){const v=h-p,g=h;h-=p;const w=r(v+1,g),b=t[v],x=n?n(b):b;f(new ts(x,b.node,m,null,w))},f=function(p){u?(u.left=p,u=p):(c=p,u=p)};for(let p=0;p<l.count;++p){const m=l.nextBitIsOne(),v=Math.pow(2,l.count-(p+1));m?d(v,ts.BLACK):(d(v,ts.BLACK),d(v,ts.RED))}return c},o=new VQ(t.length),a=i(o);return new hr(s||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rC;const Kc={};class Qo{static get Default(){return ye(Kc&&vn,"ChildrenNode.ts has not been loaded"),rC=rC||new Qo({".priority":Kc},{".priority":vn}),rC}constructor(e,n){this.indexes_=e,this.indexSet_=n}get(e){const n=Fh(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof hr?n:null}hasIndex(e){return ko(this.indexSet_,e.toString())}addIndex(e,n){ye(e!==_h,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const s=[];let r=!1;const i=n.getIterator(it.Wrap);let o=i.getNext();for(;o;)r=r||e.isDefinedOn(o.node),s.push(o),o=i.getNext();let a;r?a=aw(s,e.getCompare()):a=Kc;const l=e.toString(),u=Object.assign({},this.indexSet_);u[l]=e;const c=Object.assign({},this.indexes_);return c[l]=a,new Qo(c,u)}addToIndexes(e,n){const s=Qv(this.indexes_,(r,i)=>{const o=Fh(this.indexSet_,i);if(ye(o,"Missing index implementation for "+i),r===Kc)if(o.isDefinedOn(e.node)){const a=[],l=n.getIterator(it.Wrap);let u=l.getNext();for(;u;)u.name!==e.name&&a.push(u),u=l.getNext();return a.push(e),aw(a,o.getCompare())}else return Kc;else{const a=n.get(e.name);let l=r;return a&&(l=l.remove(new it(e.name,a))),l.insert(e,e.node)}});return new Qo(s,this.indexSet_)}removeFromIndexes(e,n){const s=Qv(this.indexes_,r=>{if(r===Kc)return r;{const i=n.get(e.name);return i?r.remove(new it(e.name,i)):r}});return new Qo(s,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ep;class Ue{static get EMPTY_NODE(){return ep||(ep=new Ue(new hr(gk),null,Qo.Default))}constructor(e,n,s){this.children_=e,this.priorityNode_=n,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&Fz(this.priorityNode_),this.children_.isEmpty()&&ye(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||ep}updatePriority(e){return this.children_.isEmpty()?this:new Ue(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const n=this.children_.get(e);return n===null?ep:n}}getChild(e){const n=rt(e);return n===null?this:this.getImmediateChild(n).getChild(Gt(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,n){if(ye(n,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(n);{const s=new it(e,n);let r,i;n.isEmpty()?(r=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(s,this.children_)):(r=this.children_.insert(e,n),i=this.indexMap_.addToIndexes(s,this.children_));const o=r.isEmpty()?ep:this.priorityNode_;return new Ue(r,o,i)}}updateChild(e,n){const s=rt(e);if(s===null)return n;{ye(rt(e)!==".priority"||Il(e)===1,".priority must be the last token in a path");const r=this.getImmediateChild(s).updateChild(Gt(e),n);return this.updateImmediateChild(s,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const n={};let s=0,r=0,i=!0;if(this.forEachChild(vn,(o,a)=>{n[o]=a.val(e),s++,i&&Ue.INTEGER_REGEXP_.test(o)?r=Math.max(r,Number(o)):i=!1}),!e&&i&&r<2*s){const o=[];for(const a in n)o[a]=n[a];return o}else return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+Pz(this.getPriority().val())+":"),this.forEachChild(vn,(n,s)=>{const r=s.hash();r!==""&&(e+=":"+n+":"+r)}),this.lazyHash_=e===""?"":hz(e)}return this.lazyHash_}getPredecessorChildName(e,n,s){const r=this.resolveIndex_(s);if(r){const i=r.getPredecessorKey(new it(e,n));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const n=this.resolveIndex_(e);if(n){const s=n.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(e){const n=this.getFirstChildName(e);return n?new it(n,this.children_.get(n)):null}getLastChildName(e){const n=this.resolveIndex_(e);if(n){const s=n.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(e){const n=this.getLastChildName(e);return n?new it(n,this.children_.get(n)):null}forEachChild(e,n){const s=this.resolveIndex_(e);return s?s.inorderTraversal(r=>n(r.name,r.node)):this.children_.inorderTraversal(n)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,n){const s=this.resolveIndex_(n);if(s)return s.getIteratorFrom(e,r=>r);{const r=this.children_.getIteratorFrom(e.name,it.Wrap);let i=r.peek();for(;i!=null&&n.compare(i,e)<0;)r.getNext(),i=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,n){const s=this.resolveIndex_(n);if(s)return s.getReverseIteratorFrom(e,r=>r);{const r=this.children_.getReverseIteratorFrom(e.name,it.Wrap);let i=r.peek();for(;i!=null&&n.compare(i,e)>0;)r.getNext(),i=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===eg?-1:0}withIndex(e){if(e===_h||this.indexMap_.hasIndex(e))return this;{const n=this.indexMap_.addIndex(e,this.children_);return new Ue(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===_h||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){const s=this.getIterator(vn),r=n.getIterator(vn);let i=s.getNext(),o=r.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=s.getNext(),o=r.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===_h?null:this.indexMap_.get(e.toString())}}Ue.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class UQ extends Ue{constructor(){super(new hr(gk),Ue.EMPTY_NODE,Qo.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Ue.EMPTY_NODE}isEmpty(){return!1}}const eg=new UQ;Object.defineProperties(it,{MIN:{value:new it(Lh,Ue.EMPTY_NODE)},MAX:{value:new it(ju,eg)}});Oz.__EMPTY_NODE=Ue.EMPTY_NODE;Zn.__childrenNodeConstructor=Ue;FQ(eg);MQ(eg);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WQ=!0;function Vn(t,e=null){if(t===null)return Ue.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),ye(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const n=t;return new Zn(n,Vn(e))}if(!(t instanceof Array)&&WQ){const n=[];let s=!1;if(Ss(t,(o,a)=>{if(o.substring(0,1)!=="."){const l=Vn(a);l.isEmpty()||(s=s||!l.getPriority().isEmpty(),n.push(new it(o,l)))}}),n.length===0)return Ue.EMPTY_NODE;const i=aw(n,PQ,o=>o.name,gk);if(s){const o=aw(n,vn.getCompare());return new Ue(i,Vn(e),new Qo({".priority":o},{".priority":vn}))}else return new Ue(i,Vn(e),Qo.Default)}else{let n=Ue.EMPTY_NODE;return Ss(t,(s,r)=>{if(ko(t,s)&&s.substring(0,1)!=="."){const i=Vn(r);(i.isLeafNode()||!i.isEmpty())&&(n=n.updateImmediateChild(s,i))}}),n.updatePriority(Vn(e))}}LQ(Vn);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jQ extends _x{constructor(e){super(),this.indexPath_=e,ye(!ut(e)&&rt(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){const s=this.extractChild(e.node),r=this.extractChild(n.node),i=s.compareTo(r);return i===0?yc(e.name,n.name):i}makePost(e,n){const s=Vn(e),r=Ue.EMPTY_NODE.updateChild(this.indexPath_,s);return new it(n,r)}maxPost(){const e=Ue.EMPTY_NODE.updateChild(this.indexPath_,eg);return new it(ju,e)}toString(){return cm(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GQ extends _x{compare(e,n){const s=e.node.compareTo(n.node);return s===0?yc(e.name,n.name):s}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return it.MIN}maxPost(){return it.MAX}makePost(e,n){const s=Vn(e);return new it(n,s)}toString(){return".value"}}const HQ=new GQ;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zz(t){return{type:"value",snapshotNode:t}}function Mh(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function hm(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function dm(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function qQ(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yk{constructor(e){this.index_=e}updateChild(e,n,s,r,i,o){ye(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(n);return a.getChild(r).equals(s.getChild(r))&&a.isEmpty()===s.isEmpty()||(o!=null&&(s.isEmpty()?e.hasChild(n)?o.trackChildChange(hm(n,a)):ye(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Mh(n,s)):o.trackChildChange(dm(n,s,a))),e.isLeafNode()&&s.isEmpty())?e:e.updateImmediateChild(n,s).withIndex(this.index_)}updateFullNode(e,n,s){return s!=null&&(e.isLeafNode()||e.forEachChild(vn,(r,i)=>{n.hasChild(r)||s.trackChildChange(hm(r,i))}),n.isLeafNode()||n.forEachChild(vn,(r,i)=>{if(e.hasChild(r)){const o=e.getImmediateChild(r);o.equals(i)||s.trackChildChange(dm(r,i,o))}else s.trackChildChange(Mh(r,i))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?Ue.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fm{constructor(e){this.indexedFilter_=new yk(e.getIndex()),this.index_=e.getIndex(),this.startPost_=fm.getStartPost_(e),this.endPost_=fm.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,s=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&s}updateChild(e,n,s,r,i,o){return this.matches(new it(n,s))||(s=Ue.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,s,r,i,o)}updateFullNode(e,n,s){n.isLeafNode()&&(n=Ue.EMPTY_NODE);let r=n.withIndex(this.index_);r=r.updatePriority(Ue.EMPTY_NODE);const i=this;return n.forEachChild(vn,(o,a)=>{i.matches(new it(o,a))||(r=r.updateImmediateChild(o,Ue.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,s)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KQ{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{const s=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?s<=0:s<0},this.withinEndPost=n=>{const s=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?s<=0:s<0},this.rangedFilter_=new fm(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,s,r,i,o){return this.rangedFilter_.matches(new it(n,s))||(s=Ue.EMPTY_NODE),e.getImmediateChild(n).equals(s)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,s,r,i,o):this.fullLimitUpdateChild_(e,n,s,i,o)}updateFullNode(e,n,s){let r;if(n.isLeafNode()||n.isEmpty())r=Ue.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){r=Ue.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const a=i.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))r=r.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{r=n.withIndex(this.index_),r=r.updatePriority(Ue.EMPTY_NODE);let i;this.reverse_?i=r.getReverseIterator(this.index_):i=r.getIterator(this.index_);let o=0;for(;i.hasNext();){const a=i.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:r=r.updateImmediateChild(a.name,Ue.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,s)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,s,r,i){let o;if(this.reverse_){const h=this.index_.getCompare();o=(d,f)=>h(f,d)}else o=this.index_.getCompare();const a=e;ye(a.numChildren()===this.limit_,"");const l=new it(n,s),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),c=this.rangedFilter_.matches(l);if(a.hasChild(n)){const h=a.getImmediateChild(n);let d=r.getChildAfterChild(this.index_,u,this.reverse_);for(;d!=null&&(d.name===n||a.hasChild(d.name));)d=r.getChildAfterChild(this.index_,d,this.reverse_);const f=d==null?1:o(d,l);if(c&&!s.isEmpty()&&f>=0)return i!=null&&i.trackChildChange(dm(n,s,h)),a.updateImmediateChild(n,s);{i!=null&&i.trackChildChange(hm(n,h));const m=a.updateImmediateChild(n,Ue.EMPTY_NODE);return d!=null&&this.rangedFilter_.matches(d)?(i!=null&&i.trackChildChange(Mh(d.name,d.node)),m.updateImmediateChild(d.name,d.node)):m}}else return s.isEmpty()?e:c&&o(u,l)>=0?(i!=null&&(i.trackChildChange(hm(u.name,u.node)),i.trackChildChange(Mh(n,s))),a.updateImmediateChild(n,s).updateImmediateChild(u.name,Ue.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vk{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=vn}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return ye(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return ye(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Lh}hasEnd(){return this.endSet_}getIndexEndValue(){return ye(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return ye(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ju}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return ye(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===vn}copy(){const e=new vk;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function XQ(t){return t.loadsAllData()?new yk(t.getIndex()):t.hasLimit()?new KQ(t):new fm(t)}function IO(t){const e={};if(t.isDefault())return e;let n;if(t.index_===vn?n="$priority":t.index_===HQ?n="$value":t.index_===_h?n="$key":(ye(t.index_ instanceof jQ,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=Wn(n),t.startSet_){const s=t.startAfterSet_?"startAfter":"startAt";e[s]=Wn(t.indexStartValue_),t.startNameSet_&&(e[s]+=","+Wn(t.indexStartName_))}if(t.endSet_){const s=t.endBeforeSet_?"endBefore":"endAt";e[s]=Wn(t.indexEndValue_),t.endNameSet_&&(e[s]+=","+Wn(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function _O(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==vn&&(e.i=t.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lw extends $z{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(ye(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,n,s,r){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=s,this.appCheckTokenProvider_=r,this.log_=Zm("p:rest:"),this.listens_={}}listen(e,n,s,r){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=lw.getListenId_(e,s),a={};this.listens_[o]=a;const l=IO(e._queryParams);this.restRequest_(i+".json",l,(u,c)=>{let h=c;if(u===404&&(h=null,u=null),u===null&&this.onDataUpdate_(i,h,!1,s),Fh(this.listens_,o)===a){let d;u?u===401?d="permission_denied":d="rest_error:"+u:d="ok",r(d,null)}})}unlisten(e,n){const s=lw.getListenId_(e,n);delete this.listens_[s]}get(e){const n=IO(e._queryParams),s=e._path.toString(),r=new Hm;return this.restRequest_(s+".json",n,(i,o)=>{let a=o;i===404&&(a=null,i=null),i===null?(this.onDataUpdate_(s,a,!1,null),r.resolve(a)):r.reject(new Error(a))}),r.promise}refreshAuthToken(e){}restRequest_(e,n={},s){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,i])=>{r&&r.accessToken&&(n.auth=r.accessToken),i&&i.token&&(n.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+ud(n);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(s&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=im(a.responseText)}catch{Hs("Failed to parse JSON response for "+o+": "+a.responseText)}s(null,l)}else a.status!==401&&a.status!==404&&Hs("Got unsuccessful REST response for "+o+" Status: "+a.status),s(a.status);s=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YQ{constructor(){this.rootNode_=Ue.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uw(){return{value:null,children:new Map}}function Bz(t,e,n){if(ut(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{const s=rt(e);t.children.has(s)||t.children.set(s,uw());const r=t.children.get(s);e=Gt(e),Bz(r,e,n)}}function OI(t,e,n){t.value!==null?n(e,t.value):QQ(t,(s,r)=>{const i=new Ft(e.toString()+"/"+s);OI(r,i,n)})}function QQ(t,e){t.children.forEach((n,s)=>{e(s,n)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JQ{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),n=Object.assign({},e);return this.last_&&Ss(this.last_,(s,r)=>{n[s]=n[s]-r}),this.last_=e,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TO=10*1e3,ZQ=30*1e3,eJ=5*60*1e3;class tJ{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new JQ(e);const s=TO+(ZQ-TO)*Math.random();Op(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){const e=this.statsListener_.get(),n={};let s=!1;Ss(e,(r,i)=>{i>0&&ko(this.statsToReport_,r)&&(n[r]=i,s=!0)}),s&&this.server_.reportStats(n),Op(this.reportStats_.bind(this),Math.floor(Math.random()*2*eJ))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ni;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Ni||(Ni={}));function wk(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function xk(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function bk(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cw{constructor(e,n,s){this.path=e,this.affectedTree=n,this.revert=s,this.type=Ni.ACK_USER_WRITE,this.source=wk()}operationForChild(e){if(ut(this.path)){if(this.affectedTree.value!=null)return ye(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const n=this.affectedTree.subtree(new Ft(e));return new cw(St(),n,this.revert)}}else return ye(rt(this.path)===e,"operationForChild called for unrelated child."),new cw(Gt(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pm{constructor(e,n){this.source=e,this.path=n,this.type=Ni.LISTEN_COMPLETE}operationForChild(e){return ut(this.path)?new pm(this.source,St()):new pm(this.source,Gt(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gu{constructor(e,n,s){this.source=e,this.path=n,this.snap=s,this.type=Ni.OVERWRITE}operationForChild(e){return ut(this.path)?new Gu(this.source,St(),this.snap.getImmediateChild(e)):new Gu(this.source,Gt(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Sk=class PI{constructor(e,n,s){this.source=e,this.path=n,this.children=s,this.type=Ni.MERGE}operationForChild(e){if(ut(this.path)){const n=this.children.subtree(new Ft(e));return n.isEmpty()?null:n.value?new Gu(this.source,St(),n.value):new PI(this.source,St(),n)}else return ye(rt(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new PI(this.source,Gt(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _l{constructor(e,n,s){this.node_=e,this.fullyInitialized_=n,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(ut(e))return this.isFullyInitialized()&&!this.filtered_;const n=rt(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nJ{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function sJ(t,e,n,s){const r=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(qQ(o.childName,o.snapshotNode))}),tp(t,r,"child_removed",e,s,n),tp(t,r,"child_added",e,s,n),tp(t,r,"child_moved",i,s,n),tp(t,r,"child_changed",e,s,n),tp(t,r,"value",e,s,n),r}function tp(t,e,n,s,r,i){const o=s.filter(a=>a.type===n);o.sort((a,l)=>iJ(t,a,l)),o.forEach(a=>{const l=rJ(t,a,i);r.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(l,t.query_))})})}function rJ(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function iJ(t,e,n){if(e.childName==null||n.childName==null)throw ld("Should only compare child_ events.");const s=new it(e.childName,e.snapshotNode),r=new it(n.childName,n.snapshotNode);return t.index_.compare(s,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tx(t,e){return{eventCache:t,serverCache:e}}function Pp(t,e,n,s){return Tx(new _l(e,n,s),t.serverCache)}function Vz(t,e,n,s){return Tx(t.eventCache,new _l(e,n,s))}function hw(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function Hu(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let iC;const oJ=()=>(iC||(iC=new hr(jY)),iC);class jt{static fromObject(e){let n=new jt(null);return Ss(e,(s,r)=>{n=n.set(new Ft(s),r)}),n}constructor(e,n=oJ()){this.value=e,this.children=n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:St(),value:this.value};if(ut(e))return null;{const s=rt(e),r=this.children.get(s);if(r!==null){const i=r.findRootMostMatchingPathAndValue(Gt(e),n);return i!=null?{path:yn(new Ft(s),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(ut(e))return this;{const n=rt(e),s=this.children.get(n);return s!==null?s.subtree(Gt(e)):new jt(null)}}set(e,n){if(ut(e))return new jt(n,this.children);{const s=rt(e),i=(this.children.get(s)||new jt(null)).set(Gt(e),n),o=this.children.insert(s,i);return new jt(this.value,o)}}remove(e){if(ut(e))return this.children.isEmpty()?new jt(null):new jt(null,this.children);{const n=rt(e),s=this.children.get(n);if(s){const r=s.remove(Gt(e));let i;return r.isEmpty()?i=this.children.remove(n):i=this.children.insert(n,r),this.value===null&&i.isEmpty()?new jt(null):new jt(this.value,i)}else return this}}get(e){if(ut(e))return this.value;{const n=rt(e),s=this.children.get(n);return s?s.get(Gt(e)):null}}setTree(e,n){if(ut(e))return n;{const s=rt(e),i=(this.children.get(s)||new jt(null)).setTree(Gt(e),n);let o;return i.isEmpty()?o=this.children.remove(s):o=this.children.insert(s,i),new jt(this.value,o)}}fold(e){return this.fold_(St(),e)}fold_(e,n){const s={};return this.children.inorderTraversal((r,i)=>{s[r]=i.fold_(yn(e,r),n)}),n(e,this.value,s)}findOnPath(e,n){return this.findOnPath_(e,St(),n)}findOnPath_(e,n,s){const r=this.value?s(n,this.value):!1;if(r)return r;if(ut(e))return null;{const i=rt(e),o=this.children.get(i);return o?o.findOnPath_(Gt(e),yn(n,i),s):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,St(),n)}foreachOnPath_(e,n,s){if(ut(e))return this;{this.value&&s(n,this.value);const r=rt(e),i=this.children.get(r);return i?i.foreachOnPath_(Gt(e),yn(n,r),s):new jt(null)}}foreach(e){this.foreach_(St(),e)}foreach_(e,n){this.children.inorderTraversal((s,r)=>{r.foreach_(yn(e,s),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,s)=>{s.value&&e(n,s.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oi{constructor(e){this.writeTree_=e}static empty(){return new Oi(new jt(null))}}function Fp(t,e,n){if(ut(e))return new Oi(new jt(n));{const s=t.writeTree_.findRootMostValueAndPath(e);if(s!=null){const r=s.path;let i=s.value;const o=Ws(r,e);return i=i.updateChild(o,n),new Oi(t.writeTree_.set(r,i))}else{const r=new jt(n),i=t.writeTree_.setTree(e,r);return new Oi(i)}}}function FI(t,e,n){let s=t;return Ss(n,(r,i)=>{s=Fp(s,yn(e,r),i)}),s}function kO(t,e){if(ut(e))return Oi.empty();{const n=t.writeTree_.setTree(e,new jt(null));return new Oi(n)}}function LI(t,e){return vc(t,e)!=null}function vc(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(Ws(n.path,e)):null}function EO(t){const e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(vn,(s,r)=>{e.push(new it(s,r))}):t.writeTree_.children.inorderTraversal((s,r)=>{r.value!=null&&e.push(new it(s,r.value))}),e}function pl(t,e){if(ut(e))return t;{const n=vc(t,e);return n!=null?new Oi(new jt(n)):new Oi(t.writeTree_.subtree(e))}}function MI(t){return t.writeTree_.isEmpty()}function zh(t,e){return Uz(St(),t.writeTree_,e)}function Uz(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let s=null;return e.children.inorderTraversal((r,i)=>{r===".priority"?(ye(i.value!==null,"Priority writes must always be leaf nodes"),s=i.value):n=Uz(yn(t,r),i,n)}),!n.getChild(t).isEmpty()&&s!==null&&(n=n.updateChild(yn(t,".priority"),s)),n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kx(t,e){return Hz(e,t)}function aJ(t,e,n,s,r){ye(s>t.lastWriteId,"Stacking an older write on top of newer ones"),r===void 0&&(r=!0),t.allWrites.push({path:e,snap:n,writeId:s,visible:r}),r&&(t.visibleWrites=Fp(t.visibleWrites,e,n)),t.lastWriteId=s}function lJ(t,e,n,s){ye(s>t.lastWriteId,"Stacking an older merge on top of newer ones"),t.allWrites.push({path:e,children:n,writeId:s,visible:!0}),t.visibleWrites=FI(t.visibleWrites,e,n),t.lastWriteId=s}function uJ(t,e){for(let n=0;n<t.allWrites.length;n++){const s=t.allWrites[n];if(s.writeId===e)return s}return null}function cJ(t,e){const n=t.allWrites.findIndex(a=>a.writeId===e);ye(n>=0,"removeWrite called with nonexistent writeId.");const s=t.allWrites[n];t.allWrites.splice(n,1);let r=s.visible,i=!1,o=t.allWrites.length-1;for(;r&&o>=0;){const a=t.allWrites[o];a.visible&&(o>=n&&hJ(a,s.path)?r=!1:ei(s.path,a.path)&&(i=!0)),o--}if(r){if(i)return dJ(t),!0;if(s.snap)t.visibleWrites=kO(t.visibleWrites,s.path);else{const a=s.children;Ss(a,l=>{t.visibleWrites=kO(t.visibleWrites,yn(s.path,l))})}return!0}else return!1}function hJ(t,e){if(t.snap)return ei(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&ei(yn(t.path,n),e))return!0;return!1}function dJ(t){t.visibleWrites=Wz(t.allWrites,fJ,St()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function fJ(t){return t.visible}function Wz(t,e,n){let s=Oi.empty();for(let r=0;r<t.length;++r){const i=t[r];if(e(i)){const o=i.path;let a;if(i.snap)ei(n,o)?(a=Ws(n,o),s=Fp(s,a,i.snap)):ei(o,n)&&(a=Ws(o,n),s=Fp(s,St(),i.snap.getChild(a)));else if(i.children){if(ei(n,o))a=Ws(n,o),s=FI(s,a,i.children);else if(ei(o,n))if(a=Ws(o,n),ut(a))s=FI(s,St(),i.children);else{const l=Fh(i.children,rt(a));if(l){const u=l.getChild(Gt(a));s=Fp(s,St(),u)}}}else throw ld("WriteRecord should have .snap or .children")}}return s}function jz(t,e,n,s,r){if(!s&&!r){const i=vc(t.visibleWrites,e);if(i!=null)return i;{const o=pl(t.visibleWrites,e);if(MI(o))return n;if(n==null&&!LI(o,St()))return null;{const a=n||Ue.EMPTY_NODE;return zh(o,a)}}}else{const i=pl(t.visibleWrites,e);if(!r&&MI(i))return n;if(!r&&n==null&&!LI(i,St()))return null;{const o=function(u){return(u.visible||r)&&(!s||!~s.indexOf(u.writeId))&&(ei(u.path,e)||ei(e,u.path))},a=Wz(t.allWrites,o,e),l=n||Ue.EMPTY_NODE;return zh(a,l)}}}function pJ(t,e,n){let s=Ue.EMPTY_NODE;const r=vc(t.visibleWrites,e);if(r)return r.isLeafNode()||r.forEachChild(vn,(i,o)=>{s=s.updateImmediateChild(i,o)}),s;if(n){const i=pl(t.visibleWrites,e);return n.forEachChild(vn,(o,a)=>{const l=zh(pl(i,new Ft(o)),a);s=s.updateImmediateChild(o,l)}),EO(i).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}else{const i=pl(t.visibleWrites,e);return EO(i).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}}function mJ(t,e,n,s,r){ye(s||r,"Either existingEventSnap or existingServerSnap must exist");const i=yn(e,n);if(LI(t.visibleWrites,i))return null;{const o=pl(t.visibleWrites,i);return MI(o)?r.getChild(n):zh(o,r.getChild(n))}}function gJ(t,e,n,s){const r=yn(e,n),i=vc(t.visibleWrites,r);if(i!=null)return i;if(s.isCompleteForChild(n)){const o=pl(t.visibleWrites,r);return zh(o,s.getNode().getImmediateChild(n))}else return null}function yJ(t,e){return vc(t.visibleWrites,e)}function vJ(t,e,n,s,r,i,o){let a;const l=pl(t.visibleWrites,e),u=vc(l,St());if(u!=null)a=u;else if(n!=null)a=zh(l,n);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const c=[],h=o.getCompare(),d=i?a.getReverseIteratorFrom(s,o):a.getIteratorFrom(s,o);let f=d.getNext();for(;f&&c.length<r;)h(f,s)!==0&&c.push(f),f=d.getNext();return c}else return[]}function wJ(){return{visibleWrites:Oi.empty(),allWrites:[],lastWriteId:-1}}function dw(t,e,n,s){return jz(t.writeTree,t.treePath,e,n,s)}function Ck(t,e){return pJ(t.writeTree,t.treePath,e)}function NO(t,e,n,s){return mJ(t.writeTree,t.treePath,e,n,s)}function fw(t,e){return yJ(t.writeTree,yn(t.treePath,e))}function xJ(t,e,n,s,r,i){return vJ(t.writeTree,t.treePath,e,n,s,r,i)}function Ik(t,e,n){return gJ(t.writeTree,t.treePath,e,n)}function Gz(t,e){return Hz(yn(t.treePath,e),t.writeTree)}function Hz(t,e){return{treePath:t,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bJ{constructor(){this.changeMap=new Map}trackChildChange(e){const n=e.type,s=e.childName;ye(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),ye(s!==".priority","Only non-priority child changes can be tracked.");const r=this.changeMap.get(s);if(r){const i=r.type;if(n==="child_added"&&i==="child_removed")this.changeMap.set(s,dm(s,e.snapshotNode,r.snapshotNode));else if(n==="child_removed"&&i==="child_added")this.changeMap.delete(s);else if(n==="child_removed"&&i==="child_changed")this.changeMap.set(s,hm(s,r.oldSnap));else if(n==="child_changed"&&i==="child_added")this.changeMap.set(s,Mh(s,e.snapshotNode));else if(n==="child_changed"&&i==="child_changed")this.changeMap.set(s,dm(s,e.snapshotNode,r.oldSnap));else throw ld("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(s,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SJ{getCompleteChild(e){return null}getChildAfterChild(e,n,s){return null}}const qz=new SJ;class _k{constructor(e,n,s=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=s}getCompleteChild(e){const n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{const s=this.optCompleteServerCache_!=null?new _l(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Ik(this.writes_,e,s)}}getChildAfterChild(e,n,s){const r=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Hu(this.viewCache_),i=xJ(this.writes_,r,n,1,s,e);return i.length===0?null:i[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CJ(t){return{filter:t}}function IJ(t,e){ye(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),ye(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function _J(t,e,n,s,r){const i=new bJ;let o,a;if(n.type===Ni.OVERWRITE){const u=n;u.source.fromUser?o=zI(t,e,u.path,u.snap,s,r,i):(ye(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!ut(u.path),o=pw(t,e,u.path,u.snap,s,r,a,i))}else if(n.type===Ni.MERGE){const u=n;u.source.fromUser?o=kJ(t,e,u.path,u.children,s,r,i):(ye(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=BI(t,e,u.path,u.children,s,r,a,i))}else if(n.type===Ni.ACK_USER_WRITE){const u=n;u.revert?o=$J(t,e,u.path,s,r,i):o=EJ(t,e,u.path,u.affectedTree,s,r,i)}else if(n.type===Ni.LISTEN_COMPLETE)o=NJ(t,e,n.path,s,i);else throw ld("Unknown operation type: "+n.type);const l=i.getChanges();return TJ(e,o,l),{viewCache:o,changes:l}}function TJ(t,e,n){const s=e.eventCache;if(s.isFullyInitialized()){const r=s.getNode().isLeafNode()||s.getNode().isEmpty(),i=hw(t);(n.length>0||!t.eventCache.isFullyInitialized()||r&&!s.getNode().equals(i)||!s.getNode().getPriority().equals(i.getPriority()))&&n.push(zz(hw(e)))}}function Kz(t,e,n,s,r,i){const o=e.eventCache;if(fw(s,n)!=null)return e;{let a,l;if(ut(n))if(ye(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const u=Hu(e),c=u instanceof Ue?u:Ue.EMPTY_NODE,h=Ck(s,c);a=t.filter.updateFullNode(e.eventCache.getNode(),h,i)}else{const u=dw(s,Hu(e));a=t.filter.updateFullNode(e.eventCache.getNode(),u,i)}else{const u=rt(n);if(u===".priority"){ye(Il(n)===1,"Can't have a priority with additional path components");const c=o.getNode();l=e.serverCache.getNode();const h=NO(s,n,c,l);h!=null?a=t.filter.updatePriority(c,h):a=o.getNode()}else{const c=Gt(n);let h;if(o.isCompleteForChild(u)){l=e.serverCache.getNode();const d=NO(s,n,o.getNode(),l);d!=null?h=o.getNode().getImmediateChild(u).updateChild(c,d):h=o.getNode().getImmediateChild(u)}else h=Ik(s,u,e.serverCache);h!=null?a=t.filter.updateChild(o.getNode(),u,h,c,r,i):a=o.getNode()}}return Pp(e,a,o.isFullyInitialized()||ut(n),t.filter.filtersNodes())}}function pw(t,e,n,s,r,i,o,a){const l=e.serverCache;let u;const c=o?t.filter:t.filter.getIndexedFilter();if(ut(n))u=c.updateFullNode(l.getNode(),s,null);else if(c.filtersNodes()&&!l.isFiltered()){const f=l.getNode().updateChild(n,s);u=c.updateFullNode(l.getNode(),f,null)}else{const f=rt(n);if(!l.isCompleteForPath(n)&&Il(n)>1)return e;const p=Gt(n),v=l.getNode().getImmediateChild(f).updateChild(p,s);f===".priority"?u=c.updatePriority(l.getNode(),v):u=c.updateChild(l.getNode(),f,v,p,qz,null)}const h=Vz(e,u,l.isFullyInitialized()||ut(n),c.filtersNodes()),d=new _k(r,h,i);return Kz(t,h,n,r,d,a)}function zI(t,e,n,s,r,i,o){const a=e.eventCache;let l,u;const c=new _k(r,e,i);if(ut(n))u=t.filter.updateFullNode(e.eventCache.getNode(),s,o),l=Pp(e,u,!0,t.filter.filtersNodes());else{const h=rt(n);if(h===".priority")u=t.filter.updatePriority(e.eventCache.getNode(),s),l=Pp(e,u,a.isFullyInitialized(),a.isFiltered());else{const d=Gt(n),f=a.getNode().getImmediateChild(h);let p;if(ut(d))p=s;else{const m=c.getCompleteChild(h);m!=null?fk(d)===".priority"&&m.getChild(Az(d)).isEmpty()?p=m:p=m.updateChild(d,s):p=Ue.EMPTY_NODE}if(f.equals(p))l=e;else{const m=t.filter.updateChild(a.getNode(),h,p,d,c,o);l=Pp(e,m,a.isFullyInitialized(),t.filter.filtersNodes())}}}return l}function $O(t,e){return t.eventCache.isCompleteForChild(e)}function kJ(t,e,n,s,r,i,o){let a=e;return s.foreach((l,u)=>{const c=yn(n,l);$O(e,rt(c))&&(a=zI(t,a,c,u,r,i,o))}),s.foreach((l,u)=>{const c=yn(n,l);$O(e,rt(c))||(a=zI(t,a,c,u,r,i,o))}),a}function RO(t,e,n){return n.foreach((s,r)=>{e=e.updateChild(s,r)}),e}function BI(t,e,n,s,r,i,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,u;ut(n)?u=s:u=new jt(null).setTree(n,s);const c=e.serverCache.getNode();return u.children.inorderTraversal((h,d)=>{if(c.hasChild(h)){const f=e.serverCache.getNode().getImmediateChild(h),p=RO(t,f,d);l=pw(t,l,new Ft(h),p,r,i,o,a)}}),u.children.inorderTraversal((h,d)=>{const f=!e.serverCache.isCompleteForChild(h)&&d.value===null;if(!c.hasChild(h)&&!f){const p=e.serverCache.getNode().getImmediateChild(h),m=RO(t,p,d);l=pw(t,l,new Ft(h),m,r,i,o,a)}}),l}function EJ(t,e,n,s,r,i,o){if(fw(r,n)!=null)return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(s.value!=null){if(ut(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return pw(t,e,n,l.getNode().getChild(n),r,i,a,o);if(ut(n)){let u=new jt(null);return l.getNode().forEachChild(_h,(c,h)=>{u=u.set(new Ft(c),h)}),BI(t,e,n,u,r,i,a,o)}else return e}else{let u=new jt(null);return s.foreach((c,h)=>{const d=yn(n,c);l.isCompleteForPath(d)&&(u=u.set(c,l.getNode().getChild(d)))}),BI(t,e,n,u,r,i,a,o)}}function NJ(t,e,n,s,r){const i=e.serverCache,o=Vz(e,i.getNode(),i.isFullyInitialized()||ut(n),i.isFiltered());return Kz(t,o,n,s,qz,r)}function $J(t,e,n,s,r,i){let o;if(fw(s,n)!=null)return e;{const a=new _k(s,e,r),l=e.eventCache.getNode();let u;if(ut(n)||rt(n)===".priority"){let c;if(e.serverCache.isFullyInitialized())c=dw(s,Hu(e));else{const h=e.serverCache.getNode();ye(h instanceof Ue,"serverChildren would be complete if leaf node"),c=Ck(s,h)}c=c,u=t.filter.updateFullNode(l,c,i)}else{const c=rt(n);let h=Ik(s,c,e.serverCache);h==null&&e.serverCache.isCompleteForChild(c)&&(h=l.getImmediateChild(c)),h!=null?u=t.filter.updateChild(l,c,h,Gt(n),a,i):e.eventCache.getNode().hasChild(c)?u=t.filter.updateChild(l,c,Ue.EMPTY_NODE,Gt(n),a,i):u=l,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=dw(s,Hu(e)),o.isLeafNode()&&(u=t.filter.updateFullNode(u,o,i)))}return o=e.serverCache.isFullyInitialized()||fw(s,St())!=null,Pp(e,u,o,t.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RJ{constructor(e,n){this.query_=e,this.eventRegistrations_=[];const s=this.query_._queryParams,r=new yk(s.getIndex()),i=XQ(s);this.processor_=CJ(i);const o=n.serverCache,a=n.eventCache,l=r.updateFullNode(Ue.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(Ue.EMPTY_NODE,a.getNode(),null),c=new _l(l,o.isFullyInitialized(),r.filtersNodes()),h=new _l(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=Tx(h,c),this.eventGenerator_=new nJ(this.query_)}get query(){return this.query_}}function AJ(t){return t.viewCache_.serverCache.getNode()}function DJ(t){return hw(t.viewCache_)}function OJ(t,e){const n=Hu(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!ut(e)&&!n.getImmediateChild(rt(e)).isEmpty())?n.getChild(e):null}function AO(t){return t.eventRegistrations_.length===0}function PJ(t,e){t.eventRegistrations_.push(e)}function DO(t,e,n){const s=[];if(n){ye(e==null,"A cancel should cancel all event registrations.");const r=t.query._path;t.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(n,r);o&&s.push(o)})}if(e){let r=[];for(let i=0;i<t.eventRegistrations_.length;++i){const o=t.eventRegistrations_[i];if(!o.matches(e))r.push(o);else if(e.hasAnyCallback()){r=r.concat(t.eventRegistrations_.slice(i+1));break}}t.eventRegistrations_=r}else t.eventRegistrations_=[];return s}function OO(t,e,n,s){e.type===Ni.MERGE&&e.source.queryId!==null&&(ye(Hu(t.viewCache_),"We should always have a full cache before handling merges"),ye(hw(t.viewCache_),"Missing event cache, even though we have a server cache"));const r=t.viewCache_,i=_J(t.processor_,r,e,n,s);return IJ(t.processor_,i.viewCache),ye(i.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=i.viewCache,Xz(t,i.changes,i.viewCache.eventCache.getNode(),null)}function FJ(t,e){const n=t.viewCache_.eventCache,s=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(vn,(i,o)=>{s.push(Mh(i,o))}),n.isFullyInitialized()&&s.push(zz(n.getNode())),Xz(t,s,n.getNode(),e)}function Xz(t,e,n,s){const r=s?[s]:t.eventRegistrations_;return sJ(t.eventGenerator_,e,n,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mw;class Yz{constructor(){this.views=new Map}}function LJ(t){ye(!mw,"__referenceConstructor has already been defined"),mw=t}function MJ(){return ye(mw,"Reference.ts has not been loaded"),mw}function zJ(t){return t.views.size===0}function Tk(t,e,n,s){const r=e.source.queryId;if(r!==null){const i=t.views.get(r);return ye(i!=null,"SyncTree gave us an op for an invalid query."),OO(i,e,n,s)}else{let i=[];for(const o of t.views.values())i=i.concat(OO(o,e,n,s));return i}}function Qz(t,e,n,s,r){const i=e._queryIdentifier,o=t.views.get(i);if(!o){let a=dw(n,r?s:null),l=!1;a?l=!0:s instanceof Ue?(a=Ck(n,s),l=!1):(a=Ue.EMPTY_NODE,l=!1);const u=Tx(new _l(a,l,!1),new _l(s,r,!1));return new RJ(e,u)}return o}function BJ(t,e,n,s,r,i){const o=Qz(t,e,s,r,i);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),PJ(o,n),FJ(o,n)}function VJ(t,e,n,s){const r=e._queryIdentifier,i=[];let o=[];const a=Tl(t);if(r==="default")for(const[l,u]of t.views.entries())o=o.concat(DO(u,n,s)),AO(u)&&(t.views.delete(l),u.query._queryParams.loadsAllData()||i.push(u.query));else{const l=t.views.get(r);l&&(o=o.concat(DO(l,n,s)),AO(l)&&(t.views.delete(r),l.query._queryParams.loadsAllData()||i.push(l.query)))}return a&&!Tl(t)&&i.push(new(MJ())(e._repo,e._path)),{removed:i,events:o}}function Jz(t){const e=[];for(const n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function ml(t,e){let n=null;for(const s of t.views.values())n=n||OJ(s,e);return n}function Zz(t,e){if(e._queryParams.loadsAllData())return Ex(t);{const s=e._queryIdentifier;return t.views.get(s)}}function e4(t,e){return Zz(t,e)!=null}function Tl(t){return Ex(t)!=null}function Ex(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gw;function UJ(t){ye(!gw,"__referenceConstructor has already been defined"),gw=t}function WJ(){return ye(gw,"Reference.ts has not been loaded"),gw}let jJ=1;class PO{constructor(e){this.listenProvider_=e,this.syncPointTree_=new jt(null),this.pendingWriteTree_=wJ(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function t4(t,e,n,s,r){return aJ(t.pendingWriteTree_,e,n,s,r),r?dd(t,new Gu(wk(),e,n)):[]}function GJ(t,e,n,s){lJ(t.pendingWriteTree_,e,n,s);const r=jt.fromObject(n);return dd(t,new Sk(wk(),e,r))}function Za(t,e,n=!1){const s=uJ(t.pendingWriteTree_,e);if(cJ(t.pendingWriteTree_,e)){let i=new jt(null);return s.snap!=null?i=i.set(St(),!0):Ss(s.children,o=>{i=i.set(new Ft(o),!0)}),dd(t,new cw(s.path,i,n))}else return[]}function tg(t,e,n){return dd(t,new Gu(xk(),e,n))}function HJ(t,e,n){const s=jt.fromObject(n);return dd(t,new Sk(xk(),e,s))}function qJ(t,e){return dd(t,new pm(xk(),e))}function KJ(t,e,n){const s=Ek(t,n);if(s){const r=Nk(s),i=r.path,o=r.queryId,a=Ws(i,e),l=new pm(bk(o),a);return $k(t,i,l)}else return[]}function yw(t,e,n,s,r=!1){const i=e._path,o=t.syncPointTree_.get(i);let a=[];if(o&&(e._queryIdentifier==="default"||e4(o,e))){const l=VJ(o,e,n,s);zJ(o)&&(t.syncPointTree_=t.syncPointTree_.remove(i));const u=l.removed;if(a=l.events,!r){const c=u.findIndex(d=>d._queryParams.loadsAllData())!==-1,h=t.syncPointTree_.findOnPath(i,(d,f)=>Tl(f));if(c&&!h){const d=t.syncPointTree_.subtree(i);if(!d.isEmpty()){const f=QJ(d);for(let p=0;p<f.length;++p){const m=f[p],v=m.query,g=i4(t,m);t.listenProvider_.startListening(Lp(v),mm(t,v),g.hashFn,g.onComplete)}}}!h&&u.length>0&&!s&&(c?t.listenProvider_.stopListening(Lp(e),null):u.forEach(d=>{const f=t.queryToTagMap.get(Nx(d));t.listenProvider_.stopListening(Lp(d),f)}))}JJ(t,u)}return a}function n4(t,e,n,s){const r=Ek(t,s);if(r!=null){const i=Nk(r),o=i.path,a=i.queryId,l=Ws(o,e),u=new Gu(bk(a),l,n);return $k(t,o,u)}else return[]}function XJ(t,e,n,s){const r=Ek(t,s);if(r){const i=Nk(r),o=i.path,a=i.queryId,l=Ws(o,e),u=jt.fromObject(n),c=new Sk(bk(a),l,u);return $k(t,o,c)}else return[]}function VI(t,e,n,s=!1){const r=e._path;let i=null,o=!1;t.syncPointTree_.foreachOnPath(r,(d,f)=>{const p=Ws(d,r);i=i||ml(f,p),o=o||Tl(f)});let a=t.syncPointTree_.get(r);a?(o=o||Tl(a),i=i||ml(a,St())):(a=new Yz,t.syncPointTree_=t.syncPointTree_.set(r,a));let l;i!=null?l=!0:(l=!1,i=Ue.EMPTY_NODE,t.syncPointTree_.subtree(r).foreachChild((f,p)=>{const m=ml(p,St());m&&(i=i.updateImmediateChild(f,m))}));const u=e4(a,e);if(!u&&!e._queryParams.loadsAllData()){const d=Nx(e);ye(!t.queryToTagMap.has(d),"View does not exist, but we have a tag");const f=ZJ();t.queryToTagMap.set(d,f),t.tagToQueryMap.set(f,d)}const c=kx(t.pendingWriteTree_,r);let h=BJ(a,e,n,c,i,l);if(!u&&!o&&!s){const d=Zz(a,e);h=h.concat(eZ(t,e,d))}return h}function kk(t,e,n){const r=t.pendingWriteTree_,i=t.syncPointTree_.findOnPath(e,(o,a)=>{const l=Ws(o,e),u=ml(a,l);if(u)return u});return jz(r,e,i,n,!0)}function YJ(t,e){const n=e._path;let s=null;t.syncPointTree_.foreachOnPath(n,(u,c)=>{const h=Ws(u,n);s=s||ml(c,h)});let r=t.syncPointTree_.get(n);r?s=s||ml(r,St()):(r=new Yz,t.syncPointTree_=t.syncPointTree_.set(n,r));const i=s!=null,o=i?new _l(s,!0,!1):null,a=kx(t.pendingWriteTree_,e._path),l=Qz(r,e,a,i?o.getNode():Ue.EMPTY_NODE,i);return DJ(l)}function dd(t,e){return s4(e,t.syncPointTree_,null,kx(t.pendingWriteTree_,St()))}function s4(t,e,n,s){if(ut(t.path))return r4(t,e,n,s);{const r=e.get(St());n==null&&r!=null&&(n=ml(r,St()));let i=[];const o=rt(t.path),a=t.operationForChild(o),l=e.children.get(o);if(l&&a){const u=n?n.getImmediateChild(o):null,c=Gz(s,o);i=i.concat(s4(a,l,u,c))}return r&&(i=i.concat(Tk(r,t,s,n))),i}}function r4(t,e,n,s){const r=e.get(St());n==null&&r!=null&&(n=ml(r,St()));let i=[];return e.children.inorderTraversal((o,a)=>{const l=n?n.getImmediateChild(o):null,u=Gz(s,o),c=t.operationForChild(o);c&&(i=i.concat(r4(c,a,l,u)))}),r&&(i=i.concat(Tk(r,t,s,n))),i}function i4(t,e){const n=e.query,s=mm(t,n);return{hashFn:()=>(AJ(e)||Ue.EMPTY_NODE).hash(),onComplete:r=>{if(r==="ok")return s?KJ(t,n._path,s):qJ(t,n._path);{const i=qY(r,n);return yw(t,n,null,i)}}}}function mm(t,e){const n=Nx(e);return t.queryToTagMap.get(n)}function Nx(t){return t._path.toString()+"$"+t._queryIdentifier}function Ek(t,e){return t.tagToQueryMap.get(e)}function Nk(t){const e=t.indexOf("$");return ye(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new Ft(t.substr(0,e))}}function $k(t,e,n){const s=t.syncPointTree_.get(e);ye(s,"Missing sync point for query tag that we're tracking");const r=kx(t.pendingWriteTree_,e);return Tk(s,n,r,null)}function QJ(t){return t.fold((e,n,s)=>{if(n&&Tl(n))return[Ex(n)];{let r=[];return n&&(r=Jz(n)),Ss(s,(i,o)=>{r=r.concat(o)}),r}})}function Lp(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(WJ())(t._repo,t._path):t}function JJ(t,e){for(let n=0;n<e.length;++n){const s=e[n];if(!s._queryParams.loadsAllData()){const r=Nx(s),i=t.queryToTagMap.get(r);t.queryToTagMap.delete(r),t.tagToQueryMap.delete(i)}}}function ZJ(){return jJ++}function eZ(t,e,n){const s=e._path,r=mm(t,e),i=i4(t,n),o=t.listenProvider_.startListening(Lp(e),r,i.hashFn,i.onComplete),a=t.syncPointTree_.subtree(s);if(r)ye(!Tl(a.value),"If we're adding a query, it shouldn't be shadowed");else{const l=a.fold((u,c,h)=>{if(!ut(u)&&c&&Tl(c))return[Ex(c).query];{let d=[];return c&&(d=d.concat(Jz(c).map(f=>f.query))),Ss(h,(f,p)=>{d=d.concat(p)}),d}});for(let u=0;u<l.length;++u){const c=l[u];t.listenProvider_.stopListening(Lp(c),mm(t,c))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rk{constructor(e){this.node_=e}getImmediateChild(e){const n=this.node_.getImmediateChild(e);return new Rk(n)}node(){return this.node_}}class Ak{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){const n=yn(this.path_,e);return new Ak(this.syncTree_,n)}node(){return kk(this.syncTree_,this.path_)}}const tZ=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},FO=function(t,e,n){if(!t||typeof t!="object")return t;if(ye(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return nZ(t[".sv"],e,n);if(typeof t[".sv"]=="object")return sZ(t[".sv"],e);ye(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},nZ=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:ye(!1,"Unexpected server value: "+t)}},sZ=function(t,e,n){t.hasOwnProperty("increment")||ye(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const s=t.increment;typeof s!="number"&&ye(!1,"Unexpected increment value: "+s);const r=e.node();if(ye(r!==null&&typeof r<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return s;const o=r.getValue();return typeof o!="number"?s:o+s},o4=function(t,e,n,s){return Dk(e,new Ak(n,t),s)},a4=function(t,e,n){return Dk(t,new Rk(e),n)};function Dk(t,e,n){const s=t.getPriority().val(),r=FO(s,e.getImmediateChild(".priority"),n);let i;if(t.isLeafNode()){const o=t,a=FO(o.getValue(),e,n);return a!==o.getValue()||r!==o.getPriority().val()?new Zn(a,Vn(r)):t}else{const o=t;return i=o,r!==o.getPriority().val()&&(i=i.updatePriority(new Zn(r))),o.forEachChild(vn,(a,l)=>{const u=Dk(l,e.getImmediateChild(a),n);u!==l&&(i=i.updateImmediateChild(a,u))}),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ok{constructor(e="",n=null,s={children:{},childCount:0}){this.name=e,this.parent=n,this.node=s}}function Pk(t,e){let n=e instanceof Ft?e:new Ft(e),s=t,r=rt(n);for(;r!==null;){const i=Fh(s.node.children,r)||{children:{},childCount:0};s=new Ok(r,s,i),n=Gt(n),r=rt(n)}return s}function fd(t){return t.node.value}function l4(t,e){t.node.value=e,UI(t)}function u4(t){return t.node.childCount>0}function rZ(t){return fd(t)===void 0&&!u4(t)}function $x(t,e){Ss(t.node.children,(n,s)=>{e(new Ok(n,t,s))})}function c4(t,e,n,s){n&&!s&&e(t),$x(t,r=>{c4(r,e,!0,s)}),n&&s&&e(t)}function iZ(t,e,n){let s=t.parent;for(;s!==null;){if(e(s))return!0;s=s.parent}return!1}function ng(t){return new Ft(t.parent===null?t.name:ng(t.parent)+"/"+t.name)}function UI(t){t.parent!==null&&oZ(t.parent,t.name,t)}function oZ(t,e,n){const s=rZ(n),r=ko(t.node.children,e);s&&r?(delete t.node.children[e],t.node.childCount--,UI(t)):!s&&!r&&(t.node.children[e]=n.node,t.node.childCount++,UI(t))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aZ=/[\[\].#$\/\u0000-\u001F\u007F]/,lZ=/[\[\].#$\u0000-\u001F\u007F]/,oC=10*1024*1024,Fk=function(t){return typeof t=="string"&&t.length!==0&&!aZ.test(t)},h4=function(t){return typeof t=="string"&&t.length!==0&&!lZ.test(t)},uZ=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),h4(t)},cZ=function(t){return t===null||typeof t=="string"||typeof t=="number"&&!lk(t)||t&&typeof t=="object"&&ko(t,".sv")},hZ=function(t,e,n,s){Rx(vx(t,"value"),e,n)},Rx=function(t,e,n){const s=n instanceof Ft?new kQ(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+hu(s));if(typeof e=="function")throw new Error(t+"contains a function "+hu(s)+" with contents = "+e.toString());if(lk(e))throw new Error(t+"contains "+e.toString()+" "+hu(s));if(typeof e=="string"&&e.length>oC/3&&wx(e)>oC)throw new Error(t+"contains a string greater than "+oC+" utf8 bytes "+hu(s)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let r=!1,i=!1;if(Ss(e,(o,a)=>{if(o===".value")r=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!Fk(o)))throw new Error(t+" contains an invalid key ("+o+") "+hu(s)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);EQ(s,o),Rx(t,a,s),NQ(s)}),r&&i)throw new Error(t+' contains ".value" child '+hu(s)+" in addition to actual children.")}},dZ=function(t,e){let n,s;for(n=0;n<e.length;n++){s=e[n];const i=cm(s);for(let o=0;o<i.length;o++)if(!(i[o]===".priority"&&o===i.length-1)){if(!Fk(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+s.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(TQ);let r=null;for(n=0;n<e.length;n++){if(s=e[n],r!==null&&ei(r,s))throw new Error(t+"contains a path "+r.toString()+" that is ancestor of another path "+s.toString());r=s}},fZ=function(t,e,n,s){const r=vx(t,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(r+" must be an object containing the children to replace.");const i=[];Ss(e,(o,a)=>{const l=new Ft(o);if(Rx(r,a,yn(n,l)),fk(l)===".priority"&&!cZ(a))throw new Error(r+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");i.push(l)}),dZ(r,i)},d4=function(t,e,n,s){if(!h4(n))throw new Error(vx(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},pZ=function(t,e,n,s){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),d4(t,e,n)},mZ=function(t,e){if(rt(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},gZ=function(t,e){const n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Fk(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!uZ(n))throw new Error(vx(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yZ{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Ax(t,e){let n=null;for(let s=0;s<e.length;s++){const r=e[s],i=r.getPath();n!==null&&!pk(i,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:i}),n.events.push(r)}n&&t.eventLists_.push(n)}function f4(t,e,n){Ax(t,n),p4(t,s=>pk(s,e))}function ui(t,e,n){Ax(t,n),p4(t,s=>ei(s,e)||ei(e,s))}function p4(t,e){t.recursionDepth_++;let n=!0;for(let s=0;s<t.eventLists_.length;s++){const r=t.eventLists_[s];if(r){const i=r.path;e(i)?(vZ(t.eventLists_[s]),t.eventLists_[s]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function vZ(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(n!==null){t.events[e]=null;const s=n.getEventRunner();Dp&&ws("event: "+n.toString()),hd(s)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wZ="repo_interrupt",xZ=25;class bZ{constructor(e,n,s,r){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=s,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new yZ,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=uw(),this.transactionQueueTree_=new Ok,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function SZ(t,e,n){if(t.stats_=hk(t.repoInfo_),t.forceRestClient_||QY())t.server_=new lw(t.repoInfo_,(s,r,i,o)=>{LO(t,s,r,i,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>MO(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Wn(n)}catch(s){throw new Error("Invalid authOverride provided: "+s)}}t.persistentConnection_=new ea(t.repoInfo_,e,(s,r,i,o)=>{LO(t,s,r,i,o)},s=>{MO(t,s)},s=>{IZ(t,s)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(s=>{t.server_.refreshAuthToken(s)}),t.appCheckProvider_.addTokenChangeListener(s=>{t.server_.refreshAppCheckToken(s.token)}),t.statsReporter_=nQ(t.repoInfo_,()=>new tJ(t.stats_,t.server_)),t.infoData_=new YQ,t.infoSyncTree_=new PO({startListening:(s,r,i,o)=>{let a=[];const l=t.infoData_.getNode(s._path);return l.isEmpty()||(a=tg(t.infoSyncTree_,s._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Lk(t,"connected",!1),t.serverSyncTree_=new PO({startListening:(s,r,i,o)=>(t.server_.listen(s,i,r,(a,l)=>{const u=o(a,l);ui(t.eventQueue_,s._path,u)}),[]),stopListening:(s,r)=>{t.server_.unlisten(s,r)}})}function CZ(t){const n=t.infoData_.getNode(new Ft(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function Dx(t){return tZ({timestamp:CZ(t)})}function LO(t,e,n,s,r){t.dataUpdateCount++;const i=new Ft(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(r)if(s){const l=Qv(n,u=>Vn(u));o=XJ(t.serverSyncTree_,i,l,r)}else{const l=Vn(n);o=n4(t.serverSyncTree_,i,l,r)}else if(s){const l=Qv(n,u=>Vn(u));o=HJ(t.serverSyncTree_,i,l)}else{const l=Vn(n);o=tg(t.serverSyncTree_,i,l)}let a=i;o.length>0&&(a=Bh(t,i)),ui(t.eventQueue_,a,o)}function MO(t,e){Lk(t,"connected",e),e===!1&&EZ(t)}function IZ(t,e){Ss(e,(n,s)=>{Lk(t,n,s)})}function Lk(t,e,n){const s=new Ft("/.info/"+e),r=Vn(n);t.infoData_.updateSnapshot(s,r);const i=tg(t.infoSyncTree_,s,r);ui(t.eventQueue_,s,i)}function Mk(t){return t.nextWriteId_++}function _Z(t,e,n){const s=YJ(t.serverSyncTree_,e);return s!=null?Promise.resolve(s):t.server_.get(e).then(r=>{const i=Vn(r).withIndex(e._queryParams.getIndex());VI(t.serverSyncTree_,e,n,!0);let o;if(e._queryParams.loadsAllData())o=tg(t.serverSyncTree_,e._path,i);else{const a=mm(t.serverSyncTree_,e);o=n4(t.serverSyncTree_,e._path,i,a)}return ui(t.eventQueue_,e._path,o),yw(t.serverSyncTree_,e,n,null,!0),i},r=>(sg(t,"get for query "+Wn(e)+" failed: "+r),Promise.reject(new Error(r))))}function TZ(t,e,n,s,r){sg(t,"set",{path:e.toString(),value:n,priority:s});const i=Dx(t),o=Vn(n,s),a=kk(t.serverSyncTree_,e),l=a4(o,a,i),u=Mk(t),c=t4(t.serverSyncTree_,e,l,u,!0);Ax(t.eventQueue_,c),t.server_.put(e.toString(),o.val(!0),(d,f)=>{const p=d==="ok";p||Hs("set at "+e+" failed: "+d);const m=Za(t.serverSyncTree_,u,!p);ui(t.eventQueue_,e,m),WI(t,r,d,f)});const h=Bk(t,e);Bh(t,h),ui(t.eventQueue_,h,[])}function kZ(t,e,n,s){sg(t,"update",{path:e.toString(),value:n});let r=!0;const i=Dx(t),o={};if(Ss(n,(a,l)=>{r=!1,o[a]=o4(yn(e,a),Vn(l),t.serverSyncTree_,i)}),r)ws("update() called with empty data.  Don't do anything."),WI(t,s,"ok",void 0);else{const a=Mk(t),l=GJ(t.serverSyncTree_,e,o,a);Ax(t.eventQueue_,l),t.server_.merge(e.toString(),n,(u,c)=>{const h=u==="ok";h||Hs("update at "+e+" failed: "+u);const d=Za(t.serverSyncTree_,a,!h),f=d.length>0?Bh(t,e):e;ui(t.eventQueue_,f,d),WI(t,s,u,c)}),Ss(n,u=>{const c=Bk(t,yn(e,u));Bh(t,c)}),ui(t.eventQueue_,e,[])}}function EZ(t){sg(t,"onDisconnectEvents");const e=Dx(t),n=uw();OI(t.onDisconnect_,St(),(r,i)=>{const o=o4(r,i,t.serverSyncTree_,e);Bz(n,r,o)});let s=[];OI(n,St(),(r,i)=>{s=s.concat(tg(t.serverSyncTree_,r,i));const o=Bk(t,r);Bh(t,o)}),t.onDisconnect_=uw(),ui(t.eventQueue_,St(),s)}function NZ(t,e,n){let s;rt(e._path)===".info"?s=VI(t.infoSyncTree_,e,n):s=VI(t.serverSyncTree_,e,n),f4(t.eventQueue_,e._path,s)}function $Z(t,e,n){let s;rt(e._path)===".info"?s=yw(t.infoSyncTree_,e,n):s=yw(t.serverSyncTree_,e,n),f4(t.eventQueue_,e._path,s)}function RZ(t){t.persistentConnection_&&t.persistentConnection_.interrupt(wZ)}function sg(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),ws(n,...e)}function WI(t,e,n,s){e&&hd(()=>{if(n==="ok")e(null);else{const r=(n||"error").toUpperCase();let i=r;s&&(i+=": "+s);const o=new Error(i);o.code=r,e(o)}})}function m4(t,e,n){return kk(t.serverSyncTree_,e,n)||Ue.EMPTY_NODE}function zk(t,e=t.transactionQueueTree_){if(e||Ox(t,e),fd(e)){const n=y4(t,e);ye(n.length>0,"Sending zero length transaction queue"),n.every(r=>r.status===0)&&AZ(t,ng(e),n)}else u4(e)&&$x(e,n=>{zk(t,n)})}function AZ(t,e,n){const s=n.map(u=>u.currentWriteId),r=m4(t,e,s);let i=r;const o=r.hash();for(let u=0;u<n.length;u++){const c=n[u];ye(c.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),c.status=1,c.retryCount++;const h=Ws(e,c.path);i=i.updateChild(h,c.currentOutputSnapshotRaw)}const a=i.val(!0),l=e;t.server_.put(l.toString(),a,u=>{sg(t,"transaction put response",{path:l.toString(),status:u});let c=[];if(u==="ok"){const h=[];for(let d=0;d<n.length;d++)n[d].status=2,c=c.concat(Za(t.serverSyncTree_,n[d].currentWriteId)),n[d].onComplete&&h.push(()=>n[d].onComplete(null,!0,n[d].currentOutputSnapshotResolved)),n[d].unwatcher();Ox(t,Pk(t.transactionQueueTree_,e)),zk(t,t.transactionQueueTree_),ui(t.eventQueue_,e,c);for(let d=0;d<h.length;d++)hd(h[d])}else{if(u==="datastale")for(let h=0;h<n.length;h++)n[h].status===3?n[h].status=4:n[h].status=0;else{Hs("transaction at "+l.toString()+" failed: "+u);for(let h=0;h<n.length;h++)n[h].status=4,n[h].abortReason=u}Bh(t,e)}},o)}function Bh(t,e){const n=g4(t,e),s=ng(n),r=y4(t,n);return DZ(t,r,s),s}function DZ(t,e,n){if(e.length===0)return;const s=[];let r=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const l=e[a],u=Ws(n,l.path);let c=!1,h;if(ye(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)c=!0,h=l.abortReason,r=r.concat(Za(t.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=xZ)c=!0,h="maxretry",r=r.concat(Za(t.serverSyncTree_,l.currentWriteId,!0));else{const d=m4(t,l.path,o);l.currentInputSnapshot=d;const f=e[a].update(d.val());if(f!==void 0){Rx("transaction failed: Data returned ",f,l.path);let p=Vn(f);typeof f=="object"&&f!=null&&ko(f,".priority")||(p=p.updatePriority(d.getPriority()));const v=l.currentWriteId,g=Dx(t),w=a4(p,d,g);l.currentOutputSnapshotRaw=p,l.currentOutputSnapshotResolved=w,l.currentWriteId=Mk(t),o.splice(o.indexOf(v),1),r=r.concat(t4(t.serverSyncTree_,l.path,w,l.currentWriteId,l.applyLocally)),r=r.concat(Za(t.serverSyncTree_,v,!0))}else c=!0,h="nodata",r=r.concat(Za(t.serverSyncTree_,l.currentWriteId,!0))}ui(t.eventQueue_,n,r),r=[],c&&(e[a].status=2,function(d){setTimeout(d,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(h==="nodata"?s.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):s.push(()=>e[a].onComplete(new Error(h),!1,null))))}Ox(t,t.transactionQueueTree_);for(let a=0;a<s.length;a++)hd(s[a]);zk(t,t.transactionQueueTree_)}function g4(t,e){let n,s=t.transactionQueueTree_;for(n=rt(e);n!==null&&fd(s)===void 0;)s=Pk(s,n),e=Gt(e),n=rt(e);return s}function y4(t,e){const n=[];return v4(t,e,n),n.sort((s,r)=>s.order-r.order),n}function v4(t,e,n){const s=fd(e);if(s)for(let r=0;r<s.length;r++)n.push(s[r]);$x(e,r=>{v4(t,r,n)})}function Ox(t,e){const n=fd(e);if(n){let s=0;for(let r=0;r<n.length;r++)n[r].status!==2&&(n[s]=n[r],s++);n.length=s,l4(e,n.length>0?n:void 0)}$x(e,s=>{Ox(t,s)})}function Bk(t,e){const n=ng(g4(t,e)),s=Pk(t.transactionQueueTree_,e);return iZ(s,r=>{aC(t,r)}),aC(t,s),c4(s,r=>{aC(t,r)}),n}function aC(t,e){const n=fd(e);if(n){const s=[];let r=[],i=-1;for(let o=0;o<n.length;o++)n[o].status===3||(n[o].status===1?(ye(i===o-1,"All SENT items should be at beginning of queue."),i=o,n[o].status=3,n[o].abortReason="set"):(ye(n[o].status===0,"Unexpected transaction status in abort"),n[o].unwatcher(),r=r.concat(Za(t.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&s.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?l4(e,void 0):n.length=i+1,ui(t.eventQueue_,ng(e),r);for(let o=0;o<s.length;o++)hd(s[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OZ(t){let e="";const n=t.split("/");for(let s=0;s<n.length;s++)if(n[s].length>0){let r=n[s];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch{}e+="/"+r}return e}function PZ(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const n of t.split("&")){if(n.length===0)continue;const s=n.split("=");s.length===2?e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):Hs(`Invalid query segment '${n}' in query '${t}'`)}return e}const zO=function(t,e){const n=FZ(t),s=n.namespace;n.domain==="firebase.com"&&la(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!s||s==="undefined")&&n.domain!=="localhost"&&la("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||UY();const r=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new Cz(n.host,n.secure,s,r,e,"",s!==n.subdomain),path:new Ft(n.pathString)}},FZ=function(t){let e="",n="",s="",r="",i="",o=!0,a="https",l=443;if(typeof t=="string"){let u=t.indexOf("//");u>=0&&(a=t.substring(0,u-1),t=t.substring(u+2));let c=t.indexOf("/");c===-1&&(c=t.length);let h=t.indexOf("?");h===-1&&(h=t.length),e=t.substring(0,Math.min(c,h)),c<h&&(r=OZ(t.substring(c,h)));const d=PZ(t.substring(Math.min(t.length,h)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(u+1),10)):u=e.length;const f=e.slice(0,u);if(f.toLowerCase()==="localhost")n="localhost";else if(f.split(".").length<=2)n=f;else{const p=e.indexOf(".");s=e.substring(0,p).toLowerCase(),n=e.substring(p+1),i=s}"ns"in d&&(i=d.ns)}return{host:e,port:l,domain:n,subdomain:s,secure:o,scheme:a,pathString:r,namespace:i}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LZ{constructor(e,n,s,r){this.eventType=e,this.eventRegistration=n,this.snapshot=s,this.prevName=r}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Wn(this.snapshot.exportVal())}}class MZ{constructor(e,n,s){this.eventRegistration=e,this.error=n,this.path=s}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w4{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return ye(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vk{constructor(e,n,s,r){this._repo=e,this._path=n,this._queryParams=s,this._orderByCalled=r}get key(){return ut(this._path)?null:fk(this._path)}get ref(){return new va(this._repo,this._path)}get _queryIdentifier(){const e=_O(this._queryParams),n=uk(e);return n==="{}"?"default":n}get _queryObject(){return _O(this._queryParams)}isEqual(e){if(e=br(e),!(e instanceof Vk))return!1;const n=this._repo===e._repo,s=pk(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return n&&s&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+_Q(this._path)}}class va extends Vk{constructor(e,n){super(e,n,new vk,!1)}get parent(){const e=Az(this._path);return e===null?null:new va(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class gm{constructor(e,n,s){this._node=e,this.ref=n,this._index=s}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const n=new Ft(e),s=jI(this.ref,e);return new gm(this._node.getChild(n),s,vn)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(s,r)=>e(new gm(r,jI(this.ref,s),vn)))}hasChild(e){const n=new Ft(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function ym(t,e){return t=br(t),t._checkNotDeleted("ref"),e!==void 0?jI(t._root,e):t._root}function jI(t,e){return t=br(t),rt(t._path)===null?pZ("child","path",e):d4("child","path",e),new va(t._repo,yn(t._path,e))}function BO(t,e){t=br(t),mZ("set",t._path),hZ("set",e,t._path);const n=new Hm;return TZ(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}function zZ(t,e){fZ("update",e,t._path);const n=new Hm;return kZ(t._repo,t._path,e,n.wrapCallback(()=>{})),n.promise}function x4(t){t=br(t);const e=new w4(()=>{}),n=new Px(e);return _Z(t._repo,t,n).then(s=>new gm(s,new va(t._repo,t._path),t._queryParams.getIndex()))}class Px{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){const s=n._queryParams.getIndex();return new LZ("value",this,new gm(e.snapshotNode,new va(n._repo,n._path),s))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new MZ(this,e,n):null}matches(e){return e instanceof Px?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function BZ(t,e,n,s,r){const i=new w4(n,void 0),o=new Px(i);return NZ(t._repo,t,o),()=>$Z(t._repo,t,o)}function VZ(t,e,n,s){return BZ(t,"value",e)}LJ(va);UJ(va);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UZ="FIREBASE_DATABASE_EMULATOR_HOST",GI={};let WZ=!1;function jZ(t,e,n,s){t.repoInfo_=new Cz(`${e}:${n}`,!1,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0),s&&(t.authTokenProvider_=s)}function GZ(t,e,n,s,r){let i=s||t.options.databaseURL;i===void 0&&(t.options.projectId||la("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),ws("Using default host for project ",t.options.projectId),i=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=zO(i,r),a=o.repoInfo,l;typeof process<"u"&&aO&&(l=aO[UZ]),l?(i=`http://${l}?ns=${a.namespace}`,o=zO(i,r),a=o.repoInfo):o.repoInfo.secure;const u=new ZY(t.name,t.options,e);gZ("Invalid Firebase Database URL",o),ut(o.path)||la("Database URL must point to the root of a Firebase Database (not including a child path).");const c=qZ(a,t,u,new JY(t.name,n));return new KZ(c,t)}function HZ(t,e){const n=GI[e];(!n||n[t.key]!==t)&&la(`Database ${e}(${t.repoInfo_}) has already been deleted.`),RZ(t),delete n[t.key]}function qZ(t,e,n,s){let r=GI[e.name];r||(r={},GI[e.name]=r);let i=r[t.toURLString()];return i&&la("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new bZ(t,WZ,n,s),r[t.toURLString()]=i,i}class KZ{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(SZ(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new va(this._repo,St())),this._rootInternal}_delete(){return this._rootInternal!==null&&(HZ(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&la("Cannot call "+e+" on a deleted database.")}}function b4(t=_3(),e){const n=JT(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const s=J8("database");s&&XZ(n,...s)}return n}function XZ(t,e,n,s={}){t=br(t),t._checkNotDeleted("useEmulator"),t._instanceStarted&&la("Cannot call useEmulator() after instance has already been initialized.");const r=t._repoInternal;let i;if(r.repoInfo_.nodeAdmin)s.mockUserToken&&la('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),i=new hv(hv.OWNER);else if(s.mockUserToken){const o=typeof s.mockUserToken=="string"?s.mockUserToken:Z8(s.mockUserToken,t.app.options.projectId);i=new hv(o)}jZ(r,e,n,i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YZ(t){FY(mc),Vu(new Cl("database",(e,{instanceIdentifier:n})=>{const s=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return GZ(s,r,i,n)},"PUBLIC").setMultipleInstances(!0)),fo(lO,uO,t),fo(lO,uO,"esm2017")}ea.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};ea.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};YZ();var VO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var S4;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(I,C){function _(){}_.prototype=C.prototype,I.D=C.prototype,I.prototype=new _,I.prototype.constructor=I,I.C=function(k,A,D){for(var R=Array(arguments.length-2),W=2;W<arguments.length;W++)R[W-2]=arguments[W];return C.prototype[A].apply(k,R)}}function n(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(s,n),s.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(I,C,_){_||(_=0);var k=Array(16);if(typeof C=="string")for(var A=0;16>A;++A)k[A]=C.charCodeAt(_++)|C.charCodeAt(_++)<<8|C.charCodeAt(_++)<<16|C.charCodeAt(_++)<<24;else for(A=0;16>A;++A)k[A]=C[_++]|C[_++]<<8|C[_++]<<16|C[_++]<<24;C=I.g[0],_=I.g[1],A=I.g[2];var D=I.g[3],R=C+(D^_&(A^D))+k[0]+3614090360&4294967295;C=_+(R<<7&4294967295|R>>>25),R=D+(A^C&(_^A))+k[1]+3905402710&4294967295,D=C+(R<<12&4294967295|R>>>20),R=A+(_^D&(C^_))+k[2]+606105819&4294967295,A=D+(R<<17&4294967295|R>>>15),R=_+(C^A&(D^C))+k[3]+3250441966&4294967295,_=A+(R<<22&4294967295|R>>>10),R=C+(D^_&(A^D))+k[4]+4118548399&4294967295,C=_+(R<<7&4294967295|R>>>25),R=D+(A^C&(_^A))+k[5]+1200080426&4294967295,D=C+(R<<12&4294967295|R>>>20),R=A+(_^D&(C^_))+k[6]+2821735955&4294967295,A=D+(R<<17&4294967295|R>>>15),R=_+(C^A&(D^C))+k[7]+4249261313&4294967295,_=A+(R<<22&4294967295|R>>>10),R=C+(D^_&(A^D))+k[8]+1770035416&4294967295,C=_+(R<<7&4294967295|R>>>25),R=D+(A^C&(_^A))+k[9]+2336552879&4294967295,D=C+(R<<12&4294967295|R>>>20),R=A+(_^D&(C^_))+k[10]+4294925233&4294967295,A=D+(R<<17&4294967295|R>>>15),R=_+(C^A&(D^C))+k[11]+2304563134&4294967295,_=A+(R<<22&4294967295|R>>>10),R=C+(D^_&(A^D))+k[12]+1804603682&4294967295,C=_+(R<<7&4294967295|R>>>25),R=D+(A^C&(_^A))+k[13]+4254626195&4294967295,D=C+(R<<12&4294967295|R>>>20),R=A+(_^D&(C^_))+k[14]+2792965006&4294967295,A=D+(R<<17&4294967295|R>>>15),R=_+(C^A&(D^C))+k[15]+1236535329&4294967295,_=A+(R<<22&4294967295|R>>>10),R=C+(A^D&(_^A))+k[1]+4129170786&4294967295,C=_+(R<<5&4294967295|R>>>27),R=D+(_^A&(C^_))+k[6]+3225465664&4294967295,D=C+(R<<9&4294967295|R>>>23),R=A+(C^_&(D^C))+k[11]+643717713&4294967295,A=D+(R<<14&4294967295|R>>>18),R=_+(D^C&(A^D))+k[0]+3921069994&4294967295,_=A+(R<<20&4294967295|R>>>12),R=C+(A^D&(_^A))+k[5]+3593408605&4294967295,C=_+(R<<5&4294967295|R>>>27),R=D+(_^A&(C^_))+k[10]+38016083&4294967295,D=C+(R<<9&4294967295|R>>>23),R=A+(C^_&(D^C))+k[15]+3634488961&4294967295,A=D+(R<<14&4294967295|R>>>18),R=_+(D^C&(A^D))+k[4]+3889429448&4294967295,_=A+(R<<20&4294967295|R>>>12),R=C+(A^D&(_^A))+k[9]+568446438&4294967295,C=_+(R<<5&4294967295|R>>>27),R=D+(_^A&(C^_))+k[14]+3275163606&4294967295,D=C+(R<<9&4294967295|R>>>23),R=A+(C^_&(D^C))+k[3]+4107603335&4294967295,A=D+(R<<14&4294967295|R>>>18),R=_+(D^C&(A^D))+k[8]+1163531501&4294967295,_=A+(R<<20&4294967295|R>>>12),R=C+(A^D&(_^A))+k[13]+2850285829&4294967295,C=_+(R<<5&4294967295|R>>>27),R=D+(_^A&(C^_))+k[2]+4243563512&4294967295,D=C+(R<<9&4294967295|R>>>23),R=A+(C^_&(D^C))+k[7]+1735328473&4294967295,A=D+(R<<14&4294967295|R>>>18),R=_+(D^C&(A^D))+k[12]+2368359562&4294967295,_=A+(R<<20&4294967295|R>>>12),R=C+(_^A^D)+k[5]+4294588738&4294967295,C=_+(R<<4&4294967295|R>>>28),R=D+(C^_^A)+k[8]+2272392833&4294967295,D=C+(R<<11&4294967295|R>>>21),R=A+(D^C^_)+k[11]+1839030562&4294967295,A=D+(R<<16&4294967295|R>>>16),R=_+(A^D^C)+k[14]+4259657740&4294967295,_=A+(R<<23&4294967295|R>>>9),R=C+(_^A^D)+k[1]+2763975236&4294967295,C=_+(R<<4&4294967295|R>>>28),R=D+(C^_^A)+k[4]+1272893353&4294967295,D=C+(R<<11&4294967295|R>>>21),R=A+(D^C^_)+k[7]+4139469664&4294967295,A=D+(R<<16&4294967295|R>>>16),R=_+(A^D^C)+k[10]+3200236656&4294967295,_=A+(R<<23&4294967295|R>>>9),R=C+(_^A^D)+k[13]+681279174&4294967295,C=_+(R<<4&4294967295|R>>>28),R=D+(C^_^A)+k[0]+3936430074&4294967295,D=C+(R<<11&4294967295|R>>>21),R=A+(D^C^_)+k[3]+3572445317&4294967295,A=D+(R<<16&4294967295|R>>>16),R=_+(A^D^C)+k[6]+76029189&4294967295,_=A+(R<<23&4294967295|R>>>9),R=C+(_^A^D)+k[9]+3654602809&4294967295,C=_+(R<<4&4294967295|R>>>28),R=D+(C^_^A)+k[12]+3873151461&4294967295,D=C+(R<<11&4294967295|R>>>21),R=A+(D^C^_)+k[15]+530742520&4294967295,A=D+(R<<16&4294967295|R>>>16),R=_+(A^D^C)+k[2]+3299628645&4294967295,_=A+(R<<23&4294967295|R>>>9),R=C+(A^(_|~D))+k[0]+4096336452&4294967295,C=_+(R<<6&4294967295|R>>>26),R=D+(_^(C|~A))+k[7]+1126891415&4294967295,D=C+(R<<10&4294967295|R>>>22),R=A+(C^(D|~_))+k[14]+2878612391&4294967295,A=D+(R<<15&4294967295|R>>>17),R=_+(D^(A|~C))+k[5]+4237533241&4294967295,_=A+(R<<21&4294967295|R>>>11),R=C+(A^(_|~D))+k[12]+1700485571&4294967295,C=_+(R<<6&4294967295|R>>>26),R=D+(_^(C|~A))+k[3]+2399980690&4294967295,D=C+(R<<10&4294967295|R>>>22),R=A+(C^(D|~_))+k[10]+4293915773&4294967295,A=D+(R<<15&4294967295|R>>>17),R=_+(D^(A|~C))+k[1]+2240044497&4294967295,_=A+(R<<21&4294967295|R>>>11),R=C+(A^(_|~D))+k[8]+1873313359&4294967295,C=_+(R<<6&4294967295|R>>>26),R=D+(_^(C|~A))+k[15]+4264355552&4294967295,D=C+(R<<10&4294967295|R>>>22),R=A+(C^(D|~_))+k[6]+2734768916&4294967295,A=D+(R<<15&4294967295|R>>>17),R=_+(D^(A|~C))+k[13]+1309151649&4294967295,_=A+(R<<21&4294967295|R>>>11),R=C+(A^(_|~D))+k[4]+4149444226&4294967295,C=_+(R<<6&4294967295|R>>>26),R=D+(_^(C|~A))+k[11]+3174756917&4294967295,D=C+(R<<10&4294967295|R>>>22),R=A+(C^(D|~_))+k[2]+718787259&4294967295,A=D+(R<<15&4294967295|R>>>17),R=_+(D^(A|~C))+k[9]+3951481745&4294967295,I.g[0]=I.g[0]+C&4294967295,I.g[1]=I.g[1]+(A+(R<<21&4294967295|R>>>11))&4294967295,I.g[2]=I.g[2]+A&4294967295,I.g[3]=I.g[3]+D&4294967295}s.prototype.u=function(I,C){C===void 0&&(C=I.length);for(var _=C-this.blockSize,k=this.B,A=this.h,D=0;D<C;){if(A==0)for(;D<=_;)r(this,I,D),D+=this.blockSize;if(typeof I=="string"){for(;D<C;)if(k[A++]=I.charCodeAt(D++),A==this.blockSize){r(this,k),A=0;break}}else for(;D<C;)if(k[A++]=I[D++],A==this.blockSize){r(this,k),A=0;break}}this.h=A,this.o+=C},s.prototype.v=function(){var I=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);I[0]=128;for(var C=1;C<I.length-8;++C)I[C]=0;var _=8*this.o;for(C=I.length-8;C<I.length;++C)I[C]=_&255,_/=256;for(this.u(I),I=Array(16),C=_=0;4>C;++C)for(var k=0;32>k;k+=8)I[_++]=this.g[C]>>>k&255;return I};function i(I,C){var _=a;return Object.prototype.hasOwnProperty.call(_,I)?_[I]:_[I]=C(I)}function o(I,C){this.h=C;for(var _=[],k=!0,A=I.length-1;0<=A;A--){var D=I[A]|0;k&&D==C||(_[A]=D,k=!1)}this.g=_}var a={};function l(I){return-128<=I&&128>I?i(I,function(C){return new o([C|0],0>C?-1:0)}):new o([I|0],0>I?-1:0)}function u(I){if(isNaN(I)||!isFinite(I))return h;if(0>I)return v(u(-I));for(var C=[],_=1,k=0;I>=_;k++)C[k]=I/_|0,_*=4294967296;return new o(C,0)}function c(I,C){if(I.length==0)throw Error("number format error: empty string");if(C=C||10,2>C||36<C)throw Error("radix out of range: "+C);if(I.charAt(0)=="-")return v(c(I.substring(1),C));if(0<=I.indexOf("-"))throw Error('number format error: interior "-" character');for(var _=u(Math.pow(C,8)),k=h,A=0;A<I.length;A+=8){var D=Math.min(8,I.length-A),R=parseInt(I.substring(A,A+D),C);8>D?(D=u(Math.pow(C,D)),k=k.j(D).add(u(R))):(k=k.j(_),k=k.add(u(R)))}return k}var h=l(0),d=l(1),f=l(16777216);t=o.prototype,t.m=function(){if(m(this))return-v(this).m();for(var I=0,C=1,_=0;_<this.g.length;_++){var k=this.i(_);I+=(0<=k?k:4294967296+k)*C,C*=4294967296}return I},t.toString=function(I){if(I=I||10,2>I||36<I)throw Error("radix out of range: "+I);if(p(this))return"0";if(m(this))return"-"+v(this).toString(I);for(var C=u(Math.pow(I,6)),_=this,k="";;){var A=x(_,C).g;_=g(_,A.j(C));var D=((0<_.g.length?_.g[0]:_.h)>>>0).toString(I);if(_=A,p(_))return D+k;for(;6>D.length;)D="0"+D;k=D+k}},t.i=function(I){return 0>I?0:I<this.g.length?this.g[I]:this.h};function p(I){if(I.h!=0)return!1;for(var C=0;C<I.g.length;C++)if(I.g[C]!=0)return!1;return!0}function m(I){return I.h==-1}t.l=function(I){return I=g(this,I),m(I)?-1:p(I)?0:1};function v(I){for(var C=I.g.length,_=[],k=0;k<C;k++)_[k]=~I.g[k];return new o(_,~I.h).add(d)}t.abs=function(){return m(this)?v(this):this},t.add=function(I){for(var C=Math.max(this.g.length,I.g.length),_=[],k=0,A=0;A<=C;A++){var D=k+(this.i(A)&65535)+(I.i(A)&65535),R=(D>>>16)+(this.i(A)>>>16)+(I.i(A)>>>16);k=R>>>16,D&=65535,R&=65535,_[A]=R<<16|D}return new o(_,_[_.length-1]&-2147483648?-1:0)};function g(I,C){return I.add(v(C))}t.j=function(I){if(p(this)||p(I))return h;if(m(this))return m(I)?v(this).j(v(I)):v(v(this).j(I));if(m(I))return v(this.j(v(I)));if(0>this.l(f)&&0>I.l(f))return u(this.m()*I.m());for(var C=this.g.length+I.g.length,_=[],k=0;k<2*C;k++)_[k]=0;for(k=0;k<this.g.length;k++)for(var A=0;A<I.g.length;A++){var D=this.i(k)>>>16,R=this.i(k)&65535,W=I.i(A)>>>16,B=I.i(A)&65535;_[2*k+2*A]+=R*B,w(_,2*k+2*A),_[2*k+2*A+1]+=D*B,w(_,2*k+2*A+1),_[2*k+2*A+1]+=R*W,w(_,2*k+2*A+1),_[2*k+2*A+2]+=D*W,w(_,2*k+2*A+2)}for(k=0;k<C;k++)_[k]=_[2*k+1]<<16|_[2*k];for(k=C;k<2*C;k++)_[k]=0;return new o(_,0)};function w(I,C){for(;(I[C]&65535)!=I[C];)I[C+1]+=I[C]>>>16,I[C]&=65535,C++}function b(I,C){this.g=I,this.h=C}function x(I,C){if(p(C))throw Error("division by zero");if(p(I))return new b(h,h);if(m(I))return C=x(v(I),C),new b(v(C.g),v(C.h));if(m(C))return C=x(I,v(C)),new b(v(C.g),C.h);if(30<I.g.length){if(m(I)||m(C))throw Error("slowDivide_ only works with positive integers.");for(var _=d,k=C;0>=k.l(I);)_=S(_),k=S(k);var A=N(_,1),D=N(k,1);for(k=N(k,2),_=N(_,2);!p(k);){var R=D.add(k);0>=R.l(I)&&(A=A.add(_),D=R),k=N(k,1),_=N(_,1)}return C=g(I,A.j(C)),new b(A,C)}for(A=h;0<=I.l(C);){for(_=Math.max(1,Math.floor(I.m()/C.m())),k=Math.ceil(Math.log(_)/Math.LN2),k=48>=k?1:Math.pow(2,k-48),D=u(_),R=D.j(C);m(R)||0<R.l(I);)_-=k,D=u(_),R=D.j(C);p(D)&&(D=d),A=A.add(D),I=g(I,R)}return new b(A,I)}t.A=function(I){return x(this,I).h},t.and=function(I){for(var C=Math.max(this.g.length,I.g.length),_=[],k=0;k<C;k++)_[k]=this.i(k)&I.i(k);return new o(_,this.h&I.h)},t.or=function(I){for(var C=Math.max(this.g.length,I.g.length),_=[],k=0;k<C;k++)_[k]=this.i(k)|I.i(k);return new o(_,this.h|I.h)},t.xor=function(I){for(var C=Math.max(this.g.length,I.g.length),_=[],k=0;k<C;k++)_[k]=this.i(k)^I.i(k);return new o(_,this.h^I.h)};function S(I){for(var C=I.g.length+1,_=[],k=0;k<C;k++)_[k]=I.i(k)<<1|I.i(k-1)>>>31;return new o(_,I.h)}function N(I,C){var _=C>>5;C%=32;for(var k=I.g.length-_,A=[],D=0;D<k;D++)A[D]=0<C?I.i(D+_)>>>C|I.i(D+_+1)<<32-C:I.i(D+_);return new o(A,I.h)}s.prototype.digest=s.prototype.v,s.prototype.reset=s.prototype.s,s.prototype.update=s.prototype.u,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=c,S4=o}).apply(typeof VO<"u"?VO:typeof self<"u"?self:typeof window<"u"?window:{});var $0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(y,T,$){return y==Array.prototype||y==Object.prototype||(y[T]=$.value),y};function n(y){y=[typeof globalThis=="object"&&globalThis,y,typeof window=="object"&&window,typeof self=="object"&&self,typeof $0=="object"&&$0];for(var T=0;T<y.length;++T){var $=y[T];if($&&$.Math==Math)return $}throw Error("Cannot find global object")}var s=n(this);function r(y,T){if(T)e:{var $=s;y=y.split(".");for(var F=0;F<y.length-1;F++){var te=y[F];if(!(te in $))break e;$=$[te]}y=y[y.length-1],F=$[y],T=T(F),T!=F&&T!=null&&e($,y,{configurable:!0,writable:!0,value:T})}}function i(y,T){y instanceof String&&(y+="");var $=0,F=!1,te={next:function(){if(!F&&$<y.length){var ae=$++;return{value:T(ae,y[ae]),done:!1}}return F=!0,{done:!0,value:void 0}}};return te[Symbol.iterator]=function(){return te},te}r("Array.prototype.values",function(y){return y||function(){return i(this,function(T,$){return $})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(y){var T=typeof y;return T=T!="object"?T:y?Array.isArray(y)?"array":T:"null",T=="array"||T=="object"&&typeof y.length=="number"}function u(y){var T=typeof y;return T=="object"&&y!=null||T=="function"}function c(y,T,$){return y.call.apply(y.bind,arguments)}function h(y,T,$){if(!y)throw Error();if(2<arguments.length){var F=Array.prototype.slice.call(arguments,2);return function(){var te=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(te,F),y.apply(T,te)}}return function(){return y.apply(T,arguments)}}function d(y,T,$){return d=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?c:h,d.apply(null,arguments)}function f(y,T){var $=Array.prototype.slice.call(arguments,1);return function(){var F=$.slice();return F.push.apply(F,arguments),y.apply(this,F)}}function p(y,T){function $(){}$.prototype=T.prototype,y.aa=T.prototype,y.prototype=new $,y.prototype.constructor=y,y.Qb=function(F,te,ae){for(var we=Array(arguments.length-2),Mt=2;Mt<arguments.length;Mt++)we[Mt-2]=arguments[Mt];return T.prototype[te].apply(F,we)}}function m(y){const T=y.length;if(0<T){const $=Array(T);for(let F=0;F<T;F++)$[F]=y[F];return $}return[]}function v(y,T){for(let $=1;$<arguments.length;$++){const F=arguments[$];if(l(F)){const te=y.length||0,ae=F.length||0;y.length=te+ae;for(let we=0;we<ae;we++)y[te+we]=F[we]}else y.push(F)}}class g{constructor(T,$){this.i=T,this.j=$,this.h=0,this.g=null}get(){let T;return 0<this.h?(this.h--,T=this.g,this.g=T.next,T.next=null):T=this.i(),T}}function w(y){return/^[\s\xa0]*$/.test(y)}function b(){var y=a.navigator;return y&&(y=y.userAgent)?y:""}function x(y){return x[" "](y),y}x[" "]=function(){};var S=b().indexOf("Gecko")!=-1&&!(b().toLowerCase().indexOf("webkit")!=-1&&b().indexOf("Edge")==-1)&&!(b().indexOf("Trident")!=-1||b().indexOf("MSIE")!=-1)&&b().indexOf("Edge")==-1;function N(y,T,$){for(const F in y)T.call($,y[F],F,y)}function I(y,T){for(const $ in y)T.call(void 0,y[$],$,y)}function C(y){const T={};for(const $ in y)T[$]=y[$];return T}const _="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function k(y,T){let $,F;for(let te=1;te<arguments.length;te++){F=arguments[te];for($ in F)y[$]=F[$];for(let ae=0;ae<_.length;ae++)$=_[ae],Object.prototype.hasOwnProperty.call(F,$)&&(y[$]=F[$])}}function A(y){var T=1;y=y.split(":");const $=[];for(;0<T&&y.length;)$.push(y.shift()),T--;return y.length&&$.push(y.join(":")),$}function D(y){a.setTimeout(()=>{throw y},0)}function R(){var y=Y;let T=null;return y.g&&(T=y.g,y.g=y.g.next,y.g||(y.h=null),T.next=null),T}class W{constructor(){this.h=this.g=null}add(T,$){const F=B.get();F.set(T,$),this.h?this.h.next=F:this.g=F,this.h=F}}var B=new g(()=>new M,y=>y.reset());class M{constructor(){this.next=this.g=this.h=null}set(T,$){this.h=T,this.g=$,this.next=null}reset(){this.next=this.g=this.h=null}}let X,z=!1,Y=new W,L=()=>{const y=a.Promise.resolve(void 0);X=()=>{y.then(le)}};var le=()=>{for(var y;y=R();){try{y.h.call(y.g)}catch($){D($)}var T=B;T.j(y),100>T.h&&(T.h++,y.next=T.g,T.g=y)}z=!1};function Q(){this.s=this.s,this.C=this.C}Q.prototype.s=!1,Q.prototype.ma=function(){this.s||(this.s=!0,this.N())},Q.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function se(y,T){this.type=y,this.g=this.target=T,this.defaultPrevented=!1}se.prototype.h=function(){this.defaultPrevented=!0};var de=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var y=!1,T=Object.defineProperty({},"passive",{get:function(){y=!0}});try{const $=()=>{};a.addEventListener("test",$,T),a.removeEventListener("test",$,T)}catch{}return y}();function ue(y,T){if(se.call(this,y?y.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,y){var $=this.type=y.type,F=y.changedTouches&&y.changedTouches.length?y.changedTouches[0]:null;if(this.target=y.target||y.srcElement,this.g=T,T=y.relatedTarget){if(S){e:{try{x(T.nodeName);var te=!0;break e}catch{}te=!1}te||(T=null)}}else $=="mouseover"?T=y.fromElement:$=="mouseout"&&(T=y.toElement);this.relatedTarget=T,F?(this.clientX=F.clientX!==void 0?F.clientX:F.pageX,this.clientY=F.clientY!==void 0?F.clientY:F.pageY,this.screenX=F.screenX||0,this.screenY=F.screenY||0):(this.clientX=y.clientX!==void 0?y.clientX:y.pageX,this.clientY=y.clientY!==void 0?y.clientY:y.pageY,this.screenX=y.screenX||0,this.screenY=y.screenY||0),this.button=y.button,this.key=y.key||"",this.ctrlKey=y.ctrlKey,this.altKey=y.altKey,this.shiftKey=y.shiftKey,this.metaKey=y.metaKey,this.pointerId=y.pointerId||0,this.pointerType=typeof y.pointerType=="string"?y.pointerType:fe[y.pointerType]||"",this.state=y.state,this.i=y,y.defaultPrevented&&ue.aa.h.call(this)}}p(ue,se);var fe={2:"touch",3:"pen",4:"mouse"};ue.prototype.h=function(){ue.aa.h.call(this);var y=this.i;y.preventDefault?y.preventDefault():y.returnValue=!1};var ve="closure_listenable_"+(1e6*Math.random()|0),De=0;function Ie(y,T,$,F,te){this.listener=y,this.proxy=null,this.src=T,this.type=$,this.capture=!!F,this.ha=te,this.key=++De,this.da=this.fa=!1}function Oe(y){y.da=!0,y.listener=null,y.proxy=null,y.src=null,y.ha=null}function ze(y){this.src=y,this.g={},this.h=0}ze.prototype.add=function(y,T,$,F,te){var ae=y.toString();y=this.g[ae],y||(y=this.g[ae]=[],this.h++);var we=Qe(y,T,F,te);return-1<we?(T=y[we],$||(T.fa=!1)):(T=new Ie(T,this.src,ae,!!F,te),T.fa=$,y.push(T)),T};function Ye(y,T){var $=T.type;if($ in y.g){var F=y.g[$],te=Array.prototype.indexOf.call(F,T,void 0),ae;(ae=0<=te)&&Array.prototype.splice.call(F,te,1),ae&&(Oe(T),y.g[$].length==0&&(delete y.g[$],y.h--))}}function Qe(y,T,$,F){for(var te=0;te<y.length;++te){var ae=y[te];if(!ae.da&&ae.listener==T&&ae.capture==!!$&&ae.ha==F)return te}return-1}var xt="closure_lm_"+(1e6*Math.random()|0),ft={};function at(y,T,$,F,te){if(Array.isArray(T)){for(var ae=0;ae<T.length;ae++)at(y,T[ae],$,F,te);return null}return $=ln($),y&&y[ve]?y.K(T,$,u(F)?!!F.capture:!!F,te):Ct(y,T,$,!1,F,te)}function Ct(y,T,$,F,te,ae){if(!T)throw Error("Invalid event type");var we=u(te)?!!te.capture:!!te,Mt=ms(y);if(Mt||(y[xt]=Mt=new ze(y)),$=Mt.add(T,$,F,we,ae),$.proxy)return $;if(F=vt(),$.proxy=F,F.src=y,F.listener=$,y.addEventListener)de||(te=we),te===void 0&&(te=!1),y.addEventListener(T.toString(),F,te);else if(y.attachEvent)y.attachEvent(an(T.toString()),F);else if(y.addListener&&y.removeListener)y.addListener(F);else throw Error("addEventListener and attachEvent are unavailable.");return $}function vt(){function y($){return T.call(y.src,y.listener,$)}const T=Wt;return y}function Jn(y,T,$,F,te){if(Array.isArray(T))for(var ae=0;ae<T.length;ae++)Jn(y,T[ae],$,F,te);else F=u(F)?!!F.capture:!!F,$=ln($),y&&y[ve]?(y=y.i,T=String(T).toString(),T in y.g&&(ae=y.g[T],$=Qe(ae,$,F,te),-1<$&&(Oe(ae[$]),Array.prototype.splice.call(ae,$,1),ae.length==0&&(delete y.g[T],y.h--)))):y&&(y=ms(y))&&(T=y.g[T.toString()],y=-1,T&&(y=Qe(T,$,F,te)),($=-1<y?T[y]:null)&&Ut($))}function Ut(y){if(typeof y!="number"&&y&&!y.da){var T=y.src;if(T&&T[ve])Ye(T.i,y);else{var $=y.type,F=y.proxy;T.removeEventListener?T.removeEventListener($,F,y.capture):T.detachEvent?T.detachEvent(an($),F):T.addListener&&T.removeListener&&T.removeListener(F),($=ms(T))?(Ye($,y),$.h==0&&($.src=null,T[xt]=null)):Oe(y)}}}function an(y){return y in ft?ft[y]:ft[y]="on"+y}function Wt(y,T){if(y.da)y=!0;else{T=new ue(T,this);var $=y.listener,F=y.ha||y.src;y.fa&&Ut(y),y=$.call(F,T)}return y}function ms(y){return y=y[xt],y instanceof ze?y:null}var In="__closure_events_fn_"+(1e9*Math.random()>>>0);function ln(y){return typeof y=="function"?y:(y[In]||(y[In]=function(T){return y.handleEvent(T)}),y[In])}function nt(){Q.call(this),this.i=new ze(this),this.M=this,this.F=null}p(nt,Q),nt.prototype[ve]=!0,nt.prototype.removeEventListener=function(y,T,$,F){Jn(this,y,T,$,F)};function Nt(y,T){var $,F=y.F;if(F)for($=[];F;F=F.F)$.push(F);if(y=y.M,F=T.type||T,typeof T=="string")T=new se(T,y);else if(T instanceof se)T.target=T.target||y;else{var te=T;T=new se(F,y),k(T,te)}if(te=!0,$)for(var ae=$.length-1;0<=ae;ae--){var we=T.g=$[ae];te=fn(we,F,!0,T)&&te}if(we=T.g=y,te=fn(we,F,!0,T)&&te,te=fn(we,F,!1,T)&&te,$)for(ae=0;ae<$.length;ae++)we=T.g=$[ae],te=fn(we,F,!1,T)&&te}nt.prototype.N=function(){if(nt.aa.N.call(this),this.i){var y=this.i,T;for(T in y.g){for(var $=y.g[T],F=0;F<$.length;F++)Oe($[F]);delete y.g[T],y.h--}}this.F=null},nt.prototype.K=function(y,T,$,F){return this.i.add(String(y),T,!1,$,F)},nt.prototype.L=function(y,T,$,F){return this.i.add(String(y),T,!0,$,F)};function fn(y,T,$,F){if(T=y.i.g[String(T)],!T)return!0;T=T.concat();for(var te=!0,ae=0;ae<T.length;++ae){var we=T[ae];if(we&&!we.da&&we.capture==$){var Mt=we.listener,gs=we.ha||we.src;we.fa&&Ye(y.i,we),te=Mt.call(gs,F)!==!1&&te}}return te&&!F.defaultPrevented}function jr(y,T,$){if(typeof y=="function")$&&(y=d(y,$));else if(y&&typeof y.handleEvent=="function")y=d(y.handleEvent,y);else throw Error("Invalid listener argument");return 2147483647<Number(T)?-1:a.setTimeout(y,T||0)}function Bs(y){y.g=jr(()=>{y.g=null,y.i&&(y.i=!1,Bs(y))},y.l);const T=y.h;y.h=null,y.m.apply(null,T)}class Ea extends Q{constructor(T,$){super(),this.m=T,this.l=$,this.h=null,this.i=!1,this.g=null}j(T){this.h=arguments,this.g?this.i=!0:Bs(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ji(y){Q.call(this),this.h=y,this.g={}}p(Ji,Q);var Zi=[];function zc(y){N(y.g,function(T,$){this.g.hasOwnProperty($)&&Ut(T)},y),y.g={}}Ji.prototype.N=function(){Ji.aa.N.call(this),zc(this)},Ji.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Na=a.JSON.stringify,Bc=a.JSON.parse,qy=class{stringify(y){return a.JSON.stringify(y,void 0)}parse(y){return a.JSON.parse(y,void 0)}};function tu(){}tu.prototype.h=null;function Ky(y){return y.h||(y.h=y.i())}function Xy(){}var nu={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Vc(){se.call(this,"d")}p(Vc,se);function $a(){se.call(this,"c")}p($a,se);var pi={},Yy=null;function Af(){return Yy=Yy||new nt}pi.La="serverreachability";function K(y){se.call(this,pi.La,y)}p(K,se);function ee(y){const T=Af();Nt(T,new K(T))}pi.STAT_EVENT="statevent";function oe(y,T){se.call(this,pi.STAT_EVENT,y),this.stat=T}p(oe,se);function ce(y){const T=Af();Nt(T,new oe(T,y))}pi.Ma="timingevent";function ke(y,T){se.call(this,pi.Ma,y),this.size=T}p(ke,se);function Pe(y,T){if(typeof y!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){y()},T)}function Be(){this.g=!0}Be.prototype.xa=function(){this.g=!1};function $e(y,T,$,F,te,ae){y.info(function(){if(y.g)if(ae)for(var we="",Mt=ae.split("&"),gs=0;gs<Mt.length;gs++){var bt=Mt[gs].split("=");if(1<bt.length){var _s=bt[0];bt=bt[1];var Ts=_s.split("_");we=2<=Ts.length&&Ts[1]=="type"?we+(_s+"="+bt+"&"):we+(_s+"=redacted&")}}else we=null;else we=ae;return"XMLHTTP REQ ("+F+") [attempt "+te+"]: "+T+`
`+$+`
`+we})}function Fe(y,T,$,F,te,ae,we){y.info(function(){return"XMLHTTP RESP ("+F+") [ attempt "+te+"]: "+T+`
`+$+`
`+ae+" "+we})}function Ce(y,T,$,F){y.info(function(){return"XMLHTTP TEXT ("+T+"): "+tt(y,$)+(F?" "+F:"")})}function He(y,T){y.info(function(){return"TIMEOUT: "+T})}Be.prototype.info=function(){};function tt(y,T){if(!y.g)return T;if(!T)return null;try{var $=JSON.parse(T);if($){for(y=0;y<$.length;y++)if(Array.isArray($[y])){var F=$[y];if(!(2>F.length)){var te=F[1];if(Array.isArray(te)&&!(1>te.length)){var ae=te[0];if(ae!="noop"&&ae!="stop"&&ae!="close")for(var we=1;we<te.length;we++)te[we]=""}}}}return Na($)}catch{return T}}var Dt={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},zn={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Lt;function It(){}p(It,tu),It.prototype.g=function(){return new XMLHttpRequest},It.prototype.i=function(){return{}},Lt=new It;function Ot(y,T,$,F){this.j=y,this.i=T,this.l=$,this.R=F||1,this.U=new Ji(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new $o}function $o(){this.i=null,this.g="",this.h=!1}var Ra={},Ir={};function sr(y,T,$){y.L=1,y.v=e0(Po(T)),y.m=$,y.P=!0,Uc(y,null)}function Uc(y,T){y.F=Date.now(),Ao(y),y.A=Po(y.v);var $=y.A,F=y.R;Array.isArray(F)||(F=[String(F)]),DR($.i,"t",F),y.C=0,$=y.j.J,y.h=new $o,y.g=QR(y.j,$?T:null,!y.m),0<y.O&&(y.M=new Ea(d(y.Y,y,y.g),y.O)),T=y.U,$=y.g,F=y.ca;var te="readystatechange";Array.isArray(te)||(te&&(Zi[0]=te.toString()),te=Zi);for(var ae=0;ae<te.length;ae++){var we=at($,te[ae],F||T.handleEvent,!1,T.h||T);if(!we)break;T.g[we.key]=we}T=y.H?C(y.H):{},y.m?(y.u||(y.u="POST"),T["Content-Type"]="application/x-www-form-urlencoded",y.g.ea(y.A,y.u,y.m,T)):(y.u="GET",y.g.ea(y.A,y.u,null,T)),ee(),$e(y.i,y.u,y.A,y.l,y.R,y.m)}Ot.prototype.ca=function(y){y=y.target;const T=this.M;T&&Fo(y)==3?T.j():this.Y(y)},Ot.prototype.Y=function(y){try{if(y==this.g)e:{const Ts=Fo(this.g);var T=this.g.Ba();const Gc=this.g.Z();if(!(3>Ts)&&(Ts!=3||this.g&&(this.h.h||this.g.oa()||BR(this.g)))){this.J||Ts!=4||T==7||(T==8||0>=Gc?ee(3):ee(2)),_t(this);var $=this.g.Z();this.X=$;t:if(Aa(this)){var F=BR(this.g);y="";var te=F.length,ae=Fo(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Gr(this),pn(this);var we="";break t}this.h.i=new a.TextDecoder}for(T=0;T<te;T++)this.h.h=!0,y+=this.h.i.decode(F[T],{stream:!(ae&&T==te-1)});F.length=0,this.h.g+=y,this.C=0,we=this.h.g}else we=this.g.oa();if(this.o=$==200,Fe(this.i,this.u,this.A,this.l,this.R,Ts,$),this.o){if(this.T&&!this.K){t:{if(this.g){var Mt,gs=this.g;if((Mt=gs.g?gs.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!w(Mt)){var bt=Mt;break t}}bt=null}if($=bt)Ce(this.i,this.l,$,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Do(this,$);else{this.o=!1,this.s=3,ce(12),Gr(this),pn(this);break e}}if(this.P){$=!0;let mi;for(;!this.J&&this.C<we.length;)if(mi=Ro(this,we),mi==Ir){Ts==4&&(this.s=4,ce(14),$=!1),Ce(this.i,this.l,null,"[Incomplete Response]");break}else if(mi==Ra){this.s=4,ce(15),Ce(this.i,this.l,we,"[Invalid Chunk]"),$=!1;break}else Ce(this.i,this.l,mi,null),Do(this,mi);if(Aa(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ts!=4||we.length!=0||this.h.h||(this.s=1,ce(16),$=!1),this.o=this.o&&$,!$)Ce(this.i,this.l,we,"[Invalid Chunked Response]"),Gr(this),pn(this);else if(0<we.length&&!this.W){this.W=!0;var _s=this.j;_s.g==this&&_s.ba&&!_s.M&&(_s.j.info("Great, no buffering proxy detected. Bytes received: "+we.length),gS(_s),_s.M=!0,ce(11))}}else Ce(this.i,this.l,we,null),Do(this,we);Ts==4&&Gr(this),this.o&&!this.J&&(Ts==4?qR(this.j,this):(this.o=!1,Ao(this)))}else a6(this.g),$==400&&0<we.indexOf("Unknown SID")?(this.s=3,ce(12)):(this.s=0,ce(13)),Gr(this),pn(this)}}}catch{}finally{}};function Aa(y){return y.g?y.u=="GET"&&y.L!=2&&y.j.Ca:!1}function Ro(y,T){var $=y.C,F=T.indexOf(`
`,$);return F==-1?Ir:($=Number(T.substring($,F)),isNaN($)?Ra:(F+=1,F+$>T.length?Ir:(T=T.slice(F,F+$),y.C=F+$,T)))}Ot.prototype.cancel=function(){this.J=!0,Gr(this)};function Ao(y){y.S=Date.now()+y.I,su(y,y.I)}function su(y,T){if(y.B!=null)throw Error("WatchDog timer not null");y.B=Pe(d(y.ba,y),T)}function _t(y){y.B&&(a.clearTimeout(y.B),y.B=null)}Ot.prototype.ba=function(){this.B=null;const y=Date.now();0<=y-this.S?(He(this.i,this.A),this.L!=2&&(ee(),ce(17)),Gr(this),this.s=2,pn(this)):su(this,this.S-y)};function pn(y){y.j.G==0||y.J||qR(y.j,y)}function Gr(y){_t(y);var T=y.M;T&&typeof T.ma=="function"&&T.ma(),y.M=null,zc(y.U),y.g&&(T=y.g,y.g=null,T.abort(),T.ma())}function Do(y,T){try{var $=y.j;if($.G!=0&&($.g==y||hS($.h,y))){if(!y.K&&hS($.h,y)&&$.G==3){try{var F=$.Da.g.parse(T)}catch{F=null}if(Array.isArray(F)&&F.length==3){var te=F;if(te[0]==0){e:if(!$.u){if($.g)if($.g.F+3e3<y.F)o0($),r0($);else break e;mS($),ce(18)}}else $.za=te[1],0<$.za-$.T&&37500>te[2]&&$.F&&$.v==0&&!$.C&&($.C=Pe(d($.Za,$),6e3));if(1>=Qy($.h)&&$.ca){try{$.ca()}catch{}$.ca=void 0}}else iu($,11)}else if((y.K||$.g==y)&&o0($),!w(T))for(te=$.Da.g.parse(T),T=0;T<te.length;T++){let bt=te[T];if($.T=bt[0],bt=bt[1],$.G==2)if(bt[0]=="c"){$.K=bt[1],$.ia=bt[2];const _s=bt[3];_s!=null&&($.la=_s,$.j.info("VER="+$.la));const Ts=bt[4];Ts!=null&&($.Aa=Ts,$.j.info("SVER="+$.Aa));const Gc=bt[5];Gc!=null&&typeof Gc=="number"&&0<Gc&&(F=1.5*Gc,$.L=F,$.j.info("backChannelRequestTimeoutMs_="+F)),F=$;const mi=y.g;if(mi){const a0=mi.g?mi.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(a0){var ae=F.h;ae.g||a0.indexOf("spdy")==-1&&a0.indexOf("quic")==-1&&a0.indexOf("h2")==-1||(ae.j=ae.l,ae.g=new Set,ae.h&&(dS(ae,ae.h),ae.h=null))}if(F.D){const yS=mi.g?mi.g.getResponseHeader("X-HTTP-Session-Id"):null;yS&&(F.ya=yS,Xt(F.I,F.D,yS))}}$.G=3,$.l&&$.l.ua(),$.ba&&($.R=Date.now()-y.F,$.j.info("Handshake RTT: "+$.R+"ms")),F=$;var we=y;if(F.qa=YR(F,F.J?F.ia:null,F.W),we.K){_R(F.h,we);var Mt=we,gs=F.L;gs&&(Mt.I=gs),Mt.B&&(_t(Mt),Ao(Mt)),F.g=we}else GR(F);0<$.i.length&&i0($)}else bt[0]!="stop"&&bt[0]!="close"||iu($,7);else $.G==3&&(bt[0]=="stop"||bt[0]=="close"?bt[0]=="stop"?iu($,7):pS($):bt[0]!="noop"&&$.l&&$.l.ta(bt),$.v=0)}}ee(4)}catch{}}var mn=class{constructor(y,T){this.g=y,this.map=T}};function Oo(y){this.l=y||10,a.PerformanceNavigationTiming?(y=a.performance.getEntriesByType("navigation"),y=0<y.length&&(y[0].nextHopProtocol=="hq"||y[0].nextHopProtocol=="h2")):y=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=y?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Df(y){return y.h?!0:y.g?y.g.size>=y.j:!1}function Qy(y){return y.h?1:y.g?y.g.size:0}function hS(y,T){return y.h?y.h==T:y.g?y.g.has(T):!1}function dS(y,T){y.g?y.g.add(T):y.h=T}function _R(y,T){y.h&&y.h==T?y.h=null:y.g&&y.g.has(T)&&y.g.delete(T)}Oo.prototype.cancel=function(){if(this.i=TR(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const y of this.g.values())y.cancel();this.g.clear()}};function TR(y){if(y.h!=null)return y.i.concat(y.h.D);if(y.g!=null&&y.g.size!==0){let T=y.i;for(const $ of y.g.values())T=T.concat($.D);return T}return m(y.i)}function HH(y){if(y.V&&typeof y.V=="function")return y.V();if(typeof Map<"u"&&y instanceof Map||typeof Set<"u"&&y instanceof Set)return Array.from(y.values());if(typeof y=="string")return y.split("");if(l(y)){for(var T=[],$=y.length,F=0;F<$;F++)T.push(y[F]);return T}T=[],$=0;for(F in y)T[$++]=y[F];return T}function qH(y){if(y.na&&typeof y.na=="function")return y.na();if(!y.V||typeof y.V!="function"){if(typeof Map<"u"&&y instanceof Map)return Array.from(y.keys());if(!(typeof Set<"u"&&y instanceof Set)){if(l(y)||typeof y=="string"){var T=[];y=y.length;for(var $=0;$<y;$++)T.push($);return T}T=[],$=0;for(const F in y)T[$++]=F;return T}}}function kR(y,T){if(y.forEach&&typeof y.forEach=="function")y.forEach(T,void 0);else if(l(y)||typeof y=="string")Array.prototype.forEach.call(y,T,void 0);else for(var $=qH(y),F=HH(y),te=F.length,ae=0;ae<te;ae++)T.call(void 0,F[ae],$&&$[ae],y)}var ER=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function KH(y,T){if(y){y=y.split("&");for(var $=0;$<y.length;$++){var F=y[$].indexOf("="),te=null;if(0<=F){var ae=y[$].substring(0,F);te=y[$].substring(F+1)}else ae=y[$];T(ae,te?decodeURIComponent(te.replace(/\+/g," ")):"")}}}function ru(y){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,y instanceof ru){this.h=y.h,Jy(this,y.j),this.o=y.o,this.g=y.g,Zy(this,y.s),this.l=y.l;var T=y.i,$=new Ff;$.i=T.i,T.g&&($.g=new Map(T.g),$.h=T.h),NR(this,$),this.m=y.m}else y&&(T=String(y).match(ER))?(this.h=!1,Jy(this,T[1]||"",!0),this.o=Of(T[2]||""),this.g=Of(T[3]||"",!0),Zy(this,T[4]),this.l=Of(T[5]||"",!0),NR(this,T[6]||"",!0),this.m=Of(T[7]||"")):(this.h=!1,this.i=new Ff(null,this.h))}ru.prototype.toString=function(){var y=[],T=this.j;T&&y.push(Pf(T,$R,!0),":");var $=this.g;return($||T=="file")&&(y.push("//"),(T=this.o)&&y.push(Pf(T,$R,!0),"@"),y.push(encodeURIComponent(String($)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),$=this.s,$!=null&&y.push(":",String($))),($=this.l)&&(this.g&&$.charAt(0)!="/"&&y.push("/"),y.push(Pf($,$.charAt(0)=="/"?QH:YH,!0))),($=this.i.toString())&&y.push("?",$),($=this.m)&&y.push("#",Pf($,ZH)),y.join("")};function Po(y){return new ru(y)}function Jy(y,T,$){y.j=$?Of(T,!0):T,y.j&&(y.j=y.j.replace(/:$/,""))}function Zy(y,T){if(T){if(T=Number(T),isNaN(T)||0>T)throw Error("Bad port number "+T);y.s=T}else y.s=null}function NR(y,T,$){T instanceof Ff?(y.i=T,e6(y.i,y.h)):($||(T=Pf(T,JH)),y.i=new Ff(T,y.h))}function Xt(y,T,$){y.i.set(T,$)}function e0(y){return Xt(y,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),y}function Of(y,T){return y?T?decodeURI(y.replace(/%25/g,"%2525")):decodeURIComponent(y):""}function Pf(y,T,$){return typeof y=="string"?(y=encodeURI(y).replace(T,XH),$&&(y=y.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y):null}function XH(y){return y=y.charCodeAt(0),"%"+(y>>4&15).toString(16)+(y&15).toString(16)}var $R=/[#\/\?@]/g,YH=/[#\?:]/g,QH=/[#\?]/g,JH=/[#\?@]/g,ZH=/#/g;function Ff(y,T){this.h=this.g=null,this.i=y||null,this.j=!!T}function Da(y){y.g||(y.g=new Map,y.h=0,y.i&&KH(y.i,function(T,$){y.add(decodeURIComponent(T.replace(/\+/g," ")),$)}))}t=Ff.prototype,t.add=function(y,T){Da(this),this.i=null,y=Wc(this,y);var $=this.g.get(y);return $||this.g.set(y,$=[]),$.push(T),this.h+=1,this};function RR(y,T){Da(y),T=Wc(y,T),y.g.has(T)&&(y.i=null,y.h-=y.g.get(T).length,y.g.delete(T))}function AR(y,T){return Da(y),T=Wc(y,T),y.g.has(T)}t.forEach=function(y,T){Da(this),this.g.forEach(function($,F){$.forEach(function(te){y.call(T,te,F,this)},this)},this)},t.na=function(){Da(this);const y=Array.from(this.g.values()),T=Array.from(this.g.keys()),$=[];for(let F=0;F<T.length;F++){const te=y[F];for(let ae=0;ae<te.length;ae++)$.push(T[F])}return $},t.V=function(y){Da(this);let T=[];if(typeof y=="string")AR(this,y)&&(T=T.concat(this.g.get(Wc(this,y))));else{y=Array.from(this.g.values());for(let $=0;$<y.length;$++)T=T.concat(y[$])}return T},t.set=function(y,T){return Da(this),this.i=null,y=Wc(this,y),AR(this,y)&&(this.h-=this.g.get(y).length),this.g.set(y,[T]),this.h+=1,this},t.get=function(y,T){return y?(y=this.V(y),0<y.length?String(y[0]):T):T};function DR(y,T,$){RR(y,T),0<$.length&&(y.i=null,y.g.set(Wc(y,T),m($)),y.h+=$.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const y=[],T=Array.from(this.g.keys());for(var $=0;$<T.length;$++){var F=T[$];const ae=encodeURIComponent(String(F)),we=this.V(F);for(F=0;F<we.length;F++){var te=ae;we[F]!==""&&(te+="="+encodeURIComponent(String(we[F]))),y.push(te)}}return this.i=y.join("&")};function Wc(y,T){return T=String(T),y.j&&(T=T.toLowerCase()),T}function e6(y,T){T&&!y.j&&(Da(y),y.i=null,y.g.forEach(function($,F){var te=F.toLowerCase();F!=te&&(RR(this,F),DR(this,te,$))},y)),y.j=T}function t6(y,T){const $=new Be;if(a.Image){const F=new Image;F.onload=f(Oa,$,"TestLoadImage: loaded",!0,T,F),F.onerror=f(Oa,$,"TestLoadImage: error",!1,T,F),F.onabort=f(Oa,$,"TestLoadImage: abort",!1,T,F),F.ontimeout=f(Oa,$,"TestLoadImage: timeout",!1,T,F),a.setTimeout(function(){F.ontimeout&&F.ontimeout()},1e4),F.src=y}else T(!1)}function n6(y,T){const $=new Be,F=new AbortController,te=setTimeout(()=>{F.abort(),Oa($,"TestPingServer: timeout",!1,T)},1e4);fetch(y,{signal:F.signal}).then(ae=>{clearTimeout(te),ae.ok?Oa($,"TestPingServer: ok",!0,T):Oa($,"TestPingServer: server error",!1,T)}).catch(()=>{clearTimeout(te),Oa($,"TestPingServer: error",!1,T)})}function Oa(y,T,$,F,te){try{te&&(te.onload=null,te.onerror=null,te.onabort=null,te.ontimeout=null),F($)}catch{}}function s6(){this.g=new qy}function r6(y,T,$){const F=$||"";try{kR(y,function(te,ae){let we=te;u(te)&&(we=Na(te)),T.push(F+ae+"="+encodeURIComponent(we))})}catch(te){throw T.push(F+"type="+encodeURIComponent("_badmap")),te}}function t0(y){this.l=y.Ub||null,this.j=y.eb||!1}p(t0,tu),t0.prototype.g=function(){return new n0(this.l,this.j)},t0.prototype.i=function(y){return function(){return y}}({});function n0(y,T){nt.call(this),this.D=y,this.o=T,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}p(n0,nt),t=n0.prototype,t.open=function(y,T){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=y,this.A=T,this.readyState=1,Mf(this)},t.send=function(y){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const T={headers:this.u,method:this.B,credentials:this.m,cache:void 0};y&&(T.body=y),(this.D||a).fetch(new Request(this.A,T)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Lf(this)),this.readyState=0},t.Sa=function(y){if(this.g&&(this.l=y,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=y.headers,this.readyState=2,Mf(this)),this.g&&(this.readyState=3,Mf(this),this.g)))if(this.responseType==="arraybuffer")y.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in y){if(this.j=y.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;OR(this)}else y.text().then(this.Ra.bind(this),this.ga.bind(this))};function OR(y){y.j.read().then(y.Pa.bind(y)).catch(y.ga.bind(y))}t.Pa=function(y){if(this.g){if(this.o&&y.value)this.response.push(y.value);else if(!this.o){var T=y.value?y.value:new Uint8Array(0);(T=this.v.decode(T,{stream:!y.done}))&&(this.response=this.responseText+=T)}y.done?Lf(this):Mf(this),this.readyState==3&&OR(this)}},t.Ra=function(y){this.g&&(this.response=this.responseText=y,Lf(this))},t.Qa=function(y){this.g&&(this.response=y,Lf(this))},t.ga=function(){this.g&&Lf(this)};function Lf(y){y.readyState=4,y.l=null,y.j=null,y.v=null,Mf(y)}t.setRequestHeader=function(y,T){this.u.append(y,T)},t.getResponseHeader=function(y){return this.h&&this.h.get(y.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const y=[],T=this.h.entries();for(var $=T.next();!$.done;)$=$.value,y.push($[0]+": "+$[1]),$=T.next();return y.join(`\r
`)};function Mf(y){y.onreadystatechange&&y.onreadystatechange.call(y)}Object.defineProperty(n0.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(y){this.m=y?"include":"same-origin"}});function PR(y){let T="";return N(y,function($,F){T+=F,T+=":",T+=$,T+=`\r
`}),T}function fS(y,T,$){e:{for(F in $){var F=!1;break e}F=!0}F||($=PR($),typeof y=="string"?$!=null&&encodeURIComponent(String($)):Xt(y,T,$))}function _n(y){nt.call(this),this.headers=new Map,this.o=y||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}p(_n,nt);var i6=/^https?$/i,o6=["POST","PUT"];t=_n.prototype,t.Ha=function(y){this.J=y},t.ea=function(y,T,$,F){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+y);T=T?T.toUpperCase():"GET",this.D=y,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Lt.g(),this.v=this.o?Ky(this.o):Ky(Lt),this.g.onreadystatechange=d(this.Ea,this);try{this.B=!0,this.g.open(T,String(y),!0),this.B=!1}catch(ae){FR(this,ae);return}if(y=$||"",$=new Map(this.headers),F)if(Object.getPrototypeOf(F)===Object.prototype)for(var te in F)$.set(te,F[te]);else if(typeof F.keys=="function"&&typeof F.get=="function")for(const ae of F.keys())$.set(ae,F.get(ae));else throw Error("Unknown input type for opt_headers: "+String(F));F=Array.from($.keys()).find(ae=>ae.toLowerCase()=="content-type"),te=a.FormData&&y instanceof a.FormData,!(0<=Array.prototype.indexOf.call(o6,T,void 0))||F||te||$.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ae,we]of $)this.g.setRequestHeader(ae,we);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{zR(this),this.u=!0,this.g.send(y),this.u=!1}catch(ae){FR(this,ae)}};function FR(y,T){y.h=!1,y.g&&(y.j=!0,y.g.abort(),y.j=!1),y.l=T,y.m=5,LR(y),s0(y)}function LR(y){y.A||(y.A=!0,Nt(y,"complete"),Nt(y,"error"))}t.abort=function(y){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=y||7,Nt(this,"complete"),Nt(this,"abort"),s0(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),s0(this,!0)),_n.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?MR(this):this.bb())},t.bb=function(){MR(this)};function MR(y){if(y.h&&typeof o<"u"&&(!y.v[1]||Fo(y)!=4||y.Z()!=2)){if(y.u&&Fo(y)==4)jr(y.Ea,0,y);else if(Nt(y,"readystatechange"),Fo(y)==4){y.h=!1;try{const we=y.Z();e:switch(we){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var T=!0;break e;default:T=!1}var $;if(!($=T)){var F;if(F=we===0){var te=String(y.D).match(ER)[1]||null;!te&&a.self&&a.self.location&&(te=a.self.location.protocol.slice(0,-1)),F=!i6.test(te?te.toLowerCase():"")}$=F}if($)Nt(y,"complete"),Nt(y,"success");else{y.m=6;try{var ae=2<Fo(y)?y.g.statusText:""}catch{ae=""}y.l=ae+" ["+y.Z()+"]",LR(y)}}finally{s0(y)}}}}function s0(y,T){if(y.g){zR(y);const $=y.g,F=y.v[0]?()=>{}:null;y.g=null,y.v=null,T||Nt(y,"ready");try{$.onreadystatechange=F}catch{}}}function zR(y){y.I&&(a.clearTimeout(y.I),y.I=null)}t.isActive=function(){return!!this.g};function Fo(y){return y.g?y.g.readyState:0}t.Z=function(){try{return 2<Fo(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(y){if(this.g){var T=this.g.responseText;return y&&T.indexOf(y)==0&&(T=T.substring(y.length)),Bc(T)}};function BR(y){try{if(!y.g)return null;if("response"in y.g)return y.g.response;switch(y.H){case"":case"text":return y.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in y.g)return y.g.mozResponseArrayBuffer}return null}catch{return null}}function a6(y){const T={};y=(y.g&&2<=Fo(y)&&y.g.getAllResponseHeaders()||"").split(`\r
`);for(let F=0;F<y.length;F++){if(w(y[F]))continue;var $=A(y[F]);const te=$[0];if($=$[1],typeof $!="string")continue;$=$.trim();const ae=T[te]||[];T[te]=ae,ae.push($)}I(T,function(F){return F.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function zf(y,T,$){return $&&$.internalChannelParams&&$.internalChannelParams[y]||T}function VR(y){this.Aa=0,this.i=[],this.j=new Be,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=zf("failFast",!1,y),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=zf("baseRetryDelayMs",5e3,y),this.cb=zf("retryDelaySeedMs",1e4,y),this.Wa=zf("forwardChannelMaxRetries",2,y),this.wa=zf("forwardChannelRequestTimeoutMs",2e4,y),this.pa=y&&y.xmlHttpFactory||void 0,this.Xa=y&&y.Tb||void 0,this.Ca=y&&y.useFetchStreams||!1,this.L=void 0,this.J=y&&y.supportsCrossDomainXhr||!1,this.K="",this.h=new Oo(y&&y.concurrentRequestLimit),this.Da=new s6,this.P=y&&y.fastHandshake||!1,this.O=y&&y.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=y&&y.Rb||!1,y&&y.xa&&this.j.xa(),y&&y.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&y&&y.detectBufferingProxy||!1,this.ja=void 0,y&&y.longPollingTimeout&&0<y.longPollingTimeout&&(this.ja=y.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=VR.prototype,t.la=8,t.G=1,t.connect=function(y,T,$,F){ce(0),this.W=y,this.H=T||{},$&&F!==void 0&&(this.H.OSID=$,this.H.OAID=F),this.F=this.X,this.I=YR(this,null,this.W),i0(this)};function pS(y){if(UR(y),y.G==3){var T=y.U++,$=Po(y.I);if(Xt($,"SID",y.K),Xt($,"RID",T),Xt($,"TYPE","terminate"),Bf(y,$),T=new Ot(y,y.j,T),T.L=2,T.v=e0(Po($)),$=!1,a.navigator&&a.navigator.sendBeacon)try{$=a.navigator.sendBeacon(T.v.toString(),"")}catch{}!$&&a.Image&&(new Image().src=T.v,$=!0),$||(T.g=QR(T.j,null),T.g.ea(T.v)),T.F=Date.now(),Ao(T)}XR(y)}function r0(y){y.g&&(gS(y),y.g.cancel(),y.g=null)}function UR(y){r0(y),y.u&&(a.clearTimeout(y.u),y.u=null),o0(y),y.h.cancel(),y.s&&(typeof y.s=="number"&&a.clearTimeout(y.s),y.s=null)}function i0(y){if(!Df(y.h)&&!y.s){y.s=!0;var T=y.Ga;X||L(),z||(X(),z=!0),Y.add(T,y),y.B=0}}function l6(y,T){return Qy(y.h)>=y.h.j-(y.s?1:0)?!1:y.s?(y.i=T.D.concat(y.i),!0):y.G==1||y.G==2||y.B>=(y.Va?0:y.Wa)?!1:(y.s=Pe(d(y.Ga,y,T),KR(y,y.B)),y.B++,!0)}t.Ga=function(y){if(this.s)if(this.s=null,this.G==1){if(!y){this.U=Math.floor(1e5*Math.random()),y=this.U++;const te=new Ot(this,this.j,y);let ae=this.o;if(this.S&&(ae?(ae=C(ae),k(ae,this.S)):ae=this.S),this.m!==null||this.O||(te.H=ae,ae=null),this.P)e:{for(var T=0,$=0;$<this.i.length;$++){t:{var F=this.i[$];if("__data__"in F.map&&(F=F.map.__data__,typeof F=="string")){F=F.length;break t}F=void 0}if(F===void 0)break;if(T+=F,4096<T){T=$;break e}if(T===4096||$===this.i.length-1){T=$+1;break e}}T=1e3}else T=1e3;T=jR(this,te,T),$=Po(this.I),Xt($,"RID",y),Xt($,"CVER",22),this.D&&Xt($,"X-HTTP-Session-Id",this.D),Bf(this,$),ae&&(this.O?T="headers="+encodeURIComponent(String(PR(ae)))+"&"+T:this.m&&fS($,this.m,ae)),dS(this.h,te),this.Ua&&Xt($,"TYPE","init"),this.P?(Xt($,"$req",T),Xt($,"SID","null"),te.T=!0,sr(te,$,null)):sr(te,$,T),this.G=2}}else this.G==3&&(y?WR(this,y):this.i.length==0||Df(this.h)||WR(this))};function WR(y,T){var $;T?$=T.l:$=y.U++;const F=Po(y.I);Xt(F,"SID",y.K),Xt(F,"RID",$),Xt(F,"AID",y.T),Bf(y,F),y.m&&y.o&&fS(F,y.m,y.o),$=new Ot(y,y.j,$,y.B+1),y.m===null&&($.H=y.o),T&&(y.i=T.D.concat(y.i)),T=jR(y,$,1e3),$.I=Math.round(.5*y.wa)+Math.round(.5*y.wa*Math.random()),dS(y.h,$),sr($,F,T)}function Bf(y,T){y.H&&N(y.H,function($,F){Xt(T,F,$)}),y.l&&kR({},function($,F){Xt(T,F,$)})}function jR(y,T,$){$=Math.min(y.i.length,$);var F=y.l?d(y.l.Na,y.l,y):null;e:{var te=y.i;let ae=-1;for(;;){const we=["count="+$];ae==-1?0<$?(ae=te[0].g,we.push("ofs="+ae)):ae=0:we.push("ofs="+ae);let Mt=!0;for(let gs=0;gs<$;gs++){let bt=te[gs].g;const _s=te[gs].map;if(bt-=ae,0>bt)ae=Math.max(0,te[gs].g-100),Mt=!1;else try{r6(_s,we,"req"+bt+"_")}catch{F&&F(_s)}}if(Mt){F=we.join("&");break e}}}return y=y.i.splice(0,$),T.D=y,F}function GR(y){if(!y.g&&!y.u){y.Y=1;var T=y.Fa;X||L(),z||(X(),z=!0),Y.add(T,y),y.v=0}}function mS(y){return y.g||y.u||3<=y.v?!1:(y.Y++,y.u=Pe(d(y.Fa,y),KR(y,y.v)),y.v++,!0)}t.Fa=function(){if(this.u=null,HR(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var y=2*this.R;this.j.info("BP detection timer enabled: "+y),this.A=Pe(d(this.ab,this),y)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ce(10),r0(this),HR(this))};function gS(y){y.A!=null&&(a.clearTimeout(y.A),y.A=null)}function HR(y){y.g=new Ot(y,y.j,"rpc",y.Y),y.m===null&&(y.g.H=y.o),y.g.O=0;var T=Po(y.qa);Xt(T,"RID","rpc"),Xt(T,"SID",y.K),Xt(T,"AID",y.T),Xt(T,"CI",y.F?"0":"1"),!y.F&&y.ja&&Xt(T,"TO",y.ja),Xt(T,"TYPE","xmlhttp"),Bf(y,T),y.m&&y.o&&fS(T,y.m,y.o),y.L&&(y.g.I=y.L);var $=y.g;y=y.ia,$.L=1,$.v=e0(Po(T)),$.m=null,$.P=!0,Uc($,y)}t.Za=function(){this.C!=null&&(this.C=null,r0(this),mS(this),ce(19))};function o0(y){y.C!=null&&(a.clearTimeout(y.C),y.C=null)}function qR(y,T){var $=null;if(y.g==T){o0(y),gS(y),y.g=null;var F=2}else if(hS(y.h,T))$=T.D,_R(y.h,T),F=1;else return;if(y.G!=0){if(T.o)if(F==1){$=T.m?T.m.length:0,T=Date.now()-T.F;var te=y.B;F=Af(),Nt(F,new ke(F,$)),i0(y)}else GR(y);else if(te=T.s,te==3||te==0&&0<T.X||!(F==1&&l6(y,T)||F==2&&mS(y)))switch($&&0<$.length&&(T=y.h,T.i=T.i.concat($)),te){case 1:iu(y,5);break;case 4:iu(y,10);break;case 3:iu(y,6);break;default:iu(y,2)}}}function KR(y,T){let $=y.Ta+Math.floor(Math.random()*y.cb);return y.isActive()||($*=2),$*T}function iu(y,T){if(y.j.info("Error code "+T),T==2){var $=d(y.fb,y),F=y.Xa;const te=!F;F=new ru(F||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Jy(F,"https"),e0(F),te?t6(F.toString(),$):n6(F.toString(),$)}else ce(2);y.G=0,y.l&&y.l.sa(T),XR(y),UR(y)}t.fb=function(y){y?(this.j.info("Successfully pinged google.com"),ce(2)):(this.j.info("Failed to ping google.com"),ce(1))};function XR(y){if(y.G=0,y.ka=[],y.l){const T=TR(y.h);(T.length!=0||y.i.length!=0)&&(v(y.ka,T),v(y.ka,y.i),y.h.i.length=0,m(y.i),y.i.length=0),y.l.ra()}}function YR(y,T,$){var F=$ instanceof ru?Po($):new ru($);if(F.g!="")T&&(F.g=T+"."+F.g),Zy(F,F.s);else{var te=a.location;F=te.protocol,T=T?T+"."+te.hostname:te.hostname,te=+te.port;var ae=new ru(null);F&&Jy(ae,F),T&&(ae.g=T),te&&Zy(ae,te),$&&(ae.l=$),F=ae}return $=y.D,T=y.ya,$&&T&&Xt(F,$,T),Xt(F,"VER",y.la),Bf(y,F),F}function QR(y,T,$){if(T&&!y.J)throw Error("Can't create secondary domain capable XhrIo object.");return T=y.Ca&&!y.pa?new _n(new t0({eb:$})):new _n(y.pa),T.Ha(y.J),T}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function JR(){}t=JR.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function Hr(y,T){nt.call(this),this.g=new VR(T),this.l=y,this.h=T&&T.messageUrlParams||null,y=T&&T.messageHeaders||null,T&&T.clientProtocolHeaderRequired&&(y?y["X-Client-Protocol"]="webchannel":y={"X-Client-Protocol":"webchannel"}),this.g.o=y,y=T&&T.initMessageHeaders||null,T&&T.messageContentType&&(y?y["X-WebChannel-Content-Type"]=T.messageContentType:y={"X-WebChannel-Content-Type":T.messageContentType}),T&&T.va&&(y?y["X-WebChannel-Client-Profile"]=T.va:y={"X-WebChannel-Client-Profile":T.va}),this.g.S=y,(y=T&&T.Sb)&&!w(y)&&(this.g.m=y),this.v=T&&T.supportsCrossDomainXhr||!1,this.u=T&&T.sendRawJson||!1,(T=T&&T.httpSessionIdParam)&&!w(T)&&(this.g.D=T,y=this.h,y!==null&&T in y&&(y=this.h,T in y&&delete y[T])),this.j=new jc(this)}p(Hr,nt),Hr.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Hr.prototype.close=function(){pS(this.g)},Hr.prototype.o=function(y){var T=this.g;if(typeof y=="string"){var $={};$.__data__=y,y=$}else this.u&&($={},$.__data__=Na(y),y=$);T.i.push(new mn(T.Ya++,y)),T.G==3&&i0(T)},Hr.prototype.N=function(){this.g.l=null,delete this.j,pS(this.g),delete this.g,Hr.aa.N.call(this)};function ZR(y){Vc.call(this),y.__headers__&&(this.headers=y.__headers__,this.statusCode=y.__status__,delete y.__headers__,delete y.__status__);var T=y.__sm__;if(T){e:{for(const $ in T){y=$;break e}y=void 0}(this.i=y)&&(y=this.i,T=T!==null&&y in T?T[y]:void 0),this.data=T}else this.data=y}p(ZR,Vc);function eA(){$a.call(this),this.status=1}p(eA,$a);function jc(y){this.g=y}p(jc,JR),jc.prototype.ua=function(){Nt(this.g,"a")},jc.prototype.ta=function(y){Nt(this.g,new ZR(y))},jc.prototype.sa=function(y){Nt(this.g,new eA)},jc.prototype.ra=function(){Nt(this.g,"b")},Hr.prototype.send=Hr.prototype.o,Hr.prototype.open=Hr.prototype.m,Hr.prototype.close=Hr.prototype.close,Dt.NO_ERROR=0,Dt.TIMEOUT=8,Dt.HTTP_ERROR=6,zn.COMPLETE="complete",Xy.EventType=nu,nu.OPEN="a",nu.CLOSE="b",nu.ERROR="c",nu.MESSAGE="d",nt.prototype.listen=nt.prototype.K,_n.prototype.listenOnce=_n.prototype.L,_n.prototype.getLastError=_n.prototype.Ka,_n.prototype.getLastErrorCode=_n.prototype.Ba,_n.prototype.getStatus=_n.prototype.Z,_n.prototype.getResponseJson=_n.prototype.Oa,_n.prototype.getResponseText=_n.prototype.oa,_n.prototype.send=_n.prototype.ea,_n.prototype.setWithCredentials=_n.prototype.Ha}).apply(typeof $0<"u"?$0:typeof self<"u"?self:typeof window<"u"?window:{});const UO="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kr{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}kr.UNAUTHENTICATED=new kr(null),kr.GOOGLE_CREDENTIALS=new kr("google-credentials-uid"),kr.FIRST_PARTY=new kr("first-party-uid"),kr.MOCK_USER=new kr("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Fx="11.0.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vw=new xx("@firebase/firestore");function $i(t,...e){if(vw.logLevel<=kt.DEBUG){const n=e.map(I4);vw.debug(`Firestore (${Fx}): ${t}`,...n)}}function C4(t,...e){if(vw.logLevel<=kt.ERROR){const n=e.map(I4);vw.error(`Firestore (${Fx}): ${t}`,...n)}}function I4(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _4(t="Unexpected state"){const e=`FIRESTORE (${Fx}) INTERNAL ASSERTION FAILED: `+t;throw C4(e),new Error(e)}function Mp(t,e){t||_4()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ki={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ei extends ya{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zp{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QZ{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class JZ{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(kr.UNAUTHENTICATED))}shutdown(){}}class ZZ{constructor(e){this.t=e,this.currentUser=kr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){Mp(this.o===void 0);let s=this.i;const r=l=>this.i!==s?(s=this.i,n(l)):Promise.resolve();let i=new zp;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new zp,e.enqueueRetryable(()=>r(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await r(this.currentUser)})},a=l=>{$i("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):($i("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new zp)}},0),o()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(s=>this.i!==e?($i("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(Mp(typeof s.accessToken=="string"),new QZ(s.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Mp(e===null||typeof e=="string"),new kr(e)}}class eee{constructor(e,n,s){this.l=e,this.h=n,this.P=s,this.type="FirstParty",this.user=kr.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class tee{constructor(e,n,s){this.l=e,this.h=n,this.P=s}getToken(){return Promise.resolve(new eee(this.l,this.h,this.P))}start(e,n){e.enqueueRetryable(()=>n(kr.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class nee{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class see{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,n){Mp(this.o===void 0);const s=i=>{i.error!=null&&$i("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,$i("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>s(i))};const r=i=>{$i("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>r(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?r(i):$i("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(Mp(typeof n.token=="string"),this.R=n.token,new nee(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function ree(t){return t.name==="IndexedDbTransactionError"}class ww{constructor(e,n){this.projectId=e,this.database=n||"(default)"}static empty(){return new ww("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof ww&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var WO,gt;(gt=WO||(WO={}))[gt.OK=0]="OK",gt[gt.CANCELLED=1]="CANCELLED",gt[gt.UNKNOWN=2]="UNKNOWN",gt[gt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",gt[gt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",gt[gt.NOT_FOUND=5]="NOT_FOUND",gt[gt.ALREADY_EXISTS=6]="ALREADY_EXISTS",gt[gt.PERMISSION_DENIED=7]="PERMISSION_DENIED",gt[gt.UNAUTHENTICATED=16]="UNAUTHENTICATED",gt[gt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",gt[gt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",gt[gt.ABORTED=10]="ABORTED",gt[gt.OUT_OF_RANGE=11]="OUT_OF_RANGE",gt[gt.UNIMPLEMENTED=12]="UNIMPLEMENTED",gt[gt.INTERNAL=13]="INTERNAL",gt[gt.UNAVAILABLE=14]="UNAVAILABLE",gt[gt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */new S4([4294967295,4294967295],0);function lC(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iee{constructor(e,n,s=1e3,r=1.5,i=6e4){this.li=e,this.timerId=n,this.Qo=s,this.Ko=r,this.$o=i,this.Uo=0,this.Wo=null,this.Go=Date.now(),this.reset()}reset(){this.Uo=0}zo(){this.Uo=this.$o}jo(e){this.cancel();const n=Math.floor(this.Uo+this.Ho()),s=Math.max(0,Date.now()-this.Go),r=Math.max(0,n-s);r>0&&$i("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Uo} ms, delay with jitter: ${n} ms, last attempt: ${s} ms ago)`),this.Wo=this.li.enqueueAfterDelay(this.timerId,r,()=>(this.Go=Date.now(),e())),this.Uo*=this.Ko,this.Uo<this.Qo&&(this.Uo=this.Qo),this.Uo>this.$o&&(this.Uo=this.$o)}Jo(){this.Wo!==null&&(this.Wo.skipDelay(),this.Wo=null)}cancel(){this.Wo!==null&&(this.Wo.cancel(),this.Wo=null)}Ho(){return(Math.random()-.5)*this.Uo}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uk{constructor(e,n,s,r,i){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=s,this.op=r,this.removalCallback=i,this.deferred=new zp,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,s,r,i){const o=Date.now()+s,a=new Uk(e,n,o,r,i);return a.start(s),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Ei(ki.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}var jO,GO;(GO=jO||(jO={})).na="default",GO.Cache="cache";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oee(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HO=new Map;function aee(t,e,n,s){if(e===!0&&s===!0)throw new Ei(ki.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qO{constructor(e){var n,s;if(e.host===void 0){if(e.ssl!==void 0)throw new Ei(ki.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(n=e.ssl)===null||n===void 0||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Ei(ki.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}aee("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=oee((s=e.experimentalLongPollingOptions)!==null&&s!==void 0?s:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new Ei(ki.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new Ei(ki.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new Ei(ki.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(s,r){return s.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class lee{constructor(e,n,s,r){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=s,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new qO({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Ei(ki.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Ei(ki.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new qO(e),e.credentials!==void 0&&(this._authCredentials=function(s){if(!s)return new JZ;switch(s.type){case"firstParty":return new tee(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new Ei(ki.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const s=HO.get(n);s&&($i("ComponentProvider","Removing Datastore"),HO.delete(n),s.terminate())}(this),Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KO{constructor(e=Promise.resolve()){this.Iu=[],this.Eu=!1,this.du=[],this.Au=null,this.Ru=!1,this.Vu=!1,this.mu=[],this.r_=new iee(this,"async_queue_retry"),this.fu=()=>{const s=lC();s&&$i("AsyncQueue","Visibility state changed to "+s.visibilityState),this.r_.Jo()},this.gu=e;const n=lC();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this.fu)}get isShuttingDown(){return this.Eu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.pu(),this.yu(e)}enterRestrictedMode(e){if(!this.Eu){this.Eu=!0,this.Vu=e||!1;const n=lC();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.fu)}}enqueue(e){if(this.pu(),this.Eu)return new Promise(()=>{});const n=new zp;return this.yu(()=>this.Eu&&this.Vu?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Iu.push(e),this.wu()))}async wu(){if(this.Iu.length!==0){try{await this.Iu[0](),this.Iu.shift(),this.r_.reset()}catch(e){if(!ree(e))throw e;$i("AsyncQueue","Operation failed with retryable error: "+e)}this.Iu.length>0&&this.r_.jo(()=>this.wu())}}yu(e){const n=this.gu.then(()=>(this.Ru=!0,e().catch(s=>{this.Au=s,this.Ru=!1;const r=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(s);throw C4("INTERNAL UNHANDLED ERROR: ",r),s}).then(s=>(this.Ru=!1,s))));return this.gu=n,n}enqueueAfterDelay(e,n,s){this.pu(),this.mu.indexOf(e)>-1&&(n=0);const r=Uk.createAndSchedule(this,e,n,s,i=>this.Su(i));return this.du.push(r),r}pu(){this.Au&&_4()}verifyOperationInProgress(){}async bu(){let e;do e=this.gu,await e;while(e!==this.gu)}Du(e){for(const n of this.du)if(n.timerId===e)return!0;return!1}vu(e){return this.bu().then(()=>{this.du.sort((n,s)=>n.targetTimeMs-s.targetTimeMs);for(const n of this.du)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.bu()})}Cu(e){this.mu.push(e)}Su(e){const n=this.du.indexOf(e);this.du.splice(n,1)}}class uee extends lee{constructor(e,n,s,r){super(e,n,s,r),this.type="firestore",this._queue=new KO,this._persistenceKey=(r==null?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new KO(e),this._firestoreClient=void 0,await e}}}(function(e,n=!0){(function(r){Fx=r})(mc),Vu(new Cl("firestore",(s,{instanceIdentifier:r,options:i})=>{const o=s.getProvider("app").getImmediate(),a=new uee(new ZZ(s.getProvider("auth-internal")),new see(s.getProvider("app-check-internal")),function(u,c){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new Ei(ki.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ww(u.options.projectId,c)}(o,r),o);return i=Object.assign({useFetchStreams:n},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),fo(UO,"4.7.5",e),fo(UO,"4.7.5","esm2017")})();const cee={apiKey:"AIzaSyAM6PV2pMY1HUUZ1asW6cA5dDxGRKiho68",authDomain:"inventory-management-93042.firebaseapp.com",projectId:"inventory-management-93042",storageBucket:"inventory-management-93042.appspot.com",messagingSenderId:"335925214706",appId:"1:335925214706:web:20265f6b42683fa6bfff6b",measurementId:"G-ESRD0P0WZ2",databaseURL:"https://inventory-management-93042-default-rtdb.firebaseio.com/"},Lx=I3(cee),HI=b4(Lx),hee=()=>{const t=Ix(Lx);function e(){SX(t).then(()=>{alert("sign out succesfully")}).then(n("/"))}let n=ad();function s(){n("/Features")}return j.jsxs("div",{className:"Landing-main",children:[j.jsxs("nav",{className:"landing-nav-main",children:[j.jsx("div",{className:"landing-logo",children:"StockSense"}),j.jsxs("ul",{className:"nav-links-main",children:[j.jsx("li",{children:j.jsx("a",{href:"/main",children:"Home"})}),j.jsx("li",{children:j.jsx("a",{href:"/about",children:"About Us"})}),j.jsx("li",{children:j.jsx("a",{onClick:s,children:"Features"})}),j.jsx("li",{children:j.jsx("a",{href:"#logout",onClick:e,children:"Logout"})})]})]}),j.jsxs("div",{className:"main-section-writeups",children:[j.jsxs("div",{className:"content-text",children:[j.jsx("h1",{children:"Machine learning-powered inventory management system for efficient item tracking, pricing prediction, and freshness verification in digital enterprises."}),j.jsx("p",{children:"Create and deliver intelligent service solutions across inventory management and beyond using machine learning and automation."}),j.jsx("button",{className:"cta-button",onClick:s,children:"Try Our Features"})]}),j.jsx("div",{className:"background-image-inpng",children:j.jsx("img",{src:"Invo.png",alt:"Custom Background"})})]})]})},dee=()=>{const t=ad();function e(n){t(`/${n}`)}return j.jsxs("div",{className:"features-page",children:[j.jsx("div",{className:"featurs-nav",children:j.jsxs("nav",{className:"landing-nav-main",children:[j.jsx("div",{className:"landing-logo",children:"StockSense"}),j.jsxs("ul",{className:"nav-links-main",children:[j.jsx("li",{children:j.jsx("a",{href:"/",children:"Home"})}),j.jsx("li",{children:j.jsx("a",{href:"/about",children:"About Us"})}),j.jsx("li",{children:j.jsx("a",{href:"/Features",children:"Features"})}),j.jsx("li",{children:j.jsx("a",{href:"#logout",children:"Logout"})})]})]})}),j.jsxs("div",{className:"features-heading",children:[j.jsx("h1",{children:"Our Features"}),j.jsx("p",{children:"Discover the powerful tools that make inventory management effortless"})]}),j.jsxs("div",{className:"all-features-1",children:[j.jsxs("div",{className:"feature-section",onClick:()=>{e("Additems")},children:[j.jsxs("div",{className:"feature-logo",children:[j.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",stroke:"#2563EB","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-circle-plus w-8 h-8 mb-4 text-blue-600",children:[j.jsx("circle",{cx:"12",cy:"12",r:"10"}),j.jsx("path",{d:"M8 12h8"}),j.jsx("path",{d:"M12 8v8"})]})," "]}),j.jsxs("div",{className:"feature-content",children:[j.jsx("h2",{children:"Add Items"}),j.jsx("p",{children:"Easily add new items to your inventory with detailed categorization and tracking capabilities."})]})]}),j.jsxs("div",{className:"feature-section",children:[j.jsx("div",{className:"feature-logo",children:j.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"35",height:"35",viewBox:"0 0 24 24",fill:"none",stroke:"rgb(234 88 12)","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-trending-up w-8 h-8 mb-4 text-orange-600",children:[j.jsx("polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17"}),j.jsx("polyline",{points:"16 7 22 7 22 13"})]})}),j.jsxs("div",{className:"feature-content",children:[j.jsx("h2",{children:"Predict Price"}),j.jsx("p",{children:"Utilize AI-powered tools to predict prices and optimize inventory decisions effortlessly."})]})]}),j.jsxs("div",{className:"feature-section",onClick:()=>{e("Retrive")},children:[j.jsx("div",{className:"feature-logo",children:j.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"35",height:"35",viewBox:"0 0 24 24",fill:"none",stroke:"rgb(22 163 74)","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-package-search w-8 h-8 mb-4 text-green-600",children:[j.jsx("path",{d:"M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14"}),j.jsx("path",{d:"m7.5 4.27 9 5.15"}),j.jsx("polyline",{points:"3.29 7 12 12 20.71 7"}),j.jsx("line",{x1:"12",x2:"12",y1:"22",y2:"12"}),j.jsx("circle",{cx:"18.5",cy:"15.5",r:"2.5"}),j.jsx("path",{d:"M20.27 17.27 22 19"})]})}),j.jsxs("div",{className:"feature-content",children:[j.jsx("h2",{children:"Retrieve Items"}),j.jsx("p",{children:"Quick and efficient item lookup system with advanced search and filtering options."})]})]})]}),j.jsxs("div",{className:"all-features-2",children:[j.jsxs("div",{className:"feature-section",onClick:()=>{e("Display")},children:[j.jsx("div",{className:"feature-logo",children:j.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"35",height:"35",viewBox:"0 0 24 24",fill:"none",stroke:"rgb(147 51 234)","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-list-checks w-8 h-8 mb-4 text-purple-600",children:[j.jsx("path",{d:"m3 17 2 2 4-4"}),j.jsx("path",{d:"m3 7 2 2 4-4"}),j.jsx("path",{d:"M13 6h8"}),j.jsx("path",{d:"M13 12h8"}),j.jsx("path",{d:"M13 18h8"})]})}),j.jsxs("div",{className:"feature-content",children:[j.jsx("h2",{children:"Display Items"}),j.jsx("p",{children:"Comprehensive view of your inventory with customizable display options and sorting capabilities."})]})]}),j.jsxs("div",{className:"feature-section",onClick:()=>{e("check")},children:[j.jsx("div",{className:"feature-logo",children:j.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",stroke:"rgb(220 38 38)","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-thermometer-sun w-8 h-8 mb-4 text-red-600",children:[j.jsx("path",{d:"M12 9a4 4 0 0 0-2 7.5"}),j.jsx("path",{d:"M12 3v2"}),j.jsx("path",{d:"m6.6 18.4-1.4 1.4"}),j.jsx("path",{d:"M20 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z"}),j.jsx("path",{d:"M4 13H2"}),j.jsx("path",{d:"M6.34 7.34 4.93 5.93"})]})}),j.jsxs("div",{className:"feature-content",children:[j.jsx("h2",{children:"Check Freshness"}),j.jsx("p",{children:"Automated freshness monitoring system for perishable items with alerts and notifications."})]})]})]})]})},fee=()=>{const[t,e]=ne.useState(""),[n,s]=ne.useState(""),[r,i]=ne.useState(""),[o,a]=ne.useState(!1),l=b4(),u=()=>{if(t&&n&&r){a(!0);const c=ym(l,"inventory/"+t);x4(c).then(h=>{if(h.exists()){const d=h.val(),f=parseInt(d.quantity)+parseInt(n);BO(c,{itemsname:t,quantity:f.toString(),description:r}).then(()=>{a(!1),e(""),s(""),i(""),alert("Item updated successfully")}).catch(p=>{a(!1),alert("Error updating item: "+p.message)})}else{const d=new Date().getTime();BO(ym(l,"inventory/"+d),{itemsname:t,quantity:n,description:r}).then(()=>{a(!1),e(""),s(""),i(""),alert("Item added successfully")}).catch(f=>{a(!1),alert("Error adding item: "+f.message)})}}).catch(h=>{a(!1),alert("Error checking item: "+h.message)})}else alert("Please fill all the fields")};return j.jsxs("div",{className:"Additems-main",children:[j.jsxs("div",{className:"Additems-Heading",children:[j.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"50",height:"60",viewBox:"0 0 24 24",fill:"none",stroke:"#2764EB",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-circle-plus h-16 w-16 text-blue-600",children:[j.jsx("circle",{cx:"12",cy:"12",r:"10"}),j.jsx("path",{d:"M8 12h8"}),j.jsx("path",{d:"M12 8v8"})]}),j.jsx("h1",{children:"Add New Item"}),j.jsx("p",{children:"Enter the details of your new inventory item below"})]}),j.jsxs("div",{className:"Additems-form",children:[j.jsx("div",{className:"form-heading",children:j.jsx("h2",{children:"Item Information"})}),j.jsxs("div",{className:"input-section",children:[j.jsxs("label",{children:["Item Name:",j.jsx("input",{type:"text",value:t,placeholder:"Enter Item Name",onChange:c=>e(c.target.value)})]}),j.jsxs("label",{children:["Quantity:",j.jsx("input",{type:"number",value:n,placeholder:"Enter quantity",onChange:c=>s(c.target.value)})]}),j.jsxs("label",{children:["Description:",j.jsx("input",{type:"text",value:r,placeholder:"Enter item Description",onChange:c=>i(c.target.value)})]})]}),j.jsxs("div",{className:"Additems-buttons",children:[j.jsx("button",{className:"cancel",onClick:()=>{e(""),s(""),i("")},children:"Cancel"}),j.jsx("button",{className:"Add-button",onClick:u,disabled:o,children:o?"Adding...":"Add Item"})]})]})]})},pee=()=>{const[t,e]=ne.useState([]),[n,s]=ne.useState(""),[r,i]=ne.useState([]),[o,a]=ne.useState(!1);ne.useEffect(()=>{const c=ym(HI,"inventory"),h=VZ(c,d=>{const f=d.val();if(f){const m=Object.keys(f).map(v=>({id:v,...f[v]})).reduce((v,g)=>{const w=v.find(b=>b.name===g.itemsname);return w?w.quantity=parseInt(w.quantity)+parseInt(g.quantity):v.push({name:g.itemsname,quantity:g.quantity,description:g.description}),v},[]);e(m)}else e([])});return()=>h()},[]);const l=()=>{const c=t.find(h=>h.name===n);c?(i([c]),a(!0)):(i([]),a(!1))},u=c=>{const h=r.filter(d=>d.id!==c);i(h),h.length===0&&a(!1)};return j.jsxs("div",{className:"container",children:[j.jsxs("div",{className:"header",children:[j.jsx("h1",{children:"Inventory Items"}),j.jsx("p",{children:"View and manage your inventory items below"})]}),j.jsxs("div",{className:"display-select",children:[j.jsx("h3",{className:"writeselect",children:"Select :"}),j.jsxs("select",{name:"Items-selection",onChange:c=>s(c.target.value),children:[j.jsx("option",{value:"",children:"Select an Item"}),t.map((c,h)=>j.jsx("option",{value:c.name,children:c.name},h))]}),j.jsx("button",{onClick:l,children:"Display"})]}),o&&j.jsx("div",{className:"table-container",children:j.jsxs("table",{children:[j.jsx("thead",{children:j.jsxs("tr",{children:[j.jsx("th",{children:"Item Name"}),j.jsx("th",{children:"Quantity"}),j.jsx("th",{children:"Description"}),j.jsx("th",{children:"Actions"})]})}),j.jsx("tbody",{children:r.map(c=>j.jsxs("tr",{children:[j.jsx("td",{children:c.name}),j.jsx("td",{children:c.quantity}),j.jsx("td",{children:c.description}),j.jsx("td",{children:j.jsx("div",{className:"action-buttons",children:j.jsx("button",{className:"btn delete",onClick:()=>u(c.id),children:"Remove from Display"})})})]},c.name))})]})})]})};var T4={exports:{}};(function(t,e){(function(n,s){t.exports=s()})(typeof self<"u"?self:qe,()=>(()=>{var n={75:function(o){(function(){var a,l,u,c,h,d;typeof performance<"u"&&performance!==null&&performance.now?o.exports=function(){return performance.now()}:typeof process<"u"&&process!==null&&process.hrtime?(o.exports=function(){return(a()-h)/1e6},l=process.hrtime,c=(a=function(){var f;return 1e9*(f=l())[0]+f[1]})(),d=1e9*process.uptime(),h=c-d):Date.now?(o.exports=function(){return Date.now()-u},u=Date.now()):(o.exports=function(){return new Date().getTime()-u},u=new Date().getTime())}).call(this)},4087:(o,a,l)=>{for(var u=l(75),c=typeof window>"u"?l.g:window,h=["moz","webkit"],d="AnimationFrame",f=c["request"+d],p=c["cancel"+d]||c["cancelRequest"+d],m=0;!f&&m<h.length;m++)f=c[h[m]+"Request"+d],p=c[h[m]+"Cancel"+d]||c[h[m]+"CancelRequest"+d];if(!f||!p){var v=0,g=0,w=[];f=function(b){if(w.length===0){var x=u(),S=Math.max(0,16.666666666666668-(x-v));v=S+x,setTimeout(function(){var N=w.slice(0);w.length=0;for(var I=0;I<N.length;I++)if(!N[I].cancelled)try{N[I].callback(v)}catch(C){setTimeout(function(){throw C},0)}},Math.round(S))}return w.push({handle:++g,callback:b,cancelled:!1}),g},p=function(b){for(var x=0;x<w.length;x++)w[x].handle===b&&(w[x].cancelled=!0)}}o.exports=function(b){return f.call(c,b)},o.exports.cancel=function(){p.apply(c,arguments)},o.exports.polyfill=function(b){b||(b=c),b.requestAnimationFrame=f,b.cancelAnimationFrame=p}}},s={};function r(o){var a=s[o];if(a!==void 0)return a.exports;var l=s[o]={exports:{}};return n[o].call(l.exports,l,l.exports,r),l.exports}r.n=o=>{var a=o&&o.__esModule?()=>o.default:()=>o;return r.d(a,{a}),a},r.d=(o,a)=>{for(var l in a)r.o(a,l)&&!r.o(o,l)&&Object.defineProperty(o,l,{enumerable:!0,get:a[l]})},r.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),r.o=(o,a)=>Object.prototype.hasOwnProperty.call(o,a);var i={};return(()=>{r.d(i,{default:()=>W});var o=r(4087),a=r.n(o);const l=function(B){return new RegExp(/<[a-z][\s\S]*>/i).test(B)},u=function(B,M){return Math.floor(Math.random()*(M-B+1))+B};var c="TYPE_CHARACTER",h="REMOVE_CHARACTER",d="REMOVE_ALL",f="REMOVE_LAST_VISIBLE_NODE",p="PAUSE_FOR",m="CALL_FUNCTION",v="ADD_HTML_TAG_ELEMENT",g="CHANGE_DELETE_SPEED",w="CHANGE_DELAY",b="CHANGE_CURSOR",x="PASTE_STRING",S="HTML_TAG";function N(B){return N=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},N(B)}function I(B,M){var X=Object.keys(B);if(Object.getOwnPropertySymbols){var z=Object.getOwnPropertySymbols(B);M&&(z=z.filter(function(Y){return Object.getOwnPropertyDescriptor(B,Y).enumerable})),X.push.apply(X,z)}return X}function C(B){for(var M=1;M<arguments.length;M++){var X=arguments[M]!=null?arguments[M]:{};M%2?I(Object(X),!0).forEach(function(z){D(B,z,X[z])}):Object.getOwnPropertyDescriptors?Object.defineProperties(B,Object.getOwnPropertyDescriptors(X)):I(Object(X)).forEach(function(z){Object.defineProperty(B,z,Object.getOwnPropertyDescriptor(X,z))})}return B}function _(B){return function(M){if(Array.isArray(M))return k(M)}(B)||function(M){if(typeof Symbol<"u"&&M[Symbol.iterator]!=null||M["@@iterator"]!=null)return Array.from(M)}(B)||function(M,X){if(M){if(typeof M=="string")return k(M,X);var z=Object.prototype.toString.call(M).slice(8,-1);return z==="Object"&&M.constructor&&(z=M.constructor.name),z==="Map"||z==="Set"?Array.from(M):z==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(z)?k(M,X):void 0}}(B)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function k(B,M){(M==null||M>B.length)&&(M=B.length);for(var X=0,z=new Array(M);X<M;X++)z[X]=B[X];return z}function A(B,M){for(var X=0;X<M.length;X++){var z=M[X];z.enumerable=z.enumerable||!1,z.configurable=!0,"value"in z&&(z.writable=!0),Object.defineProperty(B,R(z.key),z)}}function D(B,M,X){return(M=R(M))in B?Object.defineProperty(B,M,{value:X,enumerable:!0,configurable:!0,writable:!0}):B[M]=X,B}function R(B){var M=function(X,z){if(N(X)!=="object"||X===null)return X;var Y=X[Symbol.toPrimitive];if(Y!==void 0){var L=Y.call(X,"string");if(N(L)!=="object")return L;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(X)}(B);return N(M)==="symbol"?M:String(M)}const W=function(){function B(z,Y){var L=this;if(function(Q,se){if(!(Q instanceof se))throw new TypeError("Cannot call a class as a function")}(this,B),D(this,"state",{cursorAnimation:null,lastFrameTime:null,pauseUntil:null,eventQueue:[],eventLoop:null,eventLoopPaused:!1,reverseCalledEvents:[],calledEvents:[],visibleNodes:[],initialOptions:null,elements:{container:null,wrapper:document.createElement("span"),cursor:document.createElement("span")}}),D(this,"options",{strings:null,cursor:"|",delay:"natural",pauseFor:1500,deleteSpeed:"natural",loop:!1,autoStart:!1,devMode:!1,skipAddStyles:!1,wrapperClassName:"Typewriter__wrapper",cursorClassName:"Typewriter__cursor",stringSplitter:null,onCreateTextNode:null,onRemoveNode:null}),D(this,"setupWrapperElement",function(){L.state.elements.container&&(L.state.elements.wrapper.className=L.options.wrapperClassName,L.state.elements.cursor.className=L.options.cursorClassName,L.state.elements.cursor.innerHTML=L.options.cursor,L.state.elements.container.innerHTML="",L.state.elements.container.appendChild(L.state.elements.wrapper),L.state.elements.container.appendChild(L.state.elements.cursor))}),D(this,"start",function(){return L.state.eventLoopPaused=!1,L.runEventLoop(),L}),D(this,"pause",function(){return L.state.eventLoopPaused=!0,L}),D(this,"stop",function(){return L.state.eventLoop&&((0,o.cancel)(L.state.eventLoop),L.state.eventLoop=null),L}),D(this,"pauseFor",function(Q){return L.addEventToQueue(p,{ms:Q}),L}),D(this,"typeOutAllStrings",function(){return typeof L.options.strings=="string"?(L.typeString(L.options.strings).pauseFor(L.options.pauseFor),L):(L.options.strings.forEach(function(Q){L.typeString(Q).pauseFor(L.options.pauseFor).deleteAll(L.options.deleteSpeed)}),L)}),D(this,"typeString",function(Q){var se=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(l(Q))return L.typeOutHTMLString(Q,se);if(Q){var de=(L.options||{}).stringSplitter,ue=typeof de=="function"?de(Q):Q.split("");L.typeCharacters(ue,se)}return L}),D(this,"pasteString",function(Q){var se=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return l(Q)?L.typeOutHTMLString(Q,se,!0):(Q&&L.addEventToQueue(x,{character:Q,node:se}),L)}),D(this,"typeOutHTMLString",function(Q){var se=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,de=arguments.length>2?arguments[2]:void 0,ue=function(Ie){var Oe=document.createElement("div");return Oe.innerHTML=Ie,Oe.childNodes}(Q);if(ue.length>0)for(var fe=0;fe<ue.length;fe++){var ve=ue[fe],De=ve.innerHTML;ve&&ve.nodeType!==3?(ve.innerHTML="",L.addEventToQueue(v,{node:ve,parentNode:se}),de?L.pasteString(De,ve):L.typeString(De,ve)):ve.textContent&&(de?L.pasteString(ve.textContent,se):L.typeString(ve.textContent,se))}return L}),D(this,"deleteAll",function(){var Q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"natural";return L.addEventToQueue(d,{speed:Q}),L}),D(this,"changeDeleteSpeed",function(Q){if(!Q)throw new Error("Must provide new delete speed");return L.addEventToQueue(g,{speed:Q}),L}),D(this,"changeDelay",function(Q){if(!Q)throw new Error("Must provide new delay");return L.addEventToQueue(w,{delay:Q}),L}),D(this,"changeCursor",function(Q){if(!Q)throw new Error("Must provide new cursor");return L.addEventToQueue(b,{cursor:Q}),L}),D(this,"deleteChars",function(Q){if(!Q)throw new Error("Must provide amount of characters to delete");for(var se=0;se<Q;se++)L.addEventToQueue(h);return L}),D(this,"callFunction",function(Q,se){if(!Q||typeof Q!="function")throw new Error("Callback must be a function");return L.addEventToQueue(m,{cb:Q,thisArg:se}),L}),D(this,"typeCharacters",function(Q){var se=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(!Q||!Array.isArray(Q))throw new Error("Characters must be an array");return Q.forEach(function(de){L.addEventToQueue(c,{character:de,node:se})}),L}),D(this,"removeCharacters",function(Q){if(!Q||!Array.isArray(Q))throw new Error("Characters must be an array");return Q.forEach(function(){L.addEventToQueue(h)}),L}),D(this,"addEventToQueue",function(Q,se){var de=arguments.length>2&&arguments[2]!==void 0&&arguments[2];return L.addEventToStateProperty(Q,se,de,"eventQueue")}),D(this,"addReverseCalledEvent",function(Q,se){var de=arguments.length>2&&arguments[2]!==void 0&&arguments[2];return L.options.loop?L.addEventToStateProperty(Q,se,de,"reverseCalledEvents"):L}),D(this,"addEventToStateProperty",function(Q,se){var de=arguments.length>2&&arguments[2]!==void 0&&arguments[2],ue=arguments.length>3?arguments[3]:void 0,fe={eventName:Q,eventArgs:se||{}};return L.state[ue]=de?[fe].concat(_(L.state[ue])):[].concat(_(L.state[ue]),[fe]),L}),D(this,"runEventLoop",function(){L.state.lastFrameTime||(L.state.lastFrameTime=Date.now());var Q=Date.now(),se=Q-L.state.lastFrameTime;if(!L.state.eventQueue.length){if(!L.options.loop)return;L.state.eventQueue=_(L.state.calledEvents),L.state.calledEvents=[],L.options=C({},L.state.initialOptions)}if(L.state.eventLoop=a()(L.runEventLoop),!L.state.eventLoopPaused){if(L.state.pauseUntil){if(Q<L.state.pauseUntil)return;L.state.pauseUntil=null}var de,ue=_(L.state.eventQueue),fe=ue.shift();if(!(se<=(de=fe.eventName===f||fe.eventName===h?L.options.deleteSpeed==="natural"?u(40,80):L.options.deleteSpeed:L.options.delay==="natural"?u(120,160):L.options.delay))){var ve=fe.eventName,De=fe.eventArgs;switch(L.logInDevMode({currentEvent:fe,state:L.state,delay:de}),ve){case x:case c:var Ie=De.character,Oe=De.node,ze=document.createTextNode(Ie),Ye=ze;L.options.onCreateTextNode&&typeof L.options.onCreateTextNode=="function"&&(Ye=L.options.onCreateTextNode(Ie,ze)),Ye&&(Oe?Oe.appendChild(Ye):L.state.elements.wrapper.appendChild(Ye)),L.state.visibleNodes=[].concat(_(L.state.visibleNodes),[{type:"TEXT_NODE",character:Ie,node:Ye}]);break;case h:ue.unshift({eventName:f,eventArgs:{removingCharacterNode:!0}});break;case p:var Qe=fe.eventArgs.ms;L.state.pauseUntil=Date.now()+parseInt(Qe);break;case m:var xt=fe.eventArgs,ft=xt.cb,at=xt.thisArg;ft.call(at,{elements:L.state.elements});break;case v:var Ct=fe.eventArgs,vt=Ct.node,Jn=Ct.parentNode;Jn?Jn.appendChild(vt):L.state.elements.wrapper.appendChild(vt),L.state.visibleNodes=[].concat(_(L.state.visibleNodes),[{type:S,node:vt,parentNode:Jn||L.state.elements.wrapper}]);break;case d:var Ut=L.state.visibleNodes,an=De.speed,Wt=[];an&&Wt.push({eventName:g,eventArgs:{speed:an,temp:!0}});for(var ms=0,In=Ut.length;ms<In;ms++)Wt.push({eventName:f,eventArgs:{removingCharacterNode:!1}});an&&Wt.push({eventName:g,eventArgs:{speed:L.options.deleteSpeed,temp:!0}}),ue.unshift.apply(ue,Wt);break;case f:var ln=fe.eventArgs.removingCharacterNode;if(L.state.visibleNodes.length){var nt=L.state.visibleNodes.pop(),Nt=nt.type,fn=nt.node,jr=nt.character;L.options.onRemoveNode&&typeof L.options.onRemoveNode=="function"&&L.options.onRemoveNode({node:fn,character:jr}),fn&&fn.parentNode.removeChild(fn),Nt===S&&ln&&ue.unshift({eventName:f,eventArgs:{}})}break;case g:L.options.deleteSpeed=fe.eventArgs.speed;break;case w:L.options.delay=fe.eventArgs.delay;break;case b:L.options.cursor=fe.eventArgs.cursor,L.state.elements.cursor.innerHTML=fe.eventArgs.cursor}L.options.loop&&(fe.eventName===f||fe.eventArgs&&fe.eventArgs.temp||(L.state.calledEvents=[].concat(_(L.state.calledEvents),[fe]))),L.state.eventQueue=ue,L.state.lastFrameTime=Q}}}),z)if(typeof z=="string"){var le=document.querySelector(z);if(!le)throw new Error("Could not find container element");this.state.elements.container=le}else this.state.elements.container=z;Y&&(this.options=C(C({},this.options),Y)),this.state.initialOptions=C({},this.options),this.init()}var M,X;return M=B,(X=[{key:"init",value:function(){var z,Y;this.setupWrapperElement(),this.addEventToQueue(b,{cursor:this.options.cursor},!0),this.addEventToQueue(d,null,!0),!window||window.___TYPEWRITER_JS_STYLES_ADDED___||this.options.skipAddStyles||(z=".Typewriter__cursor{-webkit-animation:Typewriter-cursor 1s infinite;animation:Typewriter-cursor 1s infinite;margin-left:1px}@-webkit-keyframes Typewriter-cursor{0%{opacity:0}50%{opacity:1}100%{opacity:0}}@keyframes Typewriter-cursor{0%{opacity:0}50%{opacity:1}100%{opacity:0}}",(Y=document.createElement("style")).appendChild(document.createTextNode(z)),document.head.appendChild(Y),window.___TYPEWRITER_JS_STYLES_ADDED___=!0),this.options.autoStart===!0&&this.options.strings&&this.typeOutAllStrings().start()}},{key:"logInDevMode",value:function(z){this.options.devMode&&console.log(z)}}])&&A(M.prototype,X),Object.defineProperty(M,"prototype",{writable:!1}),B}()})(),i.default})())})(T4);var mee=T4.exports;const k4=DF(mee),gee=()=>{const[t,e]=ne.useState(""),[n,s]=ne.useState(""),[r,i]=ne.useState(!1),o=Ix(Lx),a=ad();ne.useEffect(()=>{new k4("#typewriter",{strings:["Hello👋","Welcome Back😎"],autoStart:!0,loop:!0})},[]);const l=async c=>{c.preventDefault();try{await wX(o,t,n),a("/main")}catch{alert("Email and Password do not match or there was an issue with login")}},u=()=>{i(!r)};return j.jsxs("div",{className:"login-container",children:[j.jsx("div",{className:"type",children:j.jsx("span",{id:"typewriter"})}),j.jsxs("div",{className:"login-box",children:[j.jsx("h2",{children:"Welcome Back"}),j.jsxs("form",{onSubmit:l,children:[j.jsxs("div",{className:"input-group",children:[j.jsx("label",{children:"Email"}),j.jsx("input",{type:"email",placeholder:"Enter your email",value:t,onChange:c=>e(c.target.value),required:!0})]}),j.jsxs("div",{className:"input-group",children:[j.jsx("label",{children:"Password"}),j.jsxs("div",{className:"password-container",children:[j.jsx("input",{type:r?"text":"password",placeholder:"Enter your password",value:n,onChange:c=>s(c.target.value),required:!0}),j.jsx("span",{className:"eye-icon",onClick:u,children:r?"🙈":"👁️"})]})]}),j.jsx("button",{type:"submit",className:"login-btn",children:"Log In"})]}),j.jsx("div",{className:"footer",children:j.jsxs("p",{children:["Don't have an account? ",j.jsx("span",{onClick:()=>a("/signup"),children:"Sign Up"})]})})]})]})},yee=()=>{const[t,e]=ne.useState(""),[n,s]=ne.useState(""),[r,i]=ne.useState(!1),[o,a]=ne.useState(""),l=Ix(Lx),u=ad();function c(f){u(`/${f}`)}ne.useEffect(()=>{const f=new k4("#typewriter",{strings:["Hello","Welcome Back"],autoStart:!0,loop:!0});return()=>{f.stop()}},[]);const h=f=>{if(f.preventDefault(),!t||!n){a("Please fill out both fields.");return}vX(l,t,n).then(alert("signup succesfull")).then(u("/"))},d=()=>{i(!r)};return j.jsxs("div",{className:"signup-container",children:[j.jsx("div",{className:"type2",children:j.jsx("span",{id:"typewriter"})}),j.jsxs("div",{className:"signup-box",children:[j.jsx("h2",{children:"Create an Account"}),j.jsxs("form",{onSubmit:h,children:[o&&j.jsx("div",{className:"error-message",children:o}),j.jsxs("div",{className:"input-group",children:[j.jsx("label",{children:"Email"}),j.jsx("input",{type:"email",placeholder:"Enter your email",value:t,onChange:f=>e(f.target.value),required:!0})]}),j.jsxs("div",{className:"input-group",children:[j.jsx("label",{children:"Password"}),j.jsxs("div",{className:"password-container",children:[j.jsx("input",{type:r?"text":"password",placeholder:"Enter your password",value:n,onChange:f=>s(f.target.value),required:!0}),j.jsx("span",{className:"eye-icon",onClick:d,children:r?"🙈":"👁️"})]})]}),j.jsx("button",{type:"submit",className:"signup-btn",children:"Sign Up"})]}),j.jsx("div",{className:"footer",children:j.jsxs("p",{children:["Already have an account? ",j.jsx("span",{onClick:()=>c(""),children:"Log in"})]})})]})]})},vee=()=>{const[t,e]=ne.useState([]),[n,s]=ne.useState(""),[r,i]=ne.useState(""),[o,a]=ne.useState("");ne.useEffect(()=>{l()},[]);const l=async()=>{try{const c=ym(HI,"inventory"),h=await x4(c);if(h.exists()){const d=h.val(),f=Object.keys(d).map(p=>({id:p,...d[p]}));e(f)}else e([])}catch(c){console.error("Error fetching items:",c)}},u=async c=>{if(c.preventDefault(),a(""),!n||!r){a("Please select an item and enter a quantity.");return}try{const h=t.find(p=>p.id===n);if(!h){a("Selected item not found.");return}if(parseInt(r)>h.quantity){a("Not enough stock to remove.");return}const d=h.quantity-parseInt(r),f=ym(HI,`inventory/${n}`);await zZ(f,{quantity:d}),alert(`Updated successfully! Remaining quantity: ${d}`),i(""),l()}catch(h){console.error("Error updating quantity:",h),a("An error occurred while updating the item.")}};return j.jsxs("div",{className:"retrieve-update-container",children:[j.jsx("h1",{children:"Retrieve and Update Items"}),j.jsxs("form",{onSubmit:u,className:"retrieve-update-form",children:[j.jsxs("div",{className:"form-group",children:[j.jsx("label",{children:"Select Item:"}),j.jsxs("select",{value:n,onChange:c=>s(c.target.value),required:!0,children:[j.jsx("option",{value:"",children:"-- Select an Item --"}),t.map(c=>j.jsx("option",{value:c.id,children:c.itemsname},c.id))]})]}),j.jsxs("div",{className:"form-group",children:[j.jsx("label",{children:"Quantity to Remove:"}),j.jsx("input",{type:"number",value:r,onChange:c=>i(c.target.value),min:"1",required:!0})]}),o&&j.jsx("p",{className:"error",children:o}),j.jsx("button",{type:"submit",className:"update-btn",children:"Remove Quantity"})]}),j.jsx("h2",{children:"Current Items"}),j.jsxs("table",{className:"items-table",children:[j.jsx("thead",{children:j.jsxs("tr",{children:[j.jsx("th",{children:"Name"}),j.jsx("th",{children:"Quantity"}),j.jsx("th",{children:"Description"})]})}),j.jsx("tbody",{children:t.map(c=>j.jsxs("tr",{children:[j.jsx("td",{children:c.itemsname}),j.jsx("td",{children:c.quantity}),j.jsx("td",{children:c.description})]},c.id))})]})]})};var E4={},Wk={};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wee=1e-7,xee=1e-4;class jk{constructor(e,n){this.backend=e,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,n){this.dataIdsCount++,this.data.set(e,n)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class Mx{refCount(e){return rr("refCount")}incRef(e){return rr("incRef")}timerAvailable(){return!0}time(e){return rr("time")}read(e){return rr("read")}readSync(e){return rr("readSync")}readToGPU(e,n){return rr("readToGPU")}numDataIds(){return rr("numDataIds")}disposeData(e,n){return rr("disposeData")}write(e,n,s){return rr("write")}move(e,n,s,r,i){return rr("move")}createTensorFromGPUData(e,n,s){return rr("createTensorFromGPUData")}memory(){return rr("memory")}floatPrecision(){return rr("floatPrecision")}epsilon(){return this.floatPrecision()===32?wee:xee}dispose(){return rr("dispose")}}function rr(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gk(t){let e=t.length,n=0;for(;e>0;)n=Math.random()*e|0,e--,jo(t,e,n)}function bee(t,e){if(t.length!==e.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${t.length}Second array length was ${e.length}`);let n=t.length,s=0;for(;n>0;)s=Math.random()*n|0,n--,jo(t,n,s),jo(e,n,s)}function kl(t,e,n){return Math.max(t,Math.min(e,n))}function zx(t){return t%2===0?t:t+1}function jo(t,e,n){const s=t[e];t[e]=t[n],t[n]=s}function N4(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}function See(t,e){const n=Math.random();return e*n+(1-n)*t}function Cee(t,e){let n=0;for(let s=0;s<t.length;s++){const r=Number(t[s])-Number(e[s]);n+=r*r}return n}function O(t,e){if(!t)throw new Error(typeof e=="string"?e:e())}function cs(t,e,n=""){O(st(t,e),()=>n+` Shapes ${t} and ${e} must match`)}function wc(t){O(t!=null,()=>"The input to the tensor constructor must be a non-null value.")}function re(t){if(t.length===0)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function Iee(t){return t.length===0}function $4(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==null&&e[n]!==null&&t[n]!==e[n])return!1;return!0}function st(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function qu(t){return t%1===0}function _ee(t){if(Math.tanh!=null)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;{const e=Math.exp(2*t);return(e-1)/(e+1)}}function xw(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function Tee(t){const e=new Uint32Array(t);for(let n=0;n<t;++n)e[n]=n;return Gk(e),e}function Ru(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function qI(t,e=r=>0,n,s){return new Promise((r,i)=>{let o=0;const a=()=>{if(t()){r();return}o++;const l=e(o);if(n!=null&&o>=n){i();return}s!=null?s(a,l):setTimeout(a,l)};a()})}function Hk(t,e){let n=1,s=-1;for(let i=0;i<t.length;++i)if(t[i]>=0)n*=t[i];else if(t[i]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${i}`);s=i}else if(t[i]<0)throw Error(`Shapes can not be < 0. Found ${t[i]} at dim ${i}`);if(s===-1){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(n===0)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const r=t.slice();return r[s]=e/n,r}function Ze(t,e){const n=e.length;return t=t==null?e.map((s,r)=>r):[].concat(t),O(t.every(s=>s>=-n&&s<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`),O(t.every(s=>qu(s)),()=>`All values in axis param must be integers but got axis ${t}`),t.map(s=>s<0?n+s:s)}function wa(t,e){const n=[],s=[],r=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||r?null:Ze(e,t).sort();let o=0;for(let a=0;a<t.length;++a){if(i!=null){if(i[o]===a&&t[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${t[a]}' is not 1`);(i[o]==null||i[o]>a)&&t[a]===1&&(n.push(t[a]),s.push(a)),i[o]<=a&&o++}t[a]!==1&&(n.push(t[a]),s.push(a))}return{newShape:n,keptDims:s}}function qn(t,e){return cn(t,e)}function cn(t,e){let n=null;if(t==null||t==="float32")n=new Float32Array(e);else if(t==="int32")n=new Int32Array(e);else if(t==="bool")n=new Uint8Array(e);else if(t==="string")n=new Array(e);else throw new Error(`Unknown data type ${t}`);return n}function R4(t,e){for(let n=0;n<t.length;n++){const s=t[n];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function A4(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function qk(t,e){return!(e==="complex64"||e==="float32"&&t!=="complex64"||e==="int32"&&t!=="float32"&&t!=="complex64"||e==="bool"&&t==="bool")}function vm(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error(`Unknown dtype ${t}`)}function D4(t){if(t==null)return 0;let e=0;return t.forEach(n=>e+=n.length),e}function ao(t){return typeof t=="string"||t instanceof String}function O4(t){return typeof t=="boolean"}function bw(t){return typeof t=="number"}function xc(t){return Array.isArray(t)?xc(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":bw(t)?"float32":ao(t)?"string":O4(t)?"bool":"float32"}function El(t){return!!(t&&t.constructor&&t.call&&t.apply)}function Sw(t,e){for(let n=e;n<t;++n)if(t%n===0)return n;return t}function Me(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let s=e-3;s>=0;--s)n[s]=n[s+1]*t[s+1];return n}function P4(t,e,n,s=!1){const r=new Array;if(e.length===1){const i=e[0]*(s?2:1);for(let o=0;o<i;o++)r[o]=n[t+o]}else{const i=e[0],o=e.slice(1),a=o.reduce((l,u)=>l*u)*(s?2:1);for(let l=0;l<i;l++)r[l]=P4(t+l*a,o,n,s)}return r}function Fr(t,e,n=!1){if(t.length===0)return e[0];const s=t.reduce((r,i)=>r*i)*(n?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return P4(0,t,e,n)}function F4(t,e){if(Array.isArray(t))return t;if(e==="float32")return t instanceof Float32Array?t:new Float32Array(t);if(e==="int32")return t instanceof Int32Array?t:new Int32Array(t);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(t));throw new Error(`Unknown dtype ${e}`)}function Bx(t,e){const n=us(t,e);for(let s=0;s<n.length;s++)n[s]=1;return n}function us(t,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool")return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function Kk(t,e){const n=t.reduce((s,r)=>s*r,1);if(e==null||e==="float32")return Fr(t,new Float32Array(n));if(e==="int32")return Fr(t,new Int32Array(n));if(e==="bool")return Fr(t,new Uint8Array(n));throw new Error(`Unknown data type ${e}`)}function Sr(t){t.forEach(e=>{O(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`)})}function Pi(t,e,n){if(e===0)return 0;if(e===1)return t[0];let s=t[t.length-1];for(let r=0;r<t.length-1;++r)s+=n[r]*t[r];return s}function bc(t,e,n){if(e===0)return[];if(e===1)return[t];const s=new Array(e);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(t/n[r]),t-=s[r]*n[r];return s[s.length-1]=t,s}function ua(t){return t&&t.then&&typeof t.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XO="tfjsflags";class L4{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=kee,this.populateURLFlags()}setPlatform(e,n){this.platform!=null&&(Z().getBool("IS_TEST")||Z().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=n}registerFlag(e,n,s){if(this.flagRegistry[e]={evaluationFn:n,setHook:s},this.urlFlags[e]!=null){const r=this.urlFlags[e];Z().getBool("IS_TEST")||Z().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const n=this.evaluateFlag(e);if(ua(n))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=n,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,n){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=n,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(n)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);XO in e&&e[XO].split(",").forEach(s=>{const[r,i]=s.split(":");this.urlFlags[r]=Nee(r,i)})}}function kee(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(n,...s)=>(Eee(e,s[0],s[1]),s.join("="))),e}function Eee(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}function Nee(t,e){const n=e.toLowerCase();return n==="true"||n==="false"?n==="true":`${+n}`===n?+n:e}function Z(){return Xk}let Xk=null;function $ee(t){Xk=t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let uC;function M4(){if(uC==null){let t;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else if(typeof self<"u")t=self;else throw new Error("Could not find a global object");uC=t}return uC}function Ree(){const t=M4();return t._tfGlobals==null&&(t._tfGlobals=new Map),t._tfGlobals}function Yk(t,e){const n=Ree();if(n.has(t))return n.get(t);{const s=e();return n.set(t,s),n.get(t)}}const rg="Abs",pd="Acos",md="Acosh",Sc="Add",ig="AddN",Vx="All",Ux="Any",og="ArgMax",ag="ArgMin",gd="Asin",yd="Asinh",vd="Atan",wd="Atanh",xd="Atan2",lg="AvgPool",Wx="AvgPoolGrad",ug="AvgPool3D",jx="AvgPool3DGrad",cg="BatchMatMul",hg="BatchToSpaceND",Gx="Bincount",dg="BitwiseAnd",z4="BroadcastTo",Hx="BroadcastArgs",bd="Cast",Sd="Ceil",Cd="ClipByValue",qx="Complex",fg="ComplexAbs",pg="Concat",mg="Conv2D",Kx="Conv2DBackpropFilter",gg="Conv2DBackpropInput",yg="Conv3D",Xx="Conv3DBackpropFilterV2",Yx="Conv3DBackpropInputV2",Id="Cos",_d="Cosh",Qx="Cumprod",vg="Cumsum",Jx="CropAndResize",Zx="DenseBincount",eb="DepthToSpace",wg="DepthwiseConv2dNative",tb="DepthwiseConv2dNativeBackpropFilter",nb="DepthwiseConv2dNativeBackpropInput",sb="Diag",xg="Dilation2D",Cw="Dilation2DBackpropInput",Iw="Dilation2DBackpropFilter",rb="Draw",Td="RealDiv",ib="Einsum",kd="Elu",ob="EluGrad",Ed="Erf",bg="Equal",Nd="Exp",Sg="ExpandDims",$d="Expm1",ab="FFT",lb="Fill",ub="FlipLeftRight",Rd="Floor",Ad="FloorDiv",Cg="FusedBatchNorm",Ig="GatherV2",cb="GatherNd",_g="Greater",Dd="GreaterEqual",Od="Identity",hb="IFFT",db="Imag",Pd="IsFinite",Fd="IsInf",Ld="IsNan",Tg="LeakyRelu",kg="Less",Eg="LessEqual",fb="LinSpace",Md="Log",zd="Log1p",Ng="LogicalAnd",$g="LogicalNot",Rg="LogicalOr",Aee="LogicalXor",B4="LogSoftmax",Dee="LowerBound",Ag="LRN",pb="LRNGrad",Oee="MatrixBandPart",Dg="Max",Bd="Maximum",Og="MaxPool",mb="MaxPoolGrad",Pg="MaxPool3D",gb="MaxPool3DGrad",yb="MaxPoolWithArgmax",Fg="Mean",Lg="Min",Vd="Minimum",Mg="MirrorPad",Ud="Mod",vb="Multinomial",Wd="Multiply",zg="Neg",Bg="NotEqual",wb="NonMaxSuppressionV3",xb="NonMaxSuppressionV4",bb="NonMaxSuppressionV5",Vg="OnesLike",Ug="OneHot",Wg="Pack",jg="PadV2",Pee="Pool",jd="Pow",Gg="Prelu",Hg="Prod",Sb="RaggedGather",Cb="RaggedRange",Ib="RaggedTensorToTensor",_b="Range",Tb="Real",Gd="Reciprocal",Hd="Relu",qg="Reshape",Kg="ResizeNearestNeighbor",kb="ResizeNearestNeighborGrad",Xg="ResizeBilinear",Eb="ResizeBilinearGrad",qd="Relu6",Yg="Reverse",Kd="Round",Xd="Rsqrt",Nb="ScatterNd",$b="TensorScatterUpdate",Rb="SearchSorted",Qg="Select",Yd="Selu",Jg="Slice",Qd="Sin",Jd="Sinh",Zd="Sign",ef="Sigmoid",tf="Softplus",nf="Sqrt",Zg="Sum",ey="SpaceToBatchND",ty="SplitV",ny="Softmax",Ab="SparseFillEmptyRows",Db="SparseReshape",Ob="SparseSegmentMean",Pb="SparseSegmentSum",Fb="SparseToDense",sf="SquaredDifference",Lb="Square",sy="StaticRegexReplace",Mb="StridedSlice",zb="StringNGrams",Bb="StringSplit",Vb="StringToHashBucketFast",rf="Sub",of="Tan",af="Tanh",lf="Tile",Ub="TopK",Wb="Transform",Au="Transpose",jb="Unique",ry="Unpack",iy="UnsortedSegmentSum",Fee="UpperBound",oy="ZerosLike",uf="Step",_w="FromPixels",Gb="RotateWithOffset",wm="_FusedMatMul",xm="FusedConv2D",bm="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nr(...t){Z().getBool("IS_TEST")||Z().getBool("PROD")||console.warn(...t)}function Lee(...t){Z().getBool("IS_TEST")||Z().getBool("PROD")||console.log(...t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vh=Yk("kernelRegistry",()=>new Map),Sm=Yk("gradRegistry",()=>new Map);function Cm(t,e){const n=Qk(t,e);return Vh.get(n)}function KI(t){return Sm.get(t)}function Tw(t){const e=Vh.entries(),n=[];for(;;){const{done:s,value:r}=e.next();if(s)break;const[i,o]=r,[a]=i.split("_");a===t&&n.push(o)}return n}function Hb(t){const{kernelName:e,backendName:n}=t,s=Qk(e,n);Vh.has(s)&&Nr(`The kernel '${e}' for backend '${n}' is already registered`),Vh.set(s,t)}function V4(t){const{kernelName:e}=t;Sm.has(e)&&Z().getBool("DEBUG")&&Nr(`Overriding the gradient for '${e}'`),Sm.set(e,t)}function Mee(t,e){const n=Qk(t,e);if(!Vh.has(n))throw new Error(`The kernel '${t}' for backend '${e}' is not registered`);Vh.delete(n)}function zee(t){if(!Sm.has(t))throw new Error(`The gradient '${t}' for backend is not registered`);Sm.delete(t)}function Bee(t,e){Tw(t).forEach(s=>{const r=Object.assign({},s,{backendName:e});Hb(r)})}function Qk(t,e){return`${e}_${t}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U4(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}var W4=qt,ti=null;try{ti=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function qt(t,e,n){this.low=t|0,this.high=e|0,this.unsigned=!!n}qt.prototype.__isLong__;Object.defineProperty(qt.prototype,"__isLong__",{value:!0});function Cr(t){return(t&&t.__isLong__)===!0}qt.isLong=Cr;var YO={},QO={};function Cc(t,e){var n,s,r;return e?(t>>>=0,(r=0<=t&&t<256)&&(s=QO[t],s)?s:(n=Kt(t,(t|0)<0?-1:0,!0),r&&(QO[t]=n),n)):(t|=0,(r=-128<=t&&t<128)&&(s=YO[t],s)?s:(n=Kt(t,t<0?-1:0,!1),r&&(YO[t]=n),n))}qt.fromInt=Cc;function ni(t,e){if(isNaN(t))return e?_u:si;if(e){if(t<0)return _u;if(t>=j4)return q4}else{if(t<=-ZO)return dr;if(t+1>=ZO)return H4}return t<0?ni(-t,e).neg():Kt(t%Uh|0,t/Uh|0,e)}qt.fromNumber=ni;function Kt(t,e,n){return new qt(t,e,n)}qt.fromBits=Kt;var kw=Math.pow;function Jk(t,e,n){if(t.length===0)throw Error("empty string");if(t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return si;if(typeof e=="number"?(n=e,e=!1):e=!!e,n=n||10,n<2||36<n)throw RangeError("radix");var s;if((s=t.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return Jk(t.substring(1),e,n).neg();for(var r=ni(kw(n,8)),i=si,o=0;o<t.length;o+=8){var a=Math.min(8,t.length-o),l=parseInt(t.substring(o,o+a),n);if(a<8){var u=ni(kw(n,a));i=i.mul(u).add(ni(l))}else i=i.mul(r),i=i.add(ni(l))}return i.unsigned=e,i}qt.fromString=Jk;function qi(t,e){return typeof t=="number"?ni(t,e):typeof t=="string"?Jk(t,e):Kt(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}qt.fromValue=qi;var JO=65536,Vee=1<<24,Uh=JO*JO,j4=Uh*Uh,ZO=j4/2,eP=Cc(Vee),si=Cc(0);qt.ZERO=si;var _u=Cc(0,!0);qt.UZERO=_u;var ph=Cc(1);qt.ONE=ph;var G4=Cc(1,!0);qt.UONE=G4;var XI=Cc(-1);qt.NEG_ONE=XI;var H4=Kt(-1,2147483647,!1);qt.MAX_VALUE=H4;var q4=Kt(-1,-1,!0);qt.MAX_UNSIGNED_VALUE=q4;var dr=Kt(0,-2147483648,!1);qt.MIN_VALUE=dr;var Se=qt.prototype;Se.toInt=function(){return this.unsigned?this.low>>>0:this.low};Se.toNumber=function(){return this.unsigned?(this.high>>>0)*Uh+(this.low>>>0):this.high*Uh+(this.low>>>0)};Se.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(dr)){var n=ni(e),s=this.div(n),r=s.mul(n).sub(this);return s.toString(e)+r.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=ni(kw(e,6),this.unsigned),o=this,a="";;){var l=o.div(i),u=o.sub(l.mul(i)).toInt()>>>0,c=u.toString(e);if(o=l,o.isZero())return c+a;for(;c.length<6;)c="0"+c;a=""+c+a}};Se.getHighBits=function(){return this.high};Se.getHighBitsUnsigned=function(){return this.high>>>0};Se.getLowBits=function(){return this.low};Se.getLowBitsUnsigned=function(){return this.low>>>0};Se.getNumBitsAbs=function(){if(this.isNegative())return this.eq(dr)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,n=31;n>0&&!(e&1<<n);n--);return this.high!=0?n+33:n+1};Se.isZero=function(){return this.high===0&&this.low===0};Se.eqz=Se.isZero;Se.isNegative=function(){return!this.unsigned&&this.high<0};Se.isPositive=function(){return this.unsigned||this.high>=0};Se.isOdd=function(){return(this.low&1)===1};Se.isEven=function(){return(this.low&1)===0};Se.equals=function(e){return Cr(e)||(e=qi(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Se.eq=Se.equals;Se.notEquals=function(e){return!this.eq(e)};Se.neq=Se.notEquals;Se.ne=Se.notEquals;Se.lessThan=function(e){return this.comp(e)<0};Se.lt=Se.lessThan;Se.lessThanOrEqual=function(e){return this.comp(e)<=0};Se.lte=Se.lessThanOrEqual;Se.le=Se.lessThanOrEqual;Se.greaterThan=function(e){return this.comp(e)>0};Se.gt=Se.greaterThan;Se.greaterThanOrEqual=function(e){return this.comp(e)>=0};Se.gte=Se.greaterThanOrEqual;Se.ge=Se.greaterThanOrEqual;Se.compare=function(e){if(Cr(e)||(e=qi(e)),this.eq(e))return 0;var n=this.isNegative(),s=e.isNegative();return n&&!s?-1:!n&&s?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Se.comp=Se.compare;Se.negate=function(){return!this.unsigned&&this.eq(dr)?dr:this.not().add(ph)};Se.neg=Se.negate;Se.add=function(e){Cr(e)||(e=qi(e));var n=this.high>>>16,s=this.high&65535,r=this.low>>>16,i=this.low&65535,o=e.high>>>16,a=e.high&65535,l=e.low>>>16,u=e.low&65535,c=0,h=0,d=0,f=0;return f+=i+u,d+=f>>>16,f&=65535,d+=r+l,h+=d>>>16,d&=65535,h+=s+a,c+=h>>>16,h&=65535,c+=n+o,c&=65535,Kt(d<<16|f,c<<16|h,this.unsigned)};Se.subtract=function(e){return Cr(e)||(e=qi(e)),this.add(e.neg())};Se.sub=Se.subtract;Se.multiply=function(e){if(this.isZero())return si;if(Cr(e)||(e=qi(e)),ti){var n=ti.mul(this.low,this.high,e.low,e.high);return Kt(n,ti.get_high(),this.unsigned)}if(e.isZero())return si;if(this.eq(dr))return e.isOdd()?dr:si;if(e.eq(dr))return this.isOdd()?dr:si;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(eP)&&e.lt(eP))return ni(this.toNumber()*e.toNumber(),this.unsigned);var s=this.high>>>16,r=this.high&65535,i=this.low>>>16,o=this.low&65535,a=e.high>>>16,l=e.high&65535,u=e.low>>>16,c=e.low&65535,h=0,d=0,f=0,p=0;return p+=o*c,f+=p>>>16,p&=65535,f+=i*c,d+=f>>>16,f&=65535,f+=o*u,d+=f>>>16,f&=65535,d+=r*c,h+=d>>>16,d&=65535,d+=i*u,h+=d>>>16,d&=65535,d+=o*l,h+=d>>>16,d&=65535,h+=s*c+r*u+i*l+o*a,h&=65535,Kt(f<<16|p,h<<16|d,this.unsigned)};Se.mul=Se.multiply;Se.divide=function(e){if(Cr(e)||(e=qi(e)),e.isZero())throw Error("division by zero");if(ti){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var n=(this.unsigned?ti.div_u:ti.div_s)(this.low,this.high,e.low,e.high);return Kt(n,ti.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?_u:si;var s,r,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return _u;if(e.gt(this.shru(1)))return G4;i=_u}else{if(this.eq(dr)){if(e.eq(ph)||e.eq(XI))return dr;if(e.eq(dr))return ph;var o=this.shr(1);return s=o.div(e).shl(1),s.eq(si)?e.isNegative()?ph:XI:(r=this.sub(e.mul(s)),i=s.add(r.div(e)),i)}else if(e.eq(dr))return this.unsigned?_u:si;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=si}for(r=this;r.gte(e);){s=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(s)/Math.LN2),l=a<=48?1:kw(2,a-48),u=ni(s),c=u.mul(e);c.isNegative()||c.gt(r);)s-=l,u=ni(s,this.unsigned),c=u.mul(e);u.isZero()&&(u=ph),i=i.add(u),r=r.sub(c)}return i};Se.div=Se.divide;Se.modulo=function(e){if(Cr(e)||(e=qi(e)),ti){var n=(this.unsigned?ti.rem_u:ti.rem_s)(this.low,this.high,e.low,e.high);return Kt(n,ti.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Se.mod=Se.modulo;Se.rem=Se.modulo;Se.not=function(){return Kt(~this.low,~this.high,this.unsigned)};Se.and=function(e){return Cr(e)||(e=qi(e)),Kt(this.low&e.low,this.high&e.high,this.unsigned)};Se.or=function(e){return Cr(e)||(e=qi(e)),Kt(this.low|e.low,this.high|e.high,this.unsigned)};Se.xor=function(e){return Cr(e)||(e=qi(e)),Kt(this.low^e.low,this.high^e.high,this.unsigned)};Se.shiftLeft=function(e){return Cr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Kt(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Kt(0,this.low<<e-32,this.unsigned)};Se.shl=Se.shiftLeft;Se.shiftRight=function(e){return Cr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Kt(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Kt(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Se.shr=Se.shiftRight;Se.shiftRightUnsigned=function(e){if(Cr(e)&&(e=e.toInt()),e&=63,e===0)return this;var n=this.high;if(e<32){var s=this.low;return Kt(s>>>e|n<<32-e,n>>>e,this.unsigned)}else return e===32?Kt(n,0,this.unsigned):Kt(n>>>e-32,0,this.unsigned)};Se.shru=Se.shiftRightUnsigned;Se.shr_u=Se.shiftRightUnsigned;Se.toSigned=function(){return this.unsigned?Kt(this.low,this.high,!1):this};Se.toUnsigned=function(){return this.unsigned?this:Kt(this.low,this.high,!0)};Se.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Se.toBytesLE=function(){var e=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Se.toBytesBE=function(){var e=this.high,n=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,n>>>24,n>>>16&255,n>>>8&255,n&255]};qt.fromBytes=function(e,n,s){return s?qt.fromBytesLE(e,n):qt.fromBytesBE(e,n)};qt.fromBytesLE=function(e,n){return new qt(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,n)};qt.fromBytesBE=function(e,n){return new qt(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],n)};const K4=DF(W4),Uee=u6({__proto__:null,default:K4},[W4]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mu=K4||Uee;function ay(t){return mu.fromString(t,!0,16)}const X4=ay("c3a5c85c97cb3127"),du=ay("b492b66fbe98f273"),Rs=ay("9ae16a3b2f90404f");function YI(t){return t.xor(t.shru(47))}function Y4(t,e,n){const s=t.slice(e,e+n);return mu.fromBytes(Array.from(s),!0,!0)}function zt(t,e){return Y4(t,e,8)}function tP(t,e){return Y4(t,e,4)}function Un(t,e){return e===0?t:t.shru(e).or(t.shl(64-e))}function gl(t,e,n=ay("9ddfea08eb382d69")){let s=t.xor(e).mul(n);s=s.xor(s.shru(47));let r=e.xor(s).mul(n);return r=r.xor(r.shru(47)),r=r.mul(n),r}function Wee(t,e,n,s,r,i){r=r.add(t),i=Un(i.add(r).add(s),21);const o=r;return r=r.add(e),r=r.add(n),i=i.add(Un(r,44)),[r.add(s),i.add(o)]}function R0(t,e,n,s){return Wee(zt(t,e),zt(t,e+8),zt(t,e+16),zt(t,e+24),n,s)}function jee(t,e=t.length){if(e>=8){const n=Rs.add(e*2),s=zt(t,0).add(Rs),r=zt(t,e-8),i=Un(r,37).mul(n).add(s),o=Un(s,25).add(r).mul(n);return gl(i,o,n)}if(e>=4){const n=Rs.add(e*2),s=tP(t,0);return gl(s.shl(3).add(e),tP(t,e-4),n)}if(e>0){const n=t[0],s=t[e>>1],r=t[e-1],i=n+(s<<8),o=e+(r<<2);return YI(Rs.mul(i).xor(X4.mul(o))).mul(Rs)}return Rs}function Gee(t,e=t.length){const n=Rs.add(e*2),s=zt(t,0).mul(du),r=zt(t,8),i=zt(t,e-8).mul(n),o=zt(t,e-16).mul(Rs);return gl(Un(s.add(r),43).add(Un(i,30)).add(o),s.add(Un(r.add(Rs),18)).add(i),n)}function Hee(t,e=t.length){const n=Rs.add(e*2),s=zt(t,0).mul(Rs),r=zt(t,8),i=zt(t,e-8).mul(n),o=zt(t,e-16).mul(Rs),a=Un(s.add(r),43).add(Un(i,30)).add(o),l=gl(a,s.add(Un(r.add(Rs),18)).add(i),n),u=zt(t,16).mul(n),c=zt(t,24),h=a.add(zt(t,e-32)).mul(n),d=l.add(zt(t,e-24)).mul(n);return gl(Un(u.add(c),43).add(Un(h,30)).add(d),u.add(Un(c.add(s),18)).add(h),n)}function Q4(t,e=t.length){const n=mu.fromNumber(81,!0);if(e<=32)return e<=16?jee(t,e):Gee(t,e);if(e<=64)return Hee(t,e);let s=n,r=n.mul(du).add(113),i=YI(r.mul(Rs).add(113)).mul(Rs),o=[mu.UZERO,mu.UZERO],a=[mu.UZERO,mu.UZERO];s=s.mul(Rs).add(zt(t,0));let l=0;const u=(e-1>>6)*64,c=u+(e-1&63)-63;do s=Un(s.add(r).add(o[0]).add(zt(t,l+8)),37).mul(du),r=Un(r.add(o[1]).add(zt(t,l+48)),42).mul(du),s=s.xor(a[1]),r=r.add(o[0]).add(zt(t,l+40)),i=Un(i.add(a[0]),33).mul(du),o=R0(t,l,o[1].mul(du),s.add(a[0])),a=R0(t,l+32,i.add(a[1]),r.add(zt(t,l+16))),[i,s]=[s,i],l+=64;while(l!==u);const h=du.add(i.and(255).shl(1));return l=c,a[0]=a[0].add(e-1&63),o[0]=o[0].add(a[0]),a[0]=a[0].add(o[0]),s=Un(s.add(r).add(o[0]).add(zt(t,l+8)),37).mul(h),r=Un(r.add(o[1]).add(zt(t,l+48)),42).mul(h),s=s.xor(a[1].mul(9)),r=r.add(o[0].mul(9).add(zt(t,l+40))),i=Un(i.add(a[0]),33).mul(h),o=R0(t,l,o[1].mul(h),s.add(a[0])),a=R0(t,l+32,i.add(a[1]),r.add(zt(t,l+16))),[i,s]=[s,i],gl(gl(o[0],a[0],h).add(YI(r).mul(X4)).add(i),gl(o[1],a[1],h).add(s),h)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xa(t,e){return e==="string"?go(t):Gl([t],e)}function qee(t,e){return t instanceof Float32Array&&e==="float32"||t instanceof Int32Array&&e==="int32"||t instanceof Uint8Array&&e==="bool"}function Gl(t,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=bo(t)),Z().getBool("DEBUG")&&R4(t,e),qee(t,e))return t;if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool"){const n=new Uint8Array(t.length);for(let s=0;s<n.length;++s)Math.round(t[s])!==0&&(n[s]=1);return n}else throw new Error(`Unknown data type ${e}`)}function ns(){return Z().platform.now()}function J4(t,e){return Z().platform.fetch(t,e)}function go(t,e="utf-8"){return e=e||"utf-8",Z().platform.encode(t,e)}function ca(t,e="utf-8"){return e=e||"utf-8",Z().platform.decode(t,e)}function An(t){return Z().platform.isTypedArray!=null?Z().platform.isTypedArray(t):U4(t)}function bo(t,e=[],n=!1){if(e==null&&(e=[]),typeof t=="boolean"||typeof t=="number"||typeof t=="string"||ua(t)||t==null||An(t)&&n)e.push(t);else if(Array.isArray(t)||An(t))for(let s=0;s<t.length;++s)bo(t[s],e,n);else{let s=-1;for(const r of Object.keys(t))/^([1-9]+[0-9]*|0)$/.test(r)&&(s=Math.max(s,Number(r)));for(let r=0;r<=s;r++)bo(t[r],e,n)}return e}const Kee=Object.freeze(Object.defineProperty({__proto__:null,arraysEqual:st,arraysEqualWithNull:$4,assert:O,assertNonNegativeIntegerDimensions:Sr,assertNonNull:wc,assertShapesMatch:cs,bytesFromStringArray:D4,bytesPerElement:vm,checkConversionForErrors:R4,clamp:kl,computeStrides:Me,convertBackendValuesAndArrayBuffer:F4,createScalarValue:xa,createShuffledIndices:Tee,decodeString:ca,distSquared:Cee,encodeString:go,fetch:J4,fingerPrint64:Q4,flatten:bo,getArrayFromDType:cn,getTypedArrayFromDType:qn,hasEncodingLoss:qk,hexToLong:ay,indexToLoc:bc,inferDtype:xc,inferFromImplicitShape:Hk,isBoolean:O4,isFunction:El,isInt:qu,isNumber:bw,isPromise:ua,isScalarShape:Iee,isString:ao,isTypedArray:An,isValidDtype:A4,locToIndex:Pi,makeOnesTypedArray:Bx,makeZerosNestedTypedArray:Kk,makeZerosTypedArray:us,nearestDivisor:Sw,nearestLargerEven:zx,now:ns,parseAxisParam:Ze,randUniform:See,repeatedTry:qI,rightPad:Ru,shuffle:Gk,shuffleCombo:bee,sizeFromShape:re,sizeToSquarishShape:xw,squeezeShape:wa,sum:N4,swap:jo,tanh:_ee,toNestedArray:Fr,toTypedArray:Gl},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xee{constructor(e,n){this.backendTimer=e,this.logger=n,n==null&&(this.logger=new Qee)}profileKernel(e,n,s){let r;const i=()=>{r=s()};let o;const a=ns();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(i);else{i();for(const u of r)u.dataSync();o=Promise.resolve({kernelMs:ns()-a})}if(Z().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let u=0;u<r.length;u++){const c=r[u];c.data().then(h=>{Yee(h,c.dtype,e)})}return{kernelName:e,outputs:r,inputs:n,timeMs:o.then(u=>u.kernelMs),extraInfo:o.then(u=>u.getExtraProfileInfo!=null?u.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:n,outputs:s,timeMs:r,inputs:i,extraInfo:o}=e;s.forEach(a=>{Promise.all([a.data(),r,o]).then(l=>{this.logger.logKernelProfile(n,a,l[0],l[1],i,l[2])})})}}function Yee(t,e,n){if(e!=="float32")return!1;for(let s=0;s<t.length;s++){const r=t[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${n}'`),!0}return!1}class Qee{logKernelProfile(e,n,s,r,i,o){const a=typeof r=="number"?Ru(`${r}ms`,9):r.error,l=Ru(e,25),u=n.rank,c=n.size,h=Ru(n.shape.toString(),14);let d="";for(const f in i){const p=i[f];if(p!=null){const m=p.shape||n.shape,v=m.length;d+=`${f}: ${v}D ${v>0?m:""} `}}console.log(`%c${l}	%c${a}	%c${u}D ${h}	%c${c}	%c${d}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jee(t,e,n){const s={},r={};for(let l=0;l<e.length;l++)s[e[l].id]=!0;for(let l=0;l<t.length;l++){const u=t[l],c=u.inputs;for(const h in c){const d=c[h];let f=!1;for(let p=0;p<e.length;p++)if(s[d.id]){u.outputs.forEach(m=>s[m.id]=!0),f=!0,r[u.id]=!0;break}if(f)break}}const i={};i[n.id]=!0;const o={};for(let l=t.length-1;l>=0;l--){const u=t[l],c=u.inputs;for(let h=0;h<u.outputs.length;h++)if(i[u.outputs[h].id]){for(const d in c)i[c[d].id]=!0,o[u.id]=!0;break}}const a=[];for(let l=0;l<t.length;l++){const u=t[l];if(r[u.id]&&o[u.id]){const c={};for(const d in u.inputs){const f=u.inputs[d];s[f.id]&&(c[d]=f)}const h=Object.assign({},u);h.inputs=c,h.outputs=u.outputs,a.push(h)}}return a}function Zee(t,e,n,s){for(let r=e.length-1;r>=0;r--){const i=e[r],o=[];if(i.outputs.forEach(l=>{const u=t[l.id];u!=null?o.push(u):o.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);const a=i.gradient(o);for(const l in i.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const u=n(()=>a[l]());if(u.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${u.dtype}'`);const c=i.inputs[l];if(!st(u.shape,c.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${l}' has shape '${u.shape}', which does not match the shape of the input '${c.shape}'`);if(t[c.id]==null)t[c.id]=u;else{const h=t[c.id];t[c.id]=s(h,u),h.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nP=20,np=3,cC=7;function ete(t,e,n,s){const r=Me(e),i=tte(t,e,n,r),o=e.length,a=dv(t,e,n,r,i),l=["Tensor"];return s&&(l.push(`  dtype: ${n}`),l.push(`  rank: ${o}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(u=>"    "+u).join(`
`)),l.join(`
`)}function tte(t,e,n,s){const r=re(e),i=s[s.length-1],o=new Array(i).fill(0),a=e.length,l=n==="complex64"?mp(t):t;if(a>1)for(let u=0;u<r/i;u++){const c=u*i;for(let h=0;h<i;h++)o[h]=Math.max(o[h],pp(l[c+h],0,n).length)}return o}function pp(t,e,n){let s;return Array.isArray(t)?s=`${parseFloat(t[0].toFixed(cC))} + ${parseFloat(t[1].toFixed(cC))}j`:ao(t)?s=`'${t}'`:n==="bool"?s=Z4(t):s=parseFloat(t.toFixed(cC)).toString(),Ru(s,e)}function Z4(t){return t===0?"false":"true"}function dv(t,e,n,s,r,i=!0){const o=n==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(n==="complex64"){const m=mp(t);return[pp(m[0],0,n)]}return n==="bool"?[Z4(t[0])]:[t[0].toString()]}if(l===1){if(a>nP){const v=np*o;let g=Array.from(t.slice(0,v)),w=Array.from(t.slice((a-np)*o,a*o));return n==="complex64"&&(g=mp(g),w=mp(w)),["["+g.map((b,x)=>pp(b,r[x],n)).join(", ")+", ..., "+w.map((b,x)=>pp(b,r[a-np+x],n)).join(", ")+"]"]}return["["+(n==="complex64"?mp(t):Array.from(t)).map((v,g)=>pp(v,r[g],n)).join(", ")+"]"]}const u=e.slice(1),c=s.slice(1),h=s[0]*o,d=[];if(a>nP){for(let m=0;m<np;m++){const v=m*h,g=v+h;d.push(...dv(t.slice(v,g),u,n,c,r,!1))}d.push("...");for(let m=a-np;m<a;m++){const v=m*h,g=v+h;d.push(...dv(t.slice(v,g),u,n,c,r,m===a-1))}}else for(let m=0;m<a;m++){const v=m*h,g=v+h;d.push(...dv(t.slice(v,g),u,n,c,r,m===a-1))}const f=l===2?",":"";d[0]="["+(a>0?d[0]+f:"");for(let m=1;m<d.length-1;m++)d[m]=" "+d[m]+f;let p=`,
`;for(let m=2;m<l;m++)p+=`
`;return d[d.length-1]=" "+d[d.length-1]+"]"+(i?"":p),d}function mp(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $n{constructor(e,n,s){if(this.dtype=n,this.shape=e.slice(),this.size=re(e),s!=null){const r=s.length;O(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||cn(n,this.size),this.strides=Me(e)}set(e,...n){n.length===0&&(n=[0]),O(n.length===this.rank,()=>`The number of provided coordinates (${n.length}) must match the rank (${this.rank})`);const s=this.locToIndex(n);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let n=0;for(const r of e){if(r<0||r>=this.shape[n]){const i=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(i)}n++}let s=e[e.length-1];for(let r=0;r<e.length-1;++r)s+=this.strides[r]*e[r];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let n=e[e.length-1];for(let s=0;s<e.length-1;++s)n+=this.strides[s]*e[s];return n}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const n=new Array(this.shape.length);for(let s=0;s<n.length-1;++s)n[s]=Math.floor(e/this.strides[s]),e-=n[s]*this.strides[s];return n[n.length-1]=e,n}get rank(){return this.shape.length}toTensor(){return Ii().makeTensor(this.values,this.shape,this.dtype)}}let Ii=null,Jc=null;function nte(t){Ii=t}function ste(t){Jc=t}class pt{constructor(e,n,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=n||"float32",this.size=re(e),this.strides=Me(e),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Jc.buffer(this.shape,this.dtype,e)}bufferSync(){return Jc.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return Fr(this.shape,e,this.dtype==="complex64")}arraySync(){return Fr(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=Ii().read(this.dataId);if(this.dtype==="string"){const n=await e;try{return n.map(s=>ca(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),Ii().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=Ii().readSync(this.dataId);if(this.dtype==="string")try{return e.map(n=>ca(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await Ii().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),Ii().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Jc.print(this,e)}clone(){return this.throwIfDisposed(),Jc.clone(this)}toString(e=!1){const n=this.dataSync();return ete(n,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Jc.cast(this,e)}variable(e=!0,n,s){return this.throwIfDisposed(),Ii().makeVariable(this,e,n,s)}}Object.defineProperty(pt,Symbol.hasInstance,{value:t=>!!t&&t.data!=null&&t.dataSync!=null&&t.throwIfDisposed!=null});function ie(){return Yk("Tensor",()=>pt)}ie();class Im extends pt{constructor(e,n,s,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=n,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!st(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);Ii().disposeTensor(this),this.dataId=e.dataId,Ii().incRef(this,null)}dispose(){Ii().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(Im,Symbol.hasInstance,{value:t=>t instanceof pt&&t.assign!=null&&t.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var QI;(function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"})(QI||(QI={}));var JI;(function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"})(JI||(JI={}));var ZI;(function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"})(ZI||(ZI={}));var e_;(function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"})(e_||(e_={}));var t_;(function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"})(t_||(t_={}));const rte={float32:e_,int32:JI,bool:ZI,complex64:t_};function Xs(t,e){if(t==="string"||e==="string"){if(t==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return rte[t][e]}function qb(t){return Xs(t,"int32")}function eB(t){return t!=null&&typeof t=="object"&&"texture"in t&&t.texture instanceof WebGLTexture}function tB(t){return typeof GPUBuffer<"u"&&t!=null&&typeof t=="object"&&"buffer"in t&&t.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rn(t,e){if(t.dtype===e.dtype)return[t,e];const n=Xs(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function nB(t,e){O(t.dtype===e.dtype,()=>`The dtypes of the first(${t.dtype}) and second(${e.dtype}) input must match`)}function Kb(t,e){return e.some(n=>n.id===t.id)}function ha(t){const e=[];return sB(t,e,new Set),e}function sB(t,e,n){if(t==null)return;if(t instanceof pt){e.push(t);return}if(!ite(t))return;const s=t;for(const r in s){const i=s[r];n.has(i)||(n.add(i),sB(i,e,n))}}function ite(t){return Array.isArray(t)||typeof t=="object"}const ote=Object.freeze(Object.defineProperty({__proto__:null,assertTypesMatch:nB,getTensorsInContainer:ha,isTensorInList:Kb,makeTypesMatch:rn},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hC(t){return t.kernelName!=null}class sP{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class Wh{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new sP}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const s=e[n];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:n}=this.initializeBackend(e);if(n)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,n,s=1){return e in this.registryFactory?(Nr(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:n,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:n,asyncInit:s}=this.initializeBackend(e);if(!(s?await n:n))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Xee(this.backendInstance),!0}setupRegisteredKernels(){Tw(this.backendName).forEach(n=>{n.setupFunc!=null&&n.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){Tw(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const n=this.registryFactory[e];if(n==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=n.factory();if(s&&!(s instanceof Mx)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,i=s.then(o=>r<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,Nr(`Initialization of backend ${e} failed`),Nr(o.stack||o.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return Nr(`Initialization of backend ${e} failed`),Nr(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,n)=>this.registryFactory[n].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const s=e[n],{success:r,asyncInit:i}=this.initializeBackend(s);if(i||r)return{name:s,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,n){const s=this.state.tensorInfo.get(n),r=s.backend,i=this.readSync(n),o=r.refCount(n);r.disposeData(n,!0),s.backend=e,e.move(n,i,s.shape,s.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,n){let s=null;if(n==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");n=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=n(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,n,s){e();try{const r=s();return n(),r}catch(r){throw n(),r}}nextTensorId(){return Wh.nextTensorId++}nextVariableId(){return Wh.nextVariableId++}clone(e){const n=V.runKernel(Od,{x:e}),s={x:e},r=o=>({x:()=>{const a="float32",l={x:o},u={dtype:a};return V.runKernel(bd,l,u)}}),i=[];return this.addTapeNode(this.state.activeScope.name,s,[n],r,i,{}),n}runKernel(e,n,s){if(this.backendName==null&&this.backend,!(Cm(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:n,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,n,s){const r=this.backend.numDataIds();let i=0;s.forEach(l=>{i+=l.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-n-i-o;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let n,s=[];const r=this.isTapeOn(),i=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const u=hC(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(hC(e)){const{kernelName:p,inputs:m,attrs:v}=e;this.backendName==null&&this.backend;const g=Cm(p,this.backendName);O(g!=null,()=>`Cannot find registered kernel '${p}' for backend '${this.backendName}'`),a=()=>{const w=this.backend.numDataIds();l=g.kernelFunc({inputs:m,attrs:v,backend:this.backend});const b=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(p,w,b);const x=b.map(S=>S.rank!=null?S:this.makeTensorFromTensorInfo(S));if(r){const S=this.getTensorsForGradient(p,m,x);s=this.saveTensorsForBackwardMode(S)}return x}}else{const{forwardFunc:p}=e,m=v=>{r&&(s=v.map(g=>this.keep(this.clone(g))))};a=()=>{const v=this.backend.numDataIds();l=this.tidy(()=>p(this.backend,m));const g=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,v,g),g}}const{inputs:c,attrs:h}=e,d=hC(e)?null:e.backwardsFunc;let f;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=a():(f=this.profiler.profileKernel(u,c,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(f),n=f.outputs)}),r&&this.addTapeNode(u,c,n,d,s,h),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map(p=>c[p]!=null?c[p].shape:null),outputShapes:n.map(p=>p.shape),kernelTimeMs:f.timeMs,extraInfo:f.extraInfo}),Array.isArray(l)?n:n[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,n,s){const r=KI(e);if(r!=null){const i=r.inputsToSave||[],o=r.outputsToSave||[];let a;r.saveAllInputs?(O(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(n).map(u=>n[u])):a=i.map(u=>n[u]);const l=s.filter((u,c)=>o[c]);return a.concat(l)}return[]}makeTensor(e,n,s,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let i=e;s==="string"&&ao(e[0])&&(i=e.map(l=>go(l)));const o=r.write(i,n,s),a=new pt(n,s,o,this.nextTensorId());if(this.trackTensor(a,r),s==="string"){const l=this.state.tensorInfo.get(o),u=D4(i);this.state.numBytes+=u-l.bytes,l.bytes=u}return a}makeTensorFromDataId(e,n,s,r){s=s||"float32";const i={dataId:e,shape:n,dtype:s};return this.makeTensorFromTensorInfo(i,r)}makeTensorFromTensorInfo(e,n){const{dataId:s,shape:r,dtype:i}=e,o=new pt(r,i,s,this.nextTensorId());return this.trackTensor(o,n),o}makeVariable(e,n=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const i=new Im(e,n,s,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,n){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*vm(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:n||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof Im||this.track(e)}incRef(e,n){this.trackTensor(e,n),this.backend.incRef(e.dataId)}removeDataId(e,n){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===n&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const n=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*vm(e.dtype);this.state.numBytes-=s}n.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,n.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const n=this.state.registeredVariables[e];this.disposeVariable(n)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const n=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,n,s,r,i,o){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:n,outputs:s,saved:i},l=KI(e);l!=null&&(r=l.gradFunc),r!=null&&(a.gradient=u=>(u=u.map((c,h)=>{if(c==null){const d=s[h],f=us(d.size,d.dtype);return this.makeTensor(f,d.shape,d.dtype)}return c}),r(u.length>1?u:u[0],i,o))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(n.name=e),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(e){const n=ha(e),s=new Set(n.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){const o=this.state.activeScope.track[i];!o.kept&&!s.has(o.id)&&o.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(i=>{!i.kept&&i.scopeId===r.id&&this.track(i)})}gradients(e,n,s,r=!1){if(O(n.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));O(i instanceof pt,()=>"The result y returned by f() must be a tensor.");const o=Jee(this.state.activeTape,n,i);if(!r&&o.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[i.id]=s??ate(i.shape),Zee(a,o,u=>this.tidy(u),lte);const l=n.map(u=>a[u.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(u=>{for(const c of u.saved)c.dispose()}),this.state.activeTape=null),{value:i,grads:l}})}customGrad(e){return O(El(e),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{O(n.every(a=>a instanceof pt),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};n.forEach((a,l)=>{r[l]=a});const i=(a,l)=>(s=e(...n,l),O(s.value instanceof pt,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),O(El(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),o=(a,l)=>{const u=s.gradFunc(a,l),c=Array.isArray(u)?u:[u];O(c.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),O(c.every(d=>d instanceof pt),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const h={};return c.forEach((d,f)=>{h[f]=()=>d}),h};return this.runKernelFunc({forwardFunc:i,backwardsFunc:o,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,n){return this.state.tensorInfo.get(e).backend.readToGPU(e,n)}async time(e){const n=ns(),s=await this.backend.time(e);return s.wallMs=ns()-n,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new sP;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}Wh.nextTensorId=0;Wh.nextVariableId=0;function ate(t){const e=Bx(re(t),"float32");return V.makeTensor(e,t,"float32")}function rB(){const t=M4();if(t._tfengine==null){const e=new L4(t);t._tfengine=new Wh(e)}return $ee(t._tfengine.ENV),nte(()=>t._tfengine),t._tfengine}const V=rB();function lte(t,e){const n={a:t,b:e};return V.runKernel(Sc,n)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ute(){return typeof navigator<"u"&&navigator!=null}let n_;function cte(t){n_=t}function Zk(t){if(n_!==void 0)return n_;if(t||ute()){if(t||(t=navigator),t.product==="ReactNative")return!0;const e=t.userAgent||t.vendor||(typeof window<"u"?window.opera:"");if(!e){const n=t;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function eE(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}const hte=Object.freeze(Object.defineProperty({__proto__:null,isBrowser:eE,isMobile:Zk,mockIsMobile:cte},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ys=Z();Ys.registerFlag("DEBUG",()=>!1,t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Ys.registerFlag("IS_BROWSER",()=>eE());Ys.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Ys.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Ys.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Ys.registerFlag("PROD",()=>!1);Ys.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Ys.getBool("DEBUG"));Ys.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Ys.registerFlag("IS_TEST",()=>!1);Ys.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Ys.getBool("DEBUG"));Ys.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Ys.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Ys.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function So(t,e){let n=t;if(An(t))return e==="string"?[]:[t.length];if(eB(t)){const r=t.channels||"RGBA";return[t.height,t.width*r.length]}else if(tB(t))return[t.buffer.size/(e==null?4:vm(e))];if(!Array.isArray(t))return[];const s=[];for(;Array.isArray(n)||An(n)&&e!=="string";)s.push(n.length),n=n[0];return Array.isArray(t)&&Z().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&iB(t,s,[]),s}function iB(t,e,n){if(n=n||[],!Array.isArray(t)&&!An(t)){O(e.length===0,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}O(e.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`),O(t.length===e[0],()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`);const s=e.slice(1);for(let r=0;r<t.length;++r)iB(t[r],s,n.concat(r))}function rP(t,e,n,s){if(t!=="string_or_numeric"){if(t==null)throw new Error("Expected dtype cannot be null.");if(t!=="numeric"&&t!==e||t==="numeric"&&e==="string")throw new Error(`Argument '${n}' passed to '${s}' must be ${t} tensor, but got ${e} tensor`)}}function P(t,e,n,s="numeric"){if(t instanceof ie())return rP(s,t.dtype,e,n),t;let r=xc(t);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),rP(s,r,e,n),t==null||!An(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){const l=t==null?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${l}'`)}const i=So(t,r);!An(t)&&!Array.isArray(t)&&(t=[t]);const a=r!=="string"?Gl(t,r):bo(t,[],!0);return V.makeTensor(a,i,r)}function _m(t,e,n,s="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map((i,o)=>P(i,`${e}[${o}]`,n,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tE="__op";function U(t){const e=Object.keys(t);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const s=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n=n+tE;const r=(...i)=>{V.startScope(n);try{const o=s(...i);return ua(o)&&console.error("Cannot return a Promise inside of tidy."),V.endScope(o),o}catch(o){throw V.endScope(null),o}};return Object.defineProperty(r,"name",{value:n,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dte(t,e){const n=P(t,"real","complex"),s=P(e,"imag","complex");cs(n.shape,s.shape,`real and imag shapes, ${n.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:n,imag:s};return V.runKernel(qx,r)}const da=U({complex_:dte});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hl(t,e,n,s){if(s==null)s=xc(t);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(tB(t)||eB(t)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return V.backend.createTensorFromGPUData(t,e||n,s)}if(!An(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Sr(e);const r=re(e),i=re(n);O(r===i,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${i}`);for(let o=0;o<n.length;++o){const a=n[o],l=o===n.length-1?a!==re(e.slice(o)):!0;O(n[o]===e[o]||!l,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `)}}return!An(t)&&!Array.isArray(t)&&(t=[t]),e=e||n,t=s!=="string"?Gl(t,s):bo(t,[],!0),V.makeTensor(t,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gr(t,e,n){const s=So(t,n);return Hl(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ku={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class Ki{static join(e){return new Ki(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(s=>An(s)?s.buffer:s),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let n=0;for(let s=0;s<e.length;s++){const r=e[s];s!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const i=n+r.byteLength;this.shards.push({buffer:r,start:n,end:i}),n=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,n=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,n=isNaN(Number(n))?0:n,e=Math.max(0,e),n=Math.min(this.byteLength,n),n<=e)return new ArrayBuffer(0);const s=this.findShardForByte(e);if(s===-1)throw new Error(`Could not find start shard for byte ${e}`);const r=n-e,i=new ArrayBuffer(r),o=new Uint8Array(i);let a=0;for(let l=s;l<this.shards.length;l++){const u=this.shards[l],h=e+a-u.start,d=a,p=Math.min(n,u.end)-u.start,m=new Uint8Array(u.buffer,h,p-h);if(o.set(m,d),a+=m.length,n<u.end)break}return i}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function n(r){return e<r.start?-1:e>=r.end?1:0}if(n(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=fte(this.shards,n);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function fte(t,e){let n=0,s=t.length;for(;n<=s;){const r=Math.floor((s-n)/2)+n,i=e(t[r]);if(i===0)return r;i<0?s=r:n=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pte(){Z().set("PROD",!0)}function mte(){Z().set("DEBUG",!0)}function gte(){Z().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function yte(t){Z().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function vte(){V.disposeVariables()}function xi(){return V}function s_(){return V.memory()}function wte(t){return V.profile(t)}function J(t,e){return V.tidy(t,e)}function je(t){ha(t).forEach(n=>n.dispose())}function On(t){return V.keep(t)}function xte(t){return V.time(t)}function bte(t){return V.setBackend(t)}function Ste(){return V.ready()}function oB(){return V.backendName}function Cte(t){V.removeBackend(t)}function Ite(t){return V.findBackend(t)}function _te(t){return V.findBackendFactory(t)}function nE(t,e,n=1){return V.registerBackend(t,e,n)}function sE(){return V.backend}function Tte(t,e){Z().setPlatform(t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nl=4;async function r_(t,e){const n=[],s=[],r=Array.isArray(t)?t.map(o=>o.name):Object.keys(t);for(let o=0;o<r.length;++o){const a=r[o],l=Array.isArray(t)?t[o].tensor:t[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const u={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const c=new Promise(async h=>{const d=await l.bytes(),f=d.reduce((v,g)=>v+g.length,0)+Nl*d.length,p=new Uint8Array(f);let m=0;for(let v=0;v<d.length;v++){const g=d[v],w=new Uint8Array(new Uint32Array([g.length]).buffer);p.set(w,m),m+=Nl,p.set(g,m),m+=g.length}h(p)});s.push(c)}else s.push(l.data());e!=null&&(u.group=e),n.push(u)}const i=await Promise.all(s);return{data:Nte(i),specs:n}}function rE(t,e){const n=new Ki(t),s={};let r=0;for(const i of e){const o=kte(i,(a,l)=>n.slice(r+a,r+l));s[i.name]=aB(i,n.slice(r,r+o)),r+=o}return s}function kte(t,e){const n=re(t.shape);let s;if("quantization"in t){const r=t.quantization;s=Ku[r.dtype]}else if(t.dtype==="string"){let r=0;for(let i=0;i<n;i++)r+=Nl+new Uint32Array(e(r,r+Nl))[0];return r}else s=Ku[t.dtype];return n*s}async function Ete(t,e){const n=re(t.shape);let s;if("quantization"in t){const r=t.quantization;s=Ku[r.dtype]}else if(t.dtype==="string"){let r=0;for(let i=0;i<n;i++)r+=Nl+new Uint32Array(await e(r,r+Nl))[0];return r}else s=Ku[t.dtype];return n*s}function aB(t,e){const n=t.name,s=t.dtype,r=t.shape,i=re(r);let o,a=0;if("quantization"in t){const l=t.quantization;if(l.dtype==="uint8"||l.dtype==="uint16"){if(!("min"in l&&"scale"in l))throw new Error(`Weight ${t.name} with quantization ${l.dtype} doesn't have corresponding metadata min and scale.`)}else if(l.dtype==="float16"){if(s!=="float32")throw new Error(`Weight ${t.name} is quantized with ${l.dtype} which only supports weights of type float32 not ${s}.`)}else throw new Error(`Weight ${t.name} has unknown quantization dtype ${l.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const u=Ku[l.dtype],c=l.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(s==="float32")if(l.dtype==="uint8"||l.dtype==="uint16"){o=new Float32Array(c.length);for(let h=0;h<c.length;h++){const d=c[h];o[h]=d*l.scale+l.min}}else if(l.dtype==="float16")o=Pte()(c);else throw new Error(`Unsupported quantization type ${l.dtype} for weight type float32.`);else if(s==="int32"){if(l.dtype!=="uint8"&&l.dtype!=="uint16")throw new Error(`Unsupported quantization type ${l.dtype} for weight type int32.`);o=new Int32Array(c.length);for(let h=0;h<c.length;h++){const d=c[h];o[h]=Math.round(d*l.scale+l.min)}}else throw new Error(`Unsupported dtype in weight '${n}': ${s}`);a+=i*u}else if(s==="string"){const l=re(t.shape);o=[];for(let u=0;u<l;u++){const c=new Uint32Array(e.slice(a,a+Nl))[0];a+=Nl;const h=new Uint8Array(e.slice(a,a+c));o.push(h),a+=c}}else{const l=Ku[s];if(s==="float32")o=new Float32Array(e);else if(s==="int32")o=new Int32Array(e);else if(s==="bool")o=new Uint8Array(e);else if(s==="complex64"){o=new Float32Array(e);const u=new Float32Array(o.length/2),c=new Float32Array(o.length/2);for(let p=0;p<u.length;p++)u[p]=o[p*2],c[p]=o[p*2+1];const h=gr(u,r,"float32"),d=gr(c,r,"float32"),f=da(h,d);return h.dispose(),d.dispose(),f}else throw new Error(`Unsupported dtype in weight '${n}': ${s}`);a+=i*l}return gr(o,r,s)}async function iP(t,e,n){let s=new Uint8Array(e);for(;s.byteLength<n;){const{done:r,value:i}=await t.read();if(r&&i==null){const a=n-s.byteLength;throw new Error(`Reader is done but ${a} bytes are still expected`)}const o=new Uint8Array(s.length+i.byteLength);o.set(s,0),o.set(new Uint8Array(i),s.length),s=o}return s.buffer}async function lB(t,e){const n={},s=t.getReader();let r=new ArrayBuffer(0);for(const i of e){const o=await Ete(i,async(u,c)=>(r=await iP(s,r,c),r.slice(u,c)));r=await iP(s,r,o);const a=r.slice(0,o);r=r.slice(o);const l=aB(i,a);if(n[i.name]=l,oB()==="webgpu"){const u=sE();"uploadToGPU"in u&&re(l.shape)>=Z().get("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD")&&u.uploadToGPU(l.dataId)}}return n}function Nte(t){if(t===null)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0;const n=[];t.forEach(i=>{if(e+=i.byteLength,n.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${i.constructor.name}`)});const s=new Uint8Array(e);let r=0;return n.forEach(i=>{s.set(new Uint8Array(i.buffer),r),r+=i.byteLength}),s.buffer}const iE=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function oP(t){return iE?Buffer.byteLength(t,"utf8"):new Blob([t]).size}function $te(t){if(iE)return Buffer.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let s=0,r=e.length;s<r;s++)n+=String.fromCharCode(e[s]);return btoa(n)}function Rte(t){if(iE){const s=Buffer.from(t,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let s=0;s<e.length;++s)n.set([e.charCodeAt(s)],s);return n.buffer}function uB(t){return Ki.join(t)}function aP(t){const e="/";for(t=t.trim();t.endsWith(e);)t=t.slice(0,t.length-1);const n=t.split(e);return n[n.length-1]}function cB(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return t.signature!=null&&(n.signature=t.signature),t.userDefinedMetadata!=null&&(n.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(n.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(n.initializerSignature=t.initializerSignature),t.trainingConfig!=null&&(n.trainingConfig=t.trainingConfig),n}function oE(t,e,n){const s={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(t.trainingConfig!=null&&(s.trainingConfig=t.trainingConfig),t.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");s.weightSpecs=e,s.weightData=n}return t.signature!=null&&(s.signature=t.signature),t.userDefinedMetadata!=null&&(s.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(s.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(s.initializerSignature=t.initializerSignature),s}async function aE(t,e){let n,s;return t.weightsManifest!=null&&([n,s]=await e(t.weightsManifest)),oE(t,n,s)}function ly(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:oP(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:oP(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:new Ki(t.weightData).byteLength}}function Ew(t){const e=[];for(const n of t)e.push(...n.weights);return e}function Ate(){const t=n=>{let s=n<<13,r=0;for(;!(s&8388608);)r-=8388608,s<<=1;return s&=-8388609,r+=947912704,s|r},e=new Uint32Array(2048);e[0]=0;for(let n=1;n<1024;n++)e[n]=t(n);for(let n=1024;n<2048;n++)e[n]=939524096+(n-1024<<13);return e}function Dte(){const t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}function Ote(){const t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}function Pte(){const t=Ate(),e=Dte(),n=Ote();return s=>{const r=new ArrayBuffer(4*s.length),i=new Uint32Array(r);for(let o=0;o<s.length;o++){const a=s[o],l=t[n[a>>10]+(a&1023)]+e[a>>10];i[o]=l}return new Float32Array(r)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class en{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return en.instance==null&&(en.instance=new en),en.instance}static registerSaveRouter(e){en.getInstance().saveRouters.push(e)}static registerLoadRouter(e){en.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return en.getHandlers(e,"save")}static getLoadHandlers(e,n){return en.getHandlers(e,"load",n)}static getHandlers(e,n,s){const r=[];return(n==="load"?en.getInstance().loadRouters:en.getInstance().saveRouters).forEach(o=>{const a=o(e,s);a!==null&&r.push(a)}),r}}const Fte=t=>en.registerSaveRouter(t),Lte=t=>en.registerLoadRouter(t),hB=t=>en.getSaveHandlers(t),dB=(t,e)=>en.getLoadHandlers(t,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i_="tensorflowjs",o_=1,Tu="models_store",el="model_info_store";function fB(){if(!Z().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t=typeof window>"u"?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function a_(t){const e=t.result;e.createObjectStore(Tu,{keyPath:"modelPath"}),e.createObjectStore(el,{keyPath:"modelPath"})}class Xu{constructor(e){if(this.indexedDB=fB(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,n){return new Promise((s,r)=>{const i=this.indexedDB.open(i_,o_);i.onupgradeneeded=()=>a_(i),i.onsuccess=()=>{const o=i.result;if(n==null){const a=o.transaction(Tu,"readonly"),u=a.objectStore(Tu).get(this.modelPath);u.onsuccess=()=>{if(u.result==null)return o.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(u.result.modelArtifacts)},u.onerror=c=>(o.close(),r(u.error)),a.oncomplete=()=>o.close()}else{n.weightData=Ki.join(n.weightData);const a=ly(n),l=o.transaction(el,"readwrite");let u=l.objectStore(el),c;try{c=u.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(d){return r(d)}let h;c.onsuccess=()=>{h=o.transaction(Tu,"readwrite");const d=h.objectStore(Tu);let f;try{f=d.put({modelPath:this.modelPath,modelArtifacts:n,modelArtifactsInfo:a})}catch(p){return r(p)}f.onsuccess=()=>s({modelArtifactsInfo:a}),f.onerror=p=>{u=l.objectStore(el);const m=u.delete(this.modelPath);m.onsuccess=()=>(o.close(),r(f.error)),m.onerror=v=>(o.close(),r(f.error))}},c.onerror=d=>(o.close(),r(c.error)),l.oncomplete=()=>{h==null?o.close():h.oncomplete=()=>o.close()}}},i.onerror=o=>r(i.error)})}}Xu.URL_SCHEME="indexeddb://";const pB=t=>Z().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Xu.URL_SCHEME)?Mte(t.slice(Xu.URL_SCHEME.length)):null;en.registerSaveRouter(pB);en.registerLoadRouter(pB);function Mte(t){return new Xu(t)}function zte(t){return t.startsWith(Xu.URL_SCHEME)?t.slice(Xu.URL_SCHEME.length):t}class Bte{constructor(){this.indexedDB=fB()}async listModels(){return new Promise((e,n)=>{const s=this.indexedDB.open(i_,o_);s.onupgradeneeded=()=>a_(s),s.onsuccess=()=>{const r=s.result,i=r.transaction(el,"readonly"),a=i.objectStore(el).getAll();a.onsuccess=()=>{const l={};for(const u of a.result)l[u.modelPath]=u.modelArtifactsInfo;e(l)},a.onerror=l=>(r.close(),n(a.error)),i.oncomplete=()=>r.close()},s.onerror=r=>n(s.error)})}async removeModel(e){return e=zte(e),new Promise((n,s)=>{const r=this.indexedDB.open(i_,o_);r.onupgradeneeded=()=>a_(r),r.onsuccess=()=>{const i=r.result,o=i.transaction(el,"readwrite"),a=o.objectStore(el),l=a.get(e);let u;l.onsuccess=()=>{if(l.result==null)return i.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const c=a.delete(e),h=()=>{u=i.transaction(Tu,"readwrite");const f=u.objectStore(Tu).delete(e);f.onsuccess=()=>n(l.result.modelArtifactsInfo),f.onerror=p=>s(l.error)};c.onsuccess=h,c.onerror=d=>(h(),i.close(),s(l.error))}},l.onerror=c=>(i.close(),s(l.error)),o.oncomplete=()=>{u==null?i.close():u.oncomplete=()=>i.close()}},r.onerror=i=>s(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Go="/",Zc="tensorflowjs_models",mB="info",Vte="model_topology",Ute="weight_specs",Wte="weight_data",jte="model_metadata";function gB(t){return{info:[Zc,t,mB].join(Go),topology:[Zc,t,Vte].join(Go),weightSpecs:[Zc,t,Ute].join(Go),weightData:[Zc,t,Wte].join(Go),modelMetadata:[Zc,t,jte].join(Go)}}function yB(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function Gte(t){const e=t.split(Go);if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join(Go)}function Hte(t){return t.startsWith(Yu.URL_SCHEME)?t.slice(Yu.URL_SCHEME.length):t}class Yu{constructor(e){if(!Z().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=gB(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),r=ly(e),i=Ki.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,$te(i));const o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:r}}catch{throw yB(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const n={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);n.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);n.weightSpecs=r;const i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){const a=JSON.parse(i);n.format=a.format,n.generatedBy=a.generatedBy,n.convertedBy=a.convertedBy,a.signature!=null&&(n.signature=a.signature),a.userDefinedMetadata!=null&&(n.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(n.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(n.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(n.trainingConfig=a.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return n.weightData=Rte(o),n}}Yu.URL_SCHEME="localstorage://";const vB=t=>Z().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Yu.URL_SCHEME)?qte(t.slice(Yu.URL_SCHEME.length)):null;en.registerSaveRouter(vB);en.registerLoadRouter(vB);function qte(t){return new Yu(t)}class Kte{constructor(){O(Z().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),O(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},n=Zc+Go,s=Go+mB;for(let r=0;r<this.LS.length;++r){const i=this.LS.key(r);if(i.startsWith(n)&&i.endsWith(s)){const o=Gte(i);e[o]=JSON.parse(this.LS.getItem(i))}}return e}async removeModel(e){e=Hte(e);const n=gB(e);if(this.LS.getItem(n.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(n.info));return yB(n),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Th="://";class Ns{constructor(){this.managers={}}static getInstance(){return Ns.instance==null&&(Ns.instance=new Ns),Ns.instance}static registerManager(e,n){O(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(Th)&&(e=e.slice(0,e.indexOf(Th))),O(e.length>0,()=>"scheme must not be an empty string.");const s=Ns.getInstance();O(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=n}static getManager(e){const n=Ns.getInstance().managers[e];if(n==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return n}static getSchemes(){return Object.keys(Ns.getInstance().managers)}}function fv(t){if(t.indexOf(Th)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${Ns.getSchemes().join(",")}`);return{scheme:t.split(Th)[0],path:t.split(Th)[1]}}async function wB(t,e,n=!1){O(t!==e,()=>`Old path and new path are the same: '${t}'`);const s=en.getLoadHandlers(t);O(s.length>0,()=>`Copying failed because no load handler is found for source URL ${t}.`),O(s.length<2,()=>`Copying failed because more than one (${s.length}) load handlers for source URL ${t}.`);const r=s[0],i=en.getSaveHandlers(e);O(i.length>0,()=>`Copying failed because no save handler is found for destination URL ${e}.`),O(i.length<2,()=>`Copying failed because more than one (${s.length}) save handlers for destination URL ${e}.`);const o=i[0],a=fv(t).scheme,l=fv(t).path,u=a===fv(t).scheme,c=await r.load();n&&u&&await Ns.getManager(a).removeModel(l);const h=await o.save(c);return n&&!u&&await Ns.getManager(a).removeModel(l),h.modelArtifactsInfo}async function Xte(){const t=Ns.getSchemes(),e={};for(const n of t){const s=await Ns.getManager(n).listModels();for(const r in s){const i=n+Th+r;e[i]=s[r]}}return e}async function Yte(t){const e=fv(t);return Ns.getManager(e.scheme).removeModel(e.path)}async function Qte(t,e){return wB(t,e,!1)}async function Jte(t,e){return wB(t,e,!0)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zte{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,n){return fetch(e,n)}now(){return performance.now()}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${n}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,n){return new TextDecoder(n).decode(e)}setTimeoutCustom(e,n){if(typeof window>"u"||!Z().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,n);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},n),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return U4(e)}}if(Z().get("IS_BROWSER")){Z().setPlatform("browser",new Zte);try{Ns.registerManager(Yu.URL_SCHEME,new Kte)}catch{}try{Ns.registerManager(Xu.URL_SCHEME,new Bte)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ene={importFetch:()=>require("node-fetch")};let dC;class tne{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,n){return Z().global.fetch!=null?Z().global.fetch(e,n):(dC==null&&(dC=ene.importFetch()),dC(e,n))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${n}`);return this.textEncoder.encode(e)}decode(e,n){return e.length===0?"":new this.util.TextDecoder(n).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}Z().get("IS_NODE")&&!Z().get("IS_BROWSER")&&Z().setPlatform("node",new tne);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xe(t,e="float32",n){return e=e||"float32",Sr(t),new $n(t,e,n)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nne(t,e){const n=P(t,"x","cast");if(!A4(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&n.dtype!=="string"||e!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:n},r={dtype:e};return V.runKernel(bd,s,r)}const ge=U({cast_:nne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sne(t){const n={x:P(t,"x","clone","string_or_numeric")};return V.runKernel(Od,n)}const yo=U({clone_:sne});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lE(t,e=!1){console.log(t.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */rB();const rne={buffer:Xe,cast:ge,clone:yo,print:lE};ste(rne);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ine(t,e){let n=P(t,"a","add"),s=P(e,"b","add");[n,s]=rn(n,s);const r={a:n,b:s};return V.runKernel(Sc,r)}const he=U({add_:ine});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function one(t,e){let n=P(t,"a","floorDiv"),s=P(e,"b","floorDiv");[n,s]=rn(n,s);const r={a:n,b:s};return V.runKernel(Ad,r)}const Xb=U({floorDiv_:one});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ane(t,e){let n=P(t,"a","div"),s=P(e,"b","div");if([n,s]=rn(n,s),n.dtype==="int32"&&s.dtype==="int32")return Xb(n,s);const r={a:n,b:s},i={};return V.runKernel(Td,r,i)}const Re=U({div_:ane});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lne(t,e){let n=P(t,"a","mul"),s=P(e,"b","mul");[n,s]=rn(n,s);const r={a:n,b:s};return V.runKernel(Wd,r)}const G=U({mul_:lne});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function une(t){const e=P(t,"x","abs");if(e.dtype==="complex64"){const n={x:e};return V.runKernel(fg,n)}else{const n={x:e};return V.runKernel(rg,n)}}const Tn=U({abs_:une});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cne(t){const n={x:P(t,"x","acos")};return V.runKernel(pd,n)}const uE=U({acos_:cne});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hne(t){const n={x:P(t,"x","acosh")};return V.runKernel(md,n)}const cE=U({acosh_:hne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dne(t){O(Array.isArray(t),()=>"The argument passed to tf.addN() must be a list of tensors"),O(t.length>=1,()=>`Must pass at least one tensor to tf.addN(), but got ${t.length}`);const e=t.map((r,i)=>P(r,`tensors${i}`,"addN")),n=e[0];e.forEach(r=>{if(r.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(r=>{if(!st(r.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});const s=e;return V.runKernel(ig,s)}const xB=U({addN_:dne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fne(t,e=null,n=!1){const r={x:P(t,"x","all","bool")},i={axis:e,keepDims:n};return V.runKernel(Vx,r,i)}const Yb=U({all_:fne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pne(t,e=null,n=!1){const r={x:P(t,"x","any","bool")},i={axis:e,keepDims:n};return V.runKernel(Ux,r,i)}const Tm=U({any_:pne});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mne(t,e=0){const s={x:P(t,"x","argMax")},r={axis:e};return V.runKernel(og,s,r)}const Qu=U({argMax_:mne});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gne(t,e=0){const s={x:P(t,"x","argMin")},r={axis:e};return V.runKernel(ag,s,r)}const hE=U({argMin_:gne});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yne(t){const n={x:P(t,"x","asin")};return V.runKernel(gd,n)}const dE=U({asin_:yne});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vne(t){const n={x:P(t,"x","asinh")};return V.runKernel(yd,n)}const fE=U({asinh_:vne});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wne(t){const n={x:P(t,"x","atan")};return V.runKernel(vd,n)}const pE=U({atan_:wne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xne(t,e){let n=P(t,"a","atan2"),s=P(e,"b","atan2");[n,s]=rn(n,s);const r={a:n,b:s};return V.runKernel(xd,r)}const mE=U({atan2_:xne});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bne(t){const n={x:P(t,"x","atanh")};return V.runKernel(wd,n)}const gE=U({atanh_:bne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uy(t,e,n,s,r="NHWC",i){const o=t[3],a=[...e,o],l=Sa(r);return Yn(t,a,n,i,s,null,null,l)}function hi(t,e,n,s,r,i,o="channelsLast"){const[a,l]=km(e);let u;if(o==="channelsLast")u=[a,l,t[3],t[3]];else if(o==="channelsFirst")u=[a,l,t[1],t[1]];else throw new Error(`Unknown dataFormat ${o}`);return Yn(t,u,n,s,r,i,!1,o)}function ba(t,e,n,s,r,i,o="NDHWC"){const[a,l,u]=l_(e);let c,h;if(o==="NDHWC")h="channelsLast",c=[a,l,u,t[4],t[4]];else if(o==="NCDHW")h="channelsFirst",c=[a,l,u,t[1],t[1]];else throw new Error(`Unknown dataFormat ${o}`);return ql(t,c,n,s,r,!1,h,i)}function Yn(t,e,n,s,r,i,o=!1,a="channelsLast"){let[l,u,c,h]=[-1,-1,-1,-1];if(a==="channelsLast")[l,u,c,h]=t;else if(a==="channelsFirst")[l,h,u,c]=t;else throw new Error(`Unknown dataFormat ${a}`);const[d,f,,p]=e,[m,v]=km(n),[g,w]=km(s),b=kh(d,g),x=kh(f,w),{padInfo:S,outHeight:N,outWidth:I}=Ine(r,u,c,m,v,b,x,i,a),C=o?p*h:p;let _;return a==="channelsFirst"?_=[l,C,N,I]:a==="channelsLast"&&(_=[l,N,I,C]),{batchSize:l,dataFormat:a,inHeight:u,inWidth:c,inChannels:h,outHeight:N,outWidth:I,outChannels:C,padInfo:S,strideHeight:m,strideWidth:v,filterHeight:d,filterWidth:f,effectiveFilterHeight:b,effectiveFilterWidth:x,dilationHeight:g,dilationWidth:w,inShape:t,outShape:_,filterShape:e}}function ql(t,e,n,s,r,i=!1,o="channelsLast",a){let[l,u,c,h,d]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[l,u,c,h,d]=t;else if(o==="channelsFirst")[l,d,u,c,h]=t;else throw new Error(`Unknown dataFormat ${o}`);const[f,p,m,,v]=e,[g,w,b]=l_(n),[x,S,N]=l_(s),I=kh(f,x),C=kh(p,S),_=kh(m,N),{padInfo:k,outDepth:A,outHeight:D,outWidth:R}=_ne(r,u,c,h,g,w,b,I,C,_,a),W=i?v*d:v;let B;return o==="channelsFirst"?B=[l,W,A,D,R]:o==="channelsLast"&&(B=[l,A,D,R,W]),{batchSize:l,dataFormat:o,inDepth:u,inHeight:c,inWidth:h,inChannels:d,outDepth:A,outHeight:D,outWidth:R,outChannels:W,padInfo:k,strideDepth:g,strideHeight:w,strideWidth:b,filterDepth:f,filterHeight:p,filterWidth:m,effectiveFilterDepth:I,effectiveFilterHeight:C,effectiveFilterWidth:_,dilationDepth:x,dilationHeight:S,dilationWidth:N,inShape:t,outShape:B,filterShape:e}}function Sne(t,e,n,s,r){s==null&&(s=yE(t,e,n));const i=t[0],o=t[1],a=Em((i-e+2*s)/n+1,r),l=Em((o-e+2*s)/n+1,r);return[a,l]}function Cne(t,e,n,s,r,i){r==null&&(r=yE(t,e[0],s[0]));const o=[0,0,0,n];for(let a=0;a<3;a++)t[a]+2*r>=e[a]&&(o[a]=Em((t[a]-e[a]+2*r)/s[a]+1,i));return o}function yE(t,e,n,s=1){const r=kh(e,s);return Math.floor((t[0]*(n-1)-n+r)/2)}function km(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function l_(t){return typeof t=="number"?[t,t,t]:t}function kh(t,e){return e<=1?t:t+(t-1)*(e-1)}function Ine(t,e,n,s,r,i,o,a,l){let u,c,h;if(typeof t=="number"){u={top:t,bottom:t,left:t,right:t,type:t===0?"VALID":"NUMBER"};const f=Sne([e,n],i,s,t,a);c=f[0],h=f[1]}else if(t==="same"){c=Math.ceil(e/s),h=Math.ceil(n/r);const d=Math.max(0,(c-1)*s+i-e),f=Math.max(0,(h-1)*r+o-n),p=Math.floor(d/2),m=d-p,v=Math.floor(f/2),g=f-v;u={top:p,bottom:m,left:v,right:g,type:"SAME"}}else if(t==="valid")u={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((e-i+1)/s),h=Math.ceil((n-o+1)/r);else if(typeof t=="object"){const d=l==="channelsLast"?t[1][0]:t[2][0],f=l==="channelsLast"?t[1][1]:t[2][1],p=l==="channelsLast"?t[2][0]:t[3][0],m=l==="channelsLast"?t[2][1]:t[3][1];u={top:d,bottom:f,left:p,right:m,type:d===0&&f===0&&p===0&&m===0?"VALID":"EXPLICIT"},c=Em((e-i+d+f)/s+1,a),h=Em((n-o+p+m)/r+1,a)}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:u,outHeight:c,outWidth:h}}function _ne(t,e,n,s,r,i,o,a,l,u,c){let h,d,f,p;if(t==="valid"&&(t=0),typeof t=="number"){h={top:t,bottom:t,left:t,right:t,front:t,back:t,type:t===0?"VALID":"NUMBER"};const v=Cne([e,n,s,1],[a,l,u],1,[r,i,o],t,c);d=v[0],f=v[1],p=v[2]}else if(t==="same"){d=Math.ceil(e/r),f=Math.ceil(n/i),p=Math.ceil(s/o);const m=(d-1)*r+a-e,v=(f-1)*i+l-n,g=(p-1)*o+u-s,w=Math.floor(m/2),b=m-w,x=Math.floor(v/2),S=v-x,N=Math.floor(g/2),I=g-N;h={top:x,bottom:S,left:N,right:I,front:w,back:b,type:"SAME"}}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:h,outDepth:d,outHeight:f,outWidth:p}}function Em(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function $l(t){const[e,n,s]=km(t);return e===1&&n===1&&s===1}function hs(t,e){return $l(t)||$l(e)}function Ju(t){return km(t).every(e=>e>0)}function Sa(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function Ls(t,e,n){if(n!=null){if(typeof e=="string")throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if(typeof e=="number")O(qu(e),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(r=>{O(qu(r),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${r}.`)})});else throw Error(`Error in ${t}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tne(t,e){const s={x:P(t,"x","reshape","string_or_numeric")},r={shape:e};return V.runKernel(qg,s,r)}const H=U({reshape_:Tne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kne(t,e,n,s,r){const i=P(t,"x","avgPool","float32"),o=1;O(hs(n,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`);let a=i,l=!1;i.rank===3&&(l=!0,a=H(i,[1,i.shape[0],i.shape[1],i.shape[2]])),O(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),Ls("avgPool",s,r);const u={x:a},c={filterSize:e,strides:n,pad:s,dimRoundingMode:r};let h=V.runKernel(lg,u,c);return h=ge(h,i.dtype),l?H(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const cy=U({avgPool_:kne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ene(t,e,n,s,r,i="NDHWC"){const o=P(t,"x","avgPool3d","float32");let a=o,l=!1;o.rank===4&&(l=!0,a=H(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),O(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),O(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),O(typeof n=="number"&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${n}'`),Ls("avgPool3d",s,r);const u={x:a},c={filterSize:e,strides:n,pad:s,dimRoundingMode:r,dataFormat:i};let h=V.runKernel(ug,u,c);return h=ge(h,a.dtype),l?H(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const vE=U({avgPool3d_:Ene});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nne(t,e=0){O(t.length>=1,()=>"Pass at least one tensor to concat");const n=_m(t,"tensors","concat","string_or_numeric");if(n[0].dtype==="complex64"&&n.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),n.length===1)return yo(n[0]);const s=n,r={axis:e};return V.runKernel(pg,s,r)}const wn=U({concat_:Nne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ne(t,e,n=!1,s=!1){let r=P(t,"a","matMul"),i=P(e,"b","matMul");[r,i]=rn(r,i);const o={a:r,b:i},a={transposeA:n,transposeB:s};return V.runKernel(cg,o,a)}const Je=U({matMul_:$ne});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rne(t){const n={x:P(t,"x","sigmoid","float32")};return V.runKernel(ef,n)}const Fi=U({sigmoid_:Rne});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ane(t,e,n){const s=P(t,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},i={begin:e,size:n};return V.runKernel(Jg,r,i)}const lt=U({slice_:Ane});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dne(t){const n={x:P(t,"x","tanh","float32")};return V.runKernel(af,n)}const Rl=U({tanh_:Dne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function One(t,e,n,s,r,i){const o=P(t,"forgetBias","basicLSTMCell"),a=P(e,"lstmKernel","basicLSTMCell"),l=P(n,"lstmBias","basicLSTMCell"),u=P(s,"data","basicLSTMCell"),c=P(r,"c","basicLSTMCell"),h=P(i,"h","basicLSTMCell"),d=wn([u,h],1),f=Je(d,a),p=he(f,l),m=p.shape[0],v=p.shape[1]/4,g=[m,v],w=lt(p,[0,0],g),b=lt(p,[0,v],g),x=lt(p,[0,v*2],g),S=lt(p,[0,v*3],g),N=he(G(Fi(w),Rl(b)),G(c,Fi(he(o,x)))),I=G(Rl(N),Fi(S));return[N,I]}const bB=U({basicLSTMCell_:One});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pne(t,e,n){const s=P(t,"x","batchToSpaceND"),r=e.reduce((a,l)=>a*l);O(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),O(n.length===e.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`),O(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${r}`);const i={x:s},o={blockShape:e,crops:n};return V.runKernel(hg,i,o)}const hy=U({batchToSpaceND_:Pne});function Fne(t){let e;return t.rank===0||t.rank===1?e=H(t,[1,1,1,t.size]):t.rank===2?e=H(t,[1,1,t.shape[0],t.shape[1]]):t.rank===3?e=H(t,[1,t.shape[0],t.shape[1],t.shape[2]]):e=t,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lne(t,e,n,s,r,i){i==null&&(i=.001);const o=P(t,"x","batchNorm"),a=P(e,"mean","batchNorm"),l=P(n,"variance","batchNorm");let u;r!=null&&(u=P(r,"scale","batchNorm"));let c;s!=null&&(c=P(s,"offset","batchNorm")),O(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),O(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),O(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const d={x:Fne(o),scale:u,offset:c,mean:a,variance:l},f={varianceEpsilon:i},p=V.runKernel(Cg,d,f);return H(p,o.shape)}const cf=U({batchNorm_:Lne});function Mne(t,e,n,s,r,i){const o=P(t,"x","batchNorm"),a=P(e,"mean","batchNorm"),l=P(n,"variance","batchNorm");let u;r!=null&&(u=P(r,"scale","batchNorm"));let c;return s!=null&&(c=P(s,"offset","batchNorm")),O(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),O(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),O(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),u!=null&&O(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${u.rank}.`),c!=null&&O(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${c.rank}.`),cf(o,a,l,c,u,i)}const wE=U({batchNorm2d_:Mne});function zne(t,e,n,s,r,i){const o=P(t,"x","batchNorm"),a=P(e,"mean","batchNorm"),l=P(n,"variance","batchNorm");let u;r!=null&&(u=P(r,"scale","batchNorm"));let c;return s!=null&&(c=P(s,"offset","batchNorm")),O(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),O(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),O(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),u!=null&&O(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${u.rank}.`),c!=null&&O(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${c.rank}.`),cf(o,a,l,c,u,i)}const xE=U({batchNorm3d_:zne});function Bne(t,e,n,s,r,i){const o=P(t,"x","batchNorm"),a=P(e,"mean","batchNorm"),l=P(n,"variance","batchNorm");let u;r!=null&&(u=P(r,"scale","batchNorm"));let c;return s!=null&&(c=P(s,"offset","batchNorm")),O(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),O(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),O(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),u!=null&&O(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${u.rank}.`),c!=null&&O(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${c.rank}.`),cf(o,a,l,c,u,i)}const bE=U({batchNorm4d_:Bne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vne(t,e,n){const s=P(t,"x","bincount"),r=P(e,"weights","bincount");O(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),O(n>=0,()=>`size must be non-negative, but got ${n}.`),O(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const i={x:s,weights:r},o={size:n};return V.runKernel(Gx,i,o)}const SE=U({bincount_:Vne});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Une(t,e){const n=P(t,"x","bitwiseAnd"),s=P(e,"y","bitwiseAnd");if(!st(n.shape,s.shape))throw new Error(`BitwiseAnd: Tensors must have the same shape. x: ${n.shape}, y: ${s.shape}`);if(n.dtype!=="int32"||s.dtype!=="int32")throw new Error(`BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ${n.dtype} and type of y: ${s.dtype}`);const r={a:n,b:s};return V.runKernel(dg,r)}const SB=U({bitwiseAnd_:Une});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wne(t,e){const n=P(t,"s0","broadcastArgs","int32"),s=P(e,"s1","broadcastArgs","int32");if(n.rank!==1)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(s.rank!==1)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${s.rank}`);const r={s0:n,s1:s};return V.runKernel(Hx,r)}const CB=U({broadcastArgs_:Wne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jne(t,e){let n=P(t,"broadcastTo","x");const s=n.shape;if(Sr(e),e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const u=n.shape.slice();for(;u.length<e.length;)u.unshift(1);n=H(n,u)}const r=n.shape,i=Array.from(e);for(let u=e.length-1;u>=0;u--)if(r[u]===e[u])i[u]=1;else if(n.shape[u]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(i.map((u,c)=>u>1?c:-1).filter(u=>u>=0).length===0)return yo(n);const a={x:n},l={reps:i};return V.runKernel(lf,a,l)}const Du=U({broadcastTo_:jne});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gne(t){const n={x:P(t,"x","ceil","float32")};return V.runKernel(Sd,n)}const CE=U({ceil_:Gne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ic(t,e,n){Sr(t),n=n||xc(e);const s={shape:t,value:e,dtype:n};return V.runKernel(lb,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hne(t,e,n){const s=P(t,"x","clipByValue");if(O(e<=n,()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`),e===n)return Ic(s.shape,e,s.dtype);const r={x:s},i={clipValueMin:e,clipValueMax:n};return V.runKernel(Cd,r,i)}const Qs=U({clipByValue_:Hne});function qne(t){return wn(t,0)}const IE=U({concat1d_:qne});function Kne(t,e){return wn(t,e)}const _E=U({concat2d_:Kne});function Xne(t,e){return wn(t,e)}const TE=U({concat3d_:Xne});function Yne(t,e){return wn(t,e)}const kE=U({concat4d_:Yne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qne(t,e,n,s,r="NHWC",i=[1,1],o){const a=P(t,"x","conv2d","float32"),l=P(e,"filter","conv2d","float32");let u=a,c=!1;a.rank===3&&(c=!0,u=H(a,[1,a.shape[0],a.shape[1],a.shape[2]])),O(u.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${u.rank}.`),O(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),Ls("conv2d",s,o);const h=r==="NHWC"?u.shape[3]:u.shape[1];O(h===l.shape[2],()=>`Error in conv2d: depth of input (${h}) must match input depth for filter ${l.shape[2]}.`),O(hs(n,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`),O(Ju(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),O(Ju(n),()=>"Error in conv2D: Strides should be larger than 0.");const d={x:u,filter:l},f={strides:n,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},p=V.runKernel(mg,d,f);return c?H(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const fa=U({conv2d_:Qne});function Jne(t,e,n,s,r="NWC",i=1,o){const a=P(t,"x","conv1d"),l=P(e,"filter","conv1d");let u=a,c=!1;a.rank===2&&(c=!0,u=H(a,[1,a.shape[0],a.shape[1]])),O(u.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${u.rank}.`),O(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),Ls("conv1d",s,o),O(u.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${u.shape[2]}) must match input depth for filter ${l.shape[1]}.`),O(hs(n,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${i}'`),O(Ju(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),O(Ju(n),()=>"Error in conv1D: Stride should be larger than 0."),O(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const h=H(l,[1,l.shape[0],l.shape[1],l.shape[2]]),d=H(u,[u.shape[0],1,u.shape[1],u.shape[2]]),v=fa(d,h,[1,n],s,"NHWC",[1,i],o);return c?H(v,[v.shape[2],v.shape[3]]):H(v,[v.shape[0],v.shape[2],v.shape[3]])}const Qb=U({conv1d_:Jne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zne(t,e,n,s,r,i="NHWC",o){O(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let a=t,l=e,u=!1;e.rank===3&&(u=!0,l=H(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),O(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),O(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),O(n.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`);const c=i==="NHWC"?a[3]:a[1],h=i==="NHWC"?l.shape[3]:l.shape[1];O(c===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${c}) must match input depth for filter ${n.shape[2]}.`),O(h===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${h}) must match output depth for filter ${n.shape[3]}.`),Ls("conv2dDerInput",r,o);const d={dy:l,filter:n},f={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,inputShape:a},p=V.runKernel(gg,d,f);return u?H(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const EE=U({conv2DBackpropInput_:Zne});function ese(t,e,n,s,r,i){const o=P(t,"x","conv2dTranspose"),a=P(e,"filter","conv2dTranspose");return EE(n,o,a,s,r,"NHWC",i)}const Jb=U({conv2dTranspose_:ese});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tse(t,e,n,s,r="NDHWC",i=[1,1,1]){const o=P(t,"x","conv3d"),a=P(e,"filter","conv3d");let l=o,u=!1;o.rank===4&&(u=!0,l=H(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),O(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),O(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),O(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),O(hs(n,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`),O(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),O(Ju(i),()=>"Error in conv3D: Dilated rates should be larger than 0."),O(Ju(n),()=>"Error in conv3D: Strides should be larger than 0.");const c={x:l,filter:a},h={strides:n,pad:s,dataFormat:r,dilations:i},d=V.runKernel(yg,c,h);return u?H(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const NE=U({conv3d_:tse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nse(t,e,n,s,r){O(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let i=t,o=e,a=!1;e.rank===4&&(a=!0,o=H(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,t[0],t[1],t[2],t[3]]);const l=i[4],u=o.shape[4];O(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),O(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),O(n.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`),O(l===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[3]}.`),O(u===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${u}) must match output depth for filter ${n.shape[4]}.`);const c={dy:o,filter:n},h={pad:r,strides:s,inputShape:i},d=V.runKernel(Yx,c,h);return a?H(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const IB=U({conv3DBackpropInput_:nse});function sse(t,e,n,s,r){const i=P(t,"x","conv3dTranspose"),o=P(e,"filter","conv3dTranspose");return IB(n,i,o,s,r)}const $E=U({conv3dTranspose_:sse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rse(t){const n={x:P(t,"x","cos","float32")};return V.runKernel(Id,n)}const dy=U({cos_:rse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ise(t){const n={x:P(t,"x","cosh","float32")};return V.runKernel(_d,n)}const Zb=U({cosh_:ise});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ose(t,e=0,n=!1,s=!1){const i={x:P(t,"x","cumprod")},o={axis:e,exclusive:n,reverse:s};return V.runKernel(Qx,i,o)}const Nm=U({cumprod_:ose});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ase(t,e=0,n=!1,s=!1){const i={x:P(t,"x","cumsum")},o={axis:e,exclusive:n,reverse:s};return V.runKernel(vg,i,o)}const e1=U({cumsum_:ase});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lse(t,e,n,s=!1){const r=P(t,"x","denseBincount"),i=P(e,"weights","denseBincount");O(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),O(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),O(n>=0,()=>`size must be non-negative, but got ${n}.`),O(i.size===r.size||i.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${i.shape}.`);const o={x:r,weights:i},a={size:n,binaryOutput:s};return V.runKernel(Zx,o,a)}const Nw=U({denseBincount_:lse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function use(t,e,n="NHWC"){const s=P(t,"x","depthToSpace","float32"),r=n==="NHWC"?s.shape[1]:s.shape[2],i=n==="NHWC"?s.shape[2]:s.shape[3],o=n==="NHWC"?s.shape[3]:s.shape[1];O(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),O(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e}  for depthToSpace with input shape
    ${s.shape}`),O(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e} for depthToSpace with input shape
        ${s.shape}`),O(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${s.shape}`);const a={x:s},l={blockSize:e,dataFormat:n};return V.runKernel(eb,a,l)}const RE=U({depthToSpace_:use});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cse(t,e,n,s,r="NHWC",i=[1,1],o){const a=P(t,"x","depthwiseConv2d","float32"),l=P(e,"filter","depthwiseConv2d","float32");let u=a,c=!1;a.rank===3&&(c=!0,u=H(a,[1,a.shape[0],a.shape[1],a.shape[2]])),O(u.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${u.rank}.`),O(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const h=r==="NHWC"?u.shape[3]:u.shape[1];O(h===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${h}) must match the inChannels dimension in filter ${l.shape[2]}.`),Ls("depthwiseConv2d",s,o);const d={x:u,filter:l},f={strides:n,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},p=V.runKernel(wg,d,f);return c?H(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const hf=U({depthwiseConv2d_:cse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hse(t){const n={x:P(t,"x","diag")};return V.runKernel(sb,n)}const _B=U({diag_:hse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dse(t,e,n,s,r=[1,1],i="NHWC"){const o=P(t,"x","dilation2d"),a=P(e,"filter","dilation2d");O(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),O(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),O(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let l=o,u=!1;o.rank===3&&(l=H(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=!0),O(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const c={x:l,filter:a},h={strides:n,pad:s,dilations:r},d=V.runKernel(xg,c,h);return u?H(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const AE=U({dilation2d_:dse});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zu(t,e){const n=t.length,s=[];for(let r=0;r<n;r++){const i=n-1-r,o=t[i]||1;(e[e.length-1-r]||1)>1&&o===1&&s.unshift(i)}return s}function Rn(t,e){const n=[];for(let s=0;s<e.length;s++){const r=t[t.length-s-1],i=e.length-s-1,o=e[i];(r==null||r===1&&o>1)&&n.unshift(i)}return n}function Ge(t,e){const n=Math.max(t.length,e.length),s=new Array(n);for(let r=0;r<n;r++){let i=t[t.length-r-1];i==null&&(i=1);let o=e[e.length-r-1];if(o==null&&(o=1),i===1)s[n-r-1]=o;else if(o===1)s[n-r-1]=i;else if(i!==o){const a=`Operands could not be broadcast together with shapes ${t} and ${e}.`;throw Error(a)}else s[n-r-1]=i}return s}const fse=Object.freeze(Object.defineProperty({__proto__:null,assertAndGetBroadcastShape:Ge,getBroadcastDims:Zu,getReductionAxes:Rn},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pse(t,e){let n=P(t,"a","equal","string_or_numeric"),s=P(e,"b","equal","string_or_numeric");[n,s]=rn(n,s),Ge(n.shape,s.shape);const r={a:n,b:s};return V.runKernel(bg,r)}const yr=U({equal_:pse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mse(t,e,n){const s=P(e,"a","where"),r=P(n,"b","where"),i=P(t,"condition","where","bool"),o=Ge(Ge(i.shape,s.shape),r.shape),a=Du(i,o),l=Du(s,o),u=Du(r,o),c={condition:a,t:l,e:u};return V.runKernel(Qg,c)}const Hn=U({where_:mse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gse(t){const n={x:P(t,"x","zerosLike")};return V.runKernel(oy,n)}const ct=U({zerosLike_:gse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yse(t,e){let n=P(t,"a","div"),s=P(e,"b","div");[n,s]=rn(n,s);const r=Re(n,s),i=ct(r),o=yr(s,i);return Hn(o,i,r)}const DE=U({divNoNan_:yse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vse(t,e){const n=P(t,"t1","dot"),s=P(e,"t2","dot");O((n.rank===1||n.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${s.rank}.`);const r=n.rank===1?n.size:n.shape[1],i=s.rank===1?s.size:s.shape[0];if(O(r===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${i}.`),n.rank===1&&s.rank===1){const o=H(n,[1,-1]),a=H(s,[-1,1]),l=Je(o,a);return H(l,[])}else if(n.rank===1&&s.rank===2){const o=H(n,[1,-1]),a=H(s,[s.shape[0],s.shape[1]]),l=Je(o,a);return H(l,[l.size])}else if(n.rank===2&&s.rank===1){const o=H(s,[-1,1]),a=Je(n,o);return H(a,[a.size])}else{const o=H(s,[s.shape[0],s.shape[1]]);return Je(n,o)}}const OE=U({dot_:vse});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wse(t,...e){const n=e.map((r,i)=>P(r,`tensors${i}`,"einsum")),s={equation:t};return V.runKernel(ib,n,s)}const gu=U({einsum_:wse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xse(t){const n={x:P(t,"x","elu","float32")};return V.runKernel(kd,n)}const df=U({elu_:xse});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bse(t,e){const n=P(t,"x","ensureShape","string_or_numeric");if(!$4(n.shape,e))throw new Error(`EnsureShape: Shape of tensor ${n.shape} is not compatible with expected shape ${e}`);return t}const TB=U({ensureShape_:bse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sse(t){let e=P(t,"x","erf");O(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=ge(e,"float32"));const n={x:e};return V.runKernel(Ed,n)}const t1=U({erf_:Sse});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PE(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function kB(t,e,n){const s=t.length+e.length,r=[];let i=0,o=0;for(let a=0;a<s;a++)n.indexOf(a)===-1?r.push(t[i++]):r.push(e[o++]);return r}function Qn(t,e){const n=[],s=t.length;for(let i=0;i<s;i++)e.indexOf(i)===-1&&n.push(t[i]);const r=e.map(i=>t[i]);return[n,r]}function xn(t,e){const n=e.map(s=>1);return kB(t,n,e)}function ds(t,e,n){O(PE(e,n),()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`)}function on(t,e){if(PE(t,e))return null;const n=[];for(let s=0;s<e;++s)t.indexOf(s)===-1&&n.push(s);return t.forEach(s=>n.push(s)),n}function Kl(t){return t.map((e,n)=>[n,e]).sort((e,n)=>e[1]-n[1]).map(e=>e[0])}function bn(t,e){const n=[];for(let s=e-t;s<e;++s)n.push(s);return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cse(t,e=null,n=!1){const r={x:P(t,"x","max")},i={reductionIndices:e,keepDims:n};return V.runKernel(Dg,r,i)}const Lr=U({max_:Cse});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ise(t,e=null,n=!1){const r={x:P(t,"x","min")},i={axis:e,keepDims:n};return V.runKernel(Lg,r,i)}const jh=U({min_:Ise});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _se(t,e){let n=P(t,"base","pow"),s=P(e,"exp","pow");[n,s]=rn(n,s);const r={a:n,b:s};return V.runKernel(jd,r)}const Co=U({pow_:_se});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Le(t,e){if((An(t)&&e!=="string"||Array.isArray(t))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&An(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Hl(t,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tse(t){const n={x:P(t,"x","sqrt","float32")};return V.runKernel(nf,n)}const Kn=U({sqrt_:Tse});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kse(t){const e=P(t,"x","square"),n={};return V.runKernel("Square",{x:e},n)}const $t=U({square_:kse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ese(t,e=null,n=!1){let s=P(t,"x","sum");s.dtype==="bool"&&(s=ge(s,"int32"));const r={x:s},i={axis:e,keepDims:n};return V.runKernel(Zg,r,i)}const Te=U({sum_:Ese});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nse(t,e="euclidean",n=null,s=!1){t=P(t,"x","norm");const r=EB(t,e,n);let i=r.shape;if(s){const o=Ze(n,t.shape);i=xn(r.shape,o)}return H(r,i)}function EB(t,e,n=null){if(t.rank===0)return Tn(t);if(t.rank!==1&&n===null)return EB(H(t,[-1]),e,n);if(t.rank===1||typeof n=="number"||Array.isArray(n)&&n.length===1){if(e===1)return Te(Tn(t),n);if(e===1/0)return Lr(Tn(t),n);if(e===-1/0)return jh(Tn(t),n);if(e==="euclidean"||e===2)return Kn(Te(Co(Tn(t),Le(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&n.length===2){if(e===1)return Lr(Te(Tn(t),n[0]),n[1]-1);if(e===1/0)return Lr(Te(Tn(t),n[1]),n[0]);if(e===-1/0)return jh(Te(Tn(t),n[1]),n[0]);if(e==="fro"||e==="euclidean")return Kn(Te($t(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const ff=U({norm_:Nse});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $se(t,e=null,n=!1){return ff(t,"euclidean",e,n)}const FE=U({euclideanNorm_:$se});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rse(t){const n={x:P(t,"x","exp")};return V.runKernel(Nd,n)}const Js=U({exp_:Rse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ase(t,e=0){const n=P(t,"x","expandDims","string_or_numeric");O(e<=n.rank,()=>"Axis must be <= rank of the tensor");const s={input:n},r={dim:e};return V.runKernel(Sg,s,r)}const ss=U({expandDims_:Ase});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dse(t){const n={x:P(t,"x","expm1")};return V.runKernel($d,n)}const LE=U({expm1_:Dse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ose(t,e){const n=P(t,"x","tile","string_or_numeric");O(n.rank===e.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`);const s={x:n},r={reps:e};return V.runKernel(lf,s,r)}const Ar=U({tile_:Ose});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pse(t,e,n,s="float32"){e==null&&(e=t);const r=Xe([t,e],s),i=t<=e?t:e;for(let a=0;a<i;++a)r.set(1,a,a);const o=H(r.toTensor(),[t,e]);if(n==null)return o;if(n.length===1)return Ar(ss(o,0),[n[0],1,1]);if(n.length===2)return Ar(ss(ss(o,0),0),[n[0],n[1],1,1]);if(n.length===3)return Ar(ss(ss(ss(o,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}const n1=U({eye_:Pse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fse(t){const n={x:P(t,"x","floor","float32")};return V.runKernel(Rd,n)}const pf=U({floor_:Fse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lse(t,e,n=0,s=0){const r=P(t,"x","gather"),i=P(e,"indices","gather","int32"),o={x:r,indices:i},a={axis:n,batchDims:s};return V.runKernel(Ig,o,a)}const mf=U({gather_:Lse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mse(t,e){let n=P(t,"a","greater","string_or_numeric"),s=P(e,"b","greater","string_or_numeric");[n,s]=rn(n,s),Ge(n.shape,s.shape);const r={a:n,b:s};return V.runKernel(_g,r)}const Ms=U({greater_:Mse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zse(t,e){let n=P(t,"a","greaterEqual","string_or_numeric"),s=P(e,"b","greaterEqual","string_or_numeric");[n,s]=rn(n,s),Ge(n.shape,s.shape);const r={a:n,b:s};return V.runKernel(Dd,r)}const Ca=U({greaterEqual_:zse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bse(t){const n={input:P(t,"input","imag")};return V.runKernel(db,n)}const fy=U({imag_:Bse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vse(t){const n={x:P(t,"x","isFinite")};return V.runKernel(Pd,n)}const ME=U({isFinite_:Vse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Use(t){const n={x:P(t,"x","isInf")};return V.runKernel(Fd,n)}const zE=U({isInf_:Use});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wse(t){const n={x:P(t,"x","isNaN")};return V.runKernel(Ld,n)}const BE=U({isNaN_:Wse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jse(t,e=.2){const s={x:P(t,"x","leakyRelu")},r={alpha:e};return V.runKernel(Tg,s,r)}const py=U({leakyRelu_:jse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gse(t,e){let n=P(t,"a","less","string_or_numeric"),s=P(e,"b","less","string_or_numeric");[n,s]=rn(n,s),Ge(n.shape,s.shape);const r={a:n,b:s};return V.runKernel(kg,r)}const Gh=U({less_:Gse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hse(t,e){let n=P(t,"a","lessEqual","string_or_numeric"),s=P(e,"b","lessEqual","string_or_numeric");[n,s]=rn(n,s),Ge(n.shape,s.shape);const r={a:n,b:s};return V.runKernel(Eg,r)}const Xl=U({lessEqual_:Hse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NB(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");const s={start:t,stop:e,num:n};return V.runKernel(fb,{},s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qse(t,e=5,n=1,s=1,r=.5){const i=P(t,"x","localResponseNormalization");O(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),O(qu(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=i,a=!1;i.rank===3&&(a=!0,o=H(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const l={x:o},u={depthRadius:e,bias:n,alpha:s,beta:r},c=V.runKernel(Ag,l,u);return a?H(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const VE=U({localResponseNormalization_:qse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kse(t){const n={x:P(t,"x","log","float32")};return V.runKernel(Md,n)}const vr=U({log_:Kse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xse(t){const n={x:P(t,"x","log1p")};return V.runKernel(zd,n)}const my=U({log1p_:Xse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yse(t){return O(El(t),()=>"The f passed in grad(f) must be a function"),(e,n)=>{const s=P(e,"x","tf.grad","string_or_numeric"),r=n!=null?P(n,"dy","tf.grad"):null;return V.tidy(()=>{const{value:i,grads:o}=V.gradients(()=>t(s),[s],r);return r!=null&&cs(i.shape,r.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),s1(o),o[0]})}}function Qse(t){return O(El(t),()=>"The f passed in grads(f) must be a function"),(e,n)=>{O(Array.isArray(e),()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s");const s=_m(e,"args","tf.grads","string_or_numeric"),r=n!=null?P(n,"dy","tf.grads"):null;return V.tidy(()=>{const{value:i,grads:o}=V.gradients(()=>t(...s),s,r);return r!=null&&cs(i.shape,r.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),s1(o),o})}}function Jse(t){return O(El(t),()=>"The f passed in valueAndGrad(f) must be a function"),(e,n)=>{O(e instanceof pt,()=>"The x passed in valueAndGrad(f)(x) must be a tensor"),O(n==null||n instanceof pt,()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");const{grads:s,value:r}=V.gradients(()=>t(e),[e],n);return s1(s),{grad:s[0],value:r}}}function Zse(t){return O(El(t),()=>"The f passed in valueAndGrads(f) must be a function"),(e,n)=>{O(Array.isArray(e)&&e.every(r=>r instanceof pt),()=>"The args passed in valueAndGrads(f)(args) must be array of tensors"),O(n==null||n instanceof pt,()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");const s=V.gradients(()=>t(...e),e,n);return n!=null&&cs(s.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),s1(s.grads),s}}function $B(t,e){O(El(t),()=>"The f passed in variableGrads(f) must be a function"),O(e==null||Array.isArray(e)&&e.every(u=>u instanceof Im),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=e!=null;if(!n){e=[];for(const u in V.registeredVariables)e.push(V.registeredVariables[u])}const s=n?e.filter(u=>!u.trainable):null,r=e.length;e=e.filter(u=>u.trainable),O(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const i=!0,{value:o,grads:a}=V.gradients(t,e,null,i);O(a.some(u=>u!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),O(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const l={};return e.forEach((u,c)=>{a[c]!=null&&(l[u.name]=a[c])}),s!=null&&s.forEach(u=>l[u.name]=null),{value:o,grads:l}}function Io(t){return V.customGrad(t)}function s1(t){if(t.filter(n=>n==null).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ere(t){const n={x:P(t,"x","neg")};return V.runKernel(zg,n)}const Bt=U({neg_:ere});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tre(t){const n={x:P(t,"x","softplus")};return V.runKernel(tf,n)}const _c=U({softplus_:tre});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nre(t){const e=P(t,"x","logSigmoid");return Io(s=>({value:Bt(_c(Bt(s))),gradFunc:o=>G(o,Fi(Bt(s)))}))(e)}const UE=U({logSigmoid_:nre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sre(t,e){let n=P(t,"a","sub"),s=P(e,"b","sub");[n,s]=rn(n,s);const r={a:n,b:s};return V.runKernel(rf,r)}const _e=U({sub_:sre});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rre(t,e=-1){const n=P(t,"logits","logSoftmax");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);return Io((r,i)=>{const a=Lr(r,e,!0),l=_e(r,a),u=_e(ge(l,"float32"),vr(Te(Js(l),e,!0)));return i([u]),{value:u,gradFunc:(h,d)=>{const[f]=d,p=!0,m=Js(f);return _e(h,G(Te(h,e,p),m))}}})(n)}const r1=U({logSoftmax_:rre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ire(t,e=null,n=!1){const s=P(t,"x","logSumExp"),r=Ze(e,s.shape),i=Lr(s,r,!0),o=_e(s,i),a=Js(o),l=Te(a,r),u=vr(l),c=he(H(i,u.shape),u);if(n){const h=xn(c.shape,r);return H(c,h)}return c}const gy=U({logSumExp_:ire});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ore(t,e){const n=P(t,"a","logicalAnd","bool"),s=P(e,"b","logicalAnd","bool");Ge(n.shape,s.shape);const r={a:n,b:s};return V.runKernel(Ng,r)}const ci=U({logicalAnd_:ore});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function are(t){const n={x:P(t,"x","logicalNot","bool")};return V.runKernel($g,n)}const yy=U({logicalNot_:are});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lre(t,e){const n=P(t,"a","logicalOr","bool"),s=P(e,"b","logicalOr","bool");Ge(n.shape,s.shape);const r={a:n,b:s};return V.runKernel(Rg,r)}const i1=U({logicalOr_:lre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ure(t,e){const n=P(t,"a","logicalXor","bool"),s=P(e,"b","logicalXor","bool");return Ge(n.shape,s.shape),ci(i1(t,e),yy(ci(t,e)))}const WE=U({logicalXor_:ure});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A0=2147483648;function cre(t,e,n="left"){const s=P(t,"sortedSequence","searchSorted"),r=P(e,"values","searchSorted"),i=s.shape[s.shape.length-1],o=r.shape[r.shape.length-1],a=H(s,[-1,i]),l=H(r,[-1,o]);if(a.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(a.shape[0]!==l.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(re(l.shape)>=A0)throw new Error(`values tensor size must less than ${A0}`);if(a.shape[1]>=A0)throw new Error(`trailing dim_size must less than ${A0} for int32 output type, was ${a.shape[1]}`);const u={sortedSequence:a,values:l},c={side:n};return V.runKernel(Rb,u,c)}const o1=U({searchSorted_:cre});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RB(t,e){return o1(t,e,"left")}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hre(t,e,n,s,r){const i=P(t,"x","maxPool"),o=1;let a=i,l=!1;i.rank===3&&(l=!0,a=H(i,[1,i.shape[0],i.shape[1],i.shape[2]])),O(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),O(hs(n,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),Ls("maxPool",s,r);const u={x:a},c={filterSize:e,strides:n,pad:s,dimRoundingMode:r},h=V.runKernel(Og,u,c);return l?H(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const vy=U({maxPool_:hre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dre(t,e=[1,1,1],n,s,r,i="NDHWC"){const o=P(t,"x","maxPool3d");let a=o,l=!1;o.rank===4&&(l=!0,a=H(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),O(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),O(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),Ls("maxPool3d",s,r);const u={x:a},c={filterSize:e,strides:n,pad:s,dimRoundingMode:r,dataFormat:i},h=V.runKernel(Pg,u,c);return l?H(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const jE=U({maxPool3d_:dre});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fre(t,e,n,s,r=!1){const o={x:P(t,"x","maxPoolWithArgmax")},a={filterSize:e,strides:n,pad:s,includeBatchInIndex:r},l=V.runKernel(yb,o,a);return{result:l[0],indexes:l[1]}}const AB=U({maxPoolWithArgmax_:fre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pre(t,e){let n=P(t,"a","maximum"),s=P(e,"b","maximum");[n,s]=rn(n,s),n.dtype==="bool"&&(n=ge(n,"int32"),s=ge(s,"int32")),Ge(n.shape,s.shape);const r={a:n,b:s};return V.runKernel(Bd,r)}const Eo=U({maximum_:pre});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mre(t,e=null,n=!1){const r={x:P(t,"x","mean")},i={axis:e,keepDims:n};return V.runKernel(Fg,r,i)}const nn=U({mean_:mre});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function En(t,e="float32"){if(Sr(t),e==="complex64"){const s=En(t,"float32"),r=En(t,"float32");return da(s,r)}const n=us(re(t),e);return V.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function js(t,e="float32"){if(Sr(t),e==="complex64"){const s=js(t,"float32"),r=En(t,"float32");return da(s,r)}const n=Bx(re(t),e);return V.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DB(t,e,{indexing:n="xy"}={}){if(n!=="xy"&&n!=="ij")throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(t===void 0)return[];let s=P(t,"x","meshgrid",t instanceof pt?t.dtype:"float32");if(e===void 0)return[s];let r=P(e,"y","meshgrid",e instanceof pt?e.dtype:"float32");const i=re(s.shape),o=re(r.shape);return n==="xy"?(s=H(s,[1,-1]),r=H(r,[-1,1]),[Je(js([o,1],s.dtype),s),Je(r,js([1,i],r.dtype))]):(s=H(s,[-1,1]),r=H(r,[1,-1]),[Je(s,js([1,o],s.dtype)),Je(js([i,1],r.dtype),r)])}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gre(t,e){let n=P(t,"a","minimum"),s=P(e,"b","minimum");[n,s]=rn(n,s),n.dtype==="bool"&&(n=ge(n,"int32"),s=ge(s,"int32")),Ge(n.shape,s.shape);const r={a:n,b:s};return V.runKernel(Vd,r)}const Al=U({minimum_:gre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yre(t,e,n){O(n==="reflect"||n==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);const s=P(t,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");O(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const r=n==="reflect"?1:0;for(let a=0;a<s.rank;a++)O(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),O(e[a][0]>=0&&e[a][0]<=s.shape[a]-r&&e[a][1]>=0&&e[a][1]<=s.shape[a]-r,()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-r} or less than 0 for input of shape ${s.shape}`);const i={paddings:e,mode:n},o={x:s};return V.runKernel(Mg,o,i)}const GE=U({mirrorPad_:yre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vre(t,e){let n=P(t,"a","mod"),s=P(e,"b","mod");[n,s]=rn(n,s);const r={a:n,b:s};return V.runKernel(Ud,r)}const HE=U({mod_:vre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wre(t,e=null,n=!1){t=P(t,"x","moments");const s=Ze(e,t.shape),r=nn(t,s,n);let i=r.shape;n||(i=xn(r.shape,s));const o=$t(_e(ge(t,"float32"),H(r,i))),a=nn(o,s,n);return{mean:r,variance:a}}const wy=U({moments_:wre});function xre(t,e,n,s){const r=P(e,"data","multiRNNCell"),i=_m(n,"c","multiRNNCell"),o=_m(s,"h","multiRNNCell");let a=r;const l=[];for(let h=0;h<t.length;h++){const d=t[h](a,i[h],o[h]);l.push(d[0]),l.push(d[1]),a=d[1]}const u=[],c=[];for(let h=0;h<l.length;h+=2)u.push(l[h]),c.push(l[h+1]);return[u,c]}const OB=U({multiRNNCell_:xre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bre(t,e,n,s=!1){const r=P(t,"logits","multinomial"),i=r.size,o=r.rank;if(i<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${i}.`);if(o>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${o}`);n=n||Math.random();const l={logits:o===1?H(r,[1,-1]):r},u={numSamples:e,seed:n,normalized:s},c=V.runKernel(vb,l,u);return o===1?H(c,[c.size]):c}const PB=U({multinomial_:bre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sre(t,e){let n=P(t,"a","notEqual","string_or_numeric"),s=P(e,"b","notEqual","string_or_numeric");[n,s]=rn(n,s),Ge(n.shape,s.shape);const r={a:n,b:s};return V.runKernel(Bg,r)}const ec=U({notEqual_:Sre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cre(t,e,n=1,s=0,r="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const o={indices:P(t,"indices","oneHot","int32")},a={dtype:r,depth:e,onValue:n,offValue:s};return V.runKernel(Ug,o,a)}const Hh=U({oneHot_:Cre});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ire(t){const n={x:P(t,"x","onesLike")};return V.runKernel(Vg,n)}const wr=U({onesLike_:Ire});function _re(t,e){const n=P(t,"v1","outerProduct"),s=P(e,"v2","outerProduct");O(n.rank===1&&s.rank===1,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${s.rank}.`);const r=H(n,[-1,1]),i=H(s,[1,-1]);return Je(r,i)}const FB=U({outerProduct_:_re});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tre(t,e,n=0){const s=P(t,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:e,constantValue:n},i={x:s};return V.runKernel(jg,i,r)}const Ia=U({pad_:Tre});function kre(t,e,n=0){return O(e.length===2,()=>"Invalid number of paddings. Must be length of 2."),Ia(t,[e],n)}const LB=U({pad1d_:kre});function Ere(t,e,n=0){return O(e.length===2&&e[0].length===2&&e[1].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Ia(t,e,n)}const MB=U({pad2d_:Ere});function Nre(t,e,n=0){return O(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Ia(t,e,n)}const zB=U({pad3d_:Nre});function $re(t,e,n=0){return O(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Ia(t,e,n)}const BB=U({pad4d_:$re});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rre(t,e,n){const s=P(t,"x","spaceToBatchND");O(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),O(n.length===e.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`),O(s.shape.reduce((o,a,l)=>l>0&&l<=e.length?o&&(a+n[l-1][0]+n[l-1][1])%e[l-1]===0:o,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`);const r={x:s},i={blockShape:e,paddings:n};return V.runKernel(ey,r,i)}const xy=U({spaceToBatchND_:Rre});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Are(t,e,n,s,r,i,o){r==null&&(r=[1,1]),i==null&&(i=1),s===0&&(s="valid");const a=P(t,"x","maxPool");let l=a,u=!1;a.rank===3&&(u=!0,l=H(a,[1,a.shape[0],a.shape[1],a.shape[2]])),O(hs(i,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${r}'`);const c=hi(l.shape,e,i,r,s),h=[c.dilationHeight,c.dilationWidth];let d;s==="same"?d=Ore([c.filterHeight,c.filterWidth],h):d=[[0,0],[0,0]];const f=h[0]===1&&h[1]===1,[p,m]=Dre([c.inHeight,c.inWidth],h,d),v=f?s:"valid",g=f?l:xy(l,h,p),b=(n==="avg"?()=>cy(g,e,i,v,o):()=>vy(g,e,i,v,o))(),x=f?b:hy(b,h,m);return u?H(x,[x.shape[1],x.shape[2],x.shape[3]]):x}function Dre(t,e,n){const s=n.map(c=>c[0]),r=n.map(c=>c[1]),i=t.concat(s,r),o=e.map((c,h)=>(c-i[h]%c)%c),a=r.map((c,h)=>c+o[h]),l=e.map((c,h)=>[s[h],a[h]]),u=e.map((c,h)=>[0,o[h]]);return[l,u]}function Ore(t,e){const s=t.map((o,a)=>o+(o-1)*(e[a]-1)).map(o=>o-1),r=s.map(o=>Math.floor(o/2)),i=s.map((o,a)=>o-r[a]);return s.map((o,a)=>[r[a],i[a]])}const qE=U({pool_:Are});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pre(t,e){const n=P(t,"x","prelu"),s=P(e,"alpha","prelu"),r={x:n,alpha:s};return V.runKernel(Gg,r)}const by=U({prelu_:Pre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fre(t,e=null,n=!1){let s=P(t,"x","prod");s.dtype==="bool"&&(s=ge(s,"int32"));const r={x:s},i={axis:e,keepDims:n};return V.runKernel(Hg,r,i)}const KE=U({prod_:Fre});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lre(t,e,n,s){const r=t.map((c,h)=>P(c,`tensors${h}`,"raggedGather","int32")),i=P(e,"paramsDenseValues","raggedGather"),o=P(n,"indices","raggedGather","int32"),a={paramsNestedSplits:r,paramsDenseValues:i,indices:o},l={outputRaggedRank:s},u=V.runKernel(Sb,a,l);return{outputNestedSplits:u.slice(0,u.length-1),outputDenseValues:u[u.length-1]}}const VB=U({raggedGather_:Lre});/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mre(t,e,n){const s=P(t,"starts","raggedRange"),r=P(e,"limits","raggedRange",s.dtype),i=P(n,"deltas","raggedRange",s.dtype),o={starts:s,limits:r,deltas:i},a=V.runKernel(Cb,o);return{rtNestedSplits:a[0],rtDenseValues:a[1]}}const UB=U({raggedRange_:Mre});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zre(t,e,n,s,r){const i=P(t,"shape","raggedTensorToTensor","int32"),o=P(e,"values","raggedTensorToTensor"),a=P(n,"defaultValue","raggedTensorToTensor",o.dtype),l=s.map((h,d)=>P(h,`tensors${d}`,"raggedTensorToTensor","int32")),u={shape:i,values:o,defaultValue:a,rowPartitionTensors:l},c={rowPartitionTypes:r};return V.runKernel(Ib,u,c)}const WB=U({raggedTensorToTensor_:zre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bre(t,e,n){Sr(t);const s=re(t);let r=null;if(n==null||n==="float32")r=new Float32Array(s);else if(n==="int32")r=new Int32Array(s);else if(n==="bool")r=new Uint8Array(s);else throw new Error(`Unknown data type ${n}`);for(let i=0;i<s;i++)r[i]=e();return V.makeTensor(r,t,n)}const jB=U({rand_:Bre});var XE={exports:{}};XE.exports;(function(t){(function(e,n,s){function r(l){var u=this,c=a();u.next=function(){var h=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=h-(u.c=h|0)},u.c=1,u.s0=c(" "),u.s1=c(" "),u.s2=c(" "),u.s0-=c(l),u.s0<0&&(u.s0+=1),u.s1-=c(l),u.s1<0&&(u.s1+=1),u.s2-=c(l),u.s2<0&&(u.s2+=1),c=null}function i(l,u){return u.c=l.c,u.s0=l.s0,u.s1=l.s1,u.s2=l.s2,u}function o(l,u){var c=new r(l),h=u&&u.state,d=c.next;return d.int32=function(){return c.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,h&&(typeof h=="object"&&i(h,c),d.state=function(){return i(c,{})}),d}function a(){var l=4022871197,u=function(c){c=String(c);for(var h=0;h<c.length;h++){l+=c.charCodeAt(h);var d=.02519603282416938*l;l=d>>>0,d-=l,d*=l,l=d>>>0,d-=l,l+=d*4294967296}return(l>>>0)*23283064365386963e-26};return u}n&&n.exports?n.exports=o:this.alea=o})(qe,t)})(XE);var Vre=XE.exports,YE={exports:{}};YE.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var h=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^h^h>>>8},a===(a|0)?l.x=a:u+=a;for(var c=0;c<u.length+64;c++)l.x^=u.charCodeAt(c)|0,l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function o(a,l){var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:this.xor128=o})(qe,t)})(YE);var Ure=YE.exports,QE={exports:{}};QE.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.next=function(){var h=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(h^h<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:u+=a;for(var c=0;c<u.length+64;c++)l.x^=u.charCodeAt(c)|0,c==u.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function o(a,l){var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:this.xorwow=o})(qe,t)})(QE);var Wre=QE.exports,JE={exports:{}};JE.exports;(function(t){(function(e,n,s){function r(a){var l=this;l.next=function(){var c=l.x,h=l.i,d,f;return d=c[h],d^=d>>>7,f=d^d<<24,d=c[h+1&7],f^=d^d>>>10,d=c[h+3&7],f^=d^d>>>3,d=c[h+4&7],f^=d^d<<7,d=c[h+7&7],d=d^d<<13,f^=d^d<<9,c[h]=f,l.i=h+1&7,f};function u(c,h){var d,f=[];if(h===(h|0))f[0]=h;else for(h=""+h,d=0;d<h.length;++d)f[d&7]=f[d&7]<<15^h.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?f[7]=-1:f[d],c.x=f,c.i=0,d=256;d>0;--d)c.next()}u(l,a)}function i(a,l){return l.x=a.x.slice(),l.i=a.i,l}function o(a,l){a==null&&(a=+new Date);var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(c.x&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:this.xorshift7=o})(qe,t)})(JE);var jre=JE.exports,ZE={exports:{}};ZE.exports;(function(t){(function(e,n,s){function r(a){var l=this;l.next=function(){var c=l.w,h=l.X,d=l.i,f,p;return l.w=c=c+1640531527|0,p=h[d+34&127],f=h[d=d+1&127],p^=p<<13,f^=f<<17,p^=p>>>15,f^=f>>>12,p=h[d]=p^f,l.i=d,p+(c^c>>>16)|0};function u(c,h){var d,f,p,m,v,g=[],w=128;for(h===(h|0)?(f=h,h=null):(h=h+"\0",f=0,w=Math.max(w,h.length)),p=0,m=-32;m<w;++m)h&&(f^=h.charCodeAt((m+32)%h.length)),m===0&&(v=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,m>=0&&(v=v+1640531527|0,d=g[m&127]^=f+v,p=d==0?p+1:0);for(p>=128&&(g[(h&&h.length||0)&127]=-1),p=127,m=4*128;m>0;--m)f=g[p+34&127],d=g[p=p+1&127],f^=f<<13,d^=d<<17,f^=f>>>15,d^=d>>>12,g[p]=f^d;c.w=v,c.X=g,c.i=p}u(l,a)}function i(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function o(a,l){a==null&&(a=+new Date);var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(c.X&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:this.xor4096=o})(qe,t)})(ZE);var Gre=ZE.exports,eN={exports:{}};eN.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.next=function(){var h=l.b,d=l.c,f=l.d,p=l.a;return h=h<<25^h>>>7^d,d=d-f|0,f=f<<24^f>>>8^p,p=p-h|0,l.b=h=h<<20^h>>>12^d,l.c=d=d-f|0,l.d=f<<16^d>>>16^p,l.a=p-h|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):u+=a;for(var c=0;c<u.length+20;c++)l.b^=u.charCodeAt(c)|0,l.next()}function i(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function o(a,l){var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:this.tychei=o})(qe,t)})(eN);var Hre=eN.exports,GB={exports:{}};const qre={},Kre=Object.freeze(Object.defineProperty({__proto__:null,default:qre},Symbol.toStringTag,{value:"Module"})),a1=j_(Kre);(function(t){(function(e,n,s){var r=256,i=6,o=52,a="random",l=s.pow(r,i),u=s.pow(2,o),c=u*2,h=r-1,d;function f(x,S,N){var I=[];S=S==!0?{entropy:!0}:S||{};var C=g(v(S.entropy?[x,b(n)]:x??w(),3),I),_=new p(I),k=function(){for(var A=_.g(i),D=l,R=0;A<u;)A=(A+R)*r,D*=r,R=_.g(1);for(;A>=c;)A/=2,D/=2,R>>>=1;return(A+R)/D};return k.int32=function(){return _.g(4)|0},k.quick=function(){return _.g(4)/4294967296},k.double=k,g(b(_.S),n),(S.pass||N||function(A,D,R,W){return W&&(W.S&&m(W,_),A.state=function(){return m(_,{})}),R?(s[a]=A,D):A})(k,C,"global"in S?S.global:this==s,S.state)}function p(x){var S,N=x.length,I=this,C=0,_=I.i=I.j=0,k=I.S=[];for(N||(x=[N++]);C<r;)k[C]=C++;for(C=0;C<r;C++)k[C]=k[_=h&_+x[C%N]+(S=k[C])],k[_]=S;(I.g=function(A){for(var D,R=0,W=I.i,B=I.j,M=I.S;A--;)D=M[W=h&W+1],R=R*r+M[h&(M[W]=M[B=h&B+D])+(M[B]=D)];return I.i=W,I.j=B,R})(r)}function m(x,S){return S.i=x.i,S.j=x.j,S.S=x.S.slice(),S}function v(x,S){var N=[],I=typeof x,C;if(S&&I=="object")for(C in x)try{N.push(v(x[C],S-1))}catch{}return N.length?N:I=="string"?x:x+"\0"}function g(x,S){for(var N=x+"",I,C=0;C<N.length;)S[h&C]=h&(I^=S[h&C]*19)+N.charCodeAt(C++);return b(S)}function w(){try{var x;return d&&(x=d.randomBytes)?x=x(r):(x=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(x)),b(x)}catch{var S=e.navigator,N=S&&S.plugins;return[+new Date,e,N,e.screen,b(n)]}}function b(x){return String.fromCharCode.apply(0,x)}if(g(s.random(),n),t.exports){t.exports=f;try{d=a1}catch{}}else s["seed"+a]=f})(typeof self<"u"?self:qe,[],Math)})(GB);var Xre=GB.exports,Yre=Vre,Qre=Ure,Jre=Wre,Zre=jre,eie=Gre,tie=Hre,Tc=Xre;Tc.alea=Yre;Tc.xor128=Qre;Tc.xorwow=Jre;Tc.xorshift7=Zre;Tc.xor4096=eie;Tc.tychei=tie;var tN=Tc;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nie=.001,HB=.1;function sie(t,e,n){return n==null&&(n=nN()),u_(t,e,(s,r)=>sN(s,r,n))}function nN(){return V.backend.floatPrecision()===32?nie:HB}function u_(t,e,n){let s=!0;if((An(t)||An(e))&&(s=!1),An(t)&&An(e)&&(s=!0),s){const o=t.constructor.name,a=e.constructor.name;if(o!==a)throw new Error(`Arrays are of different type. Actual: ${o}. Expected: ${a}`)}if(Array.isArray(t)&&Array.isArray(e)){const o=So(t),a=So(e);if(!st(o,a))throw new Error(`Arrays have different shapes. Actual: [${o}]. Expected: [${a}]`)}const r=An(t)?t:bo(t),i=An(e)?e:bo(e);if(r.length!==i.length)throw new Error(`Arrays have different lengths actual: ${r.length} vs expected: ${i.length}.
Actual:   ${r}.
Expected: ${i}.`);for(let o=0;o<i.length;++o){const a=r[o],l=i[o];if(!n(a,l))throw new Error(`Arrays differ: actual[${o}] = ${a}, expected[${o}] = ${l}.
Actual:   ${r}.
Expected: ${i}.`)}typeof expect<"u"&&expect().nothing()}function rie(t,e){t().then(()=>e.fail(),()=>e()),typeof expect<"u"&&expect().nothing()}function iie(t,e){const n=typeof e=="string"||typeof e=="number"||typeof e=="boolean"?[e]:e;return ao(t)||ao(t[0])||ao(e)||ao(e[0])?u_(t,n,(s,r)=>s==r):u_(t,e,(s,r)=>sN(s,r,0))}function oie(t,e,n){if(n==null&&(n=nN()),!sN(t,e,n))throw new Error(`Numbers differ: actual === ${t}, expected === ${e}`);typeof expect<"u"&&expect().nothing()}function sN(t,e,n){return!isFinite(t)&&!isFinite(e)?!0:!(isNaN(t)||isNaN(e)||Math.abs(t-e)>n)}function aie(t,e,n){for(let s=0;s<t.length;s++)if(t[s]<e||t[s]>n)throw new Error(`Value out of range:${t[s]} low: ${e}, high: ${n}`)}function lie(t,e){const n=new Float32Array(t),s=new Float32Array(e);if(n.length!==s.length)throw new Error(`Expected ArrayBuffer to be of length ${s.length}, but it was ${n.length}`);for(let r=0;r<s.length;r++)if(n[r]!==s[r])throw new Error(`Expected ArrayBuffer value at ${r} to be ${s[r]} but got ${n[r]} instead`)}function qB(t){for(let e=0;e<t.length;e++){const n=t[e];Array.isArray(n)?qB(n):t[e]=go(n)}return t}function uie(t){const e=document.createElement("video");return"playsInline"in e&&(e.playsInline=!0),e.muted=!0,e.loop=!0,e.style.position="fixed",e.style.left="0px",e.style.top="0px",e.preload="auto",e.appendChild(t),new Promise(n=>{e.addEventListener("loadeddata",s=>n(e)),e.load()})}async function cie(t){await t.play(),"requestVideoFrameCallback"in t&&await new Promise(e=>{t.requestVideoFrameCallback(e)})}const hie=Object.freeze(Object.defineProperty({__proto__:null,TEST_EPSILON_FLOAT16:HB,createVideoElement:uie,encodeStrings:qB,expectArrayBuffersEqual:lie,expectArraysClose:sie,expectArraysEqual:iie,expectNumbersClose:oie,expectPromiseToFail:rie,expectValuesInRange:aie,play:cie,testEpsilon:nN},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rN{constructor(e,n,s,r,i){this.mean=e,this.stdDev=n,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const o=i||Math.random();this.random=tN.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let e,n,s=!1;for(;!s;){let r,i,o;do r=2*this.random()-1,i=2*this.random()-1,o=r*r+i*i;while(o>=1||o===0);const a=Math.sqrt(-2*Math.log(o)/o);e=this.mean+this.stdDev*r*a,n=this.mean+this.stdDev*i*a,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class die{constructor(e,n,s,r){this.alpha=e,this.beta=1/n,this.dtype=s;const i=r||Math.random();this.randu=tN.alea(i.toString()),this.randn=new rN(0,1,s,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let e,n,s,r,i,o;for(;;){do r=this.randn.nextValue(),o=1+this.c*r;while(o<=0);if(o*=o*o,e=r*r,n=1-.331*e*e,s=.5*e+this.d*(1-o+Math.log(o)),i=this.randu(),i<n||Math.log(i)<s)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)}convertValue(e){return this.dtype==="float32"?e:Math.round(e)}}class fie{constructor(e=0,n=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=n-e,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${n} <= 1 and dtype is not float`);this.random=tN.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pie(t,e,n=1,s="float32",r){if(Sr(t),n==null&&(n=1),s==null&&(s="float32"),s!=="float32"&&s!=="int32")throw new Error(`Unsupported data type ${s}`);const i=new die(e,n,s,r),o=Xe(t,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const KB=U({randomGamma_:pie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mie(t,e=0,n=1,s,r){if(Sr(t),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const i=new rN(e,n,s,!1,r),o=Xe(t,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const l1=U({randomNormal_:mie});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gie(t,e,n){if(e!=null&&e==="bool")throw new Error(`Unsupported data type ${e}`);return l1(t,0,1,e,n)}const XB=U({randomStandardNormal_:gie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yie(t,e=0,n=1,s="float32",r){Sr(t);const i=Xe(t,s),o=new fie(e,n,null,r);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const Yl=U({randomUniform_:yie});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vie(t,e,n,s){return Yl(t,e,n,"int32",s)}const YB=U({randomUniformInt_:vie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tc(t,e,n=1,s="float32"){if(n===0)throw new Error("Cannot have a step of zero");const r={start:t,stop:e,step:n,dtype:s};return V.runKernel(_b,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wie(t){const n={input:P(t,"input","real")};return V.runKernel(Tb,n)}const qh=U({real_:wie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xie(t){const n={x:P(t,"x","reciprocal")};return V.runKernel(Gd,n)}const iN=U({reciprocal_:xie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bie(t){const n={x:P(t,"x","relu")};return V.runKernel(Hd,n)}const Xi=U({relu_:bie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sie(t){const n={x:P(t,"x","relu6")};return V.runKernel(qd,n)}const u1=U({relu6_:Sie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cie(t,e){const s={x:P(t,"x","reverse")},r={dims:e};return V.runKernel(Yg,s,r)}const zr=U({reverse_:Cie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iie(t){const e=P(t,"x","reverse");return O(e.rank===1,()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`),zr(e,0)}const QB=U({reverse1d_:Iie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ie(t,e){const n=P(t,"x","reverse");return O(n.rank===2,()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`),zr(n,e)}const JB=U({reverse2d_:_ie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tie(t,e){const n=P(t,"x","reverse");return O(n.rank===3,()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`),zr(n,e)}const ZB=U({reverse3d_:Tie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kie(t,e){const n=P(t,"x","reverse");return O(n.rank===4,()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`),zr(n,e)}const eV=U({reverse4d_:kie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eie(t){const n={x:P(t,"x","round")};return V.runKernel(Kd,n)}const c1=U({round_:Eie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nie(t){const n={x:P(t,"x","rsqrt","float32")};return V.runKernel(Xd,n)}const h1=U({rsqrt_:Nie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ie(t){const n={x:P(t,"x","selu")};return V.runKernel(Yd,n)}const d1=U({selu_:$ie});function Rie(t,e,n,s,r,i=[1,1],o="NHWC"){const a=P(t,"x","separableConv2d"),l=P(e,"depthwiseFilter","separableConv2d"),u=P(n,"pointwiseFilter","separableConv2d");let c=a,h=!1;if(a.rank===3&&(h=!0,c=H(a,[1,a.shape[0],a.shape[1],a.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");O(c.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${c.rank}.`),O(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),O(u.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),O(u.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${u.shape[0]}.`),O(u.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${u.shape[1]}.`);const d=l.shape[2],f=l.shape[3];O(u.shape[2]===d*f,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${d*f}, but got ${u.shape[2]}.`);const p=hf(c,l,s,r,o,i),v=fa(p,u,1,"valid",o);return h?H(v,[v.shape[1],v.shape[2],v.shape[3]]):v}const f1=U({separableConv2d_:Rie});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Aie(t,e){const n=P(t,"x","setdiff1d"),s=P(e,"y","setdiff1d");O(n.dtype===s.dtype,()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${s.dtype}).`),O(n.rank===1,()=>`x should be 1D tensor, but got x (${n.shape}).`),O(s.rank===1,()=>`y should be 1D tensor, but got y (${s.shape}).`);const r=await n.data(),i=await s.data(),o=new Set(i);let a=0;for(let c=0;c<r.length;c++)o.has(r[c])||a++;const l=new $n([a],n.dtype),u=new $n([a],"int32");for(let c=0,h=0;c<r.length;c++)o.has(r[c])||(l.values[h]=r[c],u.values[h]=c,h++);return[l.toTensor(),u.toTensor()]}const tV=Aie;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Die(t){const n={x:P(t,"x","sign")};return V.runKernel(Zd,n)}const oN=U({sign_:Die});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oie(t){const n={x:P(t,"x","sin","float32")};return V.runKernel(Qd,n)}const p1=U({sin_:Oie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pie(t){const n={x:P(t,"x","sinh")};return V.runKernel(Jd,n)}const m1=U({sinh_:Pie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fie(t,e,n){const s=P(t,"x","slice1d");return O(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),lt(s,[e],[n])}const Sy=U({slice1d_:Fie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lie(t,e,n){const s=P(t,"x","slice2d");return O(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),lt(s,e,n)}const g1=U({slice2d_:Lie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mie(t,e,n){const s=P(t,"x","slice3d");return O(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),lt(s,e,n)}const Cy=U({slice3d_:Mie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zie(t,e,n){const s=P(t,"x","slice4d");return O(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),lt(s,e,n)}const Kh=U({slice4d_:zie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bie(t,e=-1){const n=P(t,"logits","softmax","float32");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const s={logits:n},r={dim:e};return V.runKernel(ny,s,r)}const Iy=U({softmax_:Bie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vie(t){O(t.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`);const e={input:t};return V.runKernel(ab,e)}const _y=U({fft_:Vie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uie(t){O(t.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`);const e={input:t};return V.runKernel(hb,e)}const Xh=U({ifft_:Uie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wie(t){const e=t.shape[t.shape.length-1],n=t.size/e;let s;if(e<=2){const r=H(t,[n,e]);s=Xh(r)}else{const r=[n,2*(e-1)],i=H(qh(t),[n,e]),o=H(fy(t),[n,e]),a=zr(lt(i,[0,1],[n,e-2]),1),l=G(zr(lt(o,[0,1],[n,e-2]),1),Le(-1)),u=wn([i,a],1),c=wn([o,l],1),h=H(da(u,c),[r[0],r[1]]);s=Xh(h)}if(s=qh(s),t.rank===3&&t.shape[0]!==0){const r=s,i=t.shape[0];s=H(s,[i,s.shape[0]/i,s.shape[1]]),r.dispose()}return s}const y1=U({irfft_:Wie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jie(t,e,n=0){const r={x:P(t,"x","split")},i={numOrSizeSplits:e,axis:n};return V.runKernel(ty,r,i)}const qs=U({split_:jie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gie(t,e){O(t.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${t.dtype}`);let n=t.shape[t.shape.length-1];const s=t.size/n;let r;if(e!=null&&e<n){const p=t.shape.map(v=>0),m=t.shape.map(v=>v);m[t.shape.length-1]=e,r=lt(t,p,m),n=e}else if(e!=null&&e>n){const p=t.shape.map(m=>m);p[t.shape.length-1]=e-n,r=wn([t,En(p)],t.shape.length-1),n=e}else r=t;const i=ct(r),o=H(da(r,i),[s,n]),a=_y(o),l=Math.floor(n/2)+1,u=qh(a),c=fy(a),h=qs(u,[l,n-l],u.shape.length-1),d=qs(c,[l,n-l],c.shape.length-1),f=r.shape.slice();return f[r.shape.length-1]=l,H(da(h[0],d[0]),f)}const Ty=U({rfft_:Gie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hie(t,e){let n=P(t,"a","squaredDifference"),s=P(e,"b","squaredDifference");[n,s]=rn(n,s),Ge(n.shape,s.shape);const r={a:n,b:s},i={};return V.runKernel(sf,r,i)}const v1=U({squaredDifference_:Hie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qie(t,e){const n=P(t,"x","squeeze","string_or_numeric");return H(n,wa(n.shape,e).newShape)}const Ql=U({squeeze_:qie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kie(t,e=0){const n=_m(t,"tensors","stack","string_or_numeric");O(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&O(e<=n[0].rank,()=>"Axis must be <= rank of the tensor");const s=n,r={axis:e};return V.runKernel(Wg,s,r)}const Ps=U({stack_:Kie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xie(t,e=0){const s={x:P(t,"x","step")},r={alpha:e};return V.runKernel(uf,s,r)}const kc=U({step_:Xie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yie(t,e,n,s,r=0,i=0,o=0,a=0,l=0){const c={x:P(t,"x","stridedSlice","string_or_numeric")},h={begin:e,end:n,strides:s,beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};return V.runKernel(Mb,c,h)}const aN=U({stridedSlice_:Yie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qie(t){const n={x:P(t,"x","tan","float32")};return V.runKernel(of,n)}const lN=U({tan_:Qie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function os(t,e){wc(t);const n=So(t,e);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Hl(t,null,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yl(t,e,n){if(wc(t),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=So(t,n);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Hl(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uN(t,e,n){if(wc(t),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");const s=So(t,n);if(s.length!==3&&s.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Hl(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nV(t,e,n){if(wc(t),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");const s=So(t,n);if(s.length!==4&&s.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Hl(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sV(t,e,n){if(wc(t),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");const s=So(t,n);if(s.length!==5&&s.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Hl(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rV(t,e,n){if(wc(t),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");const s=So(t,n);if(s.length!==6&&s.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||s,Hl(t,e,s,n)}function cN(t,e,n){const s=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${s}, and batchDim: ${r}.`;if(n.rank<r)throw new Error(i+` update.rank < ${r}. `);if(t.length<s+(n.rank-r))throw new Error(i+` Output shape length < ${s+(n.rank-r)}`);if(n.rank!==r+t.length-s)throw new Error(i+` update.rank != ${r+t.length-s}`);for(let o=0;o<r;++o)if(n.shape[o]!==e.shape[o])throw new Error(i+` updates.shape[${o}] (${n.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<n.rank-r;++o)if(n.shape[o+r]!==t[o+s])throw new Error(i+` updates.shape[${o+r}] (${n.shape[o+r]}) != shape[${o+r}] (${t[o+r]})`)}function w1(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(n.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(t.size===0)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}cN(n,e,t)}function Jl(t,e,n){const s=e.shape.length,r=s>1?e.shape[s-1]:1,i=n.length;let o=1;for(let h=r;h<i;++h)o*=n[h];const a=r<1?1:r,l=re(e.shape)/a,u=[...Me(n.slice(0,r)),1],c=re(n);return{sliceRank:r,numUpdates:l,sliceSize:o,strides:u,outputSize:c}}const Jie=Object.freeze(Object.defineProperty({__proto__:null,calculateShapes:Jl,validateInput:w1,validateUpdateShape:cN},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zie(t,e,n){const s=P(t,"tensor","tensorScatterupdate"),r=P(e,"indices","tensorScatterupdate","int32"),i=P(n,"updates","tensorScatterupdate");if(w1(i,r,s.shape),s.dtype!==i.dtype)throw new Error(`tensor and updates must have the same dtype, instead they are ${s.dtype} and ${i.dtype}.`);const o={tensor:s,indices:r,updates:i},a={};return V.runKernel($b,o,a)}const iV=U({tensorScatterUpdate_:Zie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eoe(t,e=1,n=!0){const s=P(t,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${e}`);const i={x:s},o={k:e,sorted:n},[a,l]=V.runKernel(Ub,i,o);return{values:a,indices:l}}const hN=U({topk_:eoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function toe(t,e=0,n=1,s,r){if(Sr(t),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const i=new rN(e,n,s,!0,r),o=Xe(t,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const x1=U({truncatedNormal_:toe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function noe(t,e=0){const n=P(t,"x","unique","string_or_numeric");O(n.rank>0,()=>"The input tensor must be at least 1D");const s={x:n},r={axis:e},[i,o]=V.runKernel(jb,s,r);return{values:i,indices:o}}const dN=U({unique_:noe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function soe(t,e,n){const s=P(t,"x","unsortedSegmentSum"),r=P(e,"segmentIds","unsortedSegmentSum","int32");O(qu(n),()=>"numSegments must be of dtype int");const i={x:s,segmentIds:r},o={numSegments:n};return V.runKernel(iy,i,o)}const b1=U({unsortedSegmentSum_:soe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function roe(t,e=0){const n=P(t,"x","unstack","string_or_numeric");O(e>=-n.shape.length&&e<n.shape.length,()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`);const s={value:n},r={axis:e};return V.runKernel(ry,s,r)}const Br=U({unstack_:roe});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oV(t,e){return o1(t,e,"right")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fN(t,e=!0,n,s){return V.makeVariable(t,e,n,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S1(t,e){const n=[];for(let i=0;i<e.length;i++)e[i]&&n.push(i);const s=Xe(t,"int32"),r=Xe([n.length,t.length],"int32");for(let i=0;i<n.length;i++){const o=s.indexToLoc(n[i]),a=i*t.length;r.values.set(o,a)}return r.toTensor()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function ioe(t){const e=P(t,"condition","whereAsync","bool"),n=await e.data(),s=S1(e.shape,n);return t!==e&&e.dispose(),s}const pN=ioe;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function ooe(t,e,n){const s=P(t,"tensor","boolMask"),r=P(e,"mask","boolMask","bool"),i=n??0,o=r.rank,a=s.shape;O(o>0,()=>"mask cannot be scalar"),cs(a.slice(i,i+o),r.shape,"mask's shape must match the first K dimensions of tensor's shape,");let l=1;for(let m=i;m<i+o;m++)l*=a[m];const u=a.slice(0,i).concat([l],a.slice(i+o)),c=H(s,u),h=H(r,[-1]),d=await pN(h),f=Ql(d,[1]),p=mf(c,f,i);return t!==s&&s.dispose(),e!==r&&r.dispose(),f.dispose(),c.dispose(),h.dispose(),d.dispose(),p}const aV=ooe;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aoe(t,e,n){const s=P(t,"x","transpose");if(e==null&&(e=s.shape.map((o,a)=>a).reverse()),O(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(o=>{O(o>=0&&o<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const r={x:s},i={perm:e};return s.dtype==="complex64"?J(()=>{let o=qh(s),a=fy(s);return o=V.runKernel(Au,{x:o},i),a=V.runKernel(Au,{x:a},i),n&&(a=Bt(a)),da(o,a)}):V.runKernel(Au,r,i)}const ot=U({transpose_:aoe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function loe(t,e,n,s,r=!0){const i=P(t,"v","movingAverage"),o=P(e,"x","movingAverage"),a=P(n,"decay","movingAverage");nB(i,o),O(st(i.shape,o.shape),()=>"Shape mismatch in v and x");const l=Le(1),u=_e(l,a);let c=G(_e(o,i),u);if(r){O(s!=null,()=>"When using zeroDebias: true, step is required.");const h=P(s,"step","movingAverage");c=Re(c,_e(l,Co(a,h)))}return he(i,c)}const lV=U({movingAverage_:loe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uoe(t,e,n){Sr(n);const s=P(t,"indices","scatterND","int32"),r=P(e,"updates","scatterND");w1(r,s,n);const i={indices:s,updates:r},o={shape:n};return V.runKernel(Nb,i,o)}const uV=U({scatterND_:uoe});function coe(t,e,n,s){if(t.dtype!=="int32")throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${t.shape}.`);const r=t.rank>0?t.shape[0]:1,i=t.rank>1?t.shape[1]:1;if(n.length!==i)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${i}.`);const o=e.size;if(!(e.rank===0||e.rank===1&&o===r))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${r}]`);if(e.dtype!==s.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hoe(t,e,n,s=0){Sr(n);const r=P(t,"sparseIndices","sparseToDense","int32"),i=P(e,"sparseValues","sparseToDense","string_or_numeric"),o=P(s,"defaultValue","sparseToDense",i.dtype);coe(r,i,n,o);const a={sparseIndices:r,sparseValues:i,defaultValue:o},l={outputShape:n};return V.runKernel(Fb,a,l)}const cV=U({sparseToDense_:hoe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function doe(t,e){const n=P(e,"indices","gatherND","int32"),r={params:P(t,"x","gatherND","string_or_numeric"),indices:n};return V.runKernel(cb,r)}const hV=U({gatherND_:doe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function foe(t,e){if(e==null)return t.shape.slice();if(st(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let s=0;s<t.shape.length;s++)e[s]==null&&t.shape[s]!=null?n.push(t.shape[s]):n.push(e[s]);return n}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function poe(t,e,n,s){const r=P(t,"x","dropout");if(O(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),O(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return t instanceof pt?r.clone():r;const i=foe(r,n),o=1-e,a=Re(pf(he(Yl(i,0,1,"float32",s),o)),o);return G(r,a)}const mN=U({dropout_:poe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gN(t){return Math.floor(Math.pow(2,Math.ceil(Math.log(t)/Math.log(2))))}function C1(t,e,n){const s=1-t%2,r=new Float32Array(t);for(let i=0;i<t;++i){const o=2*Math.PI*i/(t+s-1);r[i]=e-n*Math.cos(o)}return os(r,"float32")}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function moe(t,e,n=1){const s=P(t,"predictions","inTopK"),r=P(e,"targets","inTopK");O(s.rank>1,()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${s.rank}`),O(s.rank-1===r.rank,()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${s.rank} and targets rank ${r.rank}`),cs(s.shape.slice(0,s.shape.length-1),r.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const i=s.shape[s.shape.length-1];O(n>0&&n<=i,()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${i}), but got ${n}`);const o=await s.data(),a=await r.data(),[l,u]=[o.length/i,i],c=qn("bool",l);for(let h=0;h<l;h++){const d=h*u,f=o.subarray(d,d+u),p=[];for(let m=0;m<f.length;m++)p.push({value:f[m],index:m});p.sort((m,v)=>v.value-m.value),c[h]=0;for(let m=0;m<n;m++)if(p[m].index===a[h]){c[h]=1;break}}return t!==s&&s.dispose(),e!==r&&r.dispose(),gr(c,r.shape,"bool")}const dV=moe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function goe(t,e,n,s,r,i="NHWC",o){let a=t;t.rank===3&&(a=H(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=H(e,[1,e.shape[0],e.shape[1],e.shape[2]])),O(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),O(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),O(n.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`);const u=i==="NHWC"?a.shape[3]:a.shape[1],c=i==="NHWC"?l.shape[3]:l.shape[1];O(u===n[2],()=>`Error in conv2dDerFilter: depth of input ${u}) must match input depth in filter (${n[2]}.`),O(c===n[3],()=>`Error in conv2dDerFilter: depth of dy (${c}) must match output depth for filter (${n[3]}).`),Ls("conv2dDerFilter",r,o);const h={x:a,dy:l},d={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,filterShape:n};return V.runKernel(Kx,h,d)}const yN=U({conv2DBackpropFilter_:goe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I1(t,e,n){if(n==null||n==="linear")return t;if(n==="relu")return G(t,kc(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function _1(t,e){let n=e;const s=Rn(t.shape,e.shape);return s.length>0&&(n=Te(n,s)),H(n,t.shape)}function T1(t,e,n,s){if(e==="linear")return t;if(e==="relu")return Xi(t);if(e==="elu")return df(t);if(e==="relu6")return u1(t);if(e==="prelu")return by(t,n);if(e==="leakyrelu")return py(t,s);if(e==="sigmoid")return Fi(t);throw new Error(`Unknown fused activation ${e}.`)}const k1=(t,e)=>!(t>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yoe({x:t,filter:e,strides:n,pad:s,dataFormat:r="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:c}){if(l=l||"linear",k1(V.state.gradientDepth,l)===!1){O(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let N=fa(t,e,n,s,r,i,o);return a!=null&&(N=he(N,a)),T1(N,l,u,c)}const h=P(t,"x","conv2d","float32"),d=P(e,"filter","conv2d","float32");let f=h,p=!1;h.rank===3&&(p=!0,f=H(h,[1,h.shape[0],h.shape[1],h.shape[2]])),O(f.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${f.rank}.`),O(d.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${d.rank}.`),Ls("fused conv2d",s,o);const m=r==="NHWC"?f.shape[3]:f.shape[1];O(d.shape[2]===m,()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${d.shape[2]}.`),O(hs(n,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`);const v=Yn(f.shape,d.shape,n,i,s,o);let g;a!=null&&(g=P(a,"bias","fused conv2d"),[g]=rn(g,h),r==="NHWC"?Ge(v.outShape,g.shape):(O(g.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${g.shape.length}.`),O(g.shape.length===0||g.shape[0]===v.outChannels||g.shape[0]===1,()=>`Error in fused conv2d: bias shape (${g.shape}) is not compatible with the number of output channels (${v.outChannels})`)));let w;if(u!=null){const N=u.shape;if(O(N.length<=1||N.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${N.length}.`),N.length===1)O(N[0]===1||N[0]===v.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${N}) is not compatible with the number of output channels (${v.outChannels}).`);else if(N.length===3)try{Ge(N,v.outShape)}catch{const C=`Error in fused conv2d: PReLU activation weights (${N}) is not compatible with the output shape of the conv2d (${v.outShape}).`;throw Error(C)}w=P(u,"prelu weights","fused conv2d")}const b=(N,I)=>{O(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[C,_,k,A]=I,D=I1(N,k,l);O($l(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);const R=EE(_.shape,D,C,n,s),W=yN(_,D,C.shape,n,s),B=[R,W];if(A!=null){const M=_1(A,D);B.push(M)}return B},x={x:f,filter:d,bias:g,preluActivationWeights:w},S={strides:n,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o,activation:l,leakyreluAlpha:c};return a==null?Io((I,C,_)=>{let k=V.runKernel(xm,x,S);return _([C,I,k]),p&&(k=H(k,[k.shape[1],k.shape[2],k.shape[3]])),{value:k,gradFunc:b}})(f,d):Io((I,C,_,k)=>{let A=V.runKernel(xm,x,S);return k([C,I,A,_]),p&&(A=H(A,[A.shape[1],A.shape[2],A.shape[3]])),{value:A,gradFunc:b}})(f,d,g)}const fV=U({fusedConv2d_:yoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function voe(t,e,n,s,r,i=[1,1],o){let a=t;t.rank===3&&(a=H(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=H(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={x:a,dy:l},c={strides:s,pad:r,dimRoundingMode:o,dilations:i,filterShape:n};return V.runKernel(tb,u,c)}const pV=U({depthwiseConv2dNativeBackpropFilter_:voe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function woe(t,e,n,s,r,i=[1,1],o){let a=e,l=!1;e.rank===3&&(l=!0,a=H(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={dy:a,filter:n},c={strides:s,pad:r,dimRoundingMode:o,dilations:i,inputShape:t},h=V.runKernel(nb,u,c);return l?H(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const mV=U({depthwiseConv2dNativeBackpropInput_:woe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xoe({x:t,filter:e,strides:n,pad:s,dataFormat:r="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:c}){if(k1(V.state.gradientDepth,l)===!1){let S=hf(t,e,n,s,r,i,o);return a!=null&&(S=he(S,a)),T1(S,l,u,c)}const h=P(t,"x","depthwiseConv2d","float32"),d=P(e,"filter","depthwiseConv2d","float32");let f=h,p=!1;h.rank===3&&(p=!0,f=H(h,[1,h.shape[0],h.shape[1],h.shape[2]])),O(f.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${f.rank}.`),O(d.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${d.rank}.`),O(f.shape[3]===d.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${f.shape[3]}) must match the inChannels dimension in filter ${d.shape[2]}.`),i==null&&(i=[1,1]),O(hs(n,i),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`),Ls("fused depthwiseConv2d",s,o);const m=Yn(f.shape,d.shape,n,i,s,o,!0);let v;a!=null&&(v=P(a,"bias","fused conv2d"),[v]=rn(v,h),Ge(m.outShape,v.shape));let g;u!=null&&(g=P(u,"prelu weights","fused depthwiseConv2d"));const w=(S,N)=>{O($l(i),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${i}'`);const[I,C,_,k]=N,A=I1(S,_,l),D=mV(C.shape,A,I,n,s,i,o),R=pV(C,A,I.shape,n,s,i,o);if(k!=null){const W=_1(v,A);return[D,R,W]}return[D,R]},b={x:f,filter:d,bias:v,preluActivationWeights:g},x={strides:n,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o,activation:l,leakyreluAlpha:c};return a==null?Io((N,I,C)=>{let _=V.runKernel(bm,b,x);return C([I,N,_]),p&&(_=H(_,[_.shape[1],_.shape[2],_.shape[3]])),{value:_,gradFunc:w}})(f,d):Io((N,I,C,_)=>{let k=V.runKernel(bm,b,x);return _([I,N,k,C]),p&&(k=H(k,[k.shape[1],k.shape[2],k.shape[3]])),{value:k,gradFunc:w}})(f,d,v)}const boe=U({fusedDepthwiseConv2d_:xoe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Soe({a:t,b:e,transposeA:n=!1,transposeB:s=!1,bias:r,activation:i="linear",preluActivationWeights:o,leakyreluAlpha:a=.2}){if(k1(V.state.gradientDepth,i)===!1){let A=Je(t,e,n,s);return r!=null&&(A=he(A,r)),T1(A,i,o,a)}let l=P(t,"a","fused matMul"),u=P(e,"b","fused matMul");[l,u]=rn(l,u);const c=n?l.shape[l.rank-2]:l.shape[l.rank-1],h=s?u.shape[u.rank-1]:u.shape[u.rank-2],d=n?l.shape[l.rank-1]:l.shape[l.rank-2],f=s?u.shape[u.rank-2]:u.shape[u.rank-1],p=l.shape.slice(0,-2),m=u.shape.slice(0,-2),v=re(p),g=re(m);O(c===h,()=>`Error in fused matMul: inner shapes (${c}) and (${h}) of Tensors with shapes ${l.shape} and ${u.shape} and transposeA=${n} and transposeB=${s} must match.`);const b=Ge(l.shape.slice(0,-2),u.shape.slice(0,-2)).concat([d,f]),x=n?H(l,[v,c,d]):H(l,[v,d,c]),S=s?H(u,[g,f,h]):H(u,[g,h,f]);let N;r!=null&&(N=P(r,"bias","fused matMul"),[N]=rn(N,l),Ge(b,N.shape));let I;o!=null&&(I=P(o,"prelu weights","fused matMul"));const C=(A,D)=>{const[R,W,B,M]=D,X=I1(H(A,B.shape),B,i);let z,Y;if(!n&&!s?(z=Je(X,W,!1,!0),Y=Je(R,X,!0,!1)):!n&&s?(z=Je(X,W,!1,!1),Y=Je(X,R,!0,!1)):n&&!s?(z=Je(W,X,!1,!0),Y=Je(R,X,!1,!1)):(z=Je(W,X,!0,!0),Y=Je(X,R,!0,!0)),r!=null){const L=_1(M,X);return[z,Y,L]}else return[z,Y]},_={a:x,b:S,bias:N,preluActivationWeights:I},k={transposeA:n,transposeB:s,activation:i,leakyreluAlpha:a};return r==null?Io((D,R,W)=>{const B=V.runKernel(wm,_,k);return W([D,R,B]),{value:H(B,b),gradFunc:C}})(x,S):Io((D,R,W,B)=>{const M=V.runKernel(wm,_,k);return B([D,R,M,W]),{value:H(M,b),gradFunc:C}})(x,S,N)}const c_=U({fusedMatMul_:Soe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gV=Object.freeze(Object.defineProperty({__proto__:null,conv2d:fV,depthwiseConv2d:boe,matMul:c_},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Coe(t){return C1(t,.54,.46)}const Ioe=U({hammingWindow_:Coe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _oe(t){return C1(t,.5,.5)}const yV=U({hannWindow_:_oe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Toe(t,e,n,s=!1,r=0){let i=0;const o=[];for(;i+e<=t.size;)o.push(lt(t,i,e)),i+=n;if(s)for(;i<t.size;){const a=i+e-t.size,l=wn([lt(t,i,e-a),Ic([a],r)]);o.push(l),i+=n}return o.length===0?yl([],[0,e]):H(wn(o),[o.length,e])}const vV=U({frame_:Toe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function koe(t,e,n,s,r=yV){s==null&&(s=gN(e));const i=vV(t,e,n),o=G(i,r(e));return Ty(o,s)}const Eoe=U({stft_:koe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Noe(t,e,n,s,r="bilinear",i=0){const o=P(t,"image","cropAndResize"),a=P(e,"boxes","cropAndResize","float32"),l=P(n,"boxInd","cropAndResize","int32"),u=a.shape[0];O(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),O(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${u},4] but had shape ${a.shape}.`),O(l.rank===1&&l.shape[0]===u,()=>`Error in cropAndResize: boxInd must be have size [${u}] but had shape ${a.shape}.`),O(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),O(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),O(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const c={image:o,boxes:a,boxInd:l},h={method:r,extrapolationValue:i,cropSize:s};return V.runKernel(Jx,c,h)}const $oe=U({cropAndResize_:Noe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Roe(t){const e=P(t,"image","flipLeftRight","float32");O(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const n={image:e};return V.runKernel(ub,n,{})}const Aoe=U({flipLeftRight_:Roe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Doe(t){const e=P(t,"image","grayscaleToRGB"),n=e.rank-1,s=e.shape[n];O(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),O(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(e.rank);return r.fill(1,0,n),r[n]=3,Ar(e,r)}const Ooe=U({grayscaleToRGB_:Doe});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Poe(t){const e=P(t,"image","RGBToGrayscale"),n=e.rank-1,s=e.shape[n];O(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),O(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const r=e.dtype,i=ge(e,"float32"),o=os([.2989,.587,.114]);let a;switch(e.rank){case 2:a=gu("ij,j->i",i,o);break;case 3:a=gu("ijk,k->ij",i,o);break;case 4:a=gu("ijkl,l->ijk",i,o);break;case 5:a=gu("ijklm,m->ijkl",i,o);break;case 6:a=gu("ijklmn,n->ijklm",i,o);break;default:throw new Error("Not a valid tensor rank.")}return a=ss(a,-1),ge(a,r)}const Foe=U({rgbToGrayscale_:Poe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Loe(t,e,n=0,s=.5){const r=P(t,"image","rotateWithOffset","float32");O(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const i={image:r},o={radians:e,fillValue:n,center:s};return V.runKernel(Gb,i,o)}const Moe=U({rotateWithOffset_:Loe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gf(t,e,n,s,r,i){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),i==null&&(i=0);const o=t.shape[0];return n=Math.min(n,o),O(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),O(t.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`),O(t.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`),O(e.rank===1,()=>"scores must be a 1D tensor"),O(e.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${e.shape[0]}`),O(0<=i&&i<=1,()=>`softNmsSigma must be in [0, 1], but was '${i}'`),{maxOutputSize:n,iouThreshold:s,scoreThreshold:r,softNmsSigma:i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zoe(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY){const i=P(t,"boxes","nonMaxSuppression","float32"),o=P(e,"scores","nonMaxSuppression","float32"),a=gf(i,o,n,s,r);n=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l={maxOutputSize:n,iouThreshold:s,scoreThreshold:r};return V.runKernel(wb,{boxes:i,scores:o},l)}const Boe=U({nonMaxSuppression_:zoe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Voe(t,e,n){const s=Uoe(t,e,n),r=s<0?-(s+1):s;t.splice(r,0,e)}function Uoe(t,e,n){return joe(t,e,n||Woe)}function Woe(t,e){return t>e?1:t<e?-1:0}function joe(t,e,n){let s=0,r=t.length,i=0,o=!1;for(;s<r;){i=s+(r-s>>>1);const a=n(e,t[i]);a>0?s=i+1:(r=i,o=!a)}return o?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E1(t,e,n,s,r){return vN(t,e,n,s,r,0)}function N1(t,e,n,s,r,i){return vN(t,e,n,s,r,0,!1,i,!0)}function $1(t,e,n,s,r,i){return vN(t,e,n,s,r,i,!0)}function vN(t,e,n,s,r,i,o=!1,a=!1,l=!1){const u=[];for(let v=0;v<e.length;v++)e[v]>r&&u.push({score:e[v],boxIndex:v,suppressBeginIndex:0});u.sort(lP);const c=i>0?-.5/i:0,h=[],d=[];for(;h.length<n&&u.length>0;){const v=u.pop(),{score:g,boxIndex:w,suppressBeginIndex:b}=v;if(g<r)break;let x=!1;for(let S=h.length-1;S>=b;--S){const N=Goe(t,w,h[S]);if(N>=s){x=!0;break}if(v.score=v.score*Hoe(s,c,N),v.score<=r)break}v.suppressBeginIndex=h.length,x||(v.score===g?(h.push(w),d.push(v.score)):v.score>r&&Voe(u,v,lP))}const f=h.length,p=n-f;a&&p>0&&(h.push(...new Array(p).fill(0)),d.push(...new Array(p).fill(0)));const m={selectedIndices:h};return o&&(m.selectedScores=d),l&&(m.validOutputs=f),m}function Goe(t,e,n){const s=t.subarray(e*4,e*4+4),r=t.subarray(n*4,n*4+4),i=Math.min(s[0],s[2]),o=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),l=Math.max(s[1],s[3]),u=Math.min(r[0],r[2]),c=Math.min(r[1],r[3]),h=Math.max(r[0],r[2]),d=Math.max(r[1],r[3]),f=(a-i)*(l-o),p=(h-u)*(d-c);if(f<=0||p<=0)return 0;const m=Math.max(i,u),v=Math.max(o,c),g=Math.min(a,h),w=Math.min(l,d),b=Math.max(g-m,0)*Math.max(w-v,0);return b/(f+p-b)}function Hoe(t,e,n){const s=Math.exp(e*n*n);return n<=t?s:0}function lP(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function qoe(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY){const i=P(t,"boxes","nonMaxSuppressionAsync"),o=P(e,"scores","nonMaxSuppressionAsync"),a=gf(i,o,n,s,r);n=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l=await Promise.all([i.data(),o.data()]),u=l[0],c=l[1],{selectedIndices:h}=E1(u,c,n,s,r);return i!==t&&i.dispose(),o!==e&&o.dispose(),os(h,"int32")}const Koe=qoe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xoe(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=P(t,"boxes","nonMaxSuppression"),a=P(e,"scores","nonMaxSuppression"),l=gf(o,a,n,s,r,i);n=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const u={boxes:o,scores:a},c={maxOutputSize:n,iouThreshold:s,scoreThreshold:r,softNmsSigma:i},h=V.runKernel(bb,u,c);return{selectedIndices:h[0],selectedScores:h[1]}}const Yoe=U({nonMaxSuppressionWithScore_:Xoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Qoe(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=P(t,"boxes","nonMaxSuppressionAsync"),a=P(e,"scores","nonMaxSuppressionAsync"),l=gf(o,a,n,s,r,i);n=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const u=await Promise.all([o.data(),a.data()]),c=u[0],h=u[1],{selectedIndices:d,selectedScores:f}=$1(c,h,n,s,r,i);return o!==t&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:os(d,"int32"),selectedScores:os(f)}}const Joe=Qoe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zoe(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=P(t,"boxes","nonMaxSuppression"),a=P(e,"scores","nonMaxSuppression"),l=gf(o,a,n,s,r,null),u=l.maxOutputSize,c=l.iouThreshold,h=l.scoreThreshold,d={boxes:o,scores:a},f={maxOutputSize:u,iouThreshold:c,scoreThreshold:h,padToMaxOutputSize:i},p=V.runKernel(xb,d,f);return{selectedIndices:p[0],validOutputs:p[1]}}const eae=U({nonMaxSuppressionPadded_:Zoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function tae(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=P(t,"boxes","nonMaxSuppressionAsync"),a=P(e,"scores","nonMaxSuppressionAsync"),l=gf(o,a,n,s,r,null),u=l.maxOutputSize,c=l.iouThreshold,h=l.scoreThreshold,[d,f]=await Promise.all([o.data(),a.data()]),{selectedIndices:p,validOutputs:m}=N1(d,f,u,c,h,i);return o!==t&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:os(p,"int32"),validOutputs:Le(m,"int32")}}const nae=tae;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sae(t,e,n=!1,s=!1){const r=P(t,"images","resizeBilinear");O(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),O(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),O(s===!1||n===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=H(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:i},l={alignCorners:n,halfPixelCenters:s,size:e},u=V.runKernel(Xg,a,l);return o?H(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const wV=U({resizeBilinear_:sae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rae(t,e,n=!1,s=!1){const r=P(t,"images","resizeNearestNeighbor");O(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),O(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),O(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),O(s===!1||n===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=H(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:i},l={alignCorners:n,halfPixelCenters:s,size:e},u=V.runKernel(Kg,a,l);return o?H(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const xV=U({resizeNearestNeighbor_:rae});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iae(t,e="binary",n=!1,s=.5){const r=P(t,"image","threshold"),i=.2989,o=.587,a=.114,l=r.shape[0]*r.shape[1];let u=G(os([s]),255),c,h,d,f;if(O(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),O(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),O(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),O(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),r.shape[2]===3){[c,h,d]=qs(r,[1,1,1],-1);const v=G(c,i),g=G(h,o),w=G(d,a);f=he(he(v,g),w)}else f=t;if(e==="otsu"){const v=SE(ge(c1(f),"int32"),gr([]),256);u=oae(v,l)}const p=n?Xl(f,u):Ms(f,u);return ge(G(p,255),"int32")}function oae(t,e){let n=os([-1]),s=os([0]),r=os([0]),i,o,a,l,u,c;for(let h=0;h<t.size-1;h++){i=lt(t,0,h+1),o=lt(t,h+1),u=Re(Te(i),e),c=Re(Te(o),e);const d=Te(G(i,tc(0,i.size)));a=Re(d,Te(i));const f=Ic(o.shape,i.size),p=he(tc(0,o.size),f),m=G(o,p);l=Re(Te(m),Te(o));const v=_e(a,l),g=_e(a,l),w=G(u,c);r=G(G(w,v),g);const b=Ms(r,s);s=Hn(b,r,s),n=Hn(b,os([h]),n)}return n}const aae=U({threshold_:iae});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lae(t,e,n="nearest",s="constant",r=0,i){const o=P(t,"image","transform","float32"),a=P(e,"transforms","transform","float32");O(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),O(a.rank===2&&(a.shape[0]===o.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),O(i==null||i.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${i}.`);const l={image:o,transforms:a},u={interpolation:n,fillMode:s,fillValue:r,outputShape:i};return V.runKernel(Wb,l,u)}const uae=U({transform_:lae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cae(t,e,n){const s=P(t,"a","bandPart");O(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[i,o]=s.shape.slice(-2);let a,l;typeof e=="number"?(O(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),O(e<=i,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${i}).`),a=P(e<0?i:e,"numLower","bandPart")):(O(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=Hn(Gh(e,0),i,Al(e,i))),typeof n=="number"?(O(n%1===0,()=>`bandPart(): numUpper must be an integer, got ${n}.`),O(n<=o,()=>`bandPart(): numUpper (${n}) must not be greater than the number of columns (${o}).`),l=P(n<0?o:n,"numUpper","bandPart")):(O(n.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=Hn(Gh(n,0),o,Al(n,o)));const u=H(tc(0,i,1,"int32"),[-1,1]),c=tc(0,o,1,"int32"),h=_e(u,c),d=ci(Xl(h,a),Ca(h,Bt(l))),f=En([i,o],s.dtype);return H(Ps(Br(H(s,[-1,i,o])).map(p=>Hn(d,p,f))),r)}const hae=U({bandPart_:cae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dae(t){let e;if(Array.isArray(t)){e=!1,O(t!=null&&t.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=t[0].shape[0];for(let i=1;i<t.length;++i)O(t[i].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[i].shape[0]} vs. ${r})`)}else e=!0,t=qs(t,t.shape[0],0).map(r=>Ql(r,[0]));O(t.length<=t[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`);const n=[],s=t;for(let r=0;r<t.length;++r)n.push(V.tidy(()=>{let i=s[r];if(r>0)for(let o=0;o<r;++o){const a=G(Te(G(n[o],i)),n[o]);i=_e(i,a)}return Re(i,ff(i,"euclidean"))}));return e?Ps(n,0):n}const fae=U({gramSchmidt_:dae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pae(t,e=!1){if(O(t.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`),t.rank===2)return uP(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce((l,u)=>l*u),s=Br(H(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),r=[],i=[];s.forEach(l=>{const[u,c]=uP(l,e);r.push(u),i.push(c)});const o=H(Ps(r,0),t.shape),a=H(Ps(i,0),t.shape);return[o,a]}}function uP(t,e=!1){return V.tidy(()=>{O(t.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`);const n=t.shape[0],s=t.shape[1];let r=n1(n),i=yo(t);const o=yl([[1]],[1,1]);let a=yo(o);const l=n>=s?s:n;for(let u=0;u<l;++u){const c=i,h=a,d=r;[a,i,r]=V.tidy(()=>{const f=lt(i,[u,u],[n-u,1]),p=ff(f),m=lt(i,[u,u],[1,1]),v=Hn(Ms(m,0),yl([[-1]]),yl([[1]])),g=_e(m,G(v,p)),w=Re(f,g);w.shape[0]===1?a=yo(o):a=wn([o,lt(w,[1,0],[w.shape[0]-1,w.shape[1]])],0);const b=Bt(Re(Je(v,g),p)),x=lt(i,[u,0],[n-u,s]),S=G(b,a),N=ot(a);if(u===0)i=_e(x,Je(S,Je(N,x)));else{const _=_e(x,Je(S,Je(N,x)));i=wn([lt(i,[0,0],[u,s]),_],0)}const I=ot(S),C=lt(r,[0,u],[n,r.shape[1]-u]);if(u===0)r=_e(C,Je(Je(C,a),I));else{const _=_e(C,Je(Je(C,a),I));r=wn([lt(r,[0,0],[n,u]),_],1)}return[a,i,r]}),je([c,h,d])}return!e&&n>s&&(r=lt(r,[0,0],[n,s]),i=lt(i,[0,0],[s,s])),[r,i]})}const mae=U({qr_:pae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var As;(function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(As||(As={}));function gae(t,e,n=As.SUM_BY_NONZERO_WEIGHTS){const s=P(t,"losses","computeWeightedLoss");let r=null;e!=null&&(r=P(e,"weights","computeWeightedLoss"));const i=r==null?s:G(s,r);if(n===As.NONE)return i;if(n===As.SUM)return Te(i);if(n===As.MEAN){if(r==null)return nn(i);{const o=s.size/r.size,a=Re(Te(i),Te(r));return o>1?Re(a,Le(o)):a}}if(n===As.SUM_BY_NONZERO_WEIGHTS){if(r==null)return Re(Te(i),Le(s.size));{const o=G(r,js(s.shape)),a=ge(Te(ec(o,Le(0))),"float32");return Re(Te(i),a)}}throw Error(`Unknown reduction: ${n}`)}const _a=U({computeWeightedLoss_:gae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yae(t,e,n,s=As.SUM_BY_NONZERO_WEIGHTS){const r=P(t,"labels","absoluteDifference"),i=P(e,"predictions","absoluteDifference");let o=null;n!=null&&(o=P(n,"weights","absoluteDifference")),cs(r.shape,i.shape,"Error in absoluteDifference: ");const a=Tn(_e(r,i));return _a(a,o,s)}const vae=U({absoluteDifference_:yae});function wae(t,e,n,s,r=As.SUM_BY_NONZERO_WEIGHTS){const i=P(t,"labels","cosineDistance"),o=P(e,"predictions","cosineDistance");let a=null;s!=null&&(a=P(s,"weights","cosineDistance")),cs(i.shape,o.shape,"Error in cosineDistance: ");const l=Le(1),u=_e(l,Te(G(i,o),n,!0));return _a(u,a,r)}const xae=U({cosineDistance_:wae});function bae(t,e,n,s=As.SUM_BY_NONZERO_WEIGHTS){let r=P(t,"labels","hingeLoss");const i=P(e,"predictions","hingeLoss");let o=null;n!=null&&(o=P(n,"weights","hingeLoss")),cs(r.shape,i.shape,"Error in hingeLoss: ");const a=Le(1);r=_e(G(Le(2),r),a);const l=Xi(_e(a,G(r,i)));return _a(l,o,s)}const Sae=U({hingeLoss_:bae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cae(t,e,n,s=1,r=As.SUM_BY_NONZERO_WEIGHTS){const i=P(t,"labels","huberLoss"),o=P(e,"predictions","huberLoss");let a=null;n!=null&&(a=P(n,"weights","huberLoss")),cs(i.shape,o.shape,"Error in huberLoss: ");const l=Le(s),u=Tn(_e(o,i)),c=Al(u,l),h=_e(u,c),d=he(G(Le(.5),$t(c)),G(l,h));return _a(d,a,r)}const Iae=U({huberLoss_:Cae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ae(t,e,n,s=1e-7,r=As.SUM_BY_NONZERO_WEIGHTS){const i=P(t,"labels","logLoss"),o=P(e,"predictions","logLoss");let a=null;n!=null&&(a=P(n,"weights","logLoss")),cs(i.shape,o.shape,"Error in logLoss: ");const l=Le(1),u=Le(s),c=Bt(G(i,vr(he(o,u)))),h=G(_e(l,i),vr(he(_e(l,o),u))),d=_e(c,h);return _a(d,a,r)}const Tae=U({logLoss_:_ae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kae(t,e,n,s=As.SUM_BY_NONZERO_WEIGHTS){const r=P(t,"labels","meanSquaredError"),i=P(e,"predictions","meanSquaredError");let o=null;n!=null&&(o=P(n,"weights","meanSquaredError")),cs(r.shape,i.shape,"Error in meanSquaredError: ");const a=v1(r,i);return _a(a,o,s)}const Eae=U({meanSquaredError_:kae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nae(t,e){const n=P(t,"labels","sigmoidCrossEntropyWithLogits"),s=P(e,"logits","sigmoidCrossEntropyWithLogits");cs(n.shape,s.shape,"Error in sigmoidCrossEntropyWithLogits: ");const r=Xi(s),i=G(s,n),o=my(Js(Bt(Tn(s))));return he(_e(r,i),o)}function $ae(t,e,n,s=0,r=As.SUM_BY_NONZERO_WEIGHTS){let i=P(t,"multiClassLabels","sigmoidCrossEntropy");const o=P(e,"logits","sigmoidCrossEntropy");let a=null;if(n!=null&&(a=P(n,"weights","sigmoidCrossEntropy")),cs(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),s>0){const u=Le(s),c=Le(1),h=Le(.5);i=he(G(i,_e(c,u)),G(h,u))}const l=Nae(i,o);return _a(l,a,r)}const Rae=U({sigmoidCrossEntropy_:$ae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aae(t,e,n=-1){if(n===-1&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${n}`);return Io((r,i,o)=>{const l=gy(i,[n],!0),u=_e(ge(i,"float32"),l);o([r,u]);const c=Bt(G(u,r));return{value:Te(c,[n]),gradFunc:(f,p)=>{const[m,v]=p,g=xn(f.shape,[n]);return[G(H(f,g),_e(ge(m,"float32"),Js(v))),G(H(f,g),_e(Js(v),ge(m,"float32")))]}}})(t,e)}function Dae(t,e,n,s=0,r=As.SUM_BY_NONZERO_WEIGHTS){let i=P(t,"onehotLabels","softmaxCrossEntropy");const o=P(e,"logits","softmaxCrossEntropy");let a=null;if(n!=null&&(a=P(n,"weights","softmaxCrossEntropy")),cs(i.shape,o.shape,"Error in softmaxCrossEntropy: "),s>0){const u=Le(s),c=Le(1),h=Le(i.shape[1]);i=he(G(i,_e(c,u)),Re(u,h))}const l=Aae(i,o);return _a(l,a,r)}const Oae=U({softmaxCrossEntropy_:Dae});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pae(t,e,n,s){const r=P(t,"indices","sparseFillEmptyRows","int32"),i=P(e,"values","sparseFillEmptyRows"),o=P(n,"denseShape","sparseFillEmptyRows","int32"),a=P(s,"defaultValue","sparseFillEmptyRows",i.dtype);if(r.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        ${r.shape}`);if(i.rank!==1)throw new Error(`Values should be Tensor1D but received shape ${i.shape}`);if(o.rank!==1)throw new Error(`Dense shape should be Tensor1D but received shape ${o.shape}`);if(a.rank!==0)throw new Error(`Default value should be a scalar but received shape ${a.shape}`);const l={indices:r,values:i,denseShape:o,defaultValue:a},u=V.runKernel(Ab,l);return{outputIndices:u[0],outputValues:u[1],emptyRowIndicator:u[2],reverseIndexMap:u[3]}}const Fae=U({sparseFillEmptyRows_:Pae});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lae(t,e,n){const s=P(t,"inputIndices","sparseReshape","int32"),r=P(e,"inputShape","sparseReshape","int32"),i=P(n,"newShape","sparseReshape","int32");if(s.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        ${s.shape}`);if(r.rank!==1)throw new Error(`Input shape should be Tensor1D but received shape ${r.shape}`);if(i.rank!==1)throw new Error(`New shape should be Tensor1D but received shape ${i.shape}`);const o={inputIndices:s,inputShape:r,newShape:i},a=V.runKernel(Db,o);return{outputIndices:a[0],outputShape:a[1]}}const Mae=U({sparseReshape_:Lae});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zae(t,e,n){const s=P(t,"data","sparseSegmentMean"),r=P(e,"indices","sparseSegmentMean","int32"),i=P(n,"segmentIds","sparseSegmentMean","int32");if(s.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          ${r.shape}`);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          ${i.shape}`);const o={data:s,indices:r,segmentIds:i};return V.runKernel(Ob,o)}const Bae=U({sparseSegmentMean_:zae});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vae(t,e,n){const s=P(t,"data","sparseSegmentSum"),r=P(e,"indices","sparseSegmentSum","int32"),i=P(n,"segmentIds","sparseSegmentSum","int32");if(s.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         ${r.shape}`);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         ${i.shape}`);const o={data:s,indices:r,segmentIds:i};return V.runKernel(Pb,o)}const Uae=U({sparseSegmentSum_:Vae});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wae(t,e,n,s,r,i,o,a){const l=P(t,"data","stringNGrams","string");if(l.dtype!=="string")throw new Error("Data must be of datatype string");if(l.shape.length!==1)throw new Error(`Data must be a vector, saw: ${l.shape}`);const u=P(e,"dataSplits","stringNGrams");if(u.dtype!=="int32")throw new Error("Data splits must be of datatype int32");const c={separator:n,nGramWidths:s,leftPad:r,rightPad:i,padWidth:o,preserveShortSequences:a},h={data:l,dataSplits:u},d=V.runKernel(zb,h,c);return{nGrams:d[0],nGramsSplits:d[1]}}const jae=U({stringNGrams_:Wae});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gae(t,e,n=!0){const s=P(t,"input","stringSplit","string"),r=P(e,"delimiter","stringSplit","string");if(s.rank!==1)throw new Error(`Input should be Tensor1D but received shape ${s.shape}`);if(r.rank!==0)throw new Error(`Delimiter should be a scalar but received shape ${r.shape}`);const i={skipEmpty:n},o={input:s,delimiter:r},a=V.runKernel(Bb,o,i);return{indices:a[0],values:a[1],shape:a[2]}}const Hae=U({stringSplit_:Gae});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qae(t,e){const n=P(t,"input","stringToHashBucketFast","string"),s={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");const r={input:n};return V.runKernel(Vb,r,s)}const Kae=U({stringToHashBucketFast_:qae});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xae(t,e,n,s=!0){const r=P(t,"input","staticRegexReplace","string"),i={pattern:e,rewrite:n,replaceGlobal:s};return V.runKernel(sy,{x:r},i)}const Yae=U({staticRegexReplace_:Xae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bV={fft:_y,ifft:Xh,rfft:Ty,irfft:y1},SV={hammingWindow:Ioe,hannWindow:yV,frame:vV,stft:Eoe},ri={flipLeftRight:Aoe,grayscaleToRGB:Ooe,resizeNearestNeighbor:xV,resizeBilinear:wV,rgbToGrayscale:Foe,rotateWithOffset:Moe,cropAndResize:$oe,nonMaxSuppression:Boe,nonMaxSuppressionAsync:Koe,nonMaxSuppressionWithScore:Yoe,nonMaxSuppressionWithScoreAsync:Joe,nonMaxSuppressionPadded:eae,nonMaxSuppressionPaddedAsync:nae,threshold:aae,transform:uae},wN={bandPart:hae,gramSchmidt:fae,qr:mae},CV={absoluteDifference:vae,computeWeightedLoss:_a,cosineDistance:xae,hingeLoss:Sae,huberLoss:Iae,logLoss:Tae,meanSquaredError:Eae,sigmoidCrossEntropy:Rae,softmaxCrossEntropy:Oae},IV={sparseFillEmptyRows:Fae,sparseReshape:Mae,sparseSegmentMean:Bae,sparseSegmentSum:Uae},_V={stringNGrams:jae,stringSplit:Hae,stringToHashBucketFast:Kae,staticRegexReplace:Yae};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qae=new Map,h_=new Map;class Ec{getClassName(){return this.constructor.className}static fromConfig(e,n){return new e(n)}}class $r{constructor(){this.classNameMap={}}static getMap(){return $r.instance==null&&($r.instance=new $r),$r.instance}static register(e){$r.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function pe(t,e,n){O(t.className!=null,()=>"Class being registered does not have the static className property defined."),O(typeof t.className=="string",()=>"className is required to be a string, but got type "+typeof t.className),O(t.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof n>"u"&&(n=t.className);const s=n,r=e+">"+s;return $r.register(t),Qae.set(r,t),h_.set(t,r),t}function Jae(t){return h_.has(t)?h_.get(t):t.className}const Zae=Object.freeze(Object.defineProperty({__proto__:null,Serializable:Ec,SerializationMap:$r,getRegisteredName:Jae,registerClass:pe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ta extends Ec{minimize(e,n=!1,s){const{value:r,grads:i}=this.computeGradients(e,s);if(s!=null){const o=s.map(a=>({name:a.name,tensor:i[a.name]}));this.applyGradients(o)}else this.applyGradients(i);return je(i),n?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,n){return $B(e,n)}dispose(){this.iterations_!=null&&je(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Le(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(Ta,Symbol.hasInstance,{value:t=>t.minimize!=null&&t.computeGradients!=null&&t.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xN extends Ta{static get className(){return"Adadelta"}constructor(e,n,s=null){super(),this.learningRate=e,this.rho=n,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=V.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=V.registeredVariables[s],o=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:J(()=>ct(i).variable(o))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:J(()=>ct(i).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedGrads[r].variable,u=this.accumulatedUpdates[r].variable;J(()=>{const c=he(G(l,this.rho),G($t(a),1-this.rho)),h=G(Re(Kn(he(u,this.epsilon)),Kn(he(l,this.epsilon))),a),d=he(G(u,this.rho),G($t(h),1-this.rho));l.assign(c),u.assign(d);const f=he(G(h,-this.learningRate),i);i.assign(f)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(je(this.accumulatedGrads.map(e=>e.variable)),je(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.rho,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bN extends Ta{static get className(){return"Adagrad"}constructor(e,n=.1){super(),this.learningRate=e,this.initialAccumulatorValue=n,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=V.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:J(()=>Ic(i.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(e)?e[r].tensor:e[s];if(o==null)return;const a=this.accumulatedGrads[r].variable;J(()=>{const l=he(a,$t(o));a.assign(l);const u=he(G(Re(o,Kn(he(l,V.backend.epsilon()))),-this.learningRate),i);i.assign(u)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&je(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,n){return new e(n.learningRate,n.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SN extends Ta{static get className(){return"Adam"}constructor(e,n,s,r=null){super(),this.learningRate=e,this.beta1=n,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],J(()=>{this.accBeta1=Le(n).variable(),this.accBeta2=Le(s).variable()}),r==null&&(this.epsilon=V.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);J(()=>{const s=_e(1,this.accBeta1),r=_e(1,this.accBeta2);n.forEach((i,o)=>{const a=V.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:J(()=>ct(a).variable(l))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${i}/v`,variable:J(()=>ct(a).variable(l))});const u=Array.isArray(e)?e[o].tensor:e[i];if(u==null)return;const c=this.accumulatedFirstMoment[o].variable,h=this.accumulatedSecondMoment[o].variable,d=he(G(c,this.beta1),G(u,1-this.beta1)),f=he(G(h,this.beta2),G($t(u),1-this.beta2)),p=Re(d,s),m=Re(f,r);c.assign(d),h.assign(f);const v=he(G(Re(p,he(Kn(m),this.epsilon)),-this.learningRate),a);a.assign(v)}),this.accBeta1.assign(G(this.accBeta1,this.beta1)),this.accBeta2.assign(G(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&je(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&je(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e),J(()=>{this.accBeta1.assign(Co(this.beta1,this.iterations_+1)),this.accBeta2.assign(Co(this.beta2,this.iterations_+1))});const n=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CN extends Ta{static get className(){return"Adamax"}constructor(e,n,s,r=null,i=0){super(),this.learningRate=e,this.beta1=n,this.beta2=s,this.epsilon=r,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],J(()=>{this.iteration=Le(0).variable(),this.accBeta1=Le(n).variable()}),r==null&&(this.epsilon=V.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);J(()=>{const s=_e(1,this.accBeta1),r=Re(-this.learningRate,he(G(this.iteration,this.decay),1));n.forEach((i,o)=>{const a=V.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:ct(a).variable(l)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${i}/v`,variable:ct(a).variable(l)});const u=Array.isArray(e)?e[o].tensor:e[i];if(u==null)return;const c=this.accumulatedFirstMoment[o].variable,h=this.accumulatedWeightedInfNorm[o].variable,d=he(G(c,this.beta1),G(u,1-this.beta1)),f=G(h,this.beta2),p=Tn(u),m=Eo(f,p);c.assign(d),h.assign(m);const v=he(G(Re(r,s),Re(d,he(m,this.epsilon))),a);a.assign(v)}),this.iteration.assign(he(this.iteration,1)),this.accBeta1.assign(G(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&je(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&je(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class R1 extends Ta{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=Array.isArray(e)?e[r].tensor:e[s];if(i==null)return;const o=V.registeredVariables[s];J(()=>{const a=he(G(this.c,i),o);o.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=On(Le(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,n){return new e(n.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class IN extends R1{static get className(){return"Momentum"}constructor(e,n,s=!1){super(e),this.learningRate=e,this.momentum=n,this.useNesterov=s,this.accumulations=[],this.m=Le(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=V.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:J(()=>ct(i).variable(!1))});const o=this.accumulations[r].variable,a=Array.isArray(e)?e[r].tensor:e[s];a!=null&&J(()=>{let l;const u=he(G(this.m,o),a);this.useNesterov?l=he(G(this.c,he(a,G(u,this.m))),i):l=he(G(this.c,u),i),o.assign(u),i.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&je(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,n){return new e(n.learningRate,n.momentum,n.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _N extends Ta{static get className(){return"RMSProp"}constructor(e,n=.9,s=0,r=null,i=!1){if(super(),this.learningRate=e,this.decay=n,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,r==null&&(this.epsilon=V.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=V.registeredVariables[s],o=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:J(()=>ct(i).variable(o))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:J(()=>ct(i).variable(o))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:J(()=>ct(i).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedMeanSquares[r].variable,u=this.accumulatedMoments[r].variable;J(()=>{const c=he(G(l,this.decay),G($t(a),1-this.decay));if(this.centered){const h=this.accumulatedMeanGrads[r].variable,d=he(G(h,this.decay),G(a,1-this.decay)),f=Re(G(a,this.learningRate),Kn(_e(c,he($t(d),this.epsilon)))),p=he(G(u,this.momentum),f);l.assign(c),h.assign(d),u.assign(p);const m=_e(i,p);i.assign(m)}else{const h=he(G(l,this.decay),G($t(a),1-this.decay)),d=he(G(u,this.momentum),Re(G(a,this.learningRate),Kn(he(h,this.epsilon))));l.assign(h),u.assign(d);const f=_e(i,d);i.assign(f)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&je(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&je(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&je(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(n*2,n*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,n){return new e(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ele=[xN,bN,SN,CN,IN,_N,R1];function tle(){for(const t of ele)pe(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nle="model",sle=".json",rle=".weights.bin";function cP(t){return new Promise(e=>setTimeout(e)).then(t)}class nc{constructor(e){if(!Z().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(nc.URL_SCHEME)&&(e=e.slice(nc.URL_SCHEME.length)),(e==null||e.length===0)&&(e=nle),this.modelJsonFileName=e+sle,this.weightDataFileName=e+rle}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");const n=Ki.join(e.weightData),s=window.URL.createObjectURL(new Blob([n],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i=cB(e,r),o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),a=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(a.download=this.modelJsonFileName,a.href=o,await cP(()=>a.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){const l=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;l.download=this.weightDataFileName,l.href=s,await cP(()=>l.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:ly(e)}}}}nc.URL_SCHEME="downloads://";class ile{constructor(e){if(e==null||e.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${e}`);this.jsonFile=e[0],this.weightsFiles=e.slice(1)}async load(){return new Promise((e,n)=>{const s=new FileReader;s.onload=r=>{const i=JSON.parse(r.target.result),o=i.modelTopology;if(o==null){n(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));return}if(i.weightsManifest==null){n(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));return}if(this.weightsFiles.length===0){e({modelTopology:o});return}const l=aE(i,u=>this.loadWeights(u));e(l)},s.onerror=r=>n(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),s.readAsText(this.jsonFile)})}loadWeights(e){const n=[],s=[];for(const o of e)n.push(...o.weights),s.push(...o.paths);const r=this.checkManifestAndWeightFiles(e),i=s.map(o=>this.loadWeightsFile(o,r[o]));return Promise.all(i).then(o=>[n,o])}loadWeightsFile(e,n){return new Promise((s,r)=>{const i=new FileReader;i.onload=o=>{const a=o.target.result;s(a)},i.onerror=o=>r(`Failed to weights data from file of path '${e}'.`),i.readAsArrayBuffer(n)})}checkManifestAndWeightFiles(e){const n=[],s=this.weightsFiles.map(i=>aP(i.name)),r={};for(const i of e)i.paths.forEach(o=>{const a=aP(o);if(n.indexOf(a)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${a}'`);if(n.push(a),s.indexOf(a)===-1)throw new Error(`Weight file with basename '${a}' is not provided.`);r[o]=this.weightsFiles[s.indexOf(a)]});if(n.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${n.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return r}}const ole=t=>Z().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(nc.URL_SCHEME)?ale(t.slice(nc.URL_SCHEME.length)):null;en.registerSaveRouter(ole);function ale(t="model"){return new nc(t)}function lle(t){return new ile(t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hP(t,e,n,s){o(t),n=n??0,s=s??1,a(n,s);let r=0;const i=l=>(l.then(u=>{const c=n+ ++r/t.length*(s-n);return e(c),u}),l);function o(l){O(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,u){O(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),O(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${u}`),O(u>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${u}`)}return Promise.all(t.map(i))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function TV(t,e){e==null&&(e={});const n=e.fetchFunc==null?Z().platform.fetch:e.fetchFunc,s=t.map(h=>n(h,e.requestInit,{isBinary:!0})),a=(e.onProgress==null?await Promise.all(s):await hP(s,e.onProgress,0,.5)).map(h=>h.arrayBuffer());return e.onProgress==null?await Promise.all(a):await hP(a,e.onProgress,.5,1)}function ule(t,e){var n;const s=e.fetchFunc==null?Z().platform.fetch:e.fetchFunc;let r=0,i;return(n=e.onProgress)===null||n===void 0||n.call(e,0),new ReadableStream({pull:async o=>{for(var a;r<t.length;){i||(i=(await s(t[r],e.requestInit,{isBinary:!0})).body.getReader());const{done:l,value:u}=await i.read();if(l){r++,i=void 0,(a=e.onProgress)===null||a===void 0||a.call(e,r/t.length);continue}o.enqueue(u);return}o.close()}})}async function kV(t,e="",n,s){return EV(o=>TV(o,{requestInit:s}))(t,e,n)}function EV(t){return async(e,n="",s)=>{const r=e.map(()=>!1),i={},o=s!=null?s.map(()=>!1):[],a=[];if(e.forEach((f,p)=>{let m=0;f.weights.forEach(v=>{const g="quantization"in v?v.quantization.dtype:v.dtype,w=Ku[g]*re(v.shape),b=()=>{r[p]=!0,i[p]==null&&(i[p]=[]),i[p].push({manifestEntry:v,groupOffset:m,sizeBytes:w})};s!=null?s.forEach((x,S)=>{x===v.name&&(b(),o[S]=!0)}):b(),a.push(v.name),m+=w})}),!o.every(f=>f)){const f=s.filter((p,m)=>!o[m]);throw new Error(`Could not find weights in manifest with names: ${f.join(", ")}. 
Manifest JSON has weights with names: ${a.join(", ")}.`)}const l=r.reduce((f,p,m)=>(p&&f.push(m),f),[]),u=[];l.forEach(f=>{e[f].paths.forEach(p=>{const m=n+(n.endsWith("/")?"":"/")+p;u.push(m)})});const c=await t(u),h={};let d=0;return l.forEach(f=>{const p=e[f].paths.length,m=new Ki(c.slice(d,d+p));i[f].forEach(g=>{const w=m.slice(g.groupOffset,g.groupOffset+g.sizeBytes),b=rE(w,[g.manifestEntry]);for(const x in b)h[x]=b[x]}),d+=p}),h}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cle="application/octet-stream",hle="application/json";class TN{constructor(e,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.weightUrlConverter=n.weightUrlConverter,n.fetchFunc!=null?(O(typeof n.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=n.fetchFunc):this.fetch=Z().platform.fetch,O(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&O(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{},this.loadOptions=n}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);n.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=cB(e,s);if(n.body.append("model.json",new Blob([JSON.stringify(r)],{type:hle}),"model.json"),e.weightData!=null){const o=Ki.join(e.weightData);n.body.append("model.weights.bin",new Blob([o],{type:cle}),"model.weights.bin")}const i=await this.fetch(this.path,n);if(i.ok)return{modelArtifactsInfo:ly(e),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let n;try{n=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}const s=n.modelTopology,r=n.weightsManifest;if(s==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return n}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return aE(e,n=>this.loadWeights(n))}async loadStream(){const e=await this.loadModelJSON(),n=await this.getWeightUrls(e.weightsManifest),s=Ew(e.weightsManifest),r=()=>ule(n,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:s,getWeightStream:r})}async getWeightUrls(e){const n=Array.isArray(this.path)?this.path[1]:this.path,[s,r]=dle(n),i=this.weightPathPrefix||s,o=[],a=[];for(const l of e)for(const u of l.paths)this.weightUrlConverter!=null?a.push(this.weightUrlConverter(u)):o.push(i+u+r);return this.weightUrlConverter&&o.push(...await Promise.all(a)),o}async loadWeights(e){const n=await this.getWeightUrls(e),s=Ew(e),r=await TV(n,this.loadOptions);return[s,r]}}TN.URL_SCHEME_REGEX=/^https?:\/\//;function dle(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),s=t.substring(0,e),r=n>e?t.substring(n):"";return[s+"/",r]}function d_(t){return t.match(TN.URL_SCHEME_REGEX)!=null}const NV=(t,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let n=!0;if(Array.isArray(t)?n=t.every(s=>d_(s)):n=d_(t),n)return kN(t,e)}return null};en.registerSaveRouter(NV);en.registerLoadRouter(NV);function kN(t,e){return new TN(t,e)}function $V(t,e){return kN(t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fC{constructor(e){this.modelArtifacts=e}load(){return this.modelArtifacts}}class RV{constructor(e){this.saveHandler=e}save(e){return this.saveHandler(e)}}class fle{constructor(e){e.load&&(this.load=()=>Promise.resolve(e.load())),e.save&&(this.save=n=>Promise.resolve(e.save(n)))}}function ple(t,e,n,s){const r=arguments;return new fle($w(...r))}function $w(t,e,n,s){return arguments.length===1?t.modelTopology!=null||t.weightSpecs!=null?new fC(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new fC({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new fC({modelTopology:t,weightSpecs:e,weightData:n,trainingConfig:s}))}function mle(t){return new RV(t)}function gle(t){return new RV(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EN=Object.freeze(Object.defineProperty({__proto__:null,CompositeArrayBuffer:Ki,browserFiles:lle,browserHTTPRequest:$V,concatenateArrayBuffers:uB,copyModel:Qte,decodeWeights:rE,decodeWeightsStream:lB,encodeWeights:r_,fromMemory:ple,fromMemorySync:$w,getLoadHandlers:dB,getModelArtifactsForJSON:aE,getModelArtifactsForJSONSync:oE,getModelArtifactsInfoForJSON:ly,getSaveHandlers:hB,getWeightSpecs:Ew,http:kN,isHTTPScheme:d_,listModels:Xte,loadWeights:kV,moveModel:Jte,registerLoadRouter:Lte,registerSaveRouter:Fte,removeModel:Yte,weightsLoaderFactory:EV,withSaveHandler:mle,withSaveHandlerSync:gle},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yle(t,e,n){const s=P(t,"labels","confusionMatrix"),r=P(e,"predictions","confusionMatrix");O(n==null||n>0&&Number.isInteger(n),()=>`If provided, numClasses must be a positive integer, but got ${n}`),O(s.rank===1,()=>`Expected the rank of labels to be 1, but got ${s.rank}`),O(r.rank===1,()=>`Expected the rank of predictions to be 1, but got ${r.rank}`),O(s.shape[0]===r.shape[0],()=>`Mismatch in the number of examples: ${s.shape[0]} vs. ${r.shape[0]}. Labels and predictions should have the same number of elements.`),O(n>0&&Number.isInteger(n),()=>`numClasses is required to be a positive integer, but got ${n}`);const i=Hh(ge(s,"int32"),n),o=Hh(ge(r,"int32"),n),a=ot(i),l=Je(a,o);return ge(l,"int32")}const vle=U({confusionMatrix_:yle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wle=Object.freeze(Object.defineProperty({__proto__:null,confusionMatrix:vle},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let ou,dP=!1;function AV(t,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(t==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,s=!1,r=!1,i=!1,o=!1,a=!1;if(t.data instanceof Uint8Array)n=!0;else if(typeof ImageData<"u"&&t instanceof ImageData)s=!0;else if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)r=!0;else if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)i=!0;else if(t.getContext!=null)o=!0;else if(typeof ImageBitmap<"u"&&t instanceof ImageBitmap)a=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${t.constructor.name}`);if(Cm(_w,V.backendName)!=null){const p={pixels:t},m={numChannels:e};return V.runKernel(_w,p,m)}const[u,c]=r?[t.videoWidth,t.videoHeight]:[t.width,t.height];let h;if(o)h=t.getContext("2d").getImageData(0,0,u,c).data;else if(s||n)h=t.data;else if(i||r||a){if(ou==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")ou=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else ou=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});ou.canvas.width=u,ou.canvas.height=c,ou.drawImage(t,0,0,u,c),h=ou.getImageData(0,0,u,c).data}let d;if(e===4)d=new Int32Array(h);else{const p=u*c;d=new Int32Array(p*e);for(let m=0;m<p;m++)for(let v=0;v<e;++v)d[m*e+v]=h[m*4+v]}return uN(d,[c,u,e],"int32")}function xle(t){return t!=null&&t.data instanceof Uint8Array}function ble(){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")}function Sle(t){return t!=null&&t.width!==0&&t.height!==0}function Cle(t){return ble()&&!(t instanceof ImageBitmap)&&Sle(t)&&!xle(t)}async function Ile(t,e=3){let n=null;if(Z().getBool("WRAP_TO_IMAGEBITMAP")&&Cle(t)){let s;try{s=await createImageBitmap(t,{premultiplyAlpha:"none"})}catch{s=null}s!=null&&s.width===t.width&&s.height===t.height?n=s:n=t}else n=t;return AV(n,e)}function DV(t){if(t.rank!==2&&t.rank!==3)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${t.rank}.`);const e=t.rank===2?1:t.shape[2];if(e>4||e===2)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${e}`);if(t.dtype!=="float32"&&t.dtype!=="int32")throw new Error(`Unsupported type for toPixels: ${t.dtype}. Please use float32 or int32 tensors.`)}function _le(t){const e=(t==null?void 0:t.alpha)||1;if(e>1||e<0)throw new Error(`Alpha value ${e} is suppoed to be in range [0 - 1].`)}async function Tle(t,e){let n=P(t,"img","toPixels");if(!(t instanceof pt)){const u=n;n=ge(u,"int32"),u.dispose()}DV(n);const[s,r]=n.shape.slice(0,2),i=n.rank===2?1:n.shape[2],o=await n.data(),a=n.dtype==="float32"?255:1,l=new Uint8ClampedArray(r*s*4);for(let u=0;u<s*r;++u){const c=[0,0,0,255];for(let d=0;d<i;d++){const f=o[u*i+d];if(n.dtype==="float32"){if(f<0||f>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${f}.`)}else if(n.dtype==="int32"&&(f<0||f>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${f}.`);i===1?(c[0]=f*a,c[1]=f*a,c[2]=f*a):c[d]=f*a}const h=u*4;l[h+0]=Math.round(c[0]),l[h+1]=Math.round(c[1]),l[h+2]=Math.round(c[2]),l[h+3]=Math.round(c[3])}if(e!=null){dP||Cm(rb,V.backendName)!=null&&(console.warn("tf.browser.toPixels is not efficient to draw tensor on canvas. Please try tf.browser.draw instead."),dP=!0),e.width=r,e.height=s;const u=e.getContext("2d"),c=new ImageData(l,r,s);u.putImageData(c,0,0)}return n!==t&&n.dispose(),l}function kle(t,e,n){let s=P(t,"img","draw");if(!(t instanceof pt)){const o=s;s=ge(o,"int32"),o.dispose()}DV(s),_le(n==null?void 0:n.imageOptions);const r={image:s},i={canvas:e,options:n};V.runKernel(rb,r,i)}const OV=U({fromPixels_:AV}),Ele=Object.freeze(Object.defineProperty({__proto__:null,draw:kle,fromPixels:OV,fromPixelsAsync:Ile,toPixels:Tle},Symbol.toStringTag,{value:"Module"}));function A1(t,e){const n=t.shape.length,s=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${n}`);if(re(t.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const r=e.shape,i=r[r.length-1];let o=1;for(let h=0;h<r.length-1;++h)o*=r[h];const a=t.shape,l=r.slice();l.pop();let u=1;for(let h=i;h<n;++h)u*=a[h],l.push(a[h]);const c=[...Me(t.shape).map(h=>h/u),1].slice(0,i);return[l,o,u,c]}const Nle=Object.freeze(Object.defineProperty({__proto__:null,prepareAndValidate:A1},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f_=-2,$le=-1;function NN(t,e,n){const s=t.shape.length;O(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),O(s===n.length,()=>`Error in slice${s}D: Length of size ${n} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)O(e[r]+n[r]<=t.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${e[r]+n[r]}) would overflow input.shape[${r}] (${t.shape[r]})`)}function Rle(t){const e=[];let n=0;for(;t>0;)t&1&&e.push(n),t/=2,n++;return e}function $N(t,e,n){const s=[];for(let r=0;r<t.length;r++)s[r]=Math.ceil((e[r]-t[r])/n[r]);return s}function PV(t,e,n,s){const r=[...t];for(let i=r.length;i<s.length;i++)r.push(1);for(let i=0;i<n;i++)i===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function FV(t,e,n){return n<=t?n:n-(e-1)}function LV(t,e){const n=[];for(let s=0;s<t;s++)n.push(e+s);return n}function Ale(t,e,n,s,r,i,o,a,l){const u=t.length;let c=new Array(u),h=new Array(u),d=new Array(u);if(e.length&&n>0){const f=e[0],p=n+1;c=MV(o,f,p,s,t),h=zV(a,f,p,r,t),d=PV(i,f,p,t)}else for(let f=0;f<u;f++)c[f]=VV(o,s,i,t,f,l),h[f]=UV(a,r,i,t,f,l),d[f]=BV(i,f,l);return{begin:c,end:h,strides:d}}function MV(t,e,n,s,r){const i=[...r],o=LV(n,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=0;else{const l=FV(e,n,a);let u=s[l];t&1<<l&&(u=0),i[a]=u}return i}function zV(t,e,n,s,r){const i=[...r],o=LV(n,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=Number.MAX_SAFE_INTEGER;else{const l=FV(e,n,a);let u=s[l];t&1<<l&&(u=Number.MAX_SAFE_INTEGER),i[a]=u}for(let a=0;a<i.length;a++){const l=r[a];i[a]<0&&(i[a]+=l),i[a]=kl(0,i[a],r[a])}return i}function BV(t,e,n){let s=t[e];return(n&1<<e||s==null)&&(s=1),s}function VV(t,e,n,s,r,i){let o=e[r];const a=n[r]||1;(t&1<<r||i&1<<r||o==null)&&(a>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const l=s[r];return o<0&&(o+=l),o=kl(0,o,l-1),o}function UV(t,e,n,s,r,i){let o=e[r];const a=n[r]||1;(t&1<<r||i&1<<r||o==null)&&(a>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const l=s[r];return o<0&&(o+=l),a>0?o=kl(0,o,l):o=kl(-1,o,l-1),o}function RN(t,e,n){let s=n.length;for(let r=0;r<n.length;r++)if(n[r]>1){s=r;break}for(let r=s+1;r<n.length;r++)if(e[r]>0||n[r]!==t[r])return!1;return!0}function AN(t,e){let n=t.length>0?t[t.length-1]:1;for(let s=0;s<t.length-1;s++)n+=t[s]*e[s];return n}function D1(t,e,n){let s;const r=t.shape.length;typeof e=="number"?s=[e,...new Array(r-1).fill(0)]:e.length<r?s=e.concat(new Array(r-e.length).fill(0)):s=e.slice(),s.forEach(o=>{O(o!==-1,()=>"slice() does not support negative begin indexing.")});let i;return n==null?i=new Array(r).fill(-1):typeof n=="number"?i=[n,...new Array(r-1).fill(-1)]:n.length<r?i=n.concat(new Array(r-n.length).fill(-1)):i=n,i=i.map((o,a)=>o>=0?o:(O(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${a}.`),t.shape[a]-s[a])),[s,i]}function DN(t,e,n,s,r,i,o,a,l){let u;if(s==null?(u=new Array(e.length),u.fill(1)):u=s,o!=null&&o&o-1)throw new Error("Multiple ellipses in slice is not allowed.");let c=!1;const h={dims:u.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:n.slice(),strides:u.slice(),beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};for(let b=0;b<h.dims;b++)c&&1<<b&a&&h.numAddAxisAfterEllipsis++,1<<b&o&&(c=!0);c||(h.ellipsisMask|=1<<h.dims,h.dims++);const d={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};Dle(h,d);let f=!0,p=!0,m=!0;const v=[],g=[];for(let b=0;b<t.length;++b){if(d.strides[b]===0)throw Error(`strides[${b}] must be non-zero`);const x=!!(d.shrinkAxisMask&1<<b),S=t[b];if(S===-1){v.push(x?1:-1);continue}const N=[d.beginMask&1<<b,d.endMask&1<<b],I=[d.strides[b]>0?0:-1,d.strides[b]>0?S:S-1];if(x&&d.strides[b]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&d.strides[b]===1;const C=!!(d.beginMask&1<<b&&d.endMask&1<<b);if(d.beginValid&&d.endValid){if(x){const D=d.begin[b]<0?S+d.begin[b]:d.begin[b];if(d.begin[b]=D,d.end[b]=d.begin[b]+1,D<0||D>=S)throw Error(`slice index ${d.begin[b]} of dimension ${b} out of bounds.`)}else d.begin[b]=fP(d.begin[b],0,d.strides[b],S,N,I),d.end[b]=fP(d.end[b],1,d.strides[b],S,N,I);const A=d.strides[b]===1&&d.begin[b]===0&&d.end[b]===S;f=f&&A,p=p&&(b===0&&d.strides[b]===1||A)}else f=f&&d.strides[b]===1&&C,p=p&&(b===0&&d.strides[b]===1||C);let _,k=!1;if(d.beginValid&&d.endValid?(_=d.end[b]-d.begin[b],k=!0):x?(_=1,k=!0):C&&S>=0&&(d.strides[b]<0?_=-S:_=S,k=!0),k){let A;_===0||_<0!=d.strides[b]<0?A=0:A=Math.trunc(_/d.strides[b])+(_%d.strides[b]!==0?1:0),v.push(A)}else v.push(-1)}for(let b=0;b<d.finalShapeGatherIndices.length;++b){const x=d.finalShapeGatherIndices[b];x>=0?g.push(v[x]):x===f_&&g.push(1)}return{finalShapeSparse:g.filter((b,x)=>d.finalShapeGatherIndices[x]!==f_),finalShape:g,isIdentity:f,sliceDim0:p,isSimpleSlice:m,begin:d.begin,end:d.end,strides:d.strides}}function Dle(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let n=0;e.beginValid=t.begin!=null,e.endValid=t.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<t.dims;s++)if(1<<s&t.ellipsisMask){const r=Math.min(e.dims-(t.dims-s)+1+t.numAddAxisAfterEllipsis,e.dims);for(;n<r;n++)e.begin[n]=0,e.end[n]=0,e.strides[n]=1,e.beginMask|=1<<n,e.endMask|=1<<n,e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[n]=s}else if(1<<s&t.newAxisMask)e.finalShapeGatherIndices.push(f_),e.finalShapeGatherIndicesSparse.push(-1);else{if(n===e.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${e.dims} dims, ${e.begin.length}.`);t.begin!=null&&(e.begin[n]=t.begin[s]),t.end!=null&&(e.end[n]=t.end[s]),e.strides[n]=t.strides[s],t.beginMask&1<<s&&(e.beginMask|=1<<n),t.endMask&1<<s&&(e.endMask|=1<<n),t.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push($le),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<n):(e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[n]=s,n++}}function fP(t,e,n,s,r,i){if(r[e])return n>0?i[e]:i[e+1&1];{const o=t<0?s+t:t;return o<i[0]?i[0]:o>i[1]?i[1]:o}}const WV=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:NN,computeFlatOffset:AN,computeOutShape:$N,getNormalizedAxes:Ale,isSliceContinous:RN,maskToAxes:Rle,parseSliceParams:D1,sliceInfo:DN,startForAxis:VV,startIndicesWithElidedDims:MV,stopForAxis:UV,stopIndicesWithElidedDims:zV,stridesForAxis:BV,stridesWithElidedDims:PV},Symbol.toStringTag,{value:"Module"}));/** @license See the LICENSE file. */const jV="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GV{static sgd(e){return new R1(e)}static momentum(e,n,s=!1){return new IN(e,n,s)}static rmsprop(e,n=.9,s=0,r=null,i=!1){return new _N(e,n,s,r,i)}static adam(e=.001,n=.9,s=.999,r=null){return new SN(e,n,s,r)}static adadelta(e=.001,n=.95,s=null){return new xN(e,n,s)}static adamax(e=.002,n=.9,s=.999,r=null,i=0){return new CN(e,n,s,r,i)}static adagrad(e,n=.1){return new bN(e,n)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fu=GV;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ole=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:t=>t();function ON(){return new Promise(t=>Ole(()=>t()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PN(t,e){const n=t[0].length;t.forEach((r,i)=>{O(r.length===n,()=>`Error in concat${n}D: rank of tensors[${i}] must be the same as the rank of the rest (${n})`)}),O(e>=0&&e<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);const s=t[0];t.forEach((r,i)=>{for(let o=0;o<n;o++)O(o===e||r[o]===s[o],()=>`Error in concat${n}D: Shape of tensors[${i}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${i}.`)})}function vo(t,e){const n=t[0].slice();for(let s=1;s<t.length;s++)n[e]+=t[s][e];return n}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var _i;(function(t){t[t.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",t[t.VALUE_ROWIDS=1]="VALUE_ROWIDS",t[t.ROW_LENGTHS=2]="ROW_LENGTHS",t[t.ROW_SPLITS=3]="ROW_SPLITS",t[t.ROW_LIMITS=4]="ROW_LIMITS",t[t.ROW_STARTS=5]="ROW_STARTS"})(_i||(_i={}));function HV(t,e,n){let s=new Array;if(n==null&&e==null)return s;if(e==null)for(;s.length<t+n.length;)s.push(-1);else s=e.slice();if(n==null)return s;if(t+n.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${t+n.length}, but shape.rank = ${s.length}`);for(let r=1;r<n.length;++r){const i=n[r],o=s[s.length-n.length+r],a=s[o];if(i>=0)if(a>=0){if(a!==i)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+t}] = ${i} but shape[${r+t}] = ${a}`)}else s[o]=i}return s}function qV(t){const e={FIRST_DIM_SIZE:_i.FIRST_DIM_SIZE,VALUE_ROWIDS:_i.VALUE_ROWIDS,ROW_LENGTHS:_i.ROW_LENGTHS,ROW_SPLITS:_i.ROW_SPLITS,ROW_LIMITS:_i.ROW_LIMITS,ROW_STARTS:_i.ROW_STARTS},n=[];for(const s of t)if(s in e)n.push(e[s]);else break;return n}function KV(t){return t.length===0?0:t[0]===_i.FIRST_DIM_SIZE?t.length-1:t.length}function XV(t,e){if(t==null||e==null)return;const n=t.length,s=e.length;if(n>=s)throw new Error(`defaultValue.shape=${t} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(n,s-1);++r){const i=t[r],o=e[r+1];if(i>=0&&o>=0&&i!==1&&i!==o)throw new Error(`defaultValue.shape=${t}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-t.length}] = ${i} but ragged tensor input.flatValues.shape[${r-t.length}] = ${o}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FN=30;function O1(t){return t<=FN?t:Sw(t,Math.floor(Math.sqrt(t)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LN(t,e,n){const s=n*(typeof t=="number"?t:t[0]),r=e*(typeof t=="number"?t:t[1]);return[s,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ky(t,e,n,s=!0){let r=[];if(s)r=r.concat(e.slice(0)),r.push(t[0]/n),r=r.concat(t.slice(1));else{r=r.concat(t[0]);const i=e.length;for(let o=0;o<i;++o)r=r.concat([t[o+1]/e[o],e[o]]);r=r.concat(t.slice(i+1))}return r}function Ey(t,e,n=!0){const s=[];if(n){s.push(e);for(let r=e+1;r<t;++r)r<=2*e?(s.push(r),s.push(r-(e+1))):s.push(r)}else{const r=[],i=[];for(let o=1;o<t;++o)o>=e*2+1||o%2===1?i.push(o):r.push(o);s.push(...r),s.push(0),s.push(...i)}return s}function Ny(t,e,n,s=!0){const r=[];s?r.push(t[0]/n):r.push(t[0]*n);for(let i=1;i<t.length;++i)i<=e.length?s?r.push(e[i-1]*t[i]):r.push(t[i]/e[i-1]):r.push(t[i]);return r}function MN(t,e){const n=[0];for(let s=0;s<e;++s)n.push(t[s][0]);return n}function zN(t,e,n){const s=t.slice(0,1);for(let r=0;r<n;++r)s.push(t[r+1]-e[r][0]-e[r][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P1=1.7580993408473768,F1=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BN=.3275911,VN=.254829592,UN=-.284496736,WN=1.421413741,jN=-1.453152027,GN=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pa(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(t.length*2);for(let s=0;s<n.length;s+=2)n[s]=t[s/2],n[s+1]=e[s/2];return n}function YV(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let s=0;s<t.length;s+=2)e[s/2]=t[s],n[s/2]=t[s+1];return{real:e,imag:n}}function QV(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),s=new Float32Array(e);for(let r=0;r<t.length;r+=4)n[Math.floor(r/4)]=t[r],s[Math.floor(r/4)]=t[r+1];return{real:n,imag:s}}function JV(t){const e=Math.floor(t.length/4),n=new Float32Array(e),s=new Float32Array(e);for(let r=2;r<t.length;r+=4)n[Math.floor(r/4)]=t[r],s[Math.floor(r/4)]=t[r+1];return{real:n,imag:s}}function HN(t,e){const n=t[e*2],s=t[e*2+1];return{real:n,imag:s}}function ZV(t,e,n,s){t[s*2]=e,t[s*2+1]=n}function eU(t,e){const n=new Float32Array(t/2),s=new Float32Array(t/2);for(let r=0;r<Math.ceil(t/2);r++){const i=(e?2:-2)*Math.PI*(r/t);n[r]=Math.cos(i),s[r]=Math.sin(i)}return{real:n,imag:s}}function tU(t,e,n){const s=(n?2:-2)*Math.PI*(t/e),r=Math.cos(s),i=Math.sin(s);return{real:r,imag:i}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pC="->",Ple=/->/g,pP=",",mP="...";function qN(t,e){t=t.replace(/\s/g,"");const n=(t.length-t.replace(Ple,"").length)/pC.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error(`Equation must contain exactly one arrow ("${pC}").`);const[s,r]=t.split(pC);O(s.indexOf(mP)===-1,()=>`The ellipsis notation ("${mP}") is not supported yet.`);const i=s.split(pP),o=i.length;if(e!==o)throw new Error(`Expected ${o} input tensors, received ${e}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let d=0;d<r.length;++d){const f=r[d];if(!i.some(p=>p.indexOf(f)!==-1))throw new Error(`Output subscripts contain the label ${f} not present in the input subscripts.`);a.indexOf(f)===-1&&a.push(f)}for(let d=0;d<s.length;++d){const f=s[d];a.indexOf(f)===-1&&f!==pP&&a.push(f)}const l=new Array(i.length);for(let d=0;d<o;++d){if(new Set(i[d].split("")).size!==i[d].length)throw new Error(`Found duplicate axes in input component ${i[d]}. Support for duplicate axes in input is not implemented yet.`);l[d]=[];for(let f=0;f<i[d].length;++f)l[d].push(a.indexOf(i[d][f]))}const u=a.length,c=r.length,h=[];for(let d=c;d<u;++d)h.push(d);return{allDims:a,summedDims:h,idDims:l}}function KN(t,e){let n=new Array(t);n.fill(-1);for(let r=0;r<e.length;++r)n[e[r]]=r;const s=[];for(let r=0;r<t;++r)n[r]===-1&&s.push(r);return n=n.filter(r=>r!==-1),{permutationIndices:n,expandDims:s}}function XN(t,e,n){const s=new Array(t);for(let r=0;r<n.length;++r){const i=n[r].shape;for(let o=0;o<e[r].length;++o)s[e[r][o]]===void 0?s[e[r][o]]=i[o]:O(s[e[r][o]]===i[o],()=>`Expected dimension ${s[e[r][o]]} at axis ${o} of input shaped ${JSON.stringify(i)}, but got dimension ${i[o]}`)}}function YN(t,e){const n=t,s=[];let r=0;t.length===0&&n.push(-1),r=t.length+1;for(let o=0;o<r;++o)s.push([]);const i=[];for(let o=0;o<n.length;++o){const a=n[o],l=Fle(e,a);for(const u of l)i.indexOf(u)===-1&&(s[o].push(u),i.push(u))}return{path:n,steps:s}}function QN(t){return t.every((e,n)=>e===n)}function Fle(t,e){const n=[];for(let s=0;s<t.length;++s)(t[s].length===0||t[s].indexOf(e)!==-1||e===-1)&&n.push(s);return n}function JN(t,e,n=0){let s=[];if(typeof e=="number")O(t.shape[n]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(t.shape[n]/e);else{const r=e.reduce((o,a)=>(a===-1&&(o+=1),o),0);O(r<=1,()=>"There should be only one negative value in split array.");const i=e.indexOf(-1);if(i!==-1){const o=e.reduce((a,l)=>l>0?a+l:a);e[i]=t.shape[n]-o}O(t.shape[n]===e.reduce((o,a)=>o+a),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nU(t){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${t}`}function sU(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`}function rU(t,e,n){return`indices(${t}, 0) is invalid: ${e} >= ${n}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iU(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`}function oU(t,e){return`size ${t} must be non-negative, not ${e}`}function aU(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function lU(t,e){const n=re(t),s=re(e);return`Input to reshape is a SparseTensor with ${n}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${t} outputShape= ${e}`}function uU(t,e){const n=re(t),s=re(e);return`Input to reshape is a tensor with ${n} dense values, but the requested shape has ${s}. inputShape=${t} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p_(){return"segment ids must be >= 0"}function cU(){return"segment ids are not increasing"}function hU(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function dU(t,e,n){return`Bad: indices[${t}] == ${e} out of range [0, ${n})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fU(t,e){let n=!1,s;for(t<=FN?(s=t,n=!0):s=Sw(t,Math.floor(Math.sqrt(t)));!n;)s>e||s===t?n=!0:s=Sw(t,s+1);return s}function pU(t,e,n){const s=[],r=t.length;for(let i=0;i<r;i++)i!==e?s.push(t[i]):s.push(n);return s}function ZN(t,e,n,s){const r=e.shape.length,i=t.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>i)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${i}).`);if(n<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${n}).`);for(let h=0;h<s;++h)if(t.shape[h]!==e.shape[h])throw new Error(`x.shape[${h}]: ${t.shape[h]} should be equal to indices.shape[${h}]: ${e.shape[h]}.`);const o=t.shape[n],a=[];let l=1,u=1,c=1;for(let h=0;h<s;++h)a.push(t.shape[h]),l*=t.shape[h];for(let h=s;h<n;h++)a.push(t.shape[h]),u*=t.shape[h];for(let h=s;h<r;h++)a.push(e.shape[h]);for(let h=n+1;h<i;h++)a.push(t.shape[h]),c*=t.shape[h];return{batchSize:l,sliceSize:c,outerSize:u,dimSize:o,outputShape:a}}const Lle=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:ZN,computeOutShape:pU,segOpComputeOptimalWindowSize:fU},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ma(t){try{return t.map(e=>ca(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function mU(t){return t.map(e=>go(e))}const gU=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:VN,ERF_A2:UN,ERF_A3:WN,ERF_A4:jN,ERF_A5:GN,ERF_P:BN,PARALLELIZE_THRESHOLD:FN,get RowPartitionType(){return _i},SELU_SCALE:F1,SELU_SCALEALPHA:P1,applyActivation:T1,assertAndGetBroadcastShape:Ge,assertAxesAreInnerMostDims:ds,assertParamsConsistent:PN,assignToTypedArray:ZV,axesAreInnerMostDims:PE,calculateShapes:Jl,checkEinsumDimSizes:XN,checkPadOnDimRoundingMode:Ls,combineLocations:kB,combineRaggedTensorToTensorShapes:HV,complexWithEvenIndex:QV,complexWithOddIndex:JV,computeConv2DInfo:Yn,computeConv3DInfo:ql,computeDefaultPad:yE,computeDilation2DInfo:uy,computeOptimalWindowSize:O1,computeOutAndReduceShapes:Qn,computeOutShape:vo,computePool2DInfo:hi,computePool3DInfo:ba,convertConv2DDataFormat:Sa,decodeEinsumEquation:qN,eitherStridesOrDilationsAreOne:hs,expandShapeToKeepDim:xn,exponent:tU,exponents:eU,fromStringArrayToUint8:mU,fromUint8ToStringArray:ma,getAxesPermutation:on,getBroadcastDims:Zu,getComplexWithIndex:HN,getEinsumComputePath:YN,getEinsumPermutation:KN,getFusedBiasGradient:_1,getFusedDyActivation:I1,getImageCenter:LN,getInnerMostAxes:bn,getPermuted:Ey,getRaggedRank:KV,getReductionAxes:Rn,getReshaped:ky,getReshapedPermuted:Ny,getRowPartitionTypesHelper:qV,getSliceBeginCoords:MN,getSliceSize:zN,getSparseFillEmptyRowsIndicesDenseShapeMismatch:nU,getSparseFillEmptyRowsNegativeIndexErrorMessage:sU,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:rU,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:aU,getSparseReshapeInputOutputMismatchErrorMessage:uU,getSparseReshapeInputOutputMultipleErrorMessage:lU,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:iU,getSparseReshapeNegativeOutputDimErrorMessage:oU,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:dU,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:p_,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:cU,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:hU,getUndoAxesPermutation:Kl,isIdentityPermutation:QN,log:Lee,mergeRealAndImagArrays:pa,prepareAndValidate:A1,prepareSplitSize:JN,segment_util:Lle,shouldFuse:k1,slice_util:WV,splitRealAndImagArrays:YV,stridesOrDilationsArePositive:Ju,tupleValuesAreOne:$l,upcastType:Xs,validateDefaultValueShape:XV,validateInput:w1,validateUpdateShape:cN,warn:Nr},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mle=Object.freeze(Object.defineProperty({__proto__:null,nonMaxSuppressionV3Impl:E1,nonMaxSuppressionV4Impl:N1,nonMaxSuppressionV5Impl:$1,whereImpl:S1},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */tle();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yU={kernelName:rg,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>G(t,kc(ge(n,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zle={kernelName:pd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=$t(ge(n,"float32")),r=Kn(_e(Le(1),s));return Bt(Re(t,r))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ble={kernelName:md,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=Kn(_e($t(ge(n,"float32")),1));return Re(t,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vle={kernelName:Sc,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Ge(n.shape,s.shape);return{a:()=>{let a=t;const l=Rn(n.shape,r);return l.length>0&&(a=Te(a,l)),H(a,n.shape)},b:()=>{let a=t;const l=Rn(s.shape,r);return l.length>0&&(a=Te(a,l)),H(a,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ule={kernelName:ig,saveAllInputs:!0,gradFunc:(t,e)=>{const n={};return e.forEach((s,r)=>{n[r]=()=>t.clone()}),n}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wle={kernelName:og,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>ct(n)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jle={kernelName:ag,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>ct(n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gle={kernelName:gd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Re(t,Kn(_e(Le(1),$t(ge(n,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hle={kernelName:yd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=Kn(he(Le(1),$t(ge(n,"float32"))));return Re(t,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qle={kernelName:xd,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Ge(n.shape,s.shape);return{a:()=>{const a=he($t(n),$t(s));let l=G(t,Re(s,a));const u=Rn(n.shape,r);return u.length>0&&(l=Te(l,u)),H(l,n.shape)},b:()=>{const a=he($t(n),$t(s));let l=Bt(G(t,Re(n,a)));const u=Rn(s.shape,r);return u.length>0&&(l=Te(l,u)),H(l,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kle={kernelName:vd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Re(t,he($t(ge(n,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xle={kernelName:wd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Re(t,_e(Le(1),$t(ge(n,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yle(t,e,n,s,r,i){const o=P(t,"dy","avgPool3dGrad"),a=P(e,"input","avgPool3dGrad");let l=o,u=a,c=!1;a.rank===4&&(c=!0,l=H(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),u=H(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),O(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),O(u.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${u.rank}.`),Ls("avgPool3dGrad",r,i);const h={dy:l,input:u},d={filterSize:n,strides:s,pad:r,dimRoundingMode:i},f=V.runKernel(jx,h,d);return c?H(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const Qle=U({avgPool3dGrad_:Yle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jle={kernelName:ug,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{filterSize:r,strides:i,pad:o,dimRoundingMode:a}=n;return{x:()=>Qle(t,s,r,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zle(t,e,n,s,r){const i=P(t,"dy","avgPoolGrad"),o=P(e,"input","avgPoolGrad");O(o.rank===i.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${i.rank})`);let a=o,l=i,u=!1;o.rank===3&&(u=!0,a=H(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=H(i,[1,i.shape[0],i.shape[1],i.shape[2]])),O(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),O(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const c={dy:l,input:a},h={filterSize:n,strides:s,pad:r},d=V.runKernel(Wx,c,h);return u?H(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const eue=U({avgPoolGrad_:Zle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tue={kernelName:lg,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{filterSize:r,strides:i,pad:o}=n;return{x:()=>eue(t,s,r,i,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nue={kernelName:cg,inputsToSave:["a","b"],gradFunc:(t,e,n)=>{const[s,r]=e,{transposeA:i,transposeB:o}=n;return!i&&!o?{a:()=>Je(t,r,!1,!0),b:()=>Je(s,t,!0,!1)}:!i&&o?{a:()=>Je(t,r,!1,!1),b:()=>Je(t,s,!0,!1)}:i&&!o?{a:()=>Je(r,t,!1,!0),b:()=>Je(s,t,!1,!1)}:{a:()=>Je(r,t,!0,!0),b:()=>Je(t,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sue={kernelName:hg,gradFunc:(t,e,n)=>{const{blockShape:s,crops:r}=n;return{x:()=>xy(t,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rue={kernelName:z4,gradFunc:(t,e,n)=>{const s=n,r=s.inputShape,i=s.shape,o=Array.from(i);for(let l=r.length-1;l>=0;l--)if(r[l]===i[l])o[l]=1;else if(r[l]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${i}].`);const a=[];for(let l=0;l<o.length;l++)o[l]>1&&a.push(l);return{x:()=>Te(t,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iue={kernelName:bd,gradFunc:t=>({x:()=>t.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oue={kernelName:Sd,gradFunc:t=>({x:()=>ct(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aue={kernelName:Cd,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{clipValueMin:r,clipValueMax:i}=n;return{x:()=>Hn(ci(Ca(s,r),Xl(s,i)),t,ct(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lue={kernelName:fg,inputsToSave:["x"],gradFunc:yU.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uue={kernelName:pg,saveAllInputs:!0,gradFunc:(t,e,n)=>{const s=e.map(l=>l.shape),{axis:r}=n,i=Ze(r,e[0].shape)[0],o=s.map(l=>l[i]);return qs(t,o,i).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cue={kernelName:mg,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[s,r]=e,{dilations:i,strides:o,pad:a,dataFormat:l}=n;return O($l(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>EE(s.shape,t,r,o,a,l),filter:()=>yN(s,t,r.shape,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hue={kernelName:gg,inputsToSave:["dy","filter"],gradFunc:(t,e,n)=>{const[s,r]=e,{strides:i,pad:o,dataFormat:a,dimRoundingMode:l}=n;return{dy:()=>fa(t,r,i,o,a,1,l),filter:()=>yN(t,s,r.shape,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function due(t,e,n,s,r){let i=t;t.rank===4&&(i=H(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));let o=e;o.rank===4&&(o=H(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),O(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),O(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),O(n.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`),O(i.shape[4]===n[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${n[3]}.`),O(o.shape[4]===n[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${n[4]}).`);const a={x:i,dy:o},l={strides:s,pad:r,filterShape:n};return V.runKernel(Xx,a,l)}const fue=U({conv3DBackpropFilter_:due});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pue={kernelName:yg,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:s,strides:r,pad:i}=n;O($l(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[o,a]=e;return{x:()=>IB(o.shape,t,a,r,i),filter:()=>fue(o,t,a.shape,r,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mue={kernelName:Id,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>G(Bt(p1(ge(n,"float32"))),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gue={kernelName:_d,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>G(m1(ge(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yue={kernelName:vg,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:r,exclusive:i,reverse:o}=n;return{x:()=>{const a=on([r],s.rank);let l=e1(t,r,i,!o);return a!=null&&(l=ot(l,a)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vue={kernelName:wg,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:s,strides:r,pad:i,dimRoundingMode:o}=n,a=s??[1,1];O($l(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,u]=e;return O(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),O(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${u.rank}.`),O(l.shape[3]===u.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`),O(hs(r,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${a}'.`),Ls("depthwiseConv2d",i,o),{x:()=>mV(l.shape,t,u,r,i,a,o),filter:()=>pV(l,t,u.shape,r,i,a,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wue={kernelName:xg,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[s,r]=e,i={x:s,filter:r,dy:t},o={x:s,filter:r,dy:t};return{x:()=>V.runKernel(Cw,i,n),filter:()=>V.runKernel(Iw,o,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xue={kernelName:kd,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e,s={dy:t,y:n};return{x:()=>V.runKernel(ob,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bue={kernelName:Ed,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,s=G(Js(Bt($t(n))),2/Math.sqrt(Math.PI));return{x:()=>G(t,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sue={kernelName:Nd,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>G(t,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cue={kernelName:Sg,inputsToSave:["input"],gradFunc:(t,e)=>{const[n]=e;return{input:()=>H(t,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iue={kernelName:$d,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>G(t,Js(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ue={kernelName:Rd,gradFunc:t=>({x:()=>ct(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tue={kernelName:Ad,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Ge(n.shape,s.shape);return{a:()=>{const a=Re(t,ge(s,"float32")),l=Rn(n.shape,r);return l.length>0?H(Te(a,l),n.shape):a},b:()=>{let a=G(t,ge(n,"float32"));const l=Rn(s.shape,r);l.length>0&&(a=H(Te(a,l),s.shape));const u=$t(s);return Bt(Re(a,ge(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kue={kernelName:Cg,inputsToSave:["x","mean","variance","scale"],gradFunc:(t,e,n)=>{const{varianceEpsilon:s}=n,[r,i,o,a]=e,l=a??Le(1),u=Rn(i.shape,r.shape),c=[];if(i.rank===1){for(let x=0;x<r.shape.length-1;++x)c.push(r.shape[x]);c.push(1)}const h=_e(r,i),d=G(t,l),f=h1(he(o,Le(s))),p=G(G(G(f,f),f),Le(-.5));return{x:()=>i.rank===1?H(G(G(t,Ar(H(f,[1,1,1,i.shape[0]]),c)),l),r.shape):H(G(G(t,f),l),r.shape),mean:()=>{let x=G(G(f,Le(-1)),d);return i.rank===1&&(x=Te(x,u)),H(x,i.shape)},variance:()=>{let x=G(G(p,h),d);return i.rank===1&&(x=Te(x,u)),H(x,i.shape)},scale:()=>{const x=G(h,f);let S=G(t,x);return i.rank===1&&(S=Te(S,u)),H(S,i.shape)},offset:()=>{let x=t;return i.rank===1&&(x=Te(x,u)),H(x,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eue={kernelName:Ig,inputsToSave:["x","indices"],gradFunc:(t,e,n)=>{const[s,r]=e,{axis:i,batchDims:o}=n,a=Ze(i,s.shape)[0],l=(u,c,h)=>()=>{const d=u.shape,f=c.size,p=d.slice(0,a),m=p.length,v=d.slice(i,d.length).slice(1),g=v.length,w=gP(0,m),b=gP(m+1,m+1+g),x=yP([p,[f],v]),S=H(h,x),N=H(c,[f]),I=yP([[m],w,b]),C=ot(S,I);let _=b1(C,N,u.shape[a]);const k=Kl(I);return _=ot(_,k),_};if(o===1){const u=s.shape[0],c=s.split(u,0);return{x:()=>Ps(c.map((f,p)=>l(f,r.slice(p,1),t.slice(p,1))())).reshape(s.shape),indices:()=>r}}else return{x:l(s,r,t),indices:()=>r}}};function gP(t,e){const n=[];for(let s=t;s<e;++s)n.push(s);return n}function yP(t){const e=[];for(let n=0;n<t.length;++n)for(let s=0;s<t[n].length;++s)e.push(t[n][s]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nue={kernelName:Dd,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>ct(n),b:()=>ct(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $ue={kernelName:Od,gradFunc:t=>({x:()=>ge(t,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rue={kernelName:Pd,gradFunc:t=>({x:()=>ct(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aue={kernelName:Fd,gradFunc:t=>({x:()=>ct(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Due={kernelName:Ld,gradFunc:t=>({x:()=>ct(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oue={kernelName:Tg,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{alpha:r}=n,i=Ms(s,0);return{x:()=>Hn(i,t,G(t,r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pue={kernelName:zd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Re(t,he(n,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fue={kernelName:Md,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Re(t,ge(n,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lue={kernelName:B4,inputsToSave:[],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s]=e,{axis:r}=n;return{logits:()=>{const o=Js(s);return _e(t,G(Te(t,r,!0),o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mue(t,e,n,s=5,r=1,i=1,o=.5){const a={x:t,y:e,dy:n},l={depthRadius:s,bias:r,alpha:i,beta:o};return V.runKernel(pb,a,l)}const zue=U({localResponseNormalizationBackprop_:Mue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bue={kernelName:Ag,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,r]=e,{depthRadius:i,bias:o,alpha:a,beta:l}=n;return{x:()=>zue(s,r,t,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vU(t,e,n,s){return e.rank<n.rank&&(e=H(e,xn(e.shape,s))),t.rank<n.rank&&(t=H(t,xn(t.shape,s))),{x:()=>G(t,ge(yr(n,e),t.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vP={kernelName:Dg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const s=n,{reductionIndices:r}=s,i=e[0],o=e[1],a=Ze(r,i.shape),l=vU(t,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vue={kernelName:Bd,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>G(t,ge(Ca(n,s),"float32")),b:()=>G(t,ge(Gh(n,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uue(t,e,n,s,r,i,o){const a=P(t,"dy","maxPool3dGrad"),l=P(e,"input","maxPool3dGrad"),u=P(n,"output","maxPool3dGrad");let c=a,h=l,d=u,f=!1;l.rank===4&&(f=!0,c=H(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),h=H(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),d=H(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),O(c.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),O(h.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${h.rank}.`),O(d.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${d.rank}.`),Ls("maxPool3dGrad",i,o);const p={dy:c,input:h,output:d},m={filterSize:s,strides:r,pad:i,dimRoundingMode:o},v=V.runKernel(gb,p,m);return f?H(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}const Wue=U({maxPool3dGrad_:Uue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jue={kernelName:Pg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,r]=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=n;return{x:()=>Wue(t,s,r,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gue(t,e,n,s,r,i,o){const a=P(t,"dy","maxPoolGrad"),l=P(e,"input","maxPoolGrad"),u=P(n,"output","maxPoolGrad");O(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),O(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),O(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),Ls("maxPoolGrad",i,o);const c={dy:a,input:l,output:u},h={filterSize:s,strides:r,pad:i,dimRoundingMode:o};return V.runKernel(mb,c,h)}const Hue=U({maxPoolGrad_:Gue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const que={kernelName:Og,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,r]=e,{filterSize:i,strides:o,pad:a}=n;return{x:()=>Hue(t,s,r,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kue={kernelName:Fg,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:r}=n,i=Ze(r,s.shape),a=Qn(s.shape,i)[1],l=re(a);return{x:()=>{const c=s.shape.slice();i.forEach(f=>{c[f]=1});const h=H(t,c);return Re(G(h,js(s.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xue={kernelName:Lg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const s=n,{axis:r}=s,[i,o]=e,a=Ze(r,i.shape),l=vU(t,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yue={kernelName:Vd,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>G(t,ge(Xl(n,s),"float32")),b:()=>G(t,ge(Ms(n,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Que={kernelName:Mg,inputsToSave:["x"],gradFunc:(t,e,n)=>{const s=e[0],{paddings:r}=n,i=r.map(o=>o[0]);return{x:()=>lt(t,i,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jue={kernelName:Ud,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Ge(n.shape,s.shape);return{a:()=>{const a=Rn(n.shape,r);return a.length>0?H(Te(t,a),n.shape):t},b:()=>{const a=G(t,Bt(pf(Re(n,s)))),l=Rn(s.shape,r);return l.length>0?H(Te(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zue={kernelName:Wd,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Ge(n.shape,s.shape);return{a:()=>{const a=G(t,ge(s,"float32")),l=Rn(n.shape,r);return l.length>0?H(Te(a,l),n.shape):a},b:()=>{const a=G(t,ge(n,"float32")),l=Rn(s.shape,r);return l.length>0?H(Te(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ece={kernelName:zg,gradFunc:t=>({x:()=>Bt(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tce={kernelName:Ug,inputsToSave:["indices"],gradFunc:(t,e)=>{const n=e[0];return{indices:()=>En(n.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nce={kernelName:Vg,gradFunc:t=>({x:()=>ct(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sce={kernelName:Wg,saveAllInputs:!0,gradFunc:(t,e,n)=>{const{axis:s}=n;return Br(t,s).map(i=>()=>i)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wP={kernelName:jg,inputsToSave:["x"],gradFunc:(t,e,n)=>{const s=e[0],{paddings:r}=n,i=r.map(o=>o[0]);return{x:()=>lt(t,i,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rce={kernelName:jd,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(t,e)=>{const[n,s,r]=e,i=n,o=s,a=Ge(i.shape,o.shape);return{a:()=>{const c=ge(o,"float32");let h=G(t,G(c,Co(i,_e(c,Le(1)))));const d=Rn(i.shape,a);return d.length>0&&(h=Te(h,d)),H(h,i.shape)},b:()=>{const c=Ms(i,0),h=Hn(c,vr(i),ct(i));let d=G(t,G(r,h));const f=Rn(o.shape,a);return f.length>0&&(d=Te(d,f)),H(d,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ice={kernelName:Gg,inputsToSave:["x","alpha"],gradFunc:(t,e)=>{const[n,s]=e,r=Ms(n,0);return{x:()=>Hn(r,t,G(t,s)),alpha:()=>{let i=Hn(r,ct(t),G(t,n));const o=Rn(s.shape,t.shape);return o.length>0&&(i=Te(i,o)),H(i,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oce(t,e,n){const s=t.shape.slice();s[n]=1;const r=H(e,s),i=Nm(t,n,!0,!1),o=Nm(t,n,!0,!0),a=G(i,o);return G(r,a)}function ace(t,e,n){const s=t.shape.length,r=s-n.length,i=on(n,s);let o=t;i!=null&&(o=ot(t,i));const a=o.shape.slice(),u=a.splice(s-n.length,n.length).reduce((d,f)=>d*f,1);a.push(u);const c=o.reshape(a);let h=oce(c,e,r);if(h=h.reshape(o.shape),i!=null){const d=Kl(i);h=ot(h,d)}return h}const lce={kernelName:Hg,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:r}=n;let i=[];return r==null?i=s.shape.map((o,a)=>a):typeof r=="number"?i=[r]:i=r,{x:()=>ace(s,t,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uce={kernelName:Td,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Ge(n.shape,s.shape);return{a:()=>{const a=Re(t,ge(s,"float32")),l=Rn(n.shape,r);return l.length>0?H(Te(a,l),n.shape):a},b:()=>{let a=G(t,ge(n,"float32"));const l=Rn(s.shape,r);l.length>0&&(a=H(Te(a,l),s.shape));const u=$t(s);return Bt(Re(a,ge(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cce={kernelName:Gd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Re(t,Bt($t(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hce={kernelName:qd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,s=G(Xl(n,6),kc(n));return{x:()=>G(t,ge(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dce={kernelName:Hd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>G(t,ge(kc(n),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fce={kernelName:qg,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>H(t,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pce={kernelName:Xg,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[s]=e,r={dy:t,images:s};return{images:()=>V.runKernel(Eb,r,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mce={kernelName:Kg,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[s]=e,r={dy:t,images:s};return{images:()=>V.runKernel(kb,r,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gce={kernelName:Yg,gradFunc:(t,e,n)=>{const{dims:s}=n,r=Ze(s,t.shape);return{x:()=>zr(t,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yce={kernelName:Kd,gradFunc:t=>({x:()=>ct(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vce={kernelName:Xd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Bt(Re(t,G(Co(n,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wce={kernelName:Qg,inputsToSave:["condition"],gradFunc:(t,e)=>{const[n]=e;return{condition:()=>ge(ct(n),"float32"),t:()=>G(t,ge(n,t.dtype)),e:()=>G(t,ge(yy(n),t.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xce={kernelName:Yd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=Ms(n,Le(0)),r=Le(P1),i=Le(F1),o=G(t,i),a=G(G(t,r),Js(ge(n,"float32")));return Hn(s,o,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bce={kernelName:ef,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>G(t,G(n,_e(Le(1),n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sce={kernelName:Zd,gradFunc:t=>({x:()=>ct(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cce={kernelName:Qd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>G(dy(ge(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ice={kernelName:Jd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>G(Zb(ge(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ce={kernelName:Jg,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{begin:r,size:i}=n,o=s.shape,[a,l]=D1(s,r,i),u=[];for(let c=0;c<t.rank;c++)u.push([a[c],o[c]-a[c]-l[c]]);return{x:()=>Ia(t,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tce={kernelName:ny,outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s]=e,{dim:r}=n,i=!0,o=G(t,s);return{logits:()=>_e(o,G(Te(o,[r],i),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kce={kernelName:tf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>G(t,Fi(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xP={kernelName:ey,gradFunc:(t,e,n)=>{const{blockShape:s,paddings:r}=n;return{x:()=>hy(t,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bP={kernelName:ty,gradFunc:(t,e,n)=>{const{axis:s}=n;return{x:()=>wn(t,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ece={kernelName:nf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Re(t,G(Kn(ge(n,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nce={kernelName:Lb,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>G(t,G(ge(n,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $ce={kernelName:sf,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Le(2);return{a:()=>G(t,G(r,_e(n,s))),b:()=>G(t,G(r,_e(s,n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rce={kernelName:uf,gradFunc:t=>({x:()=>ct(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ace={kernelName:rf,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Ge(n.shape,s.shape);return{a:()=>{let a=t;const l=Rn(n.shape,r);return l.length>0&&(a=Te(a,l)),H(a,n.shape)},b:()=>{let a=t;const l=Rn(s.shape,r);return l.length>0&&(a=Te(a,l)),H(Bt(a),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dce={kernelName:Zg,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,r=s.shape.slice(),{axis:i}=n;Ze(i,s.shape).forEach(u=>{r[u]=1});const a=H(t,r),l=G(a,js(s.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oce={kernelName:of,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Re(t,$t(dy(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pce={kernelName:af,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>G(_e(Le(1),$t(n)),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fce={kernelName:lf,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{reps:r}=n;return{x:()=>{let o=ct(s);if(s.rank===1)for(let a=0;a<r[0];++a)o=he(o,lt(t,[a*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)o=he(o,lt(t,[a*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let u=0;u<r[2];++u)o=he(o,lt(t,[a*s.shape[0],l*s.shape[1],u*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let u=0;u<r[2];++u)for(let c=0;c<r[3];++c)o=he(o,lt(t,[a*s.shape[0],l*s.shape[1],u*s.shape[2],c*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return o}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lce={kernelName:Au,gradFunc:(t,e,n)=>{const s=n,{perm:r}=s,i=Kl(r);return{x:()=>ot(t,i)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mce={kernelName:ry,gradFunc:(t,e,n)=>{const s=n,{axis:r}=s;return{value:()=>Ps(t,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zce={kernelName:iy,inputsToSave:["segmentIds"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Bce(t,n)}}};function Bce(t,e){const n=Eo(e,ct(e)),s=mf(t,n);let r=Ca(e,Le(0,"int32"));const i=s.rank-r.rank;for(let a=0;a<i;++a)r=ss(r,a+1);r=ci(r,js(s.shape,"bool"));const o=ct(s);return Hn(r,s,o)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vce={kernelName:oy,gradFunc:t=>({x:()=>ct(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uce=[yU,zle,Ble,Vle,Ule,Wle,jle,Gle,Hle,qle,Kle,Xle,Jle,tue,nue,sue,rue,iue,oue,aue,lue,uue,hue,cue,pue,mue,gue,yue,vue,wue,uce,xue,bue,Sue,Cue,Iue,Tue,_ue,kue,Eue,Nue,$ue,Rue,Aue,Due,Oue,Pue,Fue,Lue,Bue,vP,vP,Vue,jue,que,Kue,Xue,Yue,Que,Jue,Zue,ece,tce,nce,sce,wP,wP,rce,ice,lce,cce,hce,dce,fce,pce,mce,gce,yce,vce,wce,xce,bce,Sce,Cce,Ice,_ce,Tce,kce,xP,xP,bP,bP,Ece,$ce,Nce,Rce,Ace,Dce,Oce,Pce,Fce,Lce,Mce,zce,Vce];for(const t of Uce)V4(t);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.abs=function(){return this.throwIfDisposed(),Tn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.acos=function(){return this.throwIfDisposed(),uE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.acosh=function(){return this.throwIfDisposed(),cE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.add=function(t){return this.throwIfDisposed(),he(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.all=function(t,e){return this.throwIfDisposed(),Yb(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.any=function(t,e){return this.throwIfDisposed(),Tm(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.argMax=function(t){return this.throwIfDisposed(),Qu(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.argMin=function(t){return this.throwIfDisposed(),hE(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.asScalar=function(){return this.throwIfDisposed(),O(this.size===1,()=>"The array must have only 1 element."),H(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.asType=function(t){return this.throwIfDisposed(),ge(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.as1D=function(){return this.throwIfDisposed(),H(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.as2D=function(t,e){return this.throwIfDisposed(),H(this,[t,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.as3D=function(t,e,n){return this.throwIfDisposed(),H(this,[t,e,n])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.as4D=function(t,e,n,s){return this.throwIfDisposed(),H(this,[t,e,n,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.as5D=function(t,e,n,s,r){return this.throwIfDisposed(),H(this,[t,e,n,s,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.asin=function(){return this.throwIfDisposed(),dE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.asinh=function(){return this.throwIfDisposed(),fE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.atan=function(){return this.throwIfDisposed(),pE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.atan2=function(t){return this.throwIfDisposed(),mE(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.atanh=function(){return this.throwIfDisposed(),gE(this)};ie().prototype.avgPool=function(t,e,n,s){return this.throwIfDisposed(),cy(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),hy(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.batchNorm=function(t,e,n,s,r){return this.throwIfDisposed(),cf(this,t,e,n,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.broadcastTo=function(t){return this.throwIfDisposed(),Du(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.cast=function(t){return this.throwIfDisposed(),ge(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.ceil=function(){return this.throwIfDisposed(),CE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.clipByValue=function(t,e){return this.throwIfDisposed(),Qs(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.concat=function(t,e){return this.throwIfDisposed(),t instanceof pt&&(t=[t]),wn([this,...t],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.conv1d=function(t,e,n,s,r,i){return this.throwIfDisposed(),Qb(this,t,e,n,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.conv2dTranspose=function(t,e,n,s,r){return this.throwIfDisposed(),Jb(this,t,e,n,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.conv2d=function(t,e,n,s,r,i){return this.throwIfDisposed(),fa(this,t,e,n,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.cos=function(){return this.throwIfDisposed(),dy(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.cosh=function(){return this.throwIfDisposed(),Zb(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.cumprod=function(t,e,n){return this.throwIfDisposed(),Nm(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.cumsum=function(t,e,n){return this.throwIfDisposed(),e1(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),RE(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.depthwiseConv2d=function(t,e,n,s,r,i){return this.throwIfDisposed(),hf(this,t,e,n,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.dilation2d=function(t,e,n,s,r){return this.throwIfDisposed(),AE(this,t,e,n,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.divNoNan=function(t){return this.throwIfDisposed(),DE(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.div=function(t){return this.throwIfDisposed(),Re(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.dot=function(t){return this.throwIfDisposed(),OE(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.elu=function(){return this.throwIfDisposed(),df(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.equal=function(t){return this.throwIfDisposed(),yr(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.erf=function(){return this.throwIfDisposed(),t1(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.euclideanNorm=function(t,e){return this.throwIfDisposed(),FE(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.exp=function(){return this.throwIfDisposed(),Js(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.expandDims=function(t){return this.throwIfDisposed(),ss(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.expm1=function(){return this.throwIfDisposed(),LE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.fft=function(){return this.throwIfDisposed(),_y(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.flatten=function(){return this.throwIfDisposed(),H(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.floor=function(){return this.throwIfDisposed(),pf(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.floorDiv=function(t){return this.throwIfDisposed(),Xb(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.gather=function(t,e,n){return this.throwIfDisposed(),mf(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.greaterEqual=function(t){return this.throwIfDisposed(),Ca(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.greater=function(t){return this.throwIfDisposed(),Ms(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.ifft=function(){return this.throwIfDisposed(),Xh(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.irfft=function(){return this.throwIfDisposed(),y1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.isFinite=function(){return this.throwIfDisposed(),ME(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.isInf=function(){return this.throwIfDisposed(),zE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.isNaN=function(){return this.throwIfDisposed(),BE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.leakyRelu=function(t){return this.throwIfDisposed(),py(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.lessEqual=function(t){return this.throwIfDisposed(),Xl(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.less=function(t){return this.throwIfDisposed(),Gh(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.localResponseNormalization=function(t,e,n,s){return this.throwIfDisposed(),VE(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.logSigmoid=function(){return this.throwIfDisposed(),UE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.logSoftmax=function(t){return this.throwIfDisposed(),r1(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.logSumExp=function(t,e){return this.throwIfDisposed(),gy(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.log=function(){return this.throwIfDisposed(),vr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.log1p=function(){return this.throwIfDisposed(),my(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.logicalAnd=function(t){return this.throwIfDisposed(),ci(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.logicalNot=function(){return this.throwIfDisposed(),yy(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.logicalOr=function(t){return this.throwIfDisposed(),i1(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.logicalXor=function(t){return this.throwIfDisposed(),WE(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.matMul=function(t,e,n){return this.throwIfDisposed(),Je(this,t,e,n)};ie().prototype.maxPool=function(t,e,n,s){return this.throwIfDisposed(),vy(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.max=function(t,e){return this.throwIfDisposed(),Lr(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.maximum=function(t){return this.throwIfDisposed(),Eo(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.mean=function(t,e){return this.throwIfDisposed(),nn(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.min=function(t,e){return this.throwIfDisposed(),jh(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.minimum=function(t){return this.throwIfDisposed(),Al(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.mirrorPad=function(t,e){return this.throwIfDisposed(),GE(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.mod=function(t){return this.throwIfDisposed(),HE(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.mul=function(t){return this.throwIfDisposed(),G(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.neg=function(){return this.throwIfDisposed(),Bt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.norm=function(t,e,n){return this.throwIfDisposed(),ff(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.notEqual=function(t){return this.throwIfDisposed(),ec(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.oneHot=function(t,e=1,n=0){return this.throwIfDisposed(),Hh(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.onesLike=function(){return this.throwIfDisposed(),wr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.pad=function(t,e){return this.throwIfDisposed(),Ia(this,t,e)};ie().prototype.pool=function(t,e,n,s,r,i){return this.throwIfDisposed(),qE(this,t,e,n,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.pow=function(t){return this.throwIfDisposed(),Co(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.prelu=function(t){return this.throwIfDisposed(),by(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.prod=function(t,e){return this.throwIfDisposed(),KE(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.reciprocal=function(){return this.throwIfDisposed(),iN(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.relu=function(){return this.throwIfDisposed(),Xi(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.relu6=function(){return this.throwIfDisposed(),u1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.reshapeAs=function(t){return this.throwIfDisposed(),H(this,t.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.reshape=function(t){return this.throwIfDisposed(),H(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.resizeBilinear=function(t,e,n){return this.throwIfDisposed(),wV(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.resizeNearestNeighbor=function(t,e,n){return this.throwIfDisposed(),xV(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.reverse=function(t){return this.throwIfDisposed(),zr(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.rfft=function(){return this.throwIfDisposed(),Ty(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.round=function(){return this.throwIfDisposed(),c1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.rsqrt=function(){return this.throwIfDisposed(),h1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.selu=function(){return this.throwIfDisposed(),d1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.separableConv2d=function(t,e,n,s,r,i){return this.throwIfDisposed(),f1(this,t,e,n,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.sigmoid=function(){return this.throwIfDisposed(),Fi(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.sign=function(){return this.throwIfDisposed(),oN(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.sin=function(){return this.throwIfDisposed(),p1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.sinh=function(){return this.throwIfDisposed(),m1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.slice=function(t,e){return this.throwIfDisposed(),lt(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.softmax=function(t){return this.throwIfDisposed(),Iy(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.softplus=function(){return this.throwIfDisposed(),_c(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),xy(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.split=function(t,e){return this.throwIfDisposed(),qs(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.sqrt=function(){return this.throwIfDisposed(),Kn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.square=function(){return this.throwIfDisposed(),$t(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.squaredDifference=function(t){return this.throwIfDisposed(),v1(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.squeeze=function(t){return this.throwIfDisposed(),Ql(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.stack=function(t,e){this.throwIfDisposed();const n=t instanceof pt?[this,t]:[this,...t];return Ps(n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.step=function(t){return this.throwIfDisposed(),kc(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.stridedSlice=function(t,e,n,s,r,i,o,a){return this.throwIfDisposed(),aN(this,t,e,n,s,r,i,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.sub=function(t){return this.throwIfDisposed(),_e(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.sum=function(t,e){return this.throwIfDisposed(),Te(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.tan=function(){return this.throwIfDisposed(),lN(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.tanh=function(){return this.throwIfDisposed(),Rl(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.tile=function(t){return this.throwIfDisposed(),Ar(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.toBool=function(){return this.throwIfDisposed(),ge(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.toFloat=function(){return this.throwIfDisposed(),ge(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.toInt=function(){return this.throwIfDisposed(),ge(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.topk=function(t,e){return this.throwIfDisposed(),hN(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.transpose=function(t){return this.throwIfDisposed(),ot(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.unique=function(t){return this.throwIfDisposed(),dN(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),b1(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.unstack=function(t){return this.throwIfDisposed(),Br(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.where=function(t,e){return this.throwIfDisposed(),Hn(t,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.zerosLike=function(){return this.throwIfDisposed(),ct(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class no extends Error{constructor(e){super(e),Object.setPrototypeOf(this,no.prototype)}}class ii extends Error{constructor(e){super(e),Object.setPrototypeOf(this,ii.prototype)}}class q extends Error{constructor(e){super(e),Object.setPrototypeOf(this,q.prototype)}}class Ke extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ke.prototype)}}class e2 extends Error{constructor(e){super(e),Object.setPrototypeOf(this,e2.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class wU{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let n;return this.cache.has(e)&&(n=this.cache.get(e),this.cache.delete(e),this.cache.set(e,n)),n}put(e,n){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,n)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let n=0;n<this.maxEntries-e;n++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function sc(t,e){if(Array.isArray(t)){let n=[];for(let s=0;s<e;s++)n=n.concat(t);return n}else{const n=new Array(e);return n.fill(t),n}}function so(t,e){if(!t)throw new e2(e)}function SP(t,e){let n=0;for(const s of t)s===e&&n++;return n}function Us(t){return t.length===1?t[0]:t}function Tt(t){return Array.isArray(t)?t:[t]}function Vo(t){const n=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return n[0]!=="_"?n:"private"+n}function yu(t){return t.length<=1||t.indexOf("_")===-1?t:t.replace(/[_]+(\w|$)/g,(e,n)=>n.toUpperCase())}let qr={};function t2(t){if(t==null)return null;const e={};return e.className=t.getClassName(),e.config=t.getConfig(),e}function m_(t){if(!(t==null||typeof t!="object"))if(Array.isArray(t))t.forEach(e=>m_(e));else{const e=Object.keys(t);for(const n of e){const s=t[n];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?t[n]=s.value:m_(s))}}}function $y(t,e={},n={},s="object",r=!1){if(typeof t=="string"){const i=t;let o;if(i in n)o=n[i];else if(i in qr)o=qr[i];else if(o=e[i],o==null)throw new q(`Unknown ${s}: ${t}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return o}else{const i=t;if(i.className==null||i.config==null)throw new q(`${s}: Improper config format: ${JSON.stringify(i)}.
'className' and 'config' must set.`);const o=i.className;let a,l;if(o in n?[a,l]=n[o]:o in qr?[a,l]=qr.className:o in e&&([a,l]=e[o]),a==null)throw new q(`Unknown ${s}: ${o}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const u={};for(const f of Object.keys(qr))u[f]=qr[f];for(const f of Object.keys(n))u[f]=n[f];const c=i.config;c.customObjects=u;const h=Object.assign({},qr);for(const f of Object.keys(n))qr[f]=n[f];m_(i.config);const d=l(a,i.config,n,r);return qr=Object.assign({},h),d}else{const u=Object.assign({},qr);for(const h of Object.keys(n))qr[h]=n[h];const c=new a(i.config);return qr=Object.assign({},u),c}}}function Wce(t,e){return t<e?-1:t>e?1:0}function D0(t,e){return-1*Wce(t,e)}function vl(t){if(t==null)return t;const e=[];for(const n of t)e.indexOf(n)===-1&&e.push(n);return e}function jce(t){if(t==null)throw new q(`Invalid value in obj: ${JSON.stringify(t)}`);for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}function Nc(t,e,n){if(n!=null&&t.indexOf(n)<0)throw new q(`${n} is not a valid ${e}.  Valid values are ${t} or null/undefined.`)}function n2(t,e,n=0,s=1/0){return so(n>=0),so(s>=n),Array.isArray(t)&&t.length>=n&&t.length<=s&&t.every(r=>typeof r===e)}function Gn(t,e){Array.isArray(t)?(O(t.length>0,()=>`${e} is unexpectedly an empty array.`),t.forEach((n,s)=>Gn(n,`element ${s+1} of ${e}`))):O(Number.isInteger(t)&&t>0,()=>`Expected ${e} to be a positive integer, but got ${xU(t)}.`)}function xU(t){return t===null?"null":Array.isArray(t)?"["+t.map(e=>xU(e)).join(",")+"]":typeof t=="string"?`"${t}"`:`${t}`}function Gce(t,e,n){let s=n!=null?n():ns(),r;return(...o)=>{const a=n!=null?n():ns();return a-s<e||(s=a,r=t(...o)),r}}function bU(t){return t==="relu"?"relu":t==="linear"?"linear":t==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Hce=0;function SU(){return Hce++}const O0={};function L1(t=""){return t in O0||(O0[t]=0),O0[t]+=1,t+O0[t].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const qce=["channelsFirst","channelsLast"],Kce=["nearest","bilinear"],Xce=["valid","same","causal"],Yce=["max","avg"],Qce=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Xc=new Map;function Sn(t){Nc(qce,"DataFormat",t)}function Jce(t){Nc(Kce,"InterpolationFormat",t)}function Wr(t){Nc(Xce,"PaddingMode",t)}function CU(t){Nc(Yce,"PoolMode",t)}const Bp=[],CP="/";function Ou(t,e){Bp.push(t);try{const n=e();return Bp.pop(),n}catch(n){throw Bp.pop(),n}}function Zce(){return Bp.length===0?"":Bp.join(CP)+CP}function IU(t){if(!TU(t))throw new Error("Not a valid tensor name: '"+t+"'");return Zce()+t}function _U(t){if(!TU(t))throw new Error("Not a valid tensor name: '"+t+"'");Xc.has(t)||Xc.set(t,0);const e=Xc.get(t);if(Xc.set(t,Xc.get(t)+1),e>0){const n=`${t}_${e}`;return Xc.set(n,1),n}else return t}const ehe=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function TU(t){return!!t.match(ehe)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function the(t){return t===parseInt(t.toString(),10)}function wl(t,e,n){e==null&&(e=0),n==null&&(n=t.length);let s=1;for(let r=e;r<n;++r)s*=t[r];return s}function Yh(t){if(t.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let n=0;n<t.length;n++){const s=t[n];s<e&&(e=s)}return e}function Dl(t){if(t.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let n=0;n<t.length;n++){const s=t[n];s>e&&(e=s)}return e}function Ui(t,e){if(e<t)throw new q(`end (${e}) < begin (${t}) is forbidden.`);const n=[];for(let s=t;s<e;++s)n.push(s);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let mC;function Pn(){return mC==null&&(mC=sE().epsilon()),mC}function Wi(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function wo(t,e){return ge(t,e)}function Ry(t,e=-1){const n=t.shape.slice();return e<0&&(e=n.length+e+1),n.splice(e,0,1),H(t,n)}function nhe(t,e){return J(()=>{if(t.shape.length!==2)throw new q(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);const n=Ry(t,1);return g_(n,[1,e,1])})}function she(t){const e=[wl(t.shape)];return H(t,e)}function rhe(t){if(t.rank<=1)throw new q(`batchFlatten requires a minimum rank of 2. Got rank: ${t.rank}.`);const e=[t.shape[0],wl(t.shape,1)];return H(t,e)}function Pu(t,e,n){return J(()=>{switch(t.rank){case 1:return Sy(t,e,n);case 2:return g1(t,[e,0],[n,t.shape[1]]);case 3:return Cy(t,[e,0,0],[n,t.shape[1],t.shape[2]]);case 4:return Kh(t,[e,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3]]);case 5:return lt(t,[e,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return lt(t,[e,0,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new q(`sliceAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}})}function gC(t,e,n){return J(()=>{switch(t.rank){case 1:return Sy(t,e,n);case 2:return g1(t,[0,e],[t.shape[0],n]);case 3:return Cy(t,[0,0,e],[t.shape[0],t.shape[1],n]);case 4:return Kh(t,[0,0,0,e],[t.shape[0],t.shape[1],t.shape[2],n]);default:throw new q(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function P0(t,e,n,s){return J(()=>{switch(t.rank){case 1:return Sy(t,e,n);case 2:switch(s){case 1:return Pu(t,e,n);case 2:return gC(t,e,n);default:throw new q(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return Pu(t,e,n);case 2:return Cy(t,[0,e,0],[t.shape[0],n,t.shape[2]]);case 3:return gC(t,e,n);default:throw new q(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return Pu(t,e,n);case 2:return Kh(t,[0,e,0,0],[t.shape[0],n,t.shape[2],t.shape[3]]);case 3:return Kh(t,[0,0,e,0],[t.shape[0],t.shape[1],n,t.shape[3]]);case 4:return gC(t,e,n);default:throw new q(`The axis is not within the rank of the tensor ${s}`)}default:throw new q(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function s2(t,e=-1){let n;return e<0&&(n=t[0].rank,n!==0?e=n:e=0),e===t[0].rank&&(e=-1),wn(t,e)}function IP(t,e){switch(t.rank){case 1:return IE([t,e]);case 2:return _E([t,e],0);case 3:return TE([t,e],0);case 4:return kE([t,e],0);default:throw new q(`concatAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}function g_(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new q(`The length of input n (${e.length}) does not match the number of dimensions in input x (${t.rank})`);return Ar(t,e)}function M1(t,e=0,n=1,s,r){return l1(t,e,n,s,r)}function xo(t,e,n,s){if(t.rank<2||e.rank<2)throw new Ke(`dot requires both inputs to be rank >= 2 but got x shape = ${t.shape} and y shape = ${e.shape}`);if(e.rank>=3){const r=t.shape.slice(-1)[0],i=e.shape.slice(-2)[0];if(r!==i)throw new Ke(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${t.shape} and  y shape = ${e.shape}`)}if(t.rank===2&&e.rank===2)return c_({a:t,b:e,transposeA:!1,transposeB:!1,bias:s?y_(t.rank,s,Wi()):null,activation:n});{const r=t.shape.slice(),i=r.pop();t=H(t,[-1,i]);const o=e.shape.slice(),a=o.pop(),l=o.pop(),u=[...o,a],c=Array.from({length:e.rank},(p,m)=>m===0?e.rank-2:m<=e.rank-2?m-1:m);e=H(ot(e,c),[l,-1]);const h=[...r,...u];return H(c_({a:t,b:e,transposeA:!1,transposeB:!1,bias:s?y_(t.rank,s,Wi()):null,activation:n}),h)}}function kU(t,e,n){return J(()=>(Array.isArray(e)?e=os(e,"int32"):e=ge(e,"int32"),mf(t,e,n)))}function Ay(t){return G(t,t)}function y_(t,e,n){const s=e.shape;if(e.rank!==1&&e.rank!==t)throw new q(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${t}`);if(t===5){if(n==="channelsFirst")return s.length===1?H(e,[1,s[0],1,1,1]):H(e,[1,s[3],s[0],s[1],s[2]]);if(n==="channelsLast")return s.length===1?H(e,[1,1,1,1,s[0]]):H(e,[1].concat(s))}else if(t===4){if(n==="channelsFirst")return s.length===1?H(e,[1,s[0],1,1]):H(e,[1,s[2],s[0],s[1]]);if(n==="channelsLast")return s.length===1?H(e,[1,1,1,s[0]]):H(e,[1].concat(s))}else if(t===3){if(n==="channelsFirst")return s.length===1?H(e,[1,s[0],1]):H(e,[1,s[1],s[0]]);if(n==="channelsLast")return s.length===1?H(e,[1,1,s[0]]):H(e,[1].concat(s))}else if(t<3)return e;throw new q(`Unsupported input rank by biasAdd: ${e.rank}`)}function Yi(t,e,n){return J(()=>(n==null&&(n=Wi()),Sn(n),he(t,y_(t.rank,e,n))))}function ihe(t,e=1){if(e!==1)throw new Ke(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return df(t)}function ohe(t){return J(()=>Re(t,he(Tn(t),1)))}function EU(t,e,n,s){return J(()=>mN(t,e,n,s))}function ahe(t){return J(()=>{const e=he(.5,G(.2,t));return Qs(e,0,1)})}function Dy(t,e,n=!1){return n?t():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const lhe=["fanIn","fanOut","fanAvg"],uhe=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function che(t){Nc(lhe,"FanMode",t)}function hhe(t){Nc(uhe,"Distribution",t)}class di extends Ec{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class r2 extends di{apply(e,n){return En(e,n)}}r2.className="Zeros";pe(r2);class z1 extends di{apply(e,n){return js(e,n)}}z1.className="Ones";pe(z1);class i2 extends di{constructor(e){if(super(),typeof e!="object")throw new q(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new q(`config must have value set but got ${e}`);this.value=e.value}apply(e,n){return J(()=>G(Le(this.value),js(e,n)))}getConfig(){return{value:this.value}}}i2.className="Constant";pe(i2);class o2 extends di{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,n){return Yl(e,this.minval,this.maxval,n,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}o2.className="RandomUniform";pe(o2);class a2 extends di{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Ke(`randomNormal does not support dType ${n}.`);return M1(e,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}a2.className="RandomNormal";pe(a2);class l2 extends di{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Ke(`truncatedNormal does not support dType ${n}.`);return x1(e,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}l2.className="TruncatedNormal";pe(l2);class u2 extends di{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,n){return J(()=>{if(e.length!==2||e[0]!==e[1])throw new q("Identity matrix initializer can only be used for 2D square matrices.");return G(this.gain,n1(e[0]))})}getConfig(){return{gain:this.gain}}}u2.className="Identity";pe(u2);function dhe(t,e="channelsLast"){let n,s;if(Sn(e),t.length===2)n=t[0],s=t[1];else if([3,4,5].indexOf(t.length)!==-1){if(e==="channelsFirst"){const r=wl(t,2);n=t[1]*r,s=t[0]*r}else if(e==="channelsLast"){const r=wl(t,0,t.length-2);n=t[t.length-2]*r,s=t[t.length-1]*r}}else{const r=wl(t);n=Math.sqrt(r),s=Math.sqrt(r)}return[n,s]}class Zs extends di{constructor(e){if(super(),e.scale<0)throw new q(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,che(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,hhe(this.distribution),this.seed=e.seed}apply(e,n){const s=dhe(e),r=s[0],i=s[1];let o=this.scale;if(this.mode==="fanIn"?o/=Math.max(1,r):this.mode==="fanOut"?o/=Math.max(1,i):o/=Math.max(1,(r+i)/2),this.distribution==="normal"){const a=Math.sqrt(o);if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Ke(`${this.getClassName()} does not support dType ${n}.`);return x1(e,0,a,n,this.seed)}else{const a=Math.sqrt(3*o);return Yl(e,-a,a,n,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Zs.className="VarianceScaling";pe(Zs);class B1 extends Zs{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Zs.className}}B1.className="GlorotUniform";pe(B1);class V1 extends Zs{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Zs.className}}V1.className="GlorotNormal";pe(V1);class U1 extends Zs{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Zs.className}}U1.className="HeNormal";pe(U1);class W1 extends Zs{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Zs.className}}W1.className="HeUniform";pe(W1);class j1 extends Zs{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Zs.className}}j1.className="LeCunNormal";pe(j1);class G1 extends Zs{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Zs.className}}G1.className="LeCunUniform";pe(G1);class c2 extends di{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,n){return J(()=>{if(e.length<2)throw new Ke("Shape must be at least 2D.");if(n!=="int32"&&n!=="float32"&&n!==void 0)throw new TypeError(`Unsupported data type ${n}.`);n=n;const s=re(e.slice(0,-1)),r=e[e.length-1],i=s*r;i>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${i}) elements: Slowness may result.`);const o=[Math.max(r,s),Math.min(r,s)],a=M1(o,0,1,n,this.seed),l=wN.qr(a,!1);let u=l[0];const h=l[1].flatten().stridedSlice([0],[Math.min(r,s)*Math.min(r,s)],[Math.min(r,s)+1]);return u=G(u,h.sign()),s<r&&(u=u.transpose()),G(Le(this.gain),u.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}c2.className="Orthogonal";pe(c2);const _P={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function TP(t,e={}){return $y(t,$r.getMap().classNameMap,e,"initializer")}function sn(t){return t2(t)}function Jt(t){if(typeof t=="string"){const e=t in _P?_P[t]:t;if(e==="GlorotNormal")return new V1;if(e==="GlorotUniform")return new B1;if(e==="HeNormal")return new U1;if(e==="HeUniform")return new W1;if(e==="LeCunNormal")return new j1;if(e==="LeCunUniform")return new G1;{const n={};return n.className=e,n.config={},TP(n)}}else return t instanceof di?t:TP(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function v_(t){return Array.isArray(t)&&Array.isArray(t[0])}function Rw(t){return t.length===0?[]:Array.isArray(t[0])?t:[t]}function Ve(t){let e;if(Array.isArray(t)){if(t.length!==1)throw new q(`Expected Tensor length to be 1; got ${t.length}`);e=t[0]}else e=t;return e}function yt(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(t.length===1)return t=t,t[0];throw new q(`Expected exactly 1 Shape; got ${t.length}`)}else return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Aw(t){let e=0;for(const n of t)n.shape.length===0?e+=1:e+=n.shape.reduce((s,r)=>s*r);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const kP="Variable";class NU{constructor(e,n="float32",s=kP,r=!0,i=null){this.dtype=n??"float32",this.shape=e.shape,this.id=SU(),s=s??kP,this.originalName=IU(s),this.name=_U(this.originalName),this.trainable_=r,this.constraint=i,this.val=fN(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),fhe(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function fhe(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}function w_(t){return t.map(e=>e.read())}function h2(t){t.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Nn{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class ji{constructor(e,n,s,r,i,o,a){this.dtype=e,this.shape=n,this.sourceLayer=s,this.inputs=r,this.callArgs=i,this.outputTensorIndex=a,this.id=SU(),o!=null&&(this.originalName=IU(o),this.name=_U(this.originalName)),this.rank=n.length}}let phe=0;class H1{constructor(e,n){this.callArgs=n,this.id=phe++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const s of e.inboundLayers)s!=null&&s.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const n of this.inboundLayers)n!=null?e.push(n.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let mhe=0;class et extends Ec{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=mhe++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let n=e.name;if(!n){const s=this.getClassName();n=Vo(s)+"_"+L1(s)}if(this.name=n,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let s;if(e.batchInputShape!=null)s=e.batchInputShape;else if(e.inputShape!=null){let i=null;e.batchSize!=null&&(i=e.batchSize),s=[i].concat(e.inputShape)}this.batchInputShape=s;let r=e.dtype;r==null&&(r=e.inputDType),r==null&&(r="float32"),this.dtype=r}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,n){return e.name+"_ib-"+n.toString()}getNodeAtIndex(e,n){if(this.inboundNodes.length===0)throw new ii(`The layer has never been called and thus has no defined ${n}.`);if(this.inboundNodes.length<=e)throw new q(`Asked to get ${n} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return Us(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return Us(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new no(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new no(`Layer ${this.name} is not connected, no input to return.`);return Us(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new no(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new no(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Us(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(n=>n.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const n=Tt(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=Tt(this.inputSpec);if(n.length!==s.length)throw new q(`Layer ${this.name} expects ${s.length} inputs, but it received ${n.length} input tensors. Input received: ${e}`);for(let r=0;r<n.length;r++){const i=n[r],o=s[r];if(o==null)continue;const a=i.rank;if(o.ndim!=null&&a!==o.ndim)throw new q(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${o.ndim}, found ndim=${a}`);if(o.maxNDim!=null&&a>o.maxNDim)throw new q(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${o.maxNDim}, found ndim=${a}`);if(o.minNDim!=null&&a<o.minNDim)throw new q(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${o.minNDim}, found ndim=${a}.`);if(o.dtype!=null&&i.dtype!==o.dtype)throw new q(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${o.dtype}, found dtype=${i.dtype}.`);if(o.axes){const l=i.shape;for(const u in o.axes){const c=Number(u),h=o.axes[u],d=c>=0?l[c]:l[l.length+c];if(h!=null&&[h,null].indexOf(d)===-1)throw new q(`Input ${r} is incompatible with layer ${this.name}: expected axis ${c} of input shape to have value ${h} but got shape ${l}.`)}}if(o.shape!=null)for(let l=0;l<o.shape.length;++l){const u=o.shape[l],c=i.shape[l];if(u!=null&&c!=null&&u!==c)throw new q(`Input ${r} is incompatible with layer ${this.name}: expected shape=${o.shape}, found shape=${i.shape}.`)}}}call(e,n){return e}invokeCallHook(e,n){this._callHook!=null&&this._callHook(e,n)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,n){n=n||{},this.assertNotDisposed();const s=Tt(e),r=vhe(e),i=whe(e);if(r===i)throw new q("Arguments to apply() must be all SymbolicTensors or all Tensors");return Ou(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const o=[];for(const a of Tt(e))o.push(a.shape);this.build(Us(o)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&i&&(this._refCount=1)}if(this.assertInputCompatibility(e),i){let o=this.call(e,n);this.supportsMasking&&this.setMaskMetadata(e,o);const a=Tt(o),l=[];for(let u of a)s.indexOf(u)!==-1&&(u=u.clone()),l.push(u);if(o=Us(l),this.activityRegularizer!=null)throw new Ke("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return o}else{const o=ghe(e),a=this.computeOutputShape(o);let l;const u=yhe(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?o[0]:o),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((c,h)=>new ji(u,c,this,Tt(e),n,this.name,h)):l=new ji(u,a,this,Tt(e),n,this.name),this.addInboundNode(e,l,null,null,o,a,n),this._refCount++,this.activityRegularizer!=null)throw new Ke("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let n=!1;this.batchInputShape.forEach((s,r)=>{s!=null&&e[r]!=null&&e[r]!==s&&(n=!0)}),n&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new no(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const n of this.inboundNodes){const s=JSON.stringify(n.outputShapes);e.indexOf(s)===-1&&e.push(s)}if(e.length===1){const n=this.inboundNodes[0].outputShapes;return Array.isArray(n)&&Array.isArray(n[0])&&n.length===1?n[0]:n}else throw new no(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new ii(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Aw(this.weights)}build(e){this.built=!0}getWeights(e=!1){return w_(e?this.trainableWeights:this.weights)}setWeights(e){J(()=>{const n=this.weights;if(n.length!==e.length)throw new q(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${n.length} weights. Provided weights: ${e}...`);if(n.length===0)return;const s=[],r=w_(n);for(let i=0;i<r.length;++i){const o=r[i],a=n[i],l=e[i];if(!st(o.shape,l.shape))throw new q(`Layer weight shape ${o.shape} not compatible with provided weight shape ${l.shape}`);s.push([a,l])}h2(s)})}addWeight(e,n,s,r,i,o,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new q(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(r=l!=null?l():Jt("zeros"));const u=r.apply(n,s),c=new NU(u,s,e,o,a);return u.dispose(),i!=null&&this.addLoss(()=>i.apply(c.read())),o==null&&(o=!0),o?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=Tt(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,n){if(!this.supportsMasking){if(n!=null)if(Array.isArray(n))n.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return n}setMaskMetadata(e,n,s){if(!this.supportsMasking)return;const r=this.computeMask(e,s),i=Tt(n),o=Tt(r);if(i.length!==o.length)throw new Error(`${this.name} outputs ${i.length} tensors but ${i.length} masks for those tensors`);for(let a=0;a<i.length;a++)i[a].kerasMask=o[a]}addInboundNode(e,n,s,r,i,o,a=null){const l=Tt(e);n=Tt(n),s=Tt(s),r=Tt(r),i=Rw(i),o=Rw(o);const u=[],c=[],h=[];for(const d of l)u.push(d.sourceLayer),c.push(d.nodeIndex),h.push(d.tensorIndex);new H1({outboundLayer:this,inboundLayers:u,nodeIndices:c,tensorIndices:h,inputTensors:l,outputTensors:n,inputMasks:s,outputMasks:r,inputShapes:i,outputShapes:o},a);for(let d=0;d<n.length;d++)n[d].sourceLayer=this,n[d].nodeIndex=this.inboundNodes.length-1,n[d].tensorIndex=d}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function ghe(t){t=Tt(t);const e=[];for(const n of t)e.push(n.shape);return Us(e)}function yhe(t){return"float32"}function $U(t,e,n){if((e==null||n!=null&&n>0)&&(e=t.sourceLayer,n=t.nodeIndex),e.inboundNodes.length===0)return[t];{const s=e.inboundNodes[n];if(s.inboundLayers.length===0)return s.inputTensors;{const r=[];for(let i=0;i<s.inboundLayers.length;i++){const o=s.inputTensors[i],a=s.inboundLayers[i],l=s.nodeIndices[i],u=$U(o,a,l);for(const c of u)r.indexOf(c)===-1&&r.push(c)}return r}}}function vhe(t){let e=!0;for(const n of Tt(t))if(!(n instanceof ji)){e=!1;break}return e}function whe(t){let e=!0;for(const n of Tt(t))if(n instanceof ji){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class yf extends et{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:L1("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new q("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let n=e.batchInputShape;if(n==null){if(e.inputShape==null)throw new q("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");n=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new q("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=e.dtype||"float32";this.batchInputShape=n,this.dtype=s,this.inputSpec=[{shape:n}];const r=new ji(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new H1({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[n],outputShapes:[n]})}apply(e,n){throw new q(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}yf.className="InputLayer";pe(yf);function RU(t){if(t.batchShape==null&&t.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(t.batchShape!=null&&t.shape!=null)throw new q("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=t.batchShape;t.shape!=null&&e==null&&(e=[null].concat(t.shape));let n=t.dtype;return n==null&&(n="float32"),new yf({batchInputShape:e,name:t.name,dtype:n,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xhe(t,e){if(t.dtype==null||t.dtype===e.dtype)return e;try{return ge(e,t.dtype)}catch{throw new q(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${t.name}' (${t.dtype}).`)}}class tl{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof tl)for(const n in e.id2Value)this.id2Value[n]=e.id2Value[n],n in e.id2Mask&&(this.id2Mask[n]=e.id2Mask[n]);else{if(e==null)return;for(const n of e)this.add(n.key,n.value)}}add(e,n,s){if(this.id2Value[e.id]==null)this.id2Value[e.id]=xhe(e,n),this.name2Id[e.name]=e.id,s!=null&&(this.id2Mask[e.id]=s);else throw new q(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof ji){if(this.id2Value[e.id]==null)throw new q(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const n=this.name2Id[e];if(n==null)throw new q(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[n]}}getMask(e){if(e instanceof ji){if(this.id2Value[e.id]==null)throw new q(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const n=this.name2Id[e];if(n==null)throw new q(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[n]}}disposeMasks(){this.id2Mask!=null&&je(this.id2Mask)}}const Dw=new wU,Ow=new wU;function bhe(t){Dw!=null&&Dw.setMaxEntries(t),Ow!=null&&Ow.setMaxEntries(t)}function gp(t,e,n,s){const r=n==null?!1:n.training,i=Array.isArray(t),o=i?t:[t],a=o.map(p=>p.name),l=[],u=e.names();for(const p of a)u.indexOf(p)!==-1?l.push(e.getValue(p)):l.push(null);const c=a.join(",")+"|"+e.names().sort().join(",");let h=Dw.get(c),d;if(h==null){const p=She(o,e);h=p.sorted,d=p.recipientCounts,Dw.put(c,h),Ow.put(c,d)}d={},r||Object.assign(d,Ow.get(c));const f=new tl(e);for(let p=0;p<h.length;++p){const m=h[p],v=m.sourceLayer;if(v instanceof yf)continue;const g=[],w=[],b=[];let x=!1;for(const _ of m.inputs){const k=f.getValue(_),A=f.getMask(_);g.push(k),w.push(A),A!=null&&(x=!0),r||(d[_.name]--,d[_.name]===0&&!e.hasKey(_)&&a.indexOf(_.name)===-1&&!k.isDisposed&&_.sourceLayer.stateful!==!0&&b.push(k))}x&&(n=n||{},n.mask=w[0]);const S=Tt(v.apply(g,n));let N=null;v.supportsMasking&&(N=v.computeMask(g,w));const I=Ihe(m),C=Array.isArray(I)?I:[I];for(let _=0;_<C.length;++_){f.hasKey(C[_])||f.add(C[_],S[_],Array.isArray(N)?N[0]:N);const k=a.indexOf(C[_].name);k!==-1&&(l[k]=S[_])}r||je(b)}return f.disposeMasks(),i?l:l[0]}function She(t,e){O(t!=null&&t.length>0,()=>"Expected at least one fetch, got none");let n=[],s={};if(t.length===1){const r=EP(t[0],e);n=r.sorted,s=r.recipientMap}else{const r=new Set;for(const i of t){const{sorted:o,recipientMap:a}=EP(i,e);for(const l of o)r.has(l.name)||(n.push(l),r.add(l.name));for(const l in a)s[l]==null&&(s[l]=new Set),a[l].forEach(u=>s[l].add(u))}}return{sorted:n,recipientCounts:Che(s)}}function Che(t){const e={};for(const n in t)e[n]=t[n].size;return e}function EP(t,e){const n=new Set,s=[],r={};for(const a of e.names())n.add(a);const i=[],o=[];for(i.push(t);i.length>0;){const a=i[i.length-1];if(n.has(a.name)){i.pop();continue}const l=o[o.length-1]===i.length-1;if(a.inputs.length===0||l)i.pop(),s.push(a),n.add(a.name),l&&o.pop();else{o.push(i.length-1);for(const u of a.inputs)r[u.name]==null&&(r[u.name]=new Set),r[u.name].add(a.name),!n.has(u.name)&&i.push(u)}}return{sorted:s,recipientMap:r}}function Ihe(t){let e;if(t.sourceLayer.inboundNodes.length===1)e=t.sourceLayer.output;else{let n=null;for(let s=0;s<t.sourceLayer.inboundNodes.length;++s)for(const r of t.sourceLayer.inboundNodes[s].outputTensors)if(r.id===t.id){n=s;break}e=t.sourceLayer.getOutputAt(n)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _he=Z();_he.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,bhe);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function d2(t,e){return J(()=>Kn(Te(G(t,t),e,!0)))}class Oy extends Ec{getConfig(){return{}}}class f2 extends Oy{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return J(()=>{const n=d2(e,this.axis),s=Qs(n,0,this.maxValue);return G(e,Re(s,he(Pn(),n)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}f2.className="MaxNorm";pe(f2);class p2 extends Oy{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return J(()=>Re(e,he(Pn(),d2(e,this.axis))))}getConfig(){return{axis:this.axis}}}p2.className="UnitNorm";pe(p2);class m2 extends Oy{apply(e){return Xi(e)}}m2.className="NonNeg";pe(m2);class g2 extends Oy{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return J(()=>{const n=d2(e,this.axis),s=he(G(this.rate,Qs(n,this.minValue,this.maxValue)),G(1-this.rate,n));return G(e,Re(s,he(Pn(),n)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}g2.className="MinMaxNorm";pe(g2);const NP={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Fn(t){return t2(t)}function $P(t,e={}){return $y(t,$r.getMap().classNameMap,e,"constraint")}function Ln(t){if(t==null)return null;if(typeof t=="string"){const n={className:t in NP?NP[t]:t,config:{}};return $P(n)}else return t instanceof Oy?t:$P(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function The(t){return new f2(t)}function khe(t){return new p2(t)}function Ehe(){return new m2}function Nhe(t){return new g2(t)}const $he=Object.freeze(Object.defineProperty({__proto__:null,maxNorm:The,minMaxNorm:Nhe,nonNeg:Ehe,unitNorm:khe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Rhe(){return new r2}function Ahe(){return new z1}function Dhe(t){return new i2(t)}function Ohe(t){return new o2(t)}function Phe(t){return new a2(t)}function Fhe(t){return new l2(t)}function Lhe(t){return new u2(t)}function Mhe(t){return new Zs(t)}function zhe(t){return new B1(t)}function Bhe(t){return new V1(t)}function Vhe(t){return new U1(t)}function Uhe(t){return new W1(t)}function Whe(t){return new j1(t)}function jhe(t){return new G1(t)}function Ghe(t){return new c2(t)}const Hhe=Object.freeze(Object.defineProperty({__proto__:null,constant:Dhe,glorotNormal:Bhe,glorotUniform:zhe,heNormal:Vhe,heUniform:Uhe,identity:Lhe,leCunNormal:Whe,leCunUniform:jhe,ones:Ahe,orthogonal:Ghe,randomNormal:Phe,randomUniform:Ohe,truncatedNormal:Fhe,varianceScaling:Mhe,zeros:Rhe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Ba(t){if(t==null)return;const e=[],n=[],s=[];for(const r in t){const i=t[r];if(typeof i!="number"){const o=i;e.push(o.data()),n.push(r),s.push(o)}}if(e.length>0){const r=await Promise.all(e);for(let i=0;i<r.length;++i)t[n[i]]=r[i][0];je(s)}}function AU(t){if(t!=null)for(const e in t){const n=t[e];typeof n!="number"&&n.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var RP;(function(t){t[t.SILENT=0]="SILENT",t[t.VERBOSE=1]="VERBOSE"})(RP||(RP={}));const qhe=125;class Qh{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,n){}async onEpochEnd(e,n){}async onBatchBegin(e,n){}async onBatchEnd(e,n){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class DU{constructor(e,n=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=n}append(e){this.callbacks.push(e)}setParams(e){for(const n of this.callbacks)n.setParams(e)}setModel(e){for(const n of this.callbacks)n.setModel(e)}async onEpochBegin(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onEpochBegin(e,n)}async onEpochEnd(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onEpochEnd(e,n)}async onBatchBegin(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onBatchBegin(e,n)}async onBatchEnd(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onBatchEnd(e,n)}async onTrainBegin(e){e==null&&(e={});for(const n of this.callbacks)await n.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const n of this.callbacks)await n.onTrainEnd(e)}}class Khe extends Qh{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,n){n==null&&(n={});const s=n.size==null?0:n.size;this.seen+=s;for(const r in n){const i=n[r];if(typeof i=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+i*s;else{let o;r in this.totals?o=this.totals[r]:this.totals[r]=0;const a=J(()=>he(this.totals[r],G(i,s)));this.totals[r]=a,o!=null&&o.dispose()}}}async onEpochEnd(e,n){if(n!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?n[s]=this.totals[s]/this.seen:J(()=>{const r=G(Re(1,this.seen),this.totals[s]);n[s]=r,this.totals[s].dispose(),On(n[s])}))}}class OU extends Qh{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,n){n==null&&(n={}),this.epoch.push(e);for(const s in n)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(n[s])}async syncData(){const e=[],n=[],s=[];for(const i in this.history){const o=this.history[i];for(let a=0;a<o.length;++a)if(typeof o[a]!="number"){const l=o[a];e.push(l.data()),n.push(i),s.push(a)}}const r=await Promise.all(e);for(let i=0;i<r.length;++i)this.history[n[i]][s[i]].dispose(),this.history[n[i]][s[i]]=r[i][0]}}class PU extends Qh{constructor(e,n){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||ON,this.yieldEvery=n||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=qhe),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");bw(this.yieldEvery)&&(this.maybeWait=Gce(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,n,s){const r=[];this.yield!=null&&(await Ba(s),r.push(this.yield(e,n,s))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,n){this.currentEpoch=e,this.epochBegin!=null&&(await Ba(n),await this.epochBegin(e,n))}async onEpochEnd(e,n){const s=[];this.epochEnd!=null&&(await Ba(n),s.push(this.epochEnd(e,n))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(e,n){this.batchBegin!=null&&(await Ba(n),await this.batchBegin(e,n))}async onBatchEnd(e,n){const s=[];this.batchEnd!=null&&(await Ba(n),s.push(this.batchEnd(e,n))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):bw(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,e,n)),await Promise.all(s)}async onTrainBegin(e){this.trainBegin!=null&&(await Ba(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await Ba(e),await this.trainEnd(e))}}function FU(t,e){return t==null&&(t={}),t instanceof Qh?[t]:Array.isArray(t)&&t[0]instanceof Qh?t:Tt(t).map(s=>new PU(s,e))}class _r{constructor(){}static registerCallbackConstructor(e,n){O(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),_r.checkForDuplicate(n),_r.constructors[e]==null&&(_r.constructors[e]=[]),_r.constructors[e].push(n)}static checkForDuplicate(e){for(const n in _r.constructors)_r.constructors[+n].forEach(r=>{if(r===e)throw new q("Duplicate callback constructor.")})}static clear(){_r.constructors={}}static createCallbacks(e){const n=[];for(const s in _r.constructors){const r=+s;e>=r&&n.push(..._r.constructors[r])}return n.map(s=>new s)}}_r.constructors={};function LU(t,e,n,s,r,i,o,a,l){const u=new OU,c=[new Khe,..._r.createCallbacks(e)];t!=null&&c.push(...t),c.push(u);const h=new DU(c);return h.setParams({epochs:n,initialEpoch:s,samples:r,steps:i,batchSize:o,verbose:e,doValidation:a,metrics:l}),{callbackList:h,history:u}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Li(t,e={},n=!1){return $y(t,$r.getMap().classNameMap,e,"layer",n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Pw(t,e){return J(()=>{t.dtype!=="float32"&&(t=ge(t,"float32"));const n=Te(Ay(t),e,!0),s=Ic(n.shape,Pn()),r=Kn(Eo(n,s));return Re(t,r)})}function $c(t,e){return J(()=>nn(Ay(_e(e,t)),-1))}function q1(t,e){return J(()=>nn(Tn(_e(e,t)),-1))}function vf(t,e){return J(()=>{const n=_e(t,e),s=Qs(Tn(t),Pn(),Number.MAX_VALUE),r=Tn(Re(n,s));return G(100,nn(r,-1))})}function Xhe(t,e){return J(()=>{const n=Qs(e,Pn(),Number.MAX_VALUE),s=vr(he(1,n)),r=Qs(t,Pn(),Number.MAX_VALUE),i=vr(he(1,r));return nn(Ay(_e(s,i)),-1)})}function Yhe(t,e){return J(()=>{const n=Eo(0,_e(1,G(t,e)));return nn(Ay(n),-1)})}function Qhe(t,e){return J(()=>{const n=Eo(0,_e(1,G(t,e)));return nn(n,-1)})}function Jhe(t,e){return J(()=>{const n=Te(G(t,e),-1),s=Lr(G(_e(1,t),e),-1);return Eo(0,he(1,_e(s,n)))})}function Zhe(t,e){return J(()=>{const n=Math.log(2),s=_e(e,t),r=_e(he(s,_c(G(-2,s))),n);return nn(r,-1)})}function $m(t,e,n=!1){return J(()=>{if(n)e=Iy(e);else{const s=Te(e,e.shape.length-1,!0);e=Re(e,s)}return e=Qs(e,Pn(),1-Pn()),Bt(Te(G(ge(t,"float32"),vr(e)),e.shape.length-1))})}function Fw(t,e,n=!1){return J(()=>{const s=ge(pf(she(t)),"int32");e=Qs(e,Pn(),1-Pn());const r=e.shape,i=H(Hh(s,r[r.length-1]),r);return $m(i,e,n)})}function ede(t,e){if(!st(t.shape,e.shape))throw new q(`logits and labels must have the same shape, but got shapes ${JSON.stringify(t.shape)} and ${JSON.stringify(e.shape)}`);return J(()=>{const n=Xi(e),s=Bt(Tn(e));return he(_e(n,G(e,t)),my(Js(s)))})}function K1(t,e){return J(()=>{let n;return n=Qs(e,Pn(),1-Pn()),n=vr(Re(n,_e(1,n))),nn(ede(t,n),-1)})}function tde(t,e){return J(()=>{const n=Qs(t,Pn(),1),s=Qs(e,Pn(),1);return Te(G(t,vr(Re(n,s))),-1)})}function nde(t,e){return J(()=>{const n=vr(he(Pn(),e));return nn(_e(e,G(t,n)),-1)})}function y2(t,e){return J(()=>{const n=Pw(t,-1),s=Pw(e,-1),r=G(n,s);return Bt(Te(r,-1))})}const Lw={meanSquaredError:$c,meanAbsoluteError:q1,meanAbsolutePercentageError:vf,meanSquaredLogarithmicError:Xhe,squaredHinge:Yhe,hinge:Qhe,categoricalHinge:Jhe,logcosh:Zhe,categoricalCrossentropy:$m,sparseCategoricalCrossentropy:Fw,binaryCrossentropy:K1,kullbackLeiblerDivergence:tde,poisson:nde,cosineProximity:y2};function yC(t){if(typeof t=="string"){if(t in Lw)return Lw[t];let e=`Unknown loss ${t}`;throw t.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${t}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new q(e)}else return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function v2(t,e){return J(()=>{const n=G(.5,wr(e)),s=wo(Ms(e,n),t.dtype);return nn(yr(t,s),-1)})}function w2(t,e){return J(()=>wo(yr(Qu(t,-1),Qu(e,-1)),"float32"))}function MU(t,e){return J(()=>ge(Te(ci(yr(t,1),yr(e,1))),"float32"))}function sde(t,e){return J(()=>ge(Te(ci(yr(t,1),yr(e,0))),"float32"))}function rde(t,e){return J(()=>ge(Te(ci(yr(t,0),yr(e,1))),"float32"))}function zU(t,e){return J(()=>{const n=MU(t,e),s=rde(t,e),r=he(n,s);return ge(Hn(Ms(r,0),Re(n,r),0),"float32")})}function ide(t,e){return J(()=>{const n=MU(t,e),s=sde(t,e),r=he(n,s);return ge(Hn(Ms(r,0),Re(n,r),0),"float32")})}function BU(t,e){return K1(t,e)}function VU(t,e){return t.rank===e.rank&&(t=Ql(t,[t.rank-1])),e=Qu(e,-1),e.dtype!==t.dtype&&(e=ge(e,t.dtype)),ge(yr(t,e),"float32")}function ode(t,e){return J(()=>{const n=t.sub(e).square().sum(),s=t.sub(t.mean()).square().sum();return Le(1).sub(n.div(s))})}const ade=$c,lde=$c,ude=q1,cde=q1,hde=vf,dde=vf,x2=$m,fde=y2,UU=Fw,Mw={binaryAccuracy:v2,categoricalAccuracy:w2,precision:zU,categoricalCrossentropy:x2,sparseCategoricalCrossentropy:UU,mse:ade,MSE:lde,mae:ude,MAE:cde,mape:hde,MAPE:dde,cosine:fde};function pde(t){if(typeof t=="string"&&t in Mw)return Mw[t];if(typeof t!="string"&&t!=null)return t;throw new q(`Unknown metric ${t}`)}function F0(t){if(so(t!==null,`Unknown LossOrMetricFn ${t}`),typeof t=="string")return t;{let e;for(const n of Object.keys(Lw))if(Lw[n]===t){e=n;break}if(e!==void 0)return e;for(const n of Object.keys(Mw))if(Mw[n]===t){e=n;break}return e!==void 0?e:t.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function mde(t){const e={Adagrad:()=>fu.adagrad(.01),Adadelta:()=>fu.adadelta(1,.95,Pn()),Adam:()=>fu.adam(.001,.9,.999,Pn()),Adamax:()=>fu.adamax(.002,.9,.999,Pn(),0),RMSProp:()=>fu.rmsprop(.001,.9,0,Pn()),SGD:()=>fu.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,t in e)return e[t]();throw new q(`Unknown Optimizer ${t}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const AP=1*1024*1024;function DP(t,e,n=!1){if(t==null||typeof t!="object"||Object.getPrototypeOf(t)!==Object.prototype||!x_(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const s=JSON.stringify(t);s.length>AP&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${AP}.`)}}function x_(t){if(t===null)return!0;if(typeof t=="object")if(Object.getPrototypeOf(t)===Object.prototype){const e=Object.keys(t);for(const n of e)if(typeof n!="string"||!x_(t[n]))return!1;return!0}else if(Array.isArray(t)){for(const e of t)if(!x_(e))return!1;return!0}else return!1;else{const e=typeof t;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function gde(t,e,n,s=console.log){const r=vde(t),i=["Layer (type)","Input Shape","Output shape","Param #"];r?(e=e||90,n=n||[.32,.61,.89,1]):(e=e||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map(c=>Math.floor(e*c)));let o;if(!r){i.push("Receives inputs"),o=[];for(const c in t.nodesByDepth)o.push(...t.nodesByDepth[c])}s("_".repeat(e)),zw(i,n,s),s("=".repeat(e));const a=t.layers;for(let c=0;c<a.length;++c)r?wde(a[c],n,s):xde(a[c],n,o,s),s((c===a.length-1?"=":"_").repeat(e));t.checkTrainableWeightsConsistency();const l=yde(t),u=Aw(t.nonTrainableWeights);s(`Total params: ${l+u}`),s(`Trainable params: ${l}`),s(`Non-trainable params: ${u}`),s("_".repeat(e))}function yde(t){let e;return t.collectedTrainableWeights!=null?e=Aw(t.collectedTrainableWeights):e=Aw(t.trainableWeights),e}function vde(t){let e=!0;const n=[],s=[];for(const r in t.nodesByDepth)n.push(t.nodesByDepth[r]);for(const r of n){if(r.length>1||r.length===1&&r[0].inboundLayers.length>1){e=!1;break}s.push(...r)}if(e)for(const r of t.layers){let i=!1;for(const o of r.inboundNodes)if(s.indexOf(o)!==-1)if(i){e=!1;break}else i=!0;if(!e)break}return e}function zw(t,e,n=console.log){let s="";for(let r=0;r<t.length;++r)r>0&&(s=s.slice(0,s.length-1)+" "),s+=t[r],s=s.slice(0,e[r]),s+=" ".repeat(e[r]-s.length);n(s)}function wde(t,e,n){let s,r;try{r=t.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{r="multiple"}try{s=JSON.stringify(t.outputShape)}catch{s="multiple"}const i=t.name,o=t.getClassName(),a=[`${i} (${o})`,r,s,t.countParams().toString()];zw(a,e,n)}function xde(t,e,n,s){let r,i;try{i=t.inboundNodes.map(h=>JSON.stringify(h.inputShapes)).join(",")}catch{i="multiple"}try{r=JSON.stringify(t.outputShape)}catch{r="multiple"}const o=[];for(const h of t.inboundNodes)if(!(n!=null&&n.length>0&&n.indexOf(h)===-1))for(let d=0;d<h.inboundLayers.length;++d){const f=h.inboundLayers[d].name,p=h.nodeIndices[d],m=h.tensorIndices[d];o.push(`${f}[${p}][${m}]`)}const a=t.name,l=t.getClassName(),u=o.length===0?"":o[0],c=[`${a} (${l})`,i,r,t.countParams().toString(),u];zw(c,e,s);for(let h=1;h<o.length;++h)zw(["","","","",o[h]],e,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function WU(t,e,n){return(t==="inboundNodes"||t==="outputLayers"||t==="inputLayers")&&e===0&&typeof n=="string"}function Rm(t,e){if(t===null)return null;if(typeof t=="string")return yu(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){const n=[],s=t.length;for(let r=0;r<s;++r){const i=t[r];WU(e,r,i)?n.push(i):n.push(Rm(i,e))}return n}else{const n={};for(const s of Object.keys(t)){const r=t[s];if(s==="name"&&typeof r=="string")n[s]=r;else{const i=yu(s);n[i]=Rm(r,i)}}return n}}function b_(t,e){if(t==null)return null;if(typeof t=="string")return Vo(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){const n=[],s=t.length;for(let r=0;r<s;++r){const i=t[r];WU(e,r,i)?n.push(i):n.push(b_(i,e))}return n}else{const n={};for(const s of Object.keys(t)){const r=t[s],i=Vo(s);(s==="name"||s==="className")&&typeof r=="string"?n[i]=r:n[i]=b_(r,s)}return n}}/** @license See the LICENSE file. */const X1="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const bde=t=>{const e=Object.keys(t);if(e.length===0)return!1;const n=e[0].split("/");return!isNaN(parseInt(n[n.length-1],10))};class vi extends et{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const w=this.getClassName().toLowerCase();this.name=L1(w)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],vl(this.inputs).length!==this.inputs.length)throw new q(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(w=>w.name)}`);vl(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(w=>w.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const w of this.outputs){const b=w.sourceLayer,x=w.nodeIndex,S=w.tensorIndex;this.outputLayers.push(b),this.outputLayersNodeIndices.push(x),this.outputLayersTensorIndices.push(S)}for(const w of this.inputs){const b=w.sourceLayer,x=w.nodeIndex,S=w.tensorIndex;so(x===0,"input layer has >1 nodes"),so(S===0,"input layer has >1 tensors"),this.inputLayers.push(b),this.inputLayersNodeIndices.push(x),this.inputLayersTensorIndices.push(S)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let w=0;w<this.inputLayers.length;w++){const b=this.inputLayers[w];if(!(b instanceof yf))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${w} (0-based) originates from layer type ${b.getClassName()}.`);this.inputNames.push(b.name),this.feedInputShapes.push(b.batchInputShape),this.feedInputNames.push(b.name)}for(const w of this.outputLayers)this.outputNames.push(w.name);this.internalInputShapes=this.inputs.map(w=>w.shape),this.internalOutputShapes=this.outputs.map(w=>w.shape);const n={},s={},r={},i={},o={},a=[],l=(w,b,x,S,N,I)=>{(S==null||N==null||I==null)&&(S=w.sourceLayer,N=w.nodeIndex,I=w.tensorIndex);const C=S.inboundNodes[N];if(x.indexOf(C)!==-1)throw new ii(`The tensor ${w.name} at layer "${S.name}" is part of a cycle.`);if(b.indexOf(C)!==-1)return;this.containerNodes.add(vi.nodeKey(S,N)),S.id in o||(o[S.id]=Object.keys(o).length),x.indexOf(C)===-1&&x.push(C);const _=C.inboundLayers.length;for(let k=0;k<_;k++){const A=C.inputTensors[k],D=C.inboundLayers[k],R=C.nodeIndices[k],W=C.tensorIndices[k];l(A,b,x,D,R,W)}for(b.push(C);x.indexOf(C)>=0;)x.splice(x.indexOf(C),1);a.push(C)},u=[],c=[];for(const w of this.outputs)l(w,u,c);const h=a.slice().reverse();for(const w of h){s[w.id]=w,w.id in n||(n[w.id]=0);let b=n[w.id];const x=r[w.outboundLayer.id]==null?0:r[w.outboundLayer.id];b=Math.max(b,x),r[w.outboundLayer.id]=b,i[w.outboundLayer.id]=w.outboundLayer,n[w.id]=b;for(let S=0;S<w.inboundLayers.length;S++){const N=w.inboundLayers[S],I=w.nodeIndices[S],C=N.inboundNodes[I],_=n[C.id]==null?0:n[C.id];n[C.id]=Math.max(b+1,_),s[C.id]=C}}const d={};for(const w in n){const b=n[w];b in d||(d[b]=[]),d[b].push(s[w])}const f={};for(const w in r){const b=r[w];b in f||(f[b]=[]),f[b].push(i[w])}let p=Object.keys(f).map(w=>parseInt(w,10)).sort(D0);this.layers=[];for(const w of p){const b=f[w];b.sort((x,S)=>{const N=o[x.id],I=o[S.id];return N<I?-1:N>I?1:0});for(const x of b)x instanceof vi&&this.internalContainerRefs.push(x),this.layers.push(x)}this.layersByDepth=f,p=Object.keys(d).map(w=>parseInt(w,10)).sort(D0);const m=this.inputs.slice(),v=[];for(const w of p)for(const b of d[w]){const x=b.outboundLayer;if(x!=null){for(const S of b.inputTensors)if(m.indexOf(S)===-1)throw new ii(`Graph disconnected: cannot obtain value for tensor ${S} at layer "${x.name}". The following previous layers were accessed without issue: ${v}`);for(const S of b.outputTensors)m.push(S);v.push(x.name)}}this.nodesByDepth=d;const g=this.layers.map(w=>w.name);for(const w of g){const b=g.filter(x=>x===w).length;if(b!==1)throw new ii(`The name "${w}" is used ${b} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(g))}this.outboundNodes=[],this.inboundNodes=[],new H1({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(w=>null),outputMasks:this.outputs.map(w=>null),inputShapes:this.inputs.map(w=>w.shape),outputShapes:this.outputs.map(w=>w.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const n of this.layers)e.numDisposedVariables+=n.dispose().numDisposedVariables;for(const n of this.internalContainerRefs)e.numDisposedVariables+=n.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(n=>{n._trainableWeights.forEach(s=>s.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new q("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const n of this.layers)e=e.concat(n.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const n of this.layers)e.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const s of this.layers)n.push(...s.trainableWeights);return n.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,n=!0){const s={};let r=0;const i=bde(e);i&&this.parseWeights(e);for(const a of this.layers)for(const[l,u]of a.weights.entries()){const c=i?`${u.name.split("/").slice(0,-1).join("/")+"/"}${l}`:u.originalName;if(s[c]!=null)throw new q(`Duplicate weight name: ${c}`);s[c]=u,r++}const o=[];for(const a in e){let l=a;if(s[a]==null){const u=a.split("/");l=u.slice(0,-2).concat([u[u.length-1]]).join("/")}if(s[l]!=null)o.push([s[l],e[a]]);else if(n)throw new q(`Provided weight data has no target variable: ${a}`);delete s[l]}if(n){const a=[];for(const l in s)a.push(l);if(a.length>0)throw new q(`${a.length} of ${r} weights are not set: ${a}`)}h2(o)}parseWeights(e){for(const n in Object.keys(e)){const s=n.split("/"),r=["vars","layer_checkpoint_dependencies"],i=s.map(o=>o.startsWith("_")?o.slice(1):o).filter(o=>!r.includes(o)).join("/");i!==n&&(e[i]=e[n],delete e[n])}}updatedConfig(){const e=this.getConfig(),n={};return n.className=this.getClassName(),n.config=e,n.kerasVersion=`tfjs-layers ${X1}`,n.backend="TensorFlow.js",n}toJSON(e,n=!0){const s=b_(this.updatedConfig());return n?JSON.stringify(s):s}call(e,n){return J(()=>{e=Tt(e);const s=new tl;for(let r=0;r<this.inputs.length;++r)s.add(this.inputs[r],e[r]);return gp(this.outputs,s,n)})}computeMask(e,n){return J(()=>{e=Tt(e);let s;return n==null?s=sc(null,e.length):s=Tt(n),this.runInternalGraph(e,s)[1]})}computeOutputShape(e){const n=Rw(e);if(n.length!==this.inputLayers.length)throw new q(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let a=0;a<n.length;a++){const l=this.inputLayers[a],u=n[a],c=l.name+"_0_0";s[c]=u}const r=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(D0);if(r.length>1)for(const a of r){const l=this.nodesByDepth[a];for(const u of l){const c=u.outboundLayer;if(this.inputLayers.map(m=>m.id).indexOf(c.id)!==-1)continue;const h=[];for(let m=0;m<u.inboundLayers.length;m++){const v=u.inboundLayers[m],g=u.nodeIndices[m],w=u.tensorIndices[m],b=`${v.name}_${g}_${w}`,x=s[b];h.push(x)}const d=c.computeOutputShape(Us(h)),f=Rw(d),p=c.inboundNodes.indexOf(u);for(let m=0;m<f.length;m++){const v=`${c.name}_${p}_${m}`;s[v]=f[m]}}}const i=[],o=[];for(let a=0;a<this.outputLayers.length;a++){const l=this.outputLayers[a],u=this.outputLayersNodeIndices[a],c=this.outputLayersTensorIndices[a],h=`${l.name}_${u}_${c}`;o.push(h)}for(let a=0;a<o.length;a++){const l=o[a];so(l in s),i.push(s[l])}return Us(i)}runInternalGraph(e,n){n==null&&(n=sc(null,e.length));const s={};for(let l=0;l<this.inputs.length;++l){const u=this.inputs[l],c=e[l],h=n[l];s[u.id]=[c,h]}const r=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(D0);for(const l of r){const u=this.nodesByDepth[l];for(const c of u){const h=c.outboundLayer,d=c.inputTensors,f=c.outputTensors,p=new Array;for(const m of d)m.id in s&&p.push(s[m.id]);if(p.length===d.length){let m={},v,g,w,b;if(c.callArgs!=null&&(m=c.callArgs),p.length===1){const[x,S]=p[0];m.mask==null&&(m.mask=S),w=Tt(h.call(x,m)),b=Tt(h.computeMask(x,S)),v=[x],g=[S]}else v=p.map(x=>x[0]),g=p.map(x=>x[1]),m.mask==null&&(m.mask=g),w=Tt(h.call(v,m)),b=Tt(h.computeMask(v,g));if(h.activityRegularizer)throw new Ke("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let x=0;x<f.length;++x){const S=f[x],N=w[x],I=b[x];s[S.id]=[N,I]}}}}const i=[],o=[],a=[];for(const l of this.outputs){so(l.id in s,`Could not compute output ${l.name} : ${l.id}`);const[u,c]=s[l.id];a.push(u.shape),i.push(u),o.push(c)}return[i,o,a]}buildNodeConversionMap(e){const n={};let s;for(const r of this.layers){s=r instanceof vi?1:0;for(let i=0;i<r.inboundNodes.length;i++){const o=vi.nodeKey(r,i);this.containerNodes.has(o)&&(n[o]=s,s+=1)}}return n}getLayer(e,n){if(n!=null)return this.findLayer(n);if(e==null)throw new q("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const s of this.layers)if(s.name===e)return s;throw new q(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new q(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return J(()=>{const e=[];for(const n of this.layers)for(let s=0;s<n.inboundNodes.length;++s){const r=vi.nodeKey(n,s);this.containerNodes.has(r)&&e.push(...n.calculateLosses())}return e})}getConfig(){const e={name:this.name},n=this.buildNodeConversionMap(this.layers),s=[];for(const o of this.layers){const a=o.getClassName(),l=o.getConfig(),u=[];for(let h=0;h<o.inboundNodes.length;h++){const d=o.inboundNodes[h],f=vi.nodeKey(o,h);let p={};if(this.containerNodes.has(f)){if(d.callArgs)try{JSON.stringify(d.callArgs),p=d.callArgs}catch{console.warn(`Layer ${o.name} was passed non-serializable keyword arguments: ${d.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),p={}}if(d.inboundLayers.length>0){const m=[];for(let v=0;v<d.inboundLayers.length;v++){const g=d.inboundLayers[v],w=d.nodeIndices[v],b=d.tensorIndices[v],x=vi.nodeKey(g,w);let S=n[x];S==null&&(S=0),m.push([g.name,S,b,p])}u.push(m)}}}const c={};c.name=o.name,c.className=a,c.config=l,c.inboundNodes=u,s.push(c)}e.layers=s;const r=[];for(let o=0;o<this.inputLayers.length;o++){const a=this.inputLayers[o],l=this.inputLayersNodeIndices[o],u=vi.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let c=n[u];c==null&&(c=0);const h=this.inputLayersTensorIndices[o];r.push([a.name,c,h])}e.inputLayers=r;const i=[];for(let o=0;o<this.outputLayers.length;o++){const a=this.outputLayers[o],l=this.outputLayersNodeIndices[o],u=vi.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let c=n[u];c==null&&(c=0);const h=this.outputLayersTensorIndices[o];i.push([a.name,c,h])}return e.outputLayers=i,e}static fromConfig(e,n,s={},r=!1){const i={},o={};function a(v,g){v.name in o?o[v.name].push(g):o[v.name]=[g]}function l(v,g){const w=[];let b;for(const x of g){const S=x[0],N=x[1],I=x[2];if(b=x[3]==null?{}:x[3],!(S in i)){a(v,g);return}const C=i[S];if(C.inboundNodes.length<=N){a(v,g);return}const _=C.inboundNodes[N];w.push(_.outputTensors[I])}w.length>0&&v.apply(Us(w),b)}function u(v){const g=v.name,w=Li(v,n.customObjects!=null?n.customObjects:{});w.setFastWeightInitDuringBuild(r),i[g]=w,v.inboundNodes.forEach(x=>{if(!(x instanceof Array))throw new q(`Corrupted configuration, expected array for nodeData: ${x}`);a(w,x)})}const c=n.name,h=n.layers;for(const v of h)u(v);for(;!jce(o);)for(const v of h){const g=i[v.name];if(g.name in o){const w=o[g.name];delete o[g.name];for(const b of w)l(g,b)}}const d=[],f=[],p=n.inputLayers;for(const v of p){const g=v[0],w=v[1],b=v[2];so(g in i);const S=i[g].inboundNodes[w].outputTensors;d.push(S[b])}const m=n.outputLayers;for(const v of m){const g=v[0],w=v[1],b=v[2];so(g in i);const S=i[g].inboundNodes[w].outputTensors;f.push(S[b])}return new e({inputs:d,outputs:f,name:c})}get stateful(){if(this._stateful)throw new q("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){J(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Sde(t,e,n){const s=e.length;if(t==null||Array.isArray(t)&&t.length===0)return e.map(r=>null);if(s===1)return Array.isArray(t)&&t.length===1?t:typeof t=="object"&&e[0]in t?[t[e[0]]]:[t];if(Array.isArray(t)){if(t.length!==s)throw new Error(`Provided ${n} is an array of ${t.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return t}else if(typeof t=="object"&&Object.keys(t).length>0&&typeof t[Object.keys(t)[0]]=="object"){const r=[];return e.forEach(i=>{i in t?r.push(t[i]):r.push(null)}),r}else throw new Error(`The model has multiple (${s}) outputs, so ${n} must be either an array with ${s} elements or an object with ${e} keys. Provided ${n} not understood: ${JSON.stringify(t)}`)}function jU(t,e){return Sde(t,e,"classWeight")}async function GU(t,e,n,s){if(n!=null){const r=J(()=>{if(t.shape.length===1)return yo(t);if(t.shape.length===2){if(t.shape[1]>1)return Qu(t,1);if(t.shape[1]===1)return H(t,[t.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${t.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${t.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),i=Array.from(await r.data());je(r);const o=[];return i.forEach(a=>{if(n[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);o.push(n[a])}),os(o,"float32")}else return null}function Cde(t,e){return G(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Ide=32;function HU(t,e){let n,s;const r=e;n=r.xs,s=r.ys,O(n!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const i=OP("input",t.inputNames,n),o=OP("output",t.outputNames,s),a=i[0].shape[0];O(i.length===t.inputs.length,()=>`LayersModel has ${t.inputs.length} inputs, but the dataset provides ${i.length} inputs.  (Expected input keys: ${JSON.stringify(t.inputNames)})`),O(o.length===t.outputs.length,()=>`LayersModel has ${t.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(t.outputNames)})`);for(let l=0;l<i.length;l++)O(i[l].shape[0]===a,()=>`Batch size mismatch: input ${t.inputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);for(let l=0;l<o.length;l++)O(o[l].shape[0]===a,()=>`Batch size mismatch: output ${t.outputNames[l]} has ${o[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);return{xs:i,ys:o}}function OP(t,e,n){if(n instanceof pt)return[n];if(Array.isArray(n))return O(n.length===e.length,()=>`Received an array of ${n.length} Tensors, but expected ${e.length} to match the ${t} keys ${e}.`),n;{const s=[];for(const r of e){if(n[r]==null)throw new q(`The feature data generated by the dataset lacks the required ${t} key '${r}'.`);s.push(n[r])}return s}}function _de(t){if(t.length===3)throw new Ke("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}async function Tde(t,e,n){const s=n.batchesPerEpoch!=null;if(O(t.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),O(n!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),O(n.epochs!=null&&n.epochs>0&&Number.isInteger(n.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`),O(!s||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`),O(n.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;try{const r=n.validationData!=null;let i,o;if(r)if(PP(n.validationData))O(n.validationBatches==null||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`);else{const v=_de(n.validationData);i=v.xs,o=v.ys}const a=t.makeTrainFunction(),l=t.getDedupedMetricsNames();let u;r?u=l.slice().concat(l.map(v=>"val_"+v)):u=l.slice();const c=FU(n.callbacks,n.yieldEvery),h=n.verbose==null?1:n.verbose,{callbackList:d,history:f}=LU(c,h,n.epochs,null,null,kde(e,n),null,r,u);d.setModel(t),t.history=f,await d.onTrainBegin(),t.stopTraining_=!1;let p=n.initialEpoch==null?0:n.initialEpoch,m=await e.iterator();for(;p<n.epochs;){const v={};await d.onEpochBegin(p);let g=0,w=0;for(s||(m=await e.iterator());!s||g<n.batchesPerEpoch;){const b=await m.next();if(s&&b.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${g} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${n.batchesPerEpoch*n.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(b.value!=null){const{xs:x,ys:S}=HU(t,b.value),N={};N.batch=w,N.size=x[0].shape[0],await d.onBatchBegin(w,N);const I=[];if(n.classWeight!=null){const k=jU(n.classWeight,t.outputNames);for(let A=0;A<k.length;++A)I.push(await GU(S[A],null,k[A]))}const C=x.concat(S).concat(I),_=a(C);je(C);for(let k=0;k<l.length;++k){const A=l[k],D=_[k];N[A]=D,On(D)}await d.onBatchEnd(w,N),AU(N),w++,g++}if(s?g>=n.batchesPerEpoch:b.done){if(r){let x;PP(n.validationData)?x=Tt(await t.evaluateDataset(n.validationData,{batches:n.validationBatches})):x=Tt(t.evaluate(i,o,{batchSize:n.validationBatchSize==null?Ide:n.validationBatchSize,verbose:0}));for(let S=0;S<t.metricsNames.length;++S)v[`val_${t.metricsNames[S]}`]=x[S]}break}if(t.stopTraining_)break}if(await d.onEpochEnd(p,v),p++,t.stopTraining_)break}return await d.onTrainEnd(),await t.history.syncData(),t.history}finally{t.isTraining=!1}}function kde(t,e){let n=null;return e.batchesPerEpoch!=null?n=e.batchesPerEpoch:Number.isFinite(t.size)&&(n=t.size),n}function PP(t){return typeof t.iterator=="function"}function Ede(t){return typeof t.next=="function"}async function Nde(t,e,n){n=n||{};const s=n.batches!=null,r=t.testFunction;let i=[];if(n.verbose>0)throw new Ke("Verbose mode is not implemented yet.");O(!s||n.batches>0&&Number.isInteger(n.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`);const o=Ede(e)?e:await e.iterator();let a=0,l=0;for(;!s||l<n.batches;){const u=await o.next();if(i=J(()=>{if(u.value){const{xs:c,ys:h}=HU(t,u.value),d=c.concat(h),f=J(()=>r(d));if(je(d),l===0)for(let m=0;m<f.length;++m)i.push(Le(0));const p=d[0].shape[0];for(let m=0;m<f.length;++m){const v=f[m],g=i[m];i[m]=J(()=>he(i[m],G(p,v))),l>0&&je(g)}je(f),a+=p,++l}return i}),u.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let u=0;u<i.length;++u){const c=i[u];i[u]=Re(i[u],a),je(c)}return Us(i)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function vC(t){O(t>0&&Number.isInteger(t),()=>`batchSize is required to be a positive integer, but got ${t}`)}function sp(t,e,n){return t==null?[null]:Array.isArray(t)?t.map(s=>Pu(s,e,n-e)):Pu(t,e,n-e)}function S_(t,e){return J(()=>t==null?null:Array.isArray(t)?t.map(n=>S_(n,e)):kU(t,e.dtype==="int32"?e:ge(e,"int32")))}function wC(t,e){const n=[];let s=0,r=null;for(;s<t;)r=s+e,r>=t&&(r=t),n.push([s,r]),s=r;return n}function qU(t){const e=[];t instanceof pt&&(t=[t]);for(let n=0;n<t.length;++n){const s=t[n];if(s.rank===1)e.push(Ry(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(s)}}return e}function yi(t,e){if(t==null)return;const n=[];if(e instanceof pt)n.push(e.id);else if(Array.isArray(e))e.forEach(r=>n.push(r.id));else if(e!=null)for(const r in e){const i=e[r];n.push(i.id)}const s=[];if(t instanceof pt)n.indexOf(t.id)===-1&&s.push(t);else if(Array.isArray(t))t.forEach(r=>{n.indexOf(r.id)===-1&&s.push(r)});else if(t!=null)for(const r in t){const i=t[r];n.indexOf(i.id)===-1&&s.push(i)}s.forEach(r=>{r.isDisposed||r.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function $de(t){return t instanceof pt}function C_(t){return Array.isArray(t)}function FP(t){return!$de(t)&&!C_(t)}function LP(t,e,n,s=!0,r=""){if(e==null||e.length===0){if(t!=null){let o=!1;if(C_(t)&&t.length>0)o=!0;else if(FP(t)){for(const a in t)if(t.hasOwnProperty(a)){o=!0;break}}else o=!0;if(o)throw new q(`Error when checking model ${r} expected no data, but got ${t}`)}return[]}if(t==null)return e.map(o=>null);let i;if(FP(t)){t=t,i=[];for(const o of e){if(t[o]==null)throw new q(`No data provided for "${o}". Need data for each key in: ${e}`);i.push(t[o])}}else if(C_(t)){if(t=t,t.length!==e.length)throw new q(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${t}`);i=t}else{if(t=t,e.length>1)throw new q(`The model ${r} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${t.shape}`);i=[t]}if(i=qU(i),n!=null)for(let o=0;o<e.length;++o){if(n[o]==null)continue;const a=i[o];if(a.shape.length!==n[o].length)throw new q(`Error when checking ${r}: expected ${e[o]} to have ${n[o].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<n[o].length;++l){if(l===0&&!s)continue;const u=a.shape[l],c=n[o][l];if(c!=null&&c>=0&&u!==c)throw new q(`${r} expected a batch of elements where each example has shape [${n[o].slice(1,n[o].length)}] (i.e.,tensor shape [*,${n[o].slice(1,n[o].length)}]) but the ${r} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return i}function Rde(t,e,n){const s=vl(t.map(i=>i.shape[0]));s.sort();const r=vl(e.map(i=>i.shape[0]));if(r.sort(),s.length>1)throw new q(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(i=>i.shape))}`);if(r.length>1)throw new q(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(i=>i.shape))}`);if(s.length>0&&r.length>0&&!st(s,r))throw new q(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${r[0]} target sample(s).`)}function Ade(t,e,n){const s=[$c,K1,$m];for(let r=0;r<t.length;++r){const i=t[r],o=e[r],a=n[r];if(o!=null){if(o===$m&&i.shape[i.shape.length-1]===1)throw new q(`You are passing a target array of shape ${i.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(o)!==-1){const l=i.shape.slice(1),u=a.slice(1);for(let c=0;c<l.length;++c){const h=l[c],d=u[c];if(d!=null&&h!==d)throw new q(`A target Tensor with shape ${i.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function MP(t,e,n,s=!0,r=""){let i;if(Array.isArray(t)){if(t.length!==e.length)throw new q(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${t.length} Tensors(s).`);i=t}else{if(e.length>1)throw new q(`The model expects ${e.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(t.shape)}.`);i=[t]}if(n!=null)for(let o=0;o<e.length;++o){if(n[o]==null)continue;const a=i[o];if(a.shape.length!==n[o].length)throw new q(`Error when checking ${r}: expected ${e[o]} to have ${n[o].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<n[o].length;++l){if(l===0&&!s)continue;const u=a.shape[l],c=n[o][l];if(c!=null&&c!==u)throw new q(`Error when checking ${r}: expected ${e[o]} to have shape ${JSON.stringify(n[o])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function Dde(t,e){if(t==null||Array.isArray(t)&&t.length===0)return e.map(s=>[]);let n;if(typeof t=="string"||typeof t=="function")n=[t];else if(Array.isArray(t)||typeof t=="object")n=t;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${t}`);if(Array.isArray(n))return e.map(s=>n);{const s=[];for(const r of e){let i=n.hasOwnProperty(r)?n[r]:[];Array.isArray(i)||(i=[i]),s.push(i)}return s}}const Ode="layers-model";class ta extends vi{constructor(e){super(e),this.isTraining=!1}summary(e,n,s=console.log){if(!this.built)throw new q("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");gde(this,e,n,s)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=mde(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Ta))throw new q("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let n=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const o in e.loss)if(this.outputNames.indexOf(o)===-1)throw new q(`Unknown entry in loss dictionary: "${o}". Only expected the following keys: ${this.outputNames}`);for(const o of this.outputNames)e.loss[o]==null&&console.warn(`Output "${o}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${o} during training`),n.push(yC(e.loss[o]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new q(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);n=e.loss.map(a=>yC(a))}else{const o=yC(e.loss);this.outputs.forEach(a=>{n.push(o)})}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let o=0;o<this.outputs.length;++o){const a=this.internalOutputShapes[o],l=this.outputNames[o];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[o])}const s=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Ou("loss",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=this.lossFunctions[o];this.outputs.length>1&&(this.metricsTensors.push([a,o]),this.metricsNames.push(this.outputNames[o]+"_loss"))}});const r=Dde(e.metrics,this.outputNames),i=(o,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[o]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,o])};Ou("metric",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=r[o];(u=>{const c="";let h,d,f;for(const p of u){if(typeof p=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(p)!==-1){const v=this.internalOutputShapes[o];v[v.length-1]===1||this.lossFunctions[o]===K1?["accuracy","acc"].indexOf(p)!==-1?d=v2:["crossentropy","ce"].indexOf(p)!==-1&&(d=BU):this.lossFunctions[o]===Fw?["accuracy","acc"].indexOf(p)!==-1?d=VU:["crossentropy","ce"].indexOf(p)!==-1&&(d=UU):["accuracy","acc"].indexOf(p)!==-1?d=w2:["crossentropy","ce"].indexOf(p)!==-1&&(d=x2);let g;["accuracy","acc"].indexOf(p)!==-1?g="acc":["crossentropy","ce"].indexOf(p)!==-1&&(g="ce"),f=d,h=c+g}else f=pde(p),h=c+F0(p);let m;Ou(h,()=>{m=f}),i(o,h,m)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,n,s={}){const r=s.batchSize==null?32:s.batchSize;vC(r);const o=this.standardizeUserDataXY(e,n,!0,r);try{const a=o[0].concat(o[1]);this.makeTestFunction();const l=this.testFunction,u=this.testLoop(l,a,r,s.verbose,s.steps);return Us(u)}finally{yi(o[0],e),yi(o[1],n)}}async evaluateDataset(e,n){return this.makeTestFunction(),Nde(this,e,n)}checkNumSamples(e,n,s,r="steps"){let i;if(s!=null){if(i=null,n!=null)throw new q(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${n}`)}else if(e!=null)Array.isArray(e)?i=e[0].shape[0]:i=e.shape[0];else throw new q(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return i}execute(e,n){if(Array.isArray(n)&&n.length===0)throw new q("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(n),r=s?n:[n],i=this.retrieveSymbolicTensors(r),o=new tl;if(e instanceof pt&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new q(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)o.add(this.inputs[l],e[l])}else for(const l of this.inputs){const u=e[l.name];if(u==null)throw new q(`No value is provided for the model's input ${l.name}`);o.add(l,u)}const a=gp(i,o);return s?a:a[0]}retrieveSymbolicTensors(e){const n=sc(null,e.length);let s=e.length;for(const r of this.layers){const i=Array.isArray(r.output)?r.output:[r.output],o=i.map(a=>a.name);for(let a=0;a<e.length;++a){const l=o.indexOf(e[a]);if(l!==-1&&(n[a]=i[l],s--),s===0)break}if(s===0)break}if(s>0){const r=[];throw n.forEach((i,o)=>{i==null&&r.push(e[o])}),new q(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return n}predictLoop(e,n=32,s=!1){return J(()=>{const r=this.checkNumSamples(e);if(s)throw new Ke("Verbose predictLoop() is not implemented yet.");const i=wC(r,n),o=this.outputs.map(a=>[]);for(let a=0;a<i.length;++a)J(()=>{const u=i[a][0],c=i[a][1],h=sp(e,u,c),d=[];if(Array.isArray(h))for(let p=0;p<h.length;++p)d.push({key:this.inputs[p],value:h[p]});else d.push({key:this.inputs[0],value:h});const f=new tl(d);return gp(this.outputs,f)}).forEach((u,c)=>o[c].push(u));return Us(o.map(a=>wn(a,0)))})}predict(e,n={}){const s=qU(e);MP(s,this.inputNames,this.feedInputShapes,!1);try{const r=n.batchSize==null?32:n.batchSize;return vC(r),this.predictLoop(s,r)}finally{yi(s,e)}}predictOnBatch(e){MP(e,this.inputNames,this.feedInputShapes,!0);const n=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,n)}standardizeUserDataXY(e,n,s=!0,r){if(this.optimizer_==null)throw new ii("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const i=[];for(let o=0;o<this.feedOutputShapes.length;++o){const a=this.feedOutputShapes[o];this.feedLossFns[o]===Fw?i.push(a.slice(0,a.length-1).concat([1])):i.push(a)}if(e=LP(e,this.feedInputNames,this.feedInputShapes,!1,"input"),n=LP(n,this.feedOutputNames,i,!1,"target"),Rde(e,n),Ade(n,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&e[0].shape[0]%r!==0)throw new q(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,n]}async standardizeUserData(e,n,s,r,i=!0,o){const[a,l]=this.standardizeUserDataXY(e,n,i,o);if(s!=null)throw new Error("sample weight is not supported yet.");let u=null;if(r!=null){const c=jU(r,this.outputNames);u=[];for(let h=0;h<c.length;++h)u.push(await GU(l[h],null,c[h]))}return[a,l,u]}testLoop(e,n,s,r=0,i){return J(()=>{const o=this.checkNumSamples(n,s,i,"steps"),a=[];if(r>0)throw new Ke("Verbose mode is not implemented yet.");if(i!=null)throw new Ke("steps mode in testLoop() is not implemented yet");{const l=wC(o,s),u=os(Ui(0,o));for(let c=0;c<l.length;++c){const h=l[c][0],d=l[c][1],f=Pu(u,h,d-h),p=S_(n,f),m=e(p);if(c===0)for(let v=0;v<m.length;++v)a.push(Le(0));for(let v=0;v<m.length;++v){const g=m[v];a[v]=he(a[v],G(d-h,g))}}for(let c=0;c<a.length;++c)a[c]=Re(a[c],o)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,n=[];for(let s=0;s<e.length;++s){const r=e[s];let i=r;if(SP(e,r)>1){const o=SP(e.slice(0,s),r);i+=`_${o}`}n.push(i)}return n}makeTrainFunction(){return e=>{const n=[],s=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),o=[],a=()=>{const h=[];for(let m=0;m<this.inputs.length;++m)h.push({key:this.inputs[m],value:s[m]});const d=new tl(h),f=gp(this.outputs,d,{training:!0});let p;for(let m=0;m<this.lossFunctions.length;++m){const v=this.lossFunctions[m];let g=v(r[m],f[m]);i[m]!=null&&(g=Cde(g,i[m]));const w=nn(g);n.push(w),m===0?p=g:p=he(p,g)}for(let m=0;m<this.metricsTensors.length;++m){let v;if(this.outputs.length>1&&m<this.outputs.length)v=n[m];else{const g=this.metricsTensors[m][0],w=this.metricsTensors[m][1];v=nn(g(r[w],f[w]))}On(v),o.push(v)}return p=nn(p),this.calculateLosses().forEach(m=>{p=he(p,m)}),p},l=this.collectedTrainableWeights.map(h=>h.read());return[this.optimizer_.minimize(a,!0,l)].concat(o)}}makeTestFunction(){this.testFunction=e=>J(()=>{const n=[];let s;const r=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=[];for(let u=0;u<this.inputs.length;++u)o.push({key:this.inputs[u],value:r[u]});const a=new tl(o),l=gp(this.outputs,a);for(let u=0;u<this.lossFunctions.length;++u){const c=this.lossFunctions[u],h=nn(c(i[u],l[u]));u===0?s=h:s=he(s,h),n.push(s)}for(let u=0;u<this.metricsTensors.length;++u){const c=this.metricsTensors[u][0],h=this.metricsTensors[u][1],d=nn(c(i[h],l[h]));n.push(d)}return n})}async fit(e,n,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,i,o,a,l,u,c,h,d;try{const f=s.batchSize==null?32:s.batchSize;vC(f);const m=await this.standardizeUserData(e,n,s.sampleWeight,s.classWeight,!1,f);r=m[0],i=m[1],d=m[2];let v=!1,g;if(s.validationData!=null&&s.validationData.length>0){if(v=!0,s.validationData.length===2)l=s.validationData[0],u=s.validationData[1];else throw s.validationData.length===3?new Ke("validationData including sample weights is not supported yet."):new q(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const k=await this.standardizeUserData(l,u,null,null,!0,f);c=k[0],h=k[1],g=c.concat(h)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){v=!0;const _=Math.floor(r[0].shape[0]*(1-s.validationSplit)),k=r[0].shape[0];c=sp(r,_,k),o=r,r=sp(r,0,_),h=sp(i,_,k),a=i,i=sp(i,0,_),g=c.concat(h)}else s.validationSteps!=null&&(v=!0);const w=r.concat(i).concat(d);this.checkTrainableWeightsConsistency();const b=this.makeTrainFunction(),x=this.getDedupedMetricsNames();let S,N;v?(this.makeTestFunction(),S=this.testFunction,N=x.slice().concat(x.map(_=>"val_"+_))):(S=null,g=[],N=x.slice());const I=FU(s.callbacks,s.yieldEvery);return await this.fitLoop(b,w,x,f,s.epochs,s.verbose,I,S,g,s.shuffle,N,s.initialEpoch,null,null)}finally{this.isTraining=!1,yi(r,e),yi(i,n),yi(o,e),yi(a,n),yi(c,l),yi(h,u),d!=null&&je(d)}}async fitLoop(e,n,s,r,i,o,a,l,u,c,h,d,f,p){r==null&&(r=32),i==null&&(i=1),c==null&&(c=!0),d==null&&(d=0);let m=!1;if(l!=null&&u!=null&&(m=!0),p!=null&&(m=!0,f==null))throw new q("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const v=this.checkNumSamples(n,r,f,"steps_per_epoch");let g;v!=null&&(g=Ui(0,v)),o==null&&(o=1);const{callbackList:w,history:b}=LU(a,o,i,d,v,f,r,m,h);w.setModel(this),this.history=b,await w.onTrainBegin(),this.stopTraining_=!1;for(let x=d;x<i;++x){await w.onEpochBegin(x);const S={};if(f!=null)throw new Ke("stepsPerEpoch mode is not implemented yet.");{if(c==="batch")throw new Ke("batch shuffling is not implemneted yet");c&&Gk(g);const N=os(g),I=wC(v,r);for(let C=0;C<I.length;++C){const _={};if(await w.onBatchBegin(C,_),J(()=>{const k=I[C][0],A=I[C][1],D=Pu(N,k,A-k);_.batch=C,_.size=A-k;const R=S_(n,D),W=e(R);for(let B=0;B<s.length;++B){const M=s[B],X=W[B];_[M]=X,On(X)}if(C===I.length-1&&m){const B=this.testLoop(l,u,r);for(let M=0;M<s.length;++M){const X=s[M],z=B[M];On(z),S["val_"+X]=z}}}),await w.onBatchEnd(C,_),AU(_),this.stopTraining_)break}N.dispose()}if(await w.onEpochEnd(x,S),this.stopTraining_)break}return await w.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,n){return Tde(this,e,n)}async trainOnBatch(e,n){const s=await this.standardizeUserData(e,n),r=s[0],i=s[1],a=this.makeTrainFunction()(r.concat(i)),l=[];for(const u of a){const c=await u.data();l.push(c[0])}return je(a),yi(s[0],e),yi(s[1],n),Us(l)}getNamedWeights(e){const n=[],s=e!=null&&e.trainableOnly,r=s?this.trainableWeights:this.weights,i=this.getWeights(s);for(let o=0;o<r.length;++o)s&&!r[o].trainable||n.push({name:r[o].originalName,tensor:i[o]});return n}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const n=s_().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=n-s_().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=Vo(this.loss);else if(Array.isArray(this.loss)){for(const n of this.loss)if(typeof n!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(n=>Vo(n))}else{const n=Object.keys(this.loss);e={};const s=this.loss;for(const r of n)if(typeof s[r]=="string")e[r]=Vo(s[r]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Vo(F0(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>Vo(F0(e)));{const e={};for(const n in this.metrics)e[n]=Vo(F0(this.metrics[n]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const n=Rm(e.optimizer_config),s=Li(n);let r;if(typeof e.loss=="string")r=yu(e.loss);else if(Array.isArray(e.loss))r=e.loss.map(o=>yu(o));else if(e.loss!=null){r={};for(const o in e.loss)r[o]=yu(e.loss[o])}let i;if(Array.isArray(e.metrics))i=e.metrics.map(o=>yu(o));else if(e.metrics!=null){i={};for(const o in e.metrics)i[o]=yu(e.metrics[o])}this.compile({loss:r,metrics:i,optimizer:s})}async save(e,n){if(typeof e=="string"){const u=hB(e);if(u.length===0)throw new q(`Cannot find any save handlers for URL '${e}'`);if(u.length>1)throw new q(`Found more than one (${u.length}) save handlers for URL '${e}'`);e=u[0]}if(e.save==null)throw new q("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await r_(this.getNamedWeights(n)),a={modelTopology:this.toJSON(null,!1),format:Ode,generatedBy:`TensorFlow.js tfjs-layers v${X1}`,convertedBy:null};if((n==null?!1:n.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const u="optimizer",{data:c,specs:h}=await r_(await this.optimizer.getWeights(),u);s.specs.push(...h),s.data=uB([s.data,c])}return this.userDefinedMetadata!=null&&(DP(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=s.data,a.weightSpecs=s.specs,e.save(a)}setUserDefinedMetadata(e){DP(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}ta.className="Model";pe(ta);class KU extends ta{}KU.className="Functional";pe(KU);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Pde(t,e){"modelTopology"in t||(t={modelTopology:t}),t=t;let n=t.modelTopology;n.model_config!=null&&(n=n.model_config);const s=Rm(n),r=Li(s,e);if(t.weightsManifest!=null){const i=await kV(t.weightsManifest,t.pathPrefix,r.weights.map(a=>a.originalName)),o={};for(const a of r.weights)o[a.originalName]=i[a.originalName];r.loadWeights(o),je(i)}return r}async function Fde(t,e){if(e==null&&(e={}),typeof t=="string"){const n=dB(t,e);if(n.length===0)n.push($V(t,e));else if(n.length>1)throw new q(`Found more than one (${n.length}) load handlers for URL '${t}'`);t=n[0]}return Lde(t,void 0,e)}async function Lde(t,e,n){if(n==null&&(n={}),t.load==null)throw new q("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const s=await t.load();let r=s.modelTopology;r.model_config!=null&&(r=r.model_config);const i=n.strict==null?!0:n.strict,o=s.weightData!=null&&s.weightSpecs!=null&&i,a=Li(Rm(r),e,o),l=s.trainingConfig;if(l!=null&&a.loadTrainingConfig(l),s.userDefinedMetadata!=null&&a.setUserDefinedMetadata(s.userDefinedMetadata),s.weightData!=null){if(s.weightSpecs==null)throw new q("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:u,optimizerWeights:c}=Mde(s.weightData,s.weightSpecs);a.loadWeights(u,i),a.optimizer!=null&&c.length>0&&await a.optimizer.setWeights(c),je(u),je(c.map(h=>h.tensor))}return a}function Mde(t,e){const n=rE(t,e),s={},r=[];return e.forEach(i=>{i.group==="optimizer"?r.push({name:i.name,tensor:n[i.name]}):s[i.name]=n[i.name]}),{modelWeights:s,optimizerWeights:r}}class rc extends ta{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:L1("sequential_"),e.layers!=null)for(const n of e.layers)this.add(n)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new q(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const n=e instanceof rc||e instanceof ta;let s;if(n){if(s=e,s.outputs.length!==1)throw new q("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new q("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new q("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const r=RU({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(r)}if(n)this.outputs=s.outputs,this.inputs=s.inputs;else{if(e.inboundNodes.length!==1)throw new q(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new q("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=$U(this.outputs[0])}this.inboundNodes=[],new H1({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:sc(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(r=>r.shape),outputShapes:this.outputs[0].shape})}else{const r=e.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,n){return this.model==null&&this.build(),this.model.call(e,n)}build(e){if(yt(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new ta({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,n,s=console.log){this.built||this.build(),super.summary(e,n,s)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,n,s={}){if(!this.built)throw new ii("The model needs to be compiled before being used.");return this.model.evaluate(e,n,s)}async evaluateDataset(e,n){if(!this.built)throw new ii("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,n)}predict(e,n={}){return this.model==null&&this.build(),this.model.predict(e,n)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,n,s={}){if(!this.built)throw new ii("The model needs to be compiled before being used.");return this.model.fit(e,n,s)}async fitDataset(e,n){if(!this.built)throw new ii("The model needs to be compiled before being used.");return this.model.fitDataset(e,n)}async trainOnBatch(e,n){return this.model.trainOnBatch(e,n)}static fromConfig(e,n,s={},r=!1){let i,o={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new q("Legacy serialization format not supported yet.");i=n}else O(n.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),i=n.layers,delete n.layers,o=n;const a=new e(o);if(!(a instanceof rc))throw new Ke(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const l of i){const c=Li(l,void 0,r);r&&c.setFastWeightInitDuringBuild(!0),a.add(c)}return a}set stopTraining(e){if(this.model==null)throw new q("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new q("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const n of this.layers){const s={};s.className=n.getClassName(),s.config=n.getConfig(),e.push(s)}return{name:this.name,layers:e}}}rc.className="Sequential";pe(rc);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function zde(t){return new ta(t)}function Bde(t){return new rc(t)}function XU(t){return RU(t)}function Vde(t,e){_r.registerCallbackConstructor(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Cs=class extends Ec{getConfig(){return{}}};class YU extends Cs{apply(e,n=1){return ihe(e,n)}}YU.className="elu";pe(YU);class QU extends Cs{apply(e){return d1(e)}}QU.className="selu";pe(QU);class JU extends Cs{apply(e){return Xi(e)}}JU.className="relu";pe(JU);class ZU extends Cs{apply(e){return J(()=>Al(6,Xi(e)))}}ZU.className="relu6";pe(ZU);class eW extends Cs{apply(e){return e}}eW.className="linear";pe(eW);class tW extends Cs{apply(e){return Fi(e)}}tW.className="sigmoid";pe(tW);class nW extends Cs{apply(e){return ahe(e)}}nW.className="hardSigmoid";pe(nW);class sW extends Cs{apply(e){return _c(e)}}sW.className="softplus";pe(sW);class rW extends Cs{apply(e){return ohe(e)}}rW.className="softsign";pe(rW);class iW extends Cs{apply(e){return Rl(e)}}iW.className="tanh";pe(iW);let b2=class extends Cs{apply(e,n=-1){return Iy(e,n)}};b2.className="softmax";pe(b2);class oW extends Cs{apply(e,n=-1){return r1(e,n)}}oW.className="logSoftmax";pe(oW);class aW extends Cs{apply(e){return J(()=>J(()=>{const n=Math.sqrt(2),s=G(.5,he(1,t1(Re(e,n))));return G(e,s)}))}}aW.className="gelu";pe(aW);class lW extends Cs{apply(e){return J(()=>G(.5,G(e,he(1,Rl(G(Kn(Re(2,Math.PI)),he(e,G(.044715,Co(e,3)))))))))}}lW.className="gelu_new";pe(lW);class uW extends Cs{apply(e){return J(()=>G(e,Rl(_c(e))))}}uW.className="mish";pe(uW);class cW extends Cs{apply(e,n=1){return J(()=>G(Fi(G(e,n)),e))}}cW.className="swish";pe(cW);function Ol(t){return t.getClassName()}function xC(t,e={}){return $y(t,$r.getMap().classNameMap,e,"activation")}function Pl(t){if(t==null){const e={};return e.className="linear",e.config={},xC(e)}if(typeof t=="string"){const e={};return e.className=t,e.config={},xC(e)}else return t instanceof Cs?t:xC(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function S2(t){if(t!=null&&typeof t!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${t}`)}class hW extends Ec{}class Py extends hW{constructor(e){super(),S2(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return J(()=>{let n=En([1]);return this.hasL1&&(n=he(n,Te(G(this.l1,Tn(e))))),this.hasL2&&(n=he(n,Te(G(this.l2,Ay(e))))),H(n,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,n){return new e({l1:n.l1,l2:n.l2})}}Py.className="L1L2";pe(Py);function Ude(t){return S2(t),new Py({l1:t!=null?t.l1:null,l2:0})}function Wde(t){return S2(t),new Py({l2:t!=null?t.l2:null,l1:0})}const zP={l1l2:"L1L2"};function Pt(t){return t2(t)}function BP(t,e={}){return $y(t,$r.getMap().classNameMap,e,"regularizer")}function Zt(t){if(t==null)return null;if(typeof t=="string"){const n={className:t in zP?zP[t]:t,config:{}};return BP(n)}else return t instanceof hW?t:BP(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class C2 extends et{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,n){e=Ve(e);let s=Xi(e);return this.maxValue!=null&&(s=Qs(s,0,this.maxValue)),s}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},n=super.getConfig();return Object.assign(e,n),e}}C2.className="ReLU";pe(C2);class I2 extends et{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,n){const s=Ve(e);return py(s,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},n=super.getConfig();return Object.assign(e,n),e}}I2.className="LeakyReLU";pe(I2);class _2 extends et{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=Jt(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Zt(e.alphaRegularizer),this.alphaConstraint=Ln(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new q(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=yt(e);const n=e.slice(1);if(this.sharedAxes!=null)for(const r of this.sharedAxes)n[r-1]=1;this.alpha=this.addWeight("alpha",n,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let r=1;r<e.length;++r)s[r]=e[r];this.inputSpec=[new Nn({ndim:e.length,axes:s})],this.built=!0}call(e,n){return e=Ve(e),by(e,this.alpha.read())}getConfig(){const e={alphaInitializer:sn(this.alphaInitializer),alphaRegularizer:Pt(this.alphaRegularizer),alphaConstraint:Fn(this.alphaConstraint),sharedAxes:this.sharedAxes},n=super.getConfig();return Object.assign(e,n),e}}_2.className="PReLU";pe(_2);let T2=class extends et{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new Ke(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,n){const s=Ve(e);return df(s)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},n=super.getConfig();return Object.assign(e,n),e}};T2.className="ELU";pe(T2);class k2 extends et{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,n){const s=Ve(e);return G(s,ge(Ms(s,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},n=super.getConfig();return Object.assign(e,n),e}}k2.className="ThresholdedReLU";pe(k2);class E2 extends et{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new b2().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,n){return J(()=>{let s=Ve(e);const r=n.mask;if(r!=null){const i=G(_e(js(s.shape),ge(r,s.dtype)),Le(-1e9));s=he(s,i)}return this.axis instanceof Array?this.axis.length>1?Js(_e(s,gy(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},n=super.getConfig();return Object.assign(e,n),e}}E2.className="Softmax";pe(E2);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Eh(t,e,n){if(typeof t=="number")return sc(t,e);if(t.length!==e)throw new q(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${t.length} elements.`);for(let s=0;s<e;++s){const r=t[s];if(!the(r))throw new q(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(t)} including a non-integer number ${r}`)}return t}function Mi(t,e,n,s,r=1){if(t==null)return t;const i=e+(e-1)*(r-1);let o;return n==="same"?o=t:o=t-i+1,Math.floor((o+s-1)/s)}function ro(t,e,n,s){if(t==null)return null;if(s==="valid")t=t*e+Dl([n-e,0]);else if(s==="same")t=t*e;else throw new q(`Unsupport padding mode: ${s}.`);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function N2(t,e){return J(()=>(Sn(e),e==="channelsFirst"?ot(t,[0,2,3,1]):t))}function dW(t,e){return J(()=>(Sn(e),e==="channelsFirst"?ot(t,[0,2,3,4,1]):t))}function jde(t,e,n,s=1,r="valid",i,o=1){return J(()=>{if(i==null&&(i=Wi()),Sn(i),t.shape.length!==3)throw new q(`The input of a conv1dWithBias operation should be 3, but is ${t.shape.length} instead.`);if(e.shape.length!==3)throw new q(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(n!=null&&n.shape.length!==1)throw new q(`The bias for a conv1dWithBias operation should be 1, but is ${n.shape.length} instead`);if(i==="channelsFirst"&&(t=ot(t,[0,2,1])),r==="causal")throw new Ke("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=Qb(t,e,s,r==="same"?"same":"valid","NWC",o);return n!=null&&(a=Yi(a,n)),a})}function VP(t,e,n,s=[1,1],r="valid",i,o,a=null){return J(()=>{if(i==null&&(i=Wi()),Sn(i),t.rank!==3&&t.rank!==4)throw new q(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${t.rank}.`);if(e.rank!==3&&e.rank!==4)throw new q(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${t.rank}.`);let l=N2(t,i);if(r==="causal")throw new Ke("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=fV({x:l,filter:e,strides:s,pad:r==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:a}),i==="channelsFirst"&&(l=ot(l,[0,3,1,2])),l})}function Gde(t,e,n,s=[1,1,1],r="valid",i,o){return J(()=>{if(i==null&&(i=Wi()),Sn(i),t.rank!==4&&t.rank!==5)throw new q(`conv3dWithBias expects input to be of rank 4 or 5, but received ${t.rank}.`);if(e.rank!==4&&e.rank!==5)throw new q(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${t.rank}.`);let a=dW(t,i);if(r==="causal")throw new Ke("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=NE(a,e,s,r==="same"?"same":"valid","NDHWC",o),n!=null&&(a=Yi(a,n)),i==="channelsFirst"&&(a=ot(a,[0,4,1,2,3])),a})}class Y1 extends et{constructor(e,n){if(super(n),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",Y1.verifyArgs(n),this.rank=e,Gn(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new Ke(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Eh(n.kernelSize,e,"kernelSize"),this.strides=Eh(n.strides==null?1:n.strides,e,"strides"),this.padding=n.padding==null?"valid":n.padding,Wr(this.padding),this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Sn(this.dataFormat),this.activation=Pl(n.activation),this.useBias=n.useBias==null?!0:n.useBias,this.biasInitializer=Jt(n.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Ln(n.biasConstraint),this.biasRegularizer=Zt(n.biasRegularizer),this.activityRegularizer=Zt(n.activityRegularizer),this.dilationRate=Eh(n.dilationRate==null?1:n.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new q(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new q(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new q(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(so("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!n2(e.kernelSize,"number",1,3))throw new q(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Ol(this.activation),useBias:this.useBias,biasInitializer:sn(this.biasInitializer),biasRegularizer:Pt(this.biasRegularizer),activityRegularizer:Pt(this.activityRegularizer),biasConstraint:Fn(this.biasConstraint)},n=super.getConfig();return Object.assign(e,n),e}}class wf extends Y1{constructor(e,n){super(e,n),this.kernel=null,wf.verifyArgs(n),this.filters=n.filters,Gn(this.filters,"filters"),this.kernelInitializer=Jt(n.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Ln(n.kernelConstraint),this.kernelRegularizer=Zt(n.kernelRegularizer)}build(e){e=yt(e);const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new q(`The channel dimension of the input should be defined. Found ${e[n]}`);const s=e[n],r=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[n]:s}}],this.built=!0}call(e,n){return J(()=>{e=Ve(e);let s;const r=this.bias==null?null:this.bias.read(),i=bU(this.activation.getClassName());if(i!=null&&this.rank===2)s=VP(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(this.rank===1)s=jde(e,this.kernel.read(),r,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=VP(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=Gde(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new Ke("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(e){e=yt(e);const n=[],s=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let i=0;i<s.length;++i){const o=Mi(s[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);n.push(o)}let r=[e[0]];return this.dataFormat==="channelsLast"?(r=r.concat(n),r.push(this.filters)):(r.push(this.filters),r=r.concat(n)),r}getConfig(){const e={filters:this.filters,kernelInitializer:sn(this.kernelInitializer),kernelRegularizer:Pt(this.kernelRegularizer),kernelConstraint:Fn(this.kernelConstraint)},n=super.getConfig();return Object.assign(e,n),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new q(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class xf extends wf{constructor(e){super(2,e),xf.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!n2(e.kernelSize,"number",1,2))throw new q(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}xf.className="Conv2D";pe(xf);class bf extends wf{constructor(e){super(3,e),bf.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new q(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}bf.className="Conv3D";pe(bf);class $2 extends xf{constructor(e){if(super(e),this.inputSpec=[new Nn({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new q(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=yt(e),e.length!==4)throw new q("Input should have rank 4; Received input shape: "+JSON.stringify(e));const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new q("The channel dimension of the inputs should be defined. Found `None`.");const s=e[n],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Nn({ndim:4,axes:{[n]:s}})],this.built=!0}call(e,n){return J(()=>{let s=Ve(e);if(s.shape.length!==4)throw new q(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,i=r[0];let o,a;this.dataFormat==="channelsFirst"?(o=2,a=3):(o=1,a=2);const l=r[o],u=r[a],c=this.kernelSize[0],h=this.kernelSize[1],d=this.strides[0],f=this.strides[1],p=ro(l,d,c,this.padding),m=ro(u,f,h,this.padding),v=[i,p,m,this.filters];this.dataFormat!=="channelsLast"&&(s=ot(s,[0,2,3,1]));let g=Jb(s,this.kernel.read(),v,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(g=ot(g,[0,3,1,2])),this.bias!=null&&(g=Yi(g,this.bias.read(),this.dataFormat)),this.activation!=null&&(g=this.activation.apply(g)),g})}computeOutputShape(e){e=yt(e);const n=e.slice();let s,r,i;this.dataFormat==="channelsFirst"?(s=1,r=2,i=3):(s=3,r=1,i=2);const o=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],u=this.strides[1];return n[s]=this.filters,n[r]=ro(n[r],l,o,this.padding),n[i]=ro(n[i],u,a,this.padding),n}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}$2.className="Conv2DTranspose";pe($2);class R2 extends bf{constructor(e){if(super(e),this.inputSpec=[new Nn({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new q(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=yt(e),e.length!==5)throw new q("Input should have rank 5; Received input shape: "+JSON.stringify(e));const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new q("The channel dimension of the inputs should be defined. Found `None`.");const s=e[n],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Nn({ndim:5,axes:{[n]:s}})],this.built=!0}call(e,n){return J(()=>{let s=Ve(e);if(s.shape.length!==5)throw new q(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,i=r[0];let o,a,l;this.dataFormat==="channelsFirst"?(l=2,o=3,a=4):(l=1,o=2,a=3);const u=r[l],c=r[o],h=r[a],d=this.kernelSize[0],f=this.kernelSize[1],p=this.kernelSize[2],m=this.strides[0],v=this.strides[1],g=this.strides[2],w=ro(u,m,d,this.padding),b=ro(c,v,f,this.padding),x=ro(h,g,p,this.padding),S=[i,w,b,x,this.filters];this.dataFormat!=="channelsLast"&&(s=ot(s,[0,2,3,4,1]));let N=$E(s,this.kernel.read(),S,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(N=ot(N,[0,4,1,2,3])),this.bias!==null&&(N=Yi(N,this.bias.read(),this.dataFormat)),this.activation!==null&&(N=this.activation.apply(N)),N})}computeOutputShape(e){e=yt(e);const n=e.slice();let s,r,i,o;this.dataFormat==="channelsFirst"?(s=1,r=2,i=3,o=4):(s=4,r=1,i=2,o=3);const a=this.kernelSize[0],l=this.kernelSize[1],u=this.kernelSize[2],c=this.strides[0],h=this.strides[1],d=this.strides[2];return n[s]=this.filters,n[r]=ro(n[r],c,a,this.padding),n[i]=ro(n[i],h,l,this.padding),n[o]=ro(n[o],d,u,this.padding),n}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}R2.className="Conv3DTranspose";pe(R2);class fW extends wf{constructor(e,n){if(super(e,n),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,n.filters==null)throw new q("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(n.kernelInitializer!=null||n.kernelRegularizer!=null||n.kernelConstraint!=null)throw new q("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(n.padding!=null&&n.padding!=="same"&&n.padding!=="valid")throw new q(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(n.padding)}`);this.depthMultiplier=n.depthMultiplier==null?1:n.depthMultiplier,this.depthwiseInitializer=Jt(n.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Zt(n.depthwiseRegularizer),this.depthwiseConstraint=Ln(n.depthwiseConstraint),this.pointwiseInitializer=Jt(n.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Zt(n.pointwiseRegularizer),this.pointwiseConstraint=Ln(n.pointwiseConstraint)}build(e){if(e=yt(e),e.length<this.rank+2)throw new q(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null||e[n]<0)throw new q(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[n])}`);const s=e[n],r=this.kernelSize.concat([s,this.depthMultiplier]),i=[];for(let a=0;a<this.rank;++a)i.push(1);i.push(s*this.depthMultiplier,this.filters);const o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new Nn({ndim:this.rank+2,axes:{[n]:s}})],this.built=!0}call(e,n){return J(()=>{e=Ve(e);let s;if(this.rank===1)throw new Ke("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=ot(e,[0,2,3,1])),s=f1(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=Yi(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=ot(s,[0,3,1,2])),s})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=sn(this.depthwiseInitializer),e.pointwiseInitializer=sn(this.pointwiseInitializer),e.depthwiseRegularizer=Pt(this.depthwiseRegularizer),e.pointwiseRegularizer=Pt(this.pointwiseRegularizer),e.depthwiseConstraint=Fn(this.depthwiseConstraint),e.pointwiseConstraint=Fn(this.pointwiseConstraint),e}}fW.className="SeparableConv";class A2 extends fW{constructor(e){super(2,e)}}A2.className="SeparableConv2D";pe(A2);class Fy extends wf{constructor(e){super(1,e),Fy.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!n2(e.kernelSize,"number",1,1))throw new q(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}Fy.className="Conv1D";pe(Fy);class D2 extends et{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,n){return J(()=>{if(e=Ve(e),this.dataFormat==="channelsLast"){const s=P0(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return P0(s,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=P0(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return P0(s,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}D2.className="Cropping2D";pe(D2);class O2 extends et{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Sn(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,Jce(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const n=e[2]==null?null:this.size[0]*e[2],s=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],n,s]}else{const n=e[1]==null?null:this.size[0]*e[1],s=e[2]==null?null:this.size[1]*e[2];return[e[0],n,s,e[3]]}}call(e,n){return J(()=>{let s=Ve(e);const r=s.shape;if(this.dataFormat==="channelsFirst"){s=ot(s,[0,2,3,1]);const i=this.size[0]*r[2],o=this.size[1]*r[3],a=this.interpolation==="nearest"?ri.resizeNearestNeighbor(s,[i,o]):ri.resizeBilinear(s,[i,o]);return ot(a,[0,3,1,2])}else{const i=this.size[0]*r[1],o=this.size[1]*r[2];return this.interpolation==="nearest"?ri.resizeNearestNeighbor(s,[i,o]):ri.resizeBilinear(s,[i,o])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},n=super.getConfig();return Object.assign(e,n),e}}O2.className="UpSampling2D";pe(O2);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Hde(t,e,n=[1,1],s="valid",r,i){return J(()=>{r==null&&(r=Wi()),Sn(r);let o=N2(t,r);if(t.rank!==4)throw new q(`Input for depthwiseConv2d is required to be 4-D, but is instead ${t.rank}-D`);if(e.rank!==4)throw new q(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return o=hf(o,e,n,s==="same"?"same":"valid","NHWC",i),r==="channelsFirst"&&(o=ot(o,[0,3,1,2])),o})}class P2 extends Y1{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=Jt(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Ln(e.depthwiseConstraint),this.depthwiseRegularizer=Zt(e.depthwiseRegularizer)}build(e){if(e=yt(e),e.length<4)throw new q(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const n=this.dataFormat==="channelsFirst"?1:3;if(e[n]==null||e[n]<0)throw new q(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[n]}).`);const s=e[n],r=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return J(()=>{e=Ve(e);let s=Hde(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=Yi(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(e){e=yt(e);const n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,i=Mi(n,this.kernelSize[0],this.padding,this.strides[0]),o=Mi(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],r,i,o]:[e[0],i,o,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=sn(this.depthwiseInitializer),e.depthwiseRegularizer=Pt(this.depthwiseRegularizer),e.depthwiseConstraint=Fn(this.depthwiseRegularizer),e}}P2.className="DepthwiseConv2D";pe(P2);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function pW(t,e,n,s){if(Array.isArray(t)){if(e!=null||n!=null)throw new q("When inputs is an array, neither initialState or constants should be provided");s!=null&&(n=t.slice(t.length-s,t.length),t=t.slice(0,t.length-s)),t.length>1&&(e=t.slice(1,t.length)),t=t[0]}function r(i){return i==null||Array.isArray(i)?i:[i]}return e=r(e),n=r(n),{inputs:t,initialState:e,constants:n}}function mW(t,e,n,s=!1,r,i,o=!1,a=!1){return J(()=>{const l=e.shape.length;if(l<3)throw new q(`Input should be at least 3D, but is ${l}D.`);const u=[1,0].concat(Ui(2,l));e=ot(e,u),o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r!=null&&(r=ge(ge(r,"bool"),"float32"),r.rank===l-1&&(r=ss(r,-1)),r=ot(r,u)),s&&(e=zr(e,0),r!=null&&(r=zr(r,0)));const c=[];let h,d=n;const f=e.shape[0],p=Br(e);let m;r!=null&&(m=Br(r));for(let g=0;g<f;++g){const w=p[g],b=J(()=>t(w,d));if(r==null)h=b[0],d=b[1];else{const x=J(()=>{const S=m[g],N=_e(wr(S),S),I=he(G(b[0],S),G(d[0],N)),C=d.map((_,k)=>he(G(b[1][k],S),G(_,N)));return{output:I,newStates:C}});h=x.output,d=x.newStates}a&&c.push(h)}let v;return a&&(v=Ps(c,1)),[h,v,d]})}class Qi extends et{constructor(e){super(e);let n;if(e.cell==null)throw new q("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?n=new Z1({cells:e.cell}):n=e.cell,n.stateSize==null)throw new q("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=n,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new Nn({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Ui(0,e).map(n=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){v_(e)&&(e=e[0]),e=e;let n=this.cell.stateSize;Array.isArray(n)||(n=[n]);const s=n[0];let r;if(this.returnSequences?r=[e[0],e[1],s]:r=[e[0],s],this.returnState){const i=[];for(const o of n)i.push([e[0],o]);return[r].concat(i)}else return r}computeMask(e,n){return J(()=>{Array.isArray(n)&&(n=n[0]);const s=this.returnSequences?n:null;if(this.returnState){const r=this.states.map(i=>null);return[s].concat(r)}else return s})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[];for(let s=0;s<e;++s)n.push(null);return n}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new Ke("Constants support is not implemented in RNN yet.");v_(e)&&(e=e[0]),e=e;const n=this.stateful?e[0]:null,s=e.slice(2);this.inputSpec[0]=new Nn({shape:[n,null,...s]});const r=[e[0]].concat(e.slice(2));this.cell.build(r);let i;if(Array.isArray(this.cell.stateSize)?i=this.cell.stateSize:i=[this.cell.stateSize],this.stateSpec!=null){if(!st(this.stateSpec.map(o=>o.shape[o.shape.length-1]),i))throw new q(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=i.map(o=>new Nn({shape:[null,o]}));this.stateful&&this.resetStates()}resetStates(e,n=!1){J(()=>{if(!this.stateful)throw new no("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new q("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>En([s,r])):this.states_=[En([s,this.cell.stateSize])];else if(e==null)je(this.states_),this.keptStates!=null&&(je(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>En([s,r])):this.states_[0]=En([s,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new q(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);n===!0?this.keptStates.push(this.states_.slice()):je(this.states_);for(let r=0;r<this.states_.length;++r){const i=e[r],o=Array.isArray(this.cell.stateSize)?this.cell.stateSize[r]:this.cell.stateSize,a=[s,o];if(!st(i.shape,a))throw new q(`State ${r} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${i.shape}`);this.states_[r]=i}}this.states_=this.states_.map(r=>On(r.clone()))})}apply(e,n){let s=n==null?null:n.initialState,r=n==null?null:n.constants;n==null&&(n={});const i=pW(e,s,r,this.numConstants);e=i.inputs,s=i.initialState,r=i.constants;let o=[],a=[];if(s!=null){n.initialState=s,o=o.concat(s),this.stateSpec=[];for(const u of s)this.stateSpec.push(new Nn({shape:u.shape}));a=a.concat(this.stateSpec)}if(r!=null&&(n.constants=r,o=o.concat(r),this.numConstants=r.length),o[0]instanceof ji){const u=[e].concat(o),c=this.inputSpec.concat(a),h=this.inputSpec;this.inputSpec=c;const d=super.apply(u,n);return this.inputSpec=h,d}else return super.apply(e,n)}call(e,n){return J(()=>{const s=n==null?null:n.mask,r=n==null?null:n.training;let i=n==null?null:n.initialState;e=Ve(e),i==null&&(this.stateful?i=this.states_:i=this.getInitialState(e));const o=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==o)throw new q(`RNN Layer has ${o} state(s) but was passed ${i.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:r},u=mW((p,m)=>{const v=this.cell.call([p].concat(m),a);return[v[0],v.slice(1)]},e,i,this.goBackwards,s,null,this.unroll,this.returnSequences),c=u[0],h=u[1],d=u[2];this.stateful&&this.resetStates(d,r);const f=this.returnSequences?h:c;return this.returnState?[f].concat(d):f})}getInitialState(e){return J(()=>{let n=En(e.shape);return n=Te(n,[1,2]),n=Ry(n),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?g_(n,[1,s]):n):this.cell.stateSize>1?[g_(n,[1,this.cell.stateSize])]:[n]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),n={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(n.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===Qi.className&&(n.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),e),n)}static fromConfig(e,n,s={}){const r=n.cell,i=Li(r,s);return new e(Object.assign(n,{cell:i}))}}Qi.className="RNN";pe(Qi);class Ly extends et{}class Q1 extends Ly{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Gn(this.units,"units"),this.activation=Pl(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Jt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Jt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Jt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Zt(e.kernelRegularizer),this.recurrentRegularizer=Zt(e.recurrentRegularizer),this.biasRegularizer=Zt(e.biasRegularizer),this.kernelConstraint=Ln(e.kernelConstraint),this.recurrentConstraint=Ln(e.recurrentConstraint),this.biasConstraint=Ln(e.biasConstraint),this.dropout=Yh([1,Dl([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Yh([1,Dl([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=yt(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return J(()=>{if(e=e,e.length!==2)throw new q(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let s=e[1];e=e[0];const r=n.training==null?!1:n.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Fl({ones:()=>wr(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Fl({ones:()=>wr(s),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let i;const o=this.dropoutMask,a=this.recurrentDropoutMask;o!=null?i=xo(G(e,o),this.kernel.read()):i=xo(e,this.kernel.read()),this.bias!=null&&(i=Yi(i,this.bias.read())),a!=null&&(s=G(s,a));let l=he(i,xo(s,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:Ol(this.activation),useBias:this.useBias,kernelInitializer:sn(this.kernelInitializer),recurrentInitializer:sn(this.recurrentInitializer),biasInitializer:sn(this.biasInitializer),kernelRegularizer:Pt(this.kernelRegularizer),recurrentRegularizer:Pt(this.recurrentRegularizer),biasRegularizer:Pt(this.biasRegularizer),activityRegularizer:Pt(this.activityRegularizer),kernelConstraint:Fn(this.kernelConstraint),recurrentConstraint:Fn(this.recurrentConstraint),biasConstraint:Fn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),n)}}Q1.className="SimpleRNNCell";pe(Q1);class F2 extends Qi{constructor(e){e.cell=new Q1(e),super(e)}call(e,n){return J(()=>{this.cell.dropoutMask!=null&&(je(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(je(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,r=n==null?null:n.training,i=n==null?null:n.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,n){return new e(n)}}F2.className="SimpleRNN";pe(F2);class J1 extends Ly{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new q("GRUCell does not support reset_after parameter set to true.");this.units=e.units,Gn(this.units,"units"),this.activation=Pl(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Pl(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Jt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Jt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Jt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Zt(e.kernelRegularizer),this.recurrentRegularizer=Zt(e.recurrentRegularizer),this.biasRegularizer=Zt(e.biasRegularizer),this.kernelConstraint=Ln(e.kernelConstraint),this.recurrentConstraint=Ln(e.recurrentConstraint),this.biasConstraint=Ln(e.biasConstraint),this.dropout=Yh([1,Dl([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Yh([1,Dl([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=yt(e);const n=e[e.length-1];this.kernel=this.addWeight("kernel",[n,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return J(()=>{if(e=e,e.length!==2)throw new q(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const s=n.training==null?!1:n.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Fl({ones:()=>wr(e),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Fl({ones:()=>wr(r),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,o=this.recurrentDropoutMask;let a,l,u;0<this.dropout&&this.dropout<1&&(e=G(e,i[0]));let c=xo(e,this.kernel.read());this.useBias&&(c=Yi(c,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=G(r,o[0]));const h=this.recurrentKernel.read(),[d,f]=qs(h,[2*this.units,this.units],h.rank-1),p=xo(r,d),[m,v,g]=qs(c,3,c.rank-1),[w,b]=qs(p,2,p.rank-1);a=this.recurrentActivation.apply(he(m,w)),l=this.recurrentActivation.apply(he(v,b));const x=xo(G(l,r),f);u=this.activation.apply(he(g,x));const S=he(G(a,r),G(he(1,Bt(a)),u));return[S,S]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:Ol(this.activation),recurrentActivation:Ol(this.recurrentActivation),useBias:this.useBias,kernelInitializer:sn(this.kernelInitializer),recurrentInitializer:sn(this.recurrentInitializer),biasInitializer:sn(this.biasInitializer),kernelRegularizer:Pt(this.kernelRegularizer),recurrentRegularizer:Pt(this.recurrentRegularizer),biasRegularizer:Pt(this.biasRegularizer),activityRegularizer:Pt(this.activityRegularizer),kernelConstraint:Fn(this.kernelConstraint),recurrentConstraint:Fn(this.recurrentConstraint),biasConstraint:Fn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),n)}}J1.className="GRUCell";pe(J1);class L2 extends Qi{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new J1(e),super(e)}call(e,n){return J(()=>{this.cell.dropoutMask!=null&&(je(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(je(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,r=n==null?null:n.training,i=n==null?null:n.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,n){return n.implmentation===0&&(n.implementation=1),new e(n)}}L2.className="GRU";pe(L2);class My extends Ly{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Gn(this.units,"units"),this.activation=Pl(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Pl(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Jt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Jt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Jt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=Zt(e.kernelRegularizer),this.recurrentRegularizer=Zt(e.recurrentRegularizer),this.biasRegularizer=Zt(e.biasRegularizer),this.kernelConstraint=Ln(e.kernelConstraint),this.recurrentConstraint=Ln(e.recurrentConstraint),this.biasConstraint=Ln(e.biasConstraint),this.dropout=Yh([1,Dl([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Yh([1,Dl([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var n;e=yt(e);const s=e[e.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){const i=this.biasInitializer,o=this.units;r=new(n=class extends di{apply(l,u){const c=i.apply([o]),h=new z1().apply([o]),d=i.apply([o*2]);return IP(IP(c,h),d)}},n.className="CustomInit",n)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,n){return J(()=>{const s=n.training==null?!1:n.training;if(e=e,e.length!==3)throw new q(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1];const i=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Fl({ones:()=>wr(e),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Fl({ones:()=>wr(r),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,a=this.recurrentDropoutMask;let l,u,c,h;0<this.dropout&&this.dropout<1&&(e=G(e,o[0]));let d=xo(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=G(r,a[0])),d=he(d,xo(r,this.recurrentKernel.read())),this.useBias&&(d=Yi(d,this.bias.read()));const[f,p,m,v]=qs(d,4,d.rank-1);l=this.recurrentActivation.apply(f),u=this.recurrentActivation.apply(p),c=he(G(u,i),G(l,this.activation.apply(m))),h=this.recurrentActivation.apply(v);const g=G(h,this.activation.apply(c));return[g,g,c]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:Ol(this.activation),recurrentActivation:Ol(this.recurrentActivation),useBias:this.useBias,kernelInitializer:sn(this.kernelInitializer),recurrentInitializer:sn(this.recurrentInitializer),biasInitializer:sn(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Pt(this.kernelRegularizer),recurrentRegularizer:Pt(this.recurrentRegularizer),biasRegularizer:Pt(this.biasRegularizer),activityRegularizer:Pt(this.activityRegularizer),kernelConstraint:Fn(this.kernelConstraint),recurrentConstraint:Fn(this.recurrentConstraint),biasConstraint:Fn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),n)}}My.className="LSTMCell";pe(My);class M2 extends Qi{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new My(e),super(e)}call(e,n){return J(()=>{this.cell.dropoutMask!=null&&(je(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(je(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,r=n==null?null:n.training,i=n==null?null:n.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,n){return n.implmentation===0&&(n.implementation=1),new e(n)}}M2.className="LSTM";pe(M2);class Z1 extends Ly{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const n of this.cells.slice().reverse())Array.isArray(n.stateSize)?e.push(...n.stateSize):e.push(n.stateSize);return e}call(e,n){return J(()=>{e=e;let s=e.slice(1);const r=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?r.push(s.splice(0,a.stateSize.length)):r.push(s.splice(0,1));r.reverse();const i=[];let o;for(let a=0;a<this.cells.length;++a){const l=this.cells[a];s=r[a],a===0?o=[e[0]].concat(s):o=[o[0]].concat(s),o=l.call(o,n),i.push(o.slice(1))}s=[];for(const a of i.slice().reverse())s.push(...a);return[o[0]].concat(s)})}build(e){v_(e)&&(e=e[0]),e=e;let n;this.cells.forEach((s,r)=>{Ou(`RNNCell_${r}`,()=>{s.build(e),Array.isArray(s.stateSize)?n=s.stateSize[0]:n=s.stateSize,e=[e[0],n]})}),this.built=!0}getConfig(){const e=super.getConfig(),n=i=>({className:i.getClassName(),config:i.getConfig()}),r={cells:this.cells.map(n)};return Object.assign(Object.assign({},e),r)}static fromConfig(e,n,s={}){const r=[];for(const i of n.cells)r.push(Li(i,s));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const n of this.cells)e.push(...n.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const n of this.cells)e.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const s of this.cells)n.push(...s.trainableWeights);return n.concat(e)}return e}getWeights(){const e=[];for(const n of this.cells)e.push(...n.weights);return w_(e)}setWeights(e){const n=[];for(const s of this.cells){const r=s.weights.length,i=e.splice(r);for(let o=0;o<s.weights.length;++o)n.push([s.weights[o],i[o]])}h2(n)}}Z1.className="StackedRNNCells";pe(Z1);function Fl(t){const{ones:e,rate:n,training:s=!1,count:r=1,dropoutFunc:i}=t,o=()=>i!=null?i(e(),n):EU(e(),n),a=()=>Dy(o,e,s);return!r||r<=1?On(a().clone()):Array(r).fill(void 0).map(a).map(u=>On(u.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var qde=function(t,e){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(t);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(t,s[r])&&(n[s[r]]=t[s[r]]);return n};class gW extends Qi{constructor(e){if(e.unroll)throw new Ke("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new Ke("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new Nn({ndim:5})]}call(e,n){return J(()=>{if(this.cell.dropoutMask!=null&&(je(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(je(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),n&&n.constants)throw new q("ConvRNN2D cell does not support constants");const s=n==null?null:n.mask,r=n==null?null:n.training,i=n==null?null:n.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}computeOutputShape(e){let n=this.computeSingleOutputShape(e);return this.returnSequences||(n=[n[0],...n.slice(2)]),this.returnState&&(n=[n,...Array(2).fill([e[0],...n.slice(-3)])]),n}getInitialState(e){return J(()=>{const{stateSize:n}=this.cell,s=e.shape,r=this.computeSingleOutputShape(s),i=[r[0],...r.slice(2)],o=En(i);return Array.isArray(n)?Array(n.length).fill(o):[o]})}resetStates(e,n=!1){J(()=>{if(!this.stateful)throw new no("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,r=this.computeSingleOutputShape(s),i=[r[0],...r.slice(2)];if(s[0]==null)throw new q("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>En(i)):this.states_=[En(i)];else if(e==null)je(this.states_),this.keptStates!=null&&(je(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>En(i)):this.states_[0]=En(i);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new q(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);n?this.keptStates.push(this.states_.slice()):je(this.states_);for(let a=0;a<this.states_.length;++a){const l=e[a],u=i;if(!st(l.shape,u))throw new q(`State ${a} is incompatible with layer ${this.name}: expected shape=${u}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>On(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:n,filters:s,kernelSize:r,padding:i,strides:o,dilationRate:a}=this.cell,l=n==="channelsFirst",u=e[l?3:2],c=e[l?4:3],h=Mi(u,r[0],i,o[0],a[0]),d=Mi(c,r[1],i,o[1],a[1]);return[...e.slice(0,2),...l?[s,h,d]:[h,d,s]]}}gW.className="ConvRNN2D";class eS extends My{constructor(e){const{filters:n,kernelSize:s,strides:r,padding:i,dataFormat:o,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:n})),this.filters=n,Gn(this.filters,"filters"),this.kernelSize=Eh(s,2,"kernelSize"),this.kernelSize.forEach(l=>Gn(l,"kernelSize")),this.strides=Eh(r||1,2,"strides"),this.strides.forEach(l=>Gn(l,"strides")),this.padding=i||"valid",Wr(this.padding),this.dataFormat=o||"channelsLast",Sn(this.dataFormat),this.dilationRate=Eh(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>Gn(l,"dilationRate"))}build(e){var n;e=yt(e);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new q(`The channel dimension of the input should be defined. Found ${e[s]}`);const r=e[s],i=4,o=this.kernelSize.concat([r,this.filters*i]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*i]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const u=this.biasInitializer,c=this.filters;l=new(n=class extends di{apply(d,f){const p=u.apply([c]),m=js([c]),v=u.apply([c*2]);return s2([p,m,v])}},n.className="CustomInit",n)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*i],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,n){return J(()=>{if(e.length!==3)throw new q(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const s=n.training||!1,r=e[0],i=e[1],o=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Fl({ones:()=>wr(r),rate:this.dropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,u=(L,le,Q)=>!le||!le[Q]?L:G(le[Q],L);let c=u(r,l,0),h=u(r,l,1),d=u(r,l,2),f=u(r,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Fl({ones:()=>wr(i),rate:this.recurrentDropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const p=this.recurrentDropoutMask;let m=u(i,p,0),v=u(i,p,1),g=u(i,p,2),w=u(i,p,3);const b=3,[x,S,N,I]=qs(this.kernel.read(),a,b),[C,_,k,A]=this.useBias?qs(this.bias.read(),a):[null,null,null,null];c=this.inputConv(c,x,C,this.padding),h=this.inputConv(h,S,_,this.padding),d=this.inputConv(d,N,k,this.padding),f=this.inputConv(f,I,A,this.padding);const[D,R,W,B]=qs(this.recurrentKernel.read(),a,b);m=this.recurrentConv(m,D),v=this.recurrentConv(v,R),g=this.recurrentConv(g,W),w=this.recurrentConv(w,B);const M=this.recurrentActivation.apply(he(c,m)),X=this.recurrentActivation.apply(he(h,v)),z=he(G(X,o),G(M,this.activation.apply(he(d,g)))),Y=G(this.recurrentActivation.apply(he(f,w)),this.activation.apply(z));return[Y,Y,z]})}getConfig(){const e=super.getConfig(),n=qde(e,["units"]),s={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},n),s)}inputConv(e,n,s,r){const i=fa(e,n,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?Yi(i,s,this.dataFormat):i}recurrentConv(e,n){return fa(e,n,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}eS.className="ConvLSTM2DCell";pe(eS);class z2 extends gW{constructor(e){const n=new eS(e);super(Object.assign(Object.assign({},e),{cell:n}))}static fromConfig(e,n){return new e(n)}}z2.className="ConvLSTM2D";pe(z2);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class tS extends et{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const n=e.shape,s=[];for(let r=0;r<this.noiseShape.length;++r)s.push(this.noiseShape[r]==null?n[r]:this.noiseShape[r]);return s}call(e,n){return J(()=>{this.invokeCallHook(e,n);const s=Ve(e);if(0<this.rate&&this.rate<1){const r=n.training==null?!1:n.training,i=this.getNoiseShape(s);return Dy(()=>EU(s,this.rate,i,this.seed),()=>s,r)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=super.getConfig();return Object.assign(e,n),e}dispose(){return super.dispose()}}tS.className="Dropout";pe(tS);class B2 extends tS{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const n=e.shape;return[n[0],1,n[2]]}}B2.className="SpatialDropout1D";pe(B2);class V2 extends et{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let n=null;e.batchSize!=null&&(n=e.batchSize),this.batchInputShape=[n,e.inputDim]}this.units=e.units,Gn(this.units,"units"),this.activation=Pl(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=Jt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=Jt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Ln(e.kernelConstraint),this.biasConstraint=Ln(e.biasConstraint),this.kernelRegularizer=Zt(e.kernelRegularizer),this.biasRegularizer=Zt(e.biasRegularizer),this.activityRegularizer=Zt(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=yt(e);const n=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:n}}],this.built=!0}computeOutputShape(e){e=yt(e);const n=e.slice();return n[n.length-1]=this.units,n}call(e,n){return J(()=>{this.invokeCallHook(e,n);const s=Ve(e),r=bU(this.activation.getClassName());let i;return r!=null?i=xo(s,this.kernel.read(),r,this.bias?this.bias.read():null):(i=xo(s,this.kernel.read()),this.bias!=null&&(i=Yi(i,this.bias.read())),this.activation!=null&&(i=this.activation.apply(i))),i})}getConfig(){const e={units:this.units,activation:Ol(this.activation),useBias:this.useBias,kernelInitializer:sn(this.kernelInitializer),biasInitializer:sn(this.biasInitializer),kernelRegularizer:Pt(this.kernelRegularizer),biasRegularizer:Pt(this.biasRegularizer),activityRegularizer:Pt(this.activityRegularizer),kernelConstraint:Fn(this.kernelConstraint),biasConstraint:Fn(this.biasConstraint)},n=super.getConfig();return Object.assign(e,n),e}}V2.className="Dense";pe(V2);class U2 extends et{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=yt(e);for(const n of e.slice(1))if(n==null)throw new q(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],wl(e,1)]}call(e,n){return J(()=>{this.invokeCallHook(e,n);let s=Ve(e);if(this.dataFormat==="channelsFirst"&&s.rank>1){const r=[0];for(let i=2;i<s.rank;++i)r.push(i);r.push(1),s=ot(s,r)}return rhe(s)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const n=super.getConfig();return Object.assign(e,n),e}}U2.className="Flatten";pe(U2);class W2 extends et{constructor(e){super(e),this.supportsMasking=!0,this.activation=Pl(e.activation)}call(e,n){return J(()=>{this.invokeCallHook(e,n);const s=Ve(e);return this.activation.apply(s)})}getConfig(){const e={activation:Ol(this.activation)},n=super.getConfig();return Object.assign(e,n),e}}W2.className="Activation";pe(W2);class j2 extends et{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,n){return J(()=>(e=Ve(e),nhe(e,this.n)))}getConfig(){const e={n:this.n},n=super.getConfig();return Object.assign(e,n),e}}j2.className="RepeatVector";pe(j2);class G2 extends et{constructor(e){super(e),this.targetShape=e.targetShape;for(let n=0;n<this.targetShape.length;++n)this.isUnknown(this.targetShape[n])&&(this.targetShape[n]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,n){const s="Total size of new array must be unchanged.",r=n.slice();let i=1,o=null;for(let l=0;l<r.length;++l){const u=r[l];if(this.isUnknown(u))if(o===null)o=l;else throw new q("Can only specifiy one unknown dimension.");else i*=u}const a=wl(e);if(o!==null){if(i===0||a%i!==0)throw new q(s);r[o]=a/i}else if(a!==i)throw new q(s);return r}computeOutputShape(e){let n=!1;for(let s=0;s<e.length;++s)if(this.isUnknown(e[s])){n=!0;break}return n?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,n){return J(()=>{this.invokeCallHook(e,n);const s=Ve(e),r=s.shape,i=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return H(s,i)})}getConfig(){const e={targetShape:this.targetShape},n=super.getConfig();return Object.assign(e,n),e}}G2.className="Reshape";pe(G2);class H2 extends et{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const n=Ui(1,e.dims.length+1);if(!st(e.dims.slice().sort(),n))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Nn({ndim:this.dims.length+1})]}computeOutputShape(e){e=yt(e);const n=e.slice();return this.dims.forEach((s,r)=>{n[r+1]=e[s]}),n}call(e,n){return ot(Ve(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},n=super.getConfig();return Object.assign(e,n),e}}H2.className="Permute";pe(H2);class q2 extends et{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={maskValue:this.maskValue};return Object.assign(n,e),n}computeMask(e,n){const s=Ve(e);return Tm(ec(s,this.maskValue),-1)}call(e,n){return J(()=>{this.invokeCallHook(e,n);const s=Ve(e),o=Tm(ec(s,this.maskValue),-1,!0);return G(s,ge(o,s.dtype))})}}q2.className="Masking";pe(q2);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class K2 extends et{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let n=null;e.batchSize!=null&&(n=e.batchSize),e.inputLength==null?this.batchInputShape=[n,null]:this.batchInputShape=[n].concat(Tt(e.inputLength))}this.inputDim=e.inputDim,Gn(this.inputDim,"inputDim"),this.outputDim=e.outputDim,Gn(this.outputDim,"outputDim"),this.embeddingsInitializer=Jt(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Zt(e.embeddingsRegularizer),this.activityRegularizer=Zt(e.activityRegularizer),this.embeddingsConstraint=Ln(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,n){return J(()=>this.maskZero?(e=Ve(e),ec(e,ct(e))):null)}computeOutputShape(e){if(e=yt(e),this.inputLength==null)return[...e,this.outputDim];const n=Tt(this.inputLength);if(n.length!==e.length-1)throw new q(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let s=0;for(let r=0;r<n.length;++r){const i=n[r],o=e[r+1];if(i!=null&&o!=null&&i!==o)throw new q(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);i==null&&(n[s]=o),s++}}return[e[0],...n,this.outputDim]}call(e,n){return J(()=>{this.invokeCallHook(e,n);let s=Ve(e);s.dtype!=="int32"&&(s=wo(s,"int32"));const r=kU(this.embeddings.read(),H(s,[s.size]));return H(r,yt(this.computeOutputShape(s.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:sn(this.embeddingsInitializer),embeddingsRegularizer:Pt(this.embeddingsRegularizer),activityRegularizer:Pt(this.activityRegularizer),embeddingsConstraint:Fn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=super.getConfig();return Object.assign(e,n),e}}K2.className="Embedding";pe(K2);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Rc extends et{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new Ke}computeElementwiseOpOutputShape(e,n){if(e==null||n==null)return null;if(e.length<n.length)return this.computeElementwiseOpOutputShape(n,e);if(n.length===0)return e;const s=e.slice(0,e.length-n.length);for(let r=0;r<n.length;++r){const i=e[e.length-n.length+r],o=n[r];if(i==null||o==null||i<0||o<0)s.push(null);else if(i===1)s.push(o);else if(o===1)s.push(i);else{if(i!==o)throw new q("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(n));s.push(i)}}return s}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[yt(e)]),e=e,e.length<2)throw new q(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let n=[];for(const i of e)i!=null&&i[0]!==null&&n.push(i[0]);if(n=vl(n),n.length>1)throw new q(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let s=e[0]==null?null:e[0].slice(1);for(let i=1;i<e.length;++i){const o=e[i]==null?null:e[i].slice(1);s=this.computeElementwiseOpOutputShape(s,o)}const r=e.map(i=>i.length);e.indexOf(null)===-1&&vl(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,n){return J(()=>{if(e=e,this.reshapeRequired){const s=[],r=e.map(i=>i.rank);if(r.indexOf(null)===-1){const i=Dl(r);for(let o of e){const a=o.rank;for(let l=0;l<i-a;++l)o=Ry(o,1);s.push(o)}return this.mergeFunction(s)}else{let i=!1;for(const l of e){const u=l.rank;if(u==null){const c=l.shape,h=c[0],d=c.slice(1).concat([h]);let f=H(l,[h].concat(wl(c.slice(1))));f=ot(f,[1,0]),f=H(f,d),s.push(f),i=!0}else if(u>1){const c=Ui(1,u).concat([0]);s.push(ot(l,c)),i=!0}else s.push(l)}let o=this.mergeFunction(s);const a=o.rank;if(i){if(a==null){const l=o.shape,u=l.length,c=l[u-1],h=[c].concat(l.slice(0,l.length-1));o=H(ot(H(o,[-1,c]),[1,0]),h)}else if(a>1){const l=[a-1].concat(Ui(0,a-1));o=ot(o,l)}}return o}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let n;e[0]==null?n=null:n=e[0].slice(1);for(let r=1;r<e.length;++r){const i=e[r]==null?null:e[r].slice(1);n=this.computeElementwiseOpOutputShape(n,i)}let s=[];for(const r of e)r!=null&&r[0]!==null&&s.push(r[0]);return s=vl(s),s.length===1?n=s.concat(n):n=[null].concat(n),n}computeMask(e,n){return J(()=>{if(n==null)return null;if(!Array.isArray(n))throw new q("`mask` should be an Array");if(!Array.isArray(e))throw new q("`inputs` should be an Array");if(n.length!==e.length)throw new q(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${n.length})`);if(n.every(r=>r==null))return null;n=n.map(r=>r==null?r:ss(r,0));let s=n[0];for(let r=1;r<n.length-1;++r)s=ci(s,n[r]);return s})}}class X2 extends Rc{constructor(e){super(e)}mergeFunction(e){return J(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=he(n,e[s]);return n})}}X2.className="Add";pe(X2);class Y2 extends Rc{constructor(e){super(e)}mergeFunction(e){return J(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=G(n,e[s]);return n})}}Y2.className="Multiply";pe(Y2);class Q2 extends Rc{constructor(e){super(e)}mergeFunction(e){return J(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=he(n,e[s]);return G(1/e.length,n)})}}Q2.className="Average";pe(Q2);class J2 extends Rc{constructor(e){super(e)}mergeFunction(e){return J(()=>{let n=e[0];for(let s=1;s<e.length;++s)n=Eo(n,e[s]);return n})}}J2.className="Maximum";pe(J2);class Z2 extends Rc{constructor(e){super(e)}mergeFunction(e){return J(()=>{let n=e[0];for(let s=1;s<e.length;++s)n=Al(n,e[s]);return n})}}Z2.className="Minimum";pe(Z2);class e$ extends Rc{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new q("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let n=!0;for(const r of e)if(r!=null){n=!1;break}if(n)return;const s=[];for(let r=0;r<e.length;++r){const i=e[r].slice();i.splice(this.axis,1);let o=!1;for(const a of s)if(st(a,i)){o=!0;break}o||s.push(i)}if(s.length>1)throw new q("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return J(()=>s2(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new q("A `Concatenate` layer should be called on a list of inputs.");const n=e,s=n[0].slice(),r=this.axis<0?s.length+this.axis:this.axis;for(const i of n.slice(1)){if(s[r]==null||i[r]==null){s[r]=null;break}s[r]+=i[r]}return s}computeMask(e,n){if(n==null)return null;if(!Array.isArray(n))throw new q("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new q("`inputs` should be an array for Concatenate");if(n.length!==e.length)throw new q(`Mismatch in the length of mask (${n.length}) and the legnth of inputs (${e.length})`);return J(()=>{let s=!0;if(n.forEach(o=>{if(o!=null){s=!1;return}}),s)return null;const r=[];for(let o=0;o<e.length;++o)n[o]==null?r.push(ge(wr(e[o]),"bool")):n[o].rank<e[o].rank?r.push(ss(n[o],-1)):r.push(n[o]);const i=wn(r,this.axis);return Yb(i,-1,!1)})}getConfig(){const e={axis:this.axis},n=super.getConfig();return Object.assign(e,n),e}}e$.className="Concatenate";pe(e$);function rp(t,e){for(;t<0;)t+=e;return t}function Kde(t,e,n){if(t.shape.length>3||e.shape.length>3)throw new Ke("batchDot is not implemented for tensors of 4D or higher rank yet");if(O(t.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${t.shape.length}`),O(t.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof n=="number"&&(n=[n,n]),t.dtype==="complex64"||e.dtype==="complex64")throw new Ke("batchDot is not implemented for complex64-type Tensors yet.");const s=t.shape.length,r=e.shape.length;n==null&&(n=[s-1,r-2]);const i=n;return J(()=>{let o;if(s>r){o=s-r;const l=[];for(let u=0;u<o;++u)l.push(1);e=H(e,e.shape.concat(l))}else if(r>s){o=r-s;const l=[];for(let u=0;u<o;++u)l.push(1);t=H(t,t.shape.concat(l))}else o=0;let a;if(t.shape.length===2&&e.shape.length===2)i[0]===i[1]?a=Te(G(t,e),i[0]):a=Te(G(ot(t,[1,0]),e),i[1]);else{const l=i[0]!==t.shape.length-1,u=i[1]===e.shape.length-1;a=Je(t,e,l,u)}if(o>0){let l;s>r?l=s+r-3:l=s-1;const u=[];for(let c=l;c<l+o;++c)u.push(c);a=Ql(a,u)}return a.shape.length===1&&(a=ss(a,1)),a})}class t$ extends Rc{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){O(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=e[0],s=e[1];if(n.length>3||s.length>3)throw new Ke("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(n,s);if(n[r[0]]!==s[r[1]])throw new q(`Dimension incompatibility: ${n[r[0]]} !== ${s[r[1]]}`)}mergeFunction(e){if(e.length!==2)throw new q(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let n=e[0],s=e[1],r;return Array.isArray(this.axes)?r=this.axes.map((i,o)=>rp(i,e[o].shape.length)):r=[rp(this.axes,n.shape.length),rp(this.axes,s.shape.length)],this.normalize&&(n=Pw(n,r[0]),s=Pw(s,r[1])),Kde(n,s,r)}interpretAxes(e,n){let s;return Array.isArray(this.axes)?s=this.axes:s=[rp(this.axes,e.length),rp(this.axes,n.length)],s}computeOutputShape(e){O(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=e[0].slice(),s=e[1].slice();if(n.length>3||s.length>3)throw new Ke("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(n,s);n.splice(r[0],1),s.splice(r[1],1),s.splice(0,1);const i=n.concat(s);return i.length===1&&i.push(1),i}computeMask(e,n){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},n=super.getConfig();return Object.assign(e,n),e}}t$.className="Dot";pe(t$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class n$ extends et{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={stddev:this.stddev};return Object.assign(n,e),n}call(e,n){return J(()=>{this.invokeCallHook(e,n);const s=Ve(e);return Dy(()=>he(M1(s.shape,0,this.stddev),s),()=>s,n.training||!1)})}}n$.className="GaussianNoise";pe(n$);class s$ extends et{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={rate:this.rate};return Object.assign(n,e),n}call(e,n){return J(()=>{this.invokeCallHook(e,n);const s=Ve(e);return this.rate>0&&this.rate<1?Dy(()=>{const i=Math.sqrt(this.rate/(1-this.rate));return G(s,M1(s.shape,1,i))},()=>s,n.training||!1):s})}}s$.className="GaussianDropout";pe(s$);class r$ extends et{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||Ve(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={rate:this.rate};return Object.assign(n,e),n}call(e,n){return J(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(e);return Dy(()=>{const i=Ve(e),l=-1.6732632423543772*1.0507009873554805;let u=Ca(Yl(s),this.rate);u=wo(u,"float32");const c=((1-this.rate)*(1+this.rate*l**2))**-.5,h=-c*l*this.rate,d=he(G(i,u),G(he(u,-1),l));return he(G(d,c),h)},()=>Ve(e),n.training||!1)}return e})}}r$.className="AlphaDropout";pe(r$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Am(t,e,n,s,r,i=.001){let o;if(t.rank===2)o=wE(t,e,n,s,r,i);else if(t.rank===3)o=xE(t,e,n,s,r,i);else if(t.rank===4)o=bE(t,e,n,s,r,i);else throw new Ke(`batchNormalization is not implemented for array of rank ${t.rank} yet`);return o}function Xde(t,e,n,s,r=.001){return J(()=>{const i=wy(t,s),o=i.mean,a=i.variance;return[Am(t,o,a,n,e,r),o,a]})}function Yde(t,e,n,s,r=.001){return J(()=>{const i=wy(t,s),o=i.mean,a=i.variance,l=[];for(const p of Ui(0,t.rank))s.indexOf(p)!==-1?l.push(1):l.push(t.shape[p]);const u=H(o,l),c=H(a,l),h=e==null?null:H(e,l),d=n==null?null:H(n,l);return[Am(t,u,c,d,h,r),o,a]})}function Qde(t,e,n,s,r=.001){return st(s.slice().sort(),Ui(0,t.rank-1))?Xde(t,e,n,s,r):Yde(t,e,n,s,r)}class i$ extends et{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Jt(e.betaInitializer||"zeros"),this.gammaInitializer=Jt(e.gammaInitializer||"ones"),this.movingMeanInitializer=Jt(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=Jt(e.movingVarianceInitializer||"ones"),this.betaConstraint=Ln(e.betaConstraint),this.gammaConstraint=Ln(e.gammaConstraint),this.betaRegularizer=Zt(e.betaRegularizer),this.gammaRegularizer=Zt(e.gammaRegularizer)}build(e){e=yt(e);const n=this.axis>=0?this.axis:this.axis+e.length,s=e[n];if(s==null)throw new q(`Axis ${n} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new Nn({ndim:e.length,axes:{[n]:s}})];const r=[s];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,n){return J(()=>{const s=n.training==null?!1:n.training,r=Ve(e),i=r.shape,o=i.length,a=Ui(0,o),l=this.axis>=0?this.axis:this.axis+o;a.splice(l,1);const u=sc(1,o);u[l]=i[l];const c=a.slice();c.sort();const h=!st(c,Ui(0,o).slice(0,o-1)),d=()=>{if(h){const w=H(this.movingMean.read(),u),b=H(this.movingVariance.read(),u),x=this.center?H(this.beta.read(),u):null,S=this.scale?H(this.gamma.read(),u):null;return Am(r,w,b,x,S,this.epsilon)}else return Am(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return d();const[f,p,m]=Qde(r,this.gamma.read(),this.beta.read(),a,this.epsilon),v=(w,b,x)=>{J(()=>{const S=1-x,N=w.read(),I=G(_e(N,b),S);w.write(_e(N,I))})};return(()=>{v(this.movingMean,p,this.momentum),v(this.movingVariance,m,this.momentum)})(),f})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:sn(this.betaInitializer),gammaInitializer:sn(this.gammaInitializer),movingMeanInitializer:sn(this.movingMeanInitializer),movingVarianceInitializer:sn(this.movingVarianceInitializer),betaRegularizer:Pt(this.betaRegularizer),gammaRegularizer:Pt(this.gammaRegularizer),betaConstraint:Fn(this.betaConstraint),gammaConstraint:Fn(this.gammaConstraint)},n=super.getConfig();return Object.assign(e,n),e}}i$.className="BatchNormalization";pe(i$);class o$ extends et{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const n of this.axis)if(!Number.isInteger(n))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Jt(e.betaInitializer||"zeros"),this.gammaInitializer=Jt(e.gammaInitializer||"ones"),this.betaRegularizer=Zt(e.betaRegularizer),this.gammaRegularizer=Zt(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=yt(e);const n=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let i=0;i<this.axis.length;++i)this.axis[i]<0&&(this.axis[i]+=n);for(const i of this.axis)if(i<0||i>=n)throw new Error(`Invalid axis: ${i}`);if(this.axis.length!==vl(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(i=>e[i]),r=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,n){const s=Ve(e),r=s.shape,i=r.length;return J(()=>{let{mean:a,variance:l}=wy(s,this.axis,!0);const u=sc(1,i);for(const m of this.axis)u[m]=r[m];const c=m=>m!=null&&m.shape.length!==i?H(m,u):m;let h=this.scale?c(this.gamma.read()):null,d=this.center?c(this.beta.read()):null;const f=[],p=[];for(let m=0;m<i;++m)this.axis.indexOf(m)!==-1?(f.push(r[m]),p.push(1)):(f.push(1),p.push(r[m]));return a=Ar(a,f),l=Ar(l,f),h!=null&&(h=Ar(h,p)),d!=null&&(d=Ar(d,p)),Am(s,a,l,d,h,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:sn(this.betaInitializer),gammaInitializer:sn(this.gammaInitializer),betaRegularizer:Pt(this.betaRegularizer),gammaRegularizer:Pt(this.gammaRegularizer)},n=super.getConfig();return Object.assign(e,n),e}}o$.className="LayerNormalization";pe(o$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Jde(t,e,n){return J(()=>{if(t.rank!==4)throw new q(`temporalPadding expects input tensor to be 4-D, but received a ${t.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new q("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(n==null&&(n=Wi()),n!=="channelsLast"&&n!=="channelsFirst")throw new q(`Unknown data format: ${n}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return n==="channelsFirst"?s=[[0,0],[0,0],e[0],e[1]]:s=[[0,0],e[0],e[1],[0,0]],Ia(t,s)})}class a$ extends et{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?Wi():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new q(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let n,s;if(typeof e.padding[0]=="number")n=[e.padding[0],e.padding[0]],s=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new q(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(n=e.padding[0],e.padding[1].length!==2)throw new q(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);s=e.padding[1]}this.padding=[n,s]}this.inputSpec=[new Nn({ndim:4})]}computeOutputShape(e){e=yt(e);let n,s;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?n=e[2]+this.padding[0][0]+this.padding[0][1]:n=null,e[3]!=null&&e[3]>=0?s=e[3]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],e[1],n,s]):(e[1]!=null&&e[1]>=0?n=e[1]+this.padding[0][0]+this.padding[0][1]:n=null,e[2]!=null&&e[2]>=0?s=e[2]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],n,s,e[3]])}call(e,n){return J(()=>Jde(Ve(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}a$.className="ZeroPadding2D";pe(a$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function nS(t,e,n,s,r,i){return J(()=>{Sn(r),CU(i),Wr(s),n==null&&(n=[1,1]),s==null&&(s="valid"),r==null&&(r=Wi()),i==null&&(i="max"),t=N2(t,r);let o;const a=s==="same"?"same":"valid";return i==="max"?o=vy(t,e,n,a):o=cy(t,e,n,a),r==="channelsFirst"&&(o=ot(o,[0,3,1,2])),o})}function yW(t,e,n,s,r,i){return J(()=>{Sn(r),CU(i),Wr(s),n==null&&(n=[1,1,1]),s==null&&(s="valid"),r==null&&(r=Wi()),i==null&&(i="max"),t=dW(t,r);let o;const a=s==="same"?"same":"valid";return i==="max"?o=jE(t,e,n,a):o=vE(t,e,n,a),r==="channelsFirst"&&(o=ot(o,[0,4,1,2,3])),o})}class vW extends et{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new q(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(Gn(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new q(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);Gn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,Wr(this.padding),this.inputSpec=[new Nn({ndim:3})]}computeOutputShape(e){e=yt(e);const n=Mi(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],n,e[2]]}call(e,n){return J(()=>{this.invokeCallHook(e,n),e=Ry(Ve(e),2);const s=this.poolingFunction(Ve(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return Ql(s,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=super.getConfig();return Object.assign(e,n),e}}class l$ extends vW{constructor(e){super(e)}poolingFunction(e,n,s,r,i){return Sn(i),Wr(r),nS(e,n,s,r,i,"max")}}l$.className="MaxPooling1D";pe(l$);class u$ extends vW{constructor(e){super(e)}poolingFunction(e,n,s,r,i){return Sn(i),Wr(r),nS(e,n,s,r,i,"avg")}}u$.className="AveragePooling1D";pe(u$);class wW extends et{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new q(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];Gn(this.poolSize,"poolSize"),Gn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Sn(this.dataFormat),Wr(this.padding),this.inputSpec=[new Nn({ndim:4})]}computeOutputShape(e){e=yt(e);let n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2];return n=Mi(n,this.poolSize[0],this.padding,this.strides[0]),s=Mi(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],n,s]:[e[0],n,s,e[3]]}call(e,n){return J(()=>(this.invokeCallHook(e,n),this.poolingFunction(Ve(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class c$ extends wW{constructor(e){super(e)}poolingFunction(e,n,s,r,i){return Sn(i),Wr(r),nS(e,n,s,r,i,"max")}}c$.className="MaxPooling2D";pe(c$);class h$ extends wW{constructor(e){super(e)}poolingFunction(e,n,s,r,i){return Sn(i),Wr(r),nS(e,n,s,r,i,"avg")}}h$.className="AveragePooling2D";pe(h$);class xW extends et{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new q(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];Gn(this.poolSize,"poolSize"),Gn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Sn(this.dataFormat),Wr(this.padding),this.inputSpec=[new Nn({ndim:5})]}computeOutputShape(e){e=yt(e);let n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[4]:e[3];return n=Mi(n,this.poolSize[0],this.padding,this.strides[0]),s=Mi(s,this.poolSize[1],this.padding,this.strides[1]),r=Mi(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],n,s,r]:[e[0],n,s,r,e[4]]}call(e,n){return J(()=>(this.invokeCallHook(e,n),this.poolingFunction(Ve(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class d$ extends xW{constructor(e){super(e)}poolingFunction(e,n,s,r,i){return Sn(i),Wr(r),yW(e,n,s,r,i,"max")}}d$.className="MaxPooling3D";pe(d$);class f$ extends xW{constructor(e){super(e)}poolingFunction(e,n,s,r,i){return Sn(i),Wr(r),yW(e,n,s,r,i,"avg")}}f$.className="AveragePooling3D";pe(f$);class bW extends et{constructor(e){super(e),this.inputSpec=[new Nn({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,n){throw new Ke}}class p$ extends bW{constructor(e){super(e||{})}call(e,n){return J(()=>{const s=Ve(e);return nn(s,1)})}}p$.className="GlobalAveragePooling1D";pe(p$);class m$ extends bW{constructor(e){super(e||{})}call(e,n){return J(()=>{const s=Ve(e);return Lr(s,1)})}}m$.className="GlobalMaxPooling1D";pe(m$);class SW extends et{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Sn(this.dataFormat),this.inputSpec=[new Nn({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,n){throw new Ke}getConfig(){const e={dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class g$ extends SW{call(e,n){return J(()=>{const s=Ve(e);return this.dataFormat==="channelsLast"?nn(s,[1,2]):nn(s,[2,3])})}}g$.className="GlobalAveragePooling2D";pe(g$);class y$ extends SW{call(e,n){return J(()=>{const s=Ve(e);return this.dataFormat==="channelsLast"?Lr(s,[1,2]):Lr(s,[2,3])})}}y$.className="GlobalMaxPooling2D";pe(y$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class CW extends et{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=super.getConfig();return Object.assign(e,n),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,n,s={}){const r=n.layer,i=Li(r,s);delete n.layer;const o={layer:i};return Object.assign(o,n),new e(o)}}class v$ extends CW{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=yt(e),e.length<3)throw new q(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const n=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=yt(e);const n=[e[0]].concat(e.slice(2)),s=this.layer.computeOutputShape(n),r=e[1];return[s[0],r].concat(s.slice(1))}call(e,n){return J(()=>(e=Ve(e),mW((o,a)=>[Ve(this.layer.call(o,n)),[]],e,[],!1,null,null,!1,!0)[1]))}}v$.className="TimeDistributed";pe(v$);function Zde(t){Nc(Qce,"BidirectionalMergeMode",t)}const efe="concat";class w$ extends CW{constructor(e){super(e);const n=e.layer.getConfig(),s={};s.className=e.layer.getClassName(),s.config=n,this.forwardLayer=Li(s),n.goBackwards=n.goBackwards!==!0;const r={};if(r.className=e.layer.getClassName(),r.config=n,this.backwardLayer=Li(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?efe:e.mergeMode,Zde(this.mergeMode),e.weights)throw new Ke("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const n=e.length,s=Math.floor(n/2);this.forwardLayer.setWeights(e.slice(0,s)),this.backwardLayer.setWeights(e.slice(s))}computeOutputShape(e){let n=this.forwardLayer.computeOutputShape(e);Array.isArray(n)&&Array.isArray(n[0])||(n=[n]),n=n;let s,r,i;return this.returnState&&(i=n.slice(1)),s=n[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,r=[s]):this.mergeMode==null?r=[s,s.slice()]:r=[s],this.returnState?this.mergeMode==null?r.concat(i).concat(i.slice()):[s].concat(i).concat(i.slice()):Us(r)}apply(e,n){let s=n==null?null:n.initialState,r=n==null?null:n.constants;n==null&&(n={});const i=pW(e,s,r,this.numConstants);if(e=i.inputs,s=i.initialState,r=i.constants,Array.isArray(e)&&(s=e.slice(1),e=e[0]),(s==null||s.length===0)&&r==null)return super.apply(e,n);const o=[],a=[];if(s!=null){const u=s.length;if(u%2>0)throw new q("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=s,o.push(...s);const c=s.map(h=>new Nn({shape:h.shape}));this.forwardLayer.stateSpec=c.slice(0,u/2),this.backwardLayer.stateSpec=c.slice(u/2),a.push(...c)}if(r!=null)throw new Ke("Support for constants in Bidirectional layers is not implemented yet.");const l=o[0]instanceof ji;for(const u of o)if(u instanceof ji!==l)throw new q("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const u=[e].concat(o),c=this.inputSpec.concat(a),h=this.inputSpec;this.inputSpec=c;const d=super.apply(u,n);return this.inputSpec=h,d}else return super.apply(e,n)}call(e,n){return J(()=>{const s=n.initialState;let r,i;if(s==null)r=this.forwardLayer.call(e,n),i=this.backwardLayer.call(e,n);else{const l=s.slice(0,s.length/2),u=s.slice(s.length/2);r=this.forwardLayer.call(e,Object.assign(n,{initialState:l})),i=this.backwardLayer.call(e,Object.assign(n,{initialState:u}))}let o;this.returnState&&(Array.isArray(r)&&(o=r.slice(1).concat(i.slice(1))),r=r[0],i=i[0]),this.returnSequences&&(i=zr(i,1));let a;return this.mergeMode==="concat"?a=s2([r,i]):this.mergeMode==="sum"?a=he(r,i):this.mergeMode==="ave"?a=G(.5,he(r,i)):this.mergeMode==="mul"?a=G(r,i):this.mergeMode==null&&(a=[r,i]),this.returnState?this.mergeMode==null?a.concat(o):[a].concat(o):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){Ou(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),Ou(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,n){Array.isArray(n)&&(n=n[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[n,n]:s=n:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const i=this.forwardLayer.states.map(o=>null);return Array.isArray(s)?s.concat(i).concat(i):[s].concat(i).concat(i)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},n=super.getConfig();return Object.assign(e,n),e}static fromConfig(e,n){const s=Li(n.layer);if(delete n.layer,n.numConstants!=null)throw new Ke("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=n;return r.layer=s,new e(r)}}w$.className="Bidirectional";pe(w$);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class x$ extends et{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},n=super.getConfig();return Object.assign(e,n),e}call(e,n){return J(()=>(e=Ve(e),e.dtype!=="float32"&&(e=wo(e,"float32")),he(G(e,this.scale),this.offset)))}}x$.className="Rescaling";pe(x$);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:tfe,cropAndResize:nfe}=ri;class b$ extends et{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,n,s,r,i,o,a,l){return J(()=>{let u,c=!1;const h=n/o,d=s/a,f=(r+n)/o,p=(i+s)/a,m=[h,d,f,p],v=[];e.rank===3?(c=!0,u=Ps([e])):u=e;for(let S=0;S<u.shape[0];S++)v.push(m);const g=gr(v,[v.length,4]),w=tc(0,v.length,1,"int32"),x=nfe(u,g,w,[r,i],"nearest");return wo(c?Ve(Br(x)):x,l)})}upsize(e,n,s,r){return J(()=>{const i=tfe(e,[n,s]);return wo(i,r)})}call(e,n){return J(()=>{const s=Ve(e),r=s.dtype,i=s.shape,o=i[i.length-3],a=i[i.length-2];let l=0;o!==this.height&&(l=Math.floor((o-this.height)/2));let u=0;return a!==this.width&&(u=Math.floor((a-this.width)/2),u===0&&(u=1)),l>=0&&u>=0?this.centerCrop(s,l,u,this.height,this.width,o,a,r):this.upsize(e,this.height,this.width,r)})}getConfig(){const e={height:this.height,width:this.width},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){e=yt(e);const n=e.length-3,s=e.length-2;return e[n]=this.height,e[s]=this.width,e}}b$.className="CenterCrop";pe(b$);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function sfe(t,e,n,s){let r=Ve(t);if(r.dtype!=="int32"&&(r=wo(r,"int32")),e==="int")return r;const i=r.shape;if(r.rank===0&&(r=ss(r,-1)),e==="oneHot"&&r.shape[r.shape.length-1]!==1&&(r=ss(r,-1)),r.rank>2)throw new q(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${i} which would result in output rank ${r.rank}.`);const o=["multiHot","oneHot"].includes(e),a=r;let l;if(typeof s<"u"&&e==="count"?l=Nw(a,s,n,o):l=Nw(a,[],n,o),e!=="tfIdf")return l;if(s)return G(l,s);throw new q("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class S$ extends et{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){return e=yt(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,n){return J(()=>{e=Ve(e),e.dtype!=="int32"&&(e=wo(e,"int32"));let s;if(typeof n.countWeights<"u"){if(this.outputMode!=="count")throw new q(`countWeights is not used when outputMode !== count.
              Received countWeights=${n.countWeights}`);s=Ve(n.countWeights)}const r=Lr(e),i=jh(e),o=Ms(this.numTokens,r).bufferSync().get(0),a=Ca(i,0).bufferSync().get(0);if(!(o&&a))throw new q(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return sfe(e,this.outputMode,this.numTokens,s)})}}S$.className="CategoryEncoding";pe(S$);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const rfe=["bilinear","nearest"],UP=new Set(rfe);class C$ extends et{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(UP.has(e.interpolation))this.interpolation=e.interpolation;else throw new q(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=yt(e);const n=e[2];return[this.height,this.width,n]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},n=super.getConfig();return Object.assign(e,n),e}call(e,n){return J(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return ri.resizeBilinear(e,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return ri.resizeNearestNeighbor(e,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...UP]} are supported`)})}}C$.className="Resizing";pe(C$);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class IW{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}IW.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class _W extends et{constructor(e){super(e),this.randomGenerator=new IW(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},n=super.getConfig();return Object.assign(e,n),e}}_W.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const ife=["bilinear","nearest"],WP=new Set(ife);class I$ extends _W{constructor(e){super(e);const{factor:n,interpolation:s="bilinear"}=e;if(this.factor=n,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new q(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new q(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new q(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(WP.has(s))this.interpolation=s;else throw new q(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){e=yt(e);const n=e[2];return[this.imgHeight,-1,n]}call(e,n){return J(()=>{const s=Ve(e);this.imgHeight=s.shape[s.shape.length-3];const r=s.shape[s.shape.length-2];this.widthFactor=Yl([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let i=this.widthFactor.dataSync()[0]*r;i=Math.round(i);const o=[this.imgHeight,i];switch(this.interpolation){case"bilinear":return ri.resizeBilinear(e,o);case"nearest":return ri.resizeNearestNeighbor(e,o);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...WP]} are supported`)}})}}I$.className="RandomWidth";pe(I$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ofe(t){return new yf(t)}function afe(t){return new T2(t)}function lfe(t){return new C2(t)}function ufe(t){return new I2(t)}function cfe(t){return new _2(t)}function hfe(t){return new E2(t)}function dfe(t){return new k2(t)}function ffe(t){return new Fy(t)}function pfe(t){return new xf(t)}function mfe(t){return new $2(t)}function gfe(t){return new bf(t)}function yfe(t){return new R2(t)}function vfe(t){return new A2(t)}function wfe(t){return new D2(t)}function xfe(t){return new O2(t)}function bfe(t){return new P2(t)}function Sfe(t){return new W2(t)}function Cfe(t){return new V2(t)}function Ife(t){return new tS(t)}function _fe(t){return new B2(t)}function Tfe(t){return new U2(t)}function kfe(t){return new j2(t)}function Efe(t){return new G2(t)}function Nfe(t){return new H2(t)}function $fe(t){return new K2(t)}function Rfe(t){return new X2(t)}function Afe(t){return new Q2(t)}function Dfe(t){return new e$(t)}function Ofe(t){return new J2(t)}function Pfe(t){return new Z2(t)}function Ffe(t){return new Y2(t)}function Lfe(t){return new t$(t)}function Mfe(t){return new i$(t)}function zfe(t){return new o$(t)}function Bfe(t){return new a$(t)}function _$(t){return new u$(t)}function Vfe(t){return _$(t)}function Ufe(t){return _$(t)}function T$(t){return new h$(t)}function Wfe(t){return T$(t)}function jfe(t){return T$(t)}function k$(t){return new f$(t)}function Gfe(t){return k$(t)}function Hfe(t){return k$(t)}function qfe(t){return new p$(t)}function Kfe(t){return new g$(t)}function TW(t){return new m$(t)}function kW(t){return new y$(t)}function EW(t){return new l$(t)}function NW(t){return new c$(t)}function Xfe(t){return new d$(t)}function Yfe(t){return new L2(t)}function Qfe(t){return new J1(t)}function Jfe(t){return new M2(t)}function Zfe(t){return new My(t)}function epe(t){return new F2(t)}function tpe(t){return new Q1(t)}function npe(t){return new z2(t)}function spe(t){return new eS(t)}function rpe(t){return new Qi(t)}function ipe(t){return new Z1(t)}function ope(t){return new w$(t)}function ape(t){return new v$(t)}const lpe=TW,upe=kW,cpe=EW,hpe=NW;function dpe(t){return new n$(t)}function fpe(t){return new s$(t)}function ppe(t){return new r$(t)}function mpe(t){return new q2(t)}function gpe(t){return new x$(t)}function ype(t){return new b$(t)}function vpe(t){return new C$(t)}function wpe(t){return new S$(t)}function xpe(t){return new I$(t)}const bpe=Object.freeze(Object.defineProperty({__proto__:null,Layer:et,RNN:Qi,RNNCell:Ly,activation:Sfe,add:Rfe,alphaDropout:ppe,average:Afe,averagePooling1d:_$,averagePooling2d:T$,averagePooling3d:k$,avgPool1d:Vfe,avgPool2d:Wfe,avgPool3d:Gfe,avgPooling1d:Ufe,avgPooling2d:jfe,avgPooling3d:Hfe,batchNormalization:Mfe,bidirectional:ope,categoryEncoding:wpe,centerCrop:ype,concatenate:Dfe,conv1d:ffe,conv2d:pfe,conv2dTranspose:mfe,conv3d:gfe,conv3dTranspose:yfe,convLstm2d:npe,convLstm2dCell:spe,cropping2D:wfe,dense:Cfe,depthwiseConv2d:bfe,dot:Lfe,dropout:Ife,elu:afe,embedding:$fe,flatten:Tfe,gaussianDropout:fpe,gaussianNoise:dpe,globalAveragePooling1d:qfe,globalAveragePooling2d:Kfe,globalMaxPool1d:lpe,globalMaxPool2d:upe,globalMaxPooling1d:TW,globalMaxPooling2d:kW,gru:Yfe,gruCell:Qfe,input:XU,inputLayer:ofe,layerNormalization:zfe,leakyReLU:ufe,lstm:Jfe,lstmCell:Zfe,masking:mpe,maxPool1d:cpe,maxPool2d:hpe,maxPooling1d:EW,maxPooling2d:NW,maxPooling3d:Xfe,maximum:Ofe,minimum:Pfe,multiply:Ffe,permute:Nfe,prelu:cfe,randomWidth:xpe,reLU:lfe,repeatVector:kfe,rescaling:gpe,reshape:Efe,resizing:vpe,rnn:rpe,separableConv2d:vfe,simpleRNN:epe,simpleRNNCell:tpe,softmax:hfe,spatialDropout1d:_fe,stackedRNNCells:ipe,thresholdedReLU:dfe,timeDistributed:ape,upSampling2d:xfe,zeroPadding2d:Bfe},Symbol.toStringTag,{value:"Module"}));function Spe(t,e){return v2(t,e)}function Cpe(t,e){return BU(t,e)}function Ipe(t,e){return VU(t,e)}function _pe(t,e){return w2(t,e)}function Tpe(t,e){return x2(t,e)}function kpe(t,e){return zU(t,e)}function Epe(t,e){return ide(t,e)}function Npe(t,e){return y2(t,e)}function $pe(t,e){return q1(t,e)}function Rpe(t,e){return vf(t,e)}function Ape(t,e){return vf(t,e)}function Dpe(t,e){return vf(t,e)}function Ope(t,e){return $c(t,e)}function Ppe(t,e){return $c(t,e)}function Fpe(t,e){return $c(t,e)}function Lpe(t,e){return ode(t,e)}const Mpe=Object.freeze(Object.defineProperty({__proto__:null,MAPE:Ape,MSE:Ppe,binaryAccuracy:Spe,binaryCrossentropy:Cpe,categoricalAccuracy:_pe,categoricalCrossentropy:Tpe,cosineProximity:Npe,mape:Dpe,meanAbsoluteError:$pe,meanAbsolutePercentageError:Rpe,meanSquaredError:Ope,mse:Fpe,precision:kpe,r2Score:Lpe,recall:Epe,sparseCategoricalAccuracy:Ipe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const zpe=Object.freeze(Object.defineProperty({__proto__:null,modelFromJSON:Pde},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Bpe(t){return new Py(t)}function Vpe(t){return Ude(t)}function Upe(t){return Wde(t)}const Wpe=Object.freeze(Object.defineProperty({__proto__:null,l1:Vpe,l1l2:Bpe,l2:Upe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class $W extends Qh{constructor(){super(...arguments),this.model=null}setModel(e){if(!(e instanceof ta))throw new Error("model must be a LayersModel, not some other Container");this.model=e}}function L0(t,e){return t<e}function jP(t,e){return t>e}class RW extends $W{constructor(e){if(super(),e==null&&(e={}),e.restoreBestWeights)throw new Ke("restoreBestWeights = True is not implemented in EarlyStopping yet.");this.monitor=e.monitor||"val_loss",this.minDelta=Math.abs(e.minDelta||0),this.patience=e.patience||0,this.verbose=e.verbose||0,this.mode=e.mode||"auto",this.baseline=e.baseline,["auto","min","max"].indexOf(this.mode)===-1&&(console.warn(`EarlyStopping mode '${this.mode}' is invalid. Falling back to mode 'auto'.`),this.mode="auto"),this.mode==="min"?this.monitorFunc=L0:this.mode==="max"?this.monitorFunc=jP:this.monitor.indexOf("acc")!==-1?this.monitorFunc=jP:this.monitorFunc=L0,this.monitorFunc===L0&&(this.minDelta*=-1)}async onTrainBegin(e){this.wait=0,this.stoppedEpoch=0,this.baseline!=null?this.best=this.baseline:this.best=this.monitorFunc===L0?1/0:-1/0}async onEpochEnd(e,n){await Ba(n);const s=this.getMonitorValue(n);s!=null&&(this.monitorFunc(s-this.minDelta,this.best)?(this.best=s,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=e,this.model.stopTraining=!0)))}async onTrainEnd(e){this.stoppedEpoch>0&&this.verbose&&console.log(`Epoch ${this.stoppedEpoch}: early stopping.`)}getMonitorValue(e){e==null&&(e={});const n=e[this.monitor];return n==null&&console.warn(`Metric for EarlyStopping ${this.monitor} is not available. Available metrics are: ${Object.keys(e)}`),n}}function jpe(t){return new RW(t)}const Gpe={earlyStopping:jpe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hpe=Z();Hpe.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var ir;(function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"})(ir||(ir={}));var GP;(function(t){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))})(GP||(GP={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E$={};function qpe(t,e){const n={tfOpName:t,category:"custom",inputs:[],attrs:[],customExecutor:e};E$[t]=n}function AW(t){return E$[t]}function Kpe(t){delete E$[t]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E(t,e,n,s,r){const i=e.inputParams[t];if(i&&i.inputIndexStart!==void 0){const a=i.inputIndexStart,l=i.inputIndexEnd===0?void 0:i.inputIndexEnd===void 0?a+1:i.inputIndexEnd,u=a<0?e.inputNames.length+a:a;if(i.type==="tensor")return rs(e.inputNames[u],n,s,r);if(i.type==="tensors"){const d=e.inputs.slice(a,l);return e.inputNames.slice(a,l).filter((p,m)=>{var v;return((v=d[m])===null||v===void 0?void 0:v.op)!=="NoOp"}).map(p=>rs(p,n,s,r))}const c=rs(e.inputNames[u],n,s,r),h=c.dataSync();return i.type==="number"?h[0]:Fr(c.shape,h)}const o=e.attrParams[t];return o&&o.value}function rs(t,e,n,s){const[r,i]=ar(t,n);if(s!=null){const a=s.getHashTableHandleByName(r);if(a!=null)return a}const o=n.currentContextIds.find(a=>!!e[Bw(r,a)]);return o!==void 0?e[Bw(r,o)][i]:void 0}function HP(t,e,n){return e[Bw(t,n.currentContextId)]}function Uo(t,e){const[n,s,r]=ar(t,e);return[Bw(n,e&&e.currentContextId),s,r]}function Bw(t,e){return e?`${t}-${e}`:t}function ar(t,e){if(t==="")return["",0,void 0];const n=e!=null&&e.parseNodeNameCache!=null;if(n){const i=e.parseNodeNameCache.get(t);if(i!=null)return i}const s=t.split(":");let r;if(s.length===1)r=[t,0,void 0];else{const i=s[0],o=s.length===3?s[1]:void 0,a=Number(s[s.length-1]);r=[i,a,o]}return n&&e.parseNodeNameCache.set(t,r),r}function pv(t,e,n){let s=E("pad",t,e,n);if(s==="explicit"){s=E("explicitPaddings",t,e,n);const r=[[0,0],[0,0],[0,0],[0,0]];for(let i=0;i<4;i++)r[i][0]=s[i*2],r[i][1]=s[i*2+1];return r}return s}function Wo(t){return t.kept?t:yo(t)}/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xpe=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Ype=Object.freeze(Object.defineProperty({__proto__:null,json:Xpe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qpe=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsFinite",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsInf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Jpe=Object.freeze(Object.defineProperty({__proto__:null,json:Qpe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zpe=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],eme=Object.freeze(Object.defineProperty({__proto__:null,json:Zpe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tme=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],nme=Object.freeze(Object.defineProperty({__proto__:null,json:tme},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sme=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniformInt",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number"},{tfName:"maxval",name:"maxval",type:"number"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],rme=Object.freeze(Object.defineProperty({__proto__:null,json:sme},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ime=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],ome=Object.freeze(Object.defineProperty({__proto__:null,json:ime},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ame=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],lme=Object.freeze(Object.defineProperty({__proto__:null,json:ame},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ume=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],cme=Object.freeze(Object.defineProperty({__proto__:null,json:ume},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hme=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],dme=Object.freeze(Object.defineProperty({__proto__:null,json:hme},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fme=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],pme=Object.freeze(Object.defineProperty({__proto__:null,json:fme},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mme=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BitwiseAnd",category:"logical",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}]}],gme=Object.freeze(Object.defineProperty({__proto__:null,json:mme},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yme=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"MatrixBandPart",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"numLower",type:"tensor"},{start:1,name:"numUpper",type:"tensor"}]}],vme=Object.freeze(Object.defineProperty({__proto__:null,json:yme},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wme=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]}],xme=Object.freeze(Object.defineProperty({__proto__:null,json:wme},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bme=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],Sme=Object.freeze(Object.defineProperty({__proto__:null,json:bme},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cme=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]},{tfOpName:"TensorScatterUpdate",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],Ime=Object.freeze(Object.defineProperty({__proto__:null,json:Cme},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _me=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],Tme=Object.freeze(Object.defineProperty({__proto__:null,json:_me},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kme=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],Eme=Object.freeze(Object.defineProperty({__proto__:null,json:kme},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nme=[{tfOpName:"StaticRegexReplace",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"pattern",name:"pattern",type:"string"},{tfName:"rewrite",name:"rewrite",type:"string"},{tfName:"replace_global",name:"replaceGlobal",type:"bool"}]},{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],$me=Object.freeze(Object.defineProperty({__proto__:null,json:Nme},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rme=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"EnsureShape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],Ame=Object.freeze(Object.defineProperty({__proto__:null,json:Rme},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qP{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const e=[Ype,Jpe,eme,nme,rme,ome,lme,cme,dme,pme,gme,vme,xme,Sme,Ime,Tme,Eme,$me,Ame],n=[].concat(...e.map(s=>s.json));this.opMappers=n.reduce((s,r)=>(s[r.tfOpName]=r,s),{})}transformGraph(e,n={}){const s=e.node,r=[],i=[],o=[],a=s.reduce((m,v)=>(m[v.name]=this.mapNode(v),v.op.startsWith("Placeholder")?r.push(m[v.name]):v.op==="Const"?i.push(m[v.name]):(v.input==null||v.input.length===0)&&o.push(m[v.name]),m),{});let l=[];const u=[];let c={},h={};n!=null&&(c=this.mapSignatureEntries(n.inputs),h=this.mapSignatureEntries(n.outputs));const d=Object.keys(a);d.forEach(m=>{const v=a[m];v.inputNames.forEach((g,w)=>{const[b,,x]=Uo(g),S=a[b];if(S.outputs!=null){const N=S.outputs.indexOf(x);if(N!==-1){const I=`${b}:${N}`;v.inputNames[w]=I}}v.inputs.push(S),S.children.push(v)})}),Object.keys(h).length===0?d.forEach(m=>{const v=a[m];v.children.length===0&&u.push(v)}):Object.keys(h).forEach(m=>{const[v]=Uo(m),g=a[v];g!=null&&(g.signatureKey=h[m],u.push(g))}),Object.keys(c).length>0?Object.keys(c).forEach(m=>{const[v]=Uo(m),g=a[v];g&&(g.signatureKey=c[m],l.push(g))}):l=r;let f={};e.library!=null&&e.library.function!=null&&(f=e.library.function.reduce((m,v)=>(m[v.signature.name]=this.mapFunction(v),m),{}));const p={nodes:a,inputs:l,outputs:u,weights:i,placeholders:r,signature:n,functions:f};return o.length>0&&(p.initNodes=o),p}mapSignatureEntries(e){return Object.keys(e||{}).reduce((n,s)=>(n[e[s].name]=s,n),{})}mapNode(e){const n=AW(e.op)||this.opMappers[e.op]||{};e.attr==null&&(e.attr={});const s={name:e.name,op:e.op,category:n.category,inputNames:(e.input||[]).map(r=>r.startsWith("^")?r.slice(1):r),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:n.outputs};return n.inputs!=null&&(s.inputParams=n.inputs.reduce((r,i)=>(r[i.name]={type:i.type,inputIndexStart:i.start,inputIndexEnd:i.end},r),{})),n.attrs!=null&&(s.attrParams=n.attrs.reduce((r,i)=>{const o=i.type;let a;switch(i.type){case"string":a=I_(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=I_(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"string[]":a=R_(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=R_(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number":a=T_(e.attr,i.tfName,i.defaultValue||0),a===void 0&&i.tfDeprecatedName&&(a=T_(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number[]":a=$_(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=$_(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool":a=__(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=__(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool[]":a=D_(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=D_(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape":a=N_(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=N_(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape[]":a=A_(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=A_(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype":a=k_(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=k_(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype[]":a=E_(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=E_(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"func":a=KP(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=KP(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${i.type} for op: ${e.op}`)}return r[i.name]={value:a,type:o},r},{})),s}mapFunction(e){const n=e.nodeDef,s=[],r=[];let i={};n!=null&&(i=n.reduce((h,d)=>(h[d.name]=this.mapNode(d),d.op==="Const"&&r.push(h[d.name]),h),{}));const o=[],a=[];e.signature.inputArg.forEach(h=>{const[d]=Uo(h.name),f={name:d,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:N$(h.type),type:"dtype"}},children:[]};f.signatureKey=h.name,o.push(f),i[d]=f}),Object.keys(i).forEach(h=>{const d=i[h];d.inputNames.forEach((f,p)=>{const[m,,v]=Uo(f),g=i[m];if(g.outputs!=null){const w=g.outputs.indexOf(v);if(w!==-1){const b=`${m}:${w}`;d.inputNames[p]=b}}d.inputs.push(g),g.children.push(d)})});const u=e.ret;e.signature.outputArg.forEach(h=>{const[d,f]=Uo(u[h.name]),p=i[d];p!=null&&(p.defaultOutput=f,a.push(p))});const c=this.mapArgsToSignature(e);return{nodes:i,inputs:o,outputs:a,weights:r,placeholders:s,signature:c}}mapArgsToSignature(e){return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((n,s)=>(n[s.name]=this.mapArgToTensorInfo(s),n),{}),outputs:e.signature.outputArg.reduce((n,s)=>(n[s.name]=this.mapArgToTensorInfo(s,e.ret),n),{})}}mapArgToTensorInfo(e,n){let s=e.name;return n!=null&&(s=n[s]),{name:s,dtype:e.type}}}function Dme(t){const e=Z().global;if(typeof e.atob<"u")return e.atob(t);if(typeof Buffer<"u")return new Buffer(t,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function DW(t,e){const n=Array.isArray(t)?String.fromCharCode.apply(null,t):Dme(t);return e?n:n.toLowerCase()}function I_(t,e,n,s=!1){const r=t[e];return r!=null?DW(r.s,s):n}function __(t,e,n){const s=t[e];return s?s.b:n}function T_(t,e,n){const s=t[e]||{},r=s.i!=null?s.i:s.f!=null?s.f:n;return typeof r=="number"?r:parseInt(r,10)}function N$(t){switch(typeof t=="string"&&(t=ir[t]),t){case ir.DT_FLOAT:case ir.DT_HALF:return"float32";case ir.DT_INT32:case ir.DT_INT64:case ir.DT_INT8:case ir.DT_UINT8:return"int32";case ir.DT_BOOL:return"bool";case ir.DT_DOUBLE:return"float32";case ir.DT_STRING:return"string";case ir.DT_COMPLEX64:case ir.DT_COMPLEX128:return"complex64";default:return null}}function KP(t,e,n){const s=t[e];return s&&s.func?s.func.name:n}function k_(t,e,n){const s=t[e];return s&&s.type?N$(s.type):n}function E_(t,e,n){const s=t[e];return s&&s.list&&s.list.type?s.list.type.map(r=>N$(r)):n}function OW(t){if(!t.unknownRank)return t.dim!=null?t.dim.map(e=>typeof e.size=="number"?e.size:parseInt(e.size,10)):[]}function N_(t,e,n){const s=t[e];return s&&s.shape?OW(s.shape):n}function $_(t,e,n){const s=t[e];return s?((s.list.f&&s.list.f.length?s.list.f:s.list.i)||[]).map(r=>typeof r=="number"?r:parseInt(r,10)):n}function R_(t,e,n,s=!1){const r=t[e];return r&&r.list&&r.list.s?r.list.s.map(i=>DW(i,s)):n}function A_(t,e,n){const s=t[e];return s&&s.list&&s.list.shape?s.list.shape.map(r=>OW(r)):n}function D_(t,e,n){const s=t[e];return s&&s.list&&s.list.b?s.list.b:n}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ome{constructor(e,n,s){this.node=e,this.tensorMap=n,this.context=s,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(r=>this.getInput(r)),e.rawAttrs!=null&&(this.attrs=Object.keys(e.rawAttrs).reduce((r,i)=>(r[i]=this.getAttr(i),r),{}))}getInput(e){return rs(e,this.tensorMap,this.context)}getAttr(e,n){const s=this.node.rawAttrs[e];if(s.tensor!=null)return rs(e,this.tensorMap,this.context);if(s.i!=null||s.f!=null)return T_(this.node.rawAttrs,e,n);if(s.s!=null)return I_(this.node.rawAttrs,e,n);if(s.b!=null)return __(this.node.rawAttrs,e,n);if(s.shape!=null)return N_(this.node.rawAttrs,e,n);if(s.type!=null)return k_(this.node.rawAttrs,e,n);if(s.list!=null){if(s.list.i!=null||s.list.f!=null)return $_(this.node.rawAttrs,e,n);if(s.list.s!=null)return R_(this.node.rawAttrs,e,n);if(s.list.shape!=null)return A_(this.node.rawAttrs,e,n);if(s.list.b!=null)return D_(this.node.rawAttrs,e,n);if(s.list.type!=null)return E_(this.node.rawAttrs,e,n)}return n}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fs=Object.freeze(Object.defineProperty({__proto__:null,OP_SCOPE_SUFFIX:tE,abs:Tn,acos:uE,acosh:cE,add:he,addN:xB,all:Yb,any:Tm,argMax:Qu,argMin:hE,asin:dE,asinh:fE,atan:pE,atan2:mE,atanh:gE,avgPool:cy,avgPool3d:vE,basicLSTMCell:bB,batchNorm:cf,batchNorm2d:wE,batchNorm3d:xE,batchNorm4d:bE,batchToSpaceND:hy,bincount:SE,bitwiseAnd:SB,booleanMaskAsync:aV,broadcastArgs:CB,broadcastTo:Du,buffer:Xe,cast:ge,ceil:CE,clipByValue:Qs,clone:yo,complex:da,concat:wn,concat1d:IE,concat2d:_E,concat3d:TE,concat4d:kE,conv1d:Qb,conv2d:fa,conv2dTranspose:Jb,conv3d:NE,conv3dTranspose:$E,cos:dy,cosh:Zb,cosineWindow:C1,cumprod:Nm,cumsum:e1,denseBincount:Nw,depthToSpace:RE,depthwiseConv2d:hf,diag:_B,dilation2d:AE,div:Re,divNoNan:DE,dot:OE,dropout:mN,einsum:gu,elu:df,enclosingPowerOfTwo:gN,ensureShape:TB,equal:yr,erf:t1,euclideanNorm:FE,exp:Js,expandDims:ss,expm1:LE,eye:n1,fft:_y,fill:Ic,floor:pf,floorDiv:Xb,fused:gV,gather:mf,gatherND:hV,greater:Ms,greaterEqual:Ca,ifft:Xh,imag:fy,image:ri,inTopKAsync:dV,irfft:y1,isFinite:ME,isInf:zE,isNaN:BE,leakyRelu:py,less:Gh,lessEqual:Xl,linalg:wN,linspace:NB,localResponseNormalization:VE,log:vr,log1p:my,logSigmoid:UE,logSoftmax:r1,logSumExp:gy,logicalAnd:ci,logicalNot:yy,logicalOr:i1,logicalXor:WE,losses:CV,lowerBound:RB,matMul:Je,max:Lr,maxPool:vy,maxPool3d:jE,maxPoolWithArgmax:AB,maximum:Eo,mean:nn,meshgrid:DB,min:jh,minimum:Al,mirrorPad:GE,mod:HE,moments:wy,movingAverage:lV,mul:G,multiRNNCell:OB,multinomial:PB,neg:Bt,norm:ff,notEqual:ec,oneHot:Hh,ones:js,onesLike:wr,op:U,outerProduct:FB,pad:Ia,pad1d:LB,pad2d:MB,pad3d:zB,pad4d:BB,pool:qE,pow:Co,prelu:by,print:lE,prod:KE,raggedGather:VB,raggedRange:UB,raggedTensorToTensor:WB,rand:jB,randomGamma:KB,randomNormal:l1,randomStandardNormal:XB,randomUniform:Yl,randomUniformInt:YB,range:tc,real:qh,reciprocal:iN,relu:Xi,relu6:u1,reshape:H,reverse:zr,reverse1d:QB,reverse2d:JB,reverse3d:ZB,reverse4d:eV,rfft:Ty,round:c1,rsqrt:h1,scalar:Le,scatterND:uV,searchSorted:o1,selu:d1,separableConv2d:f1,setdiff1dAsync:tV,sigmoid:Fi,sign:oN,signal:SV,sin:p1,sinh:m1,slice:lt,slice1d:Sy,slice2d:g1,slice3d:Cy,slice4d:Kh,softmax:Iy,softplus:_c,spaceToBatchND:xy,sparse:IV,sparseToDense:cV,spectral:bV,split:qs,sqrt:Kn,square:$t,squaredDifference:v1,squeeze:Ql,stack:Ps,step:kc,stridedSlice:aN,string:_V,sub:_e,sum:Te,tan:lN,tanh:Rl,tensor:gr,tensor1d:os,tensor2d:yl,tensor3d:uN,tensor4d:nV,tensor5d:sV,tensor6d:rV,tensorScatterUpdate:iV,tile:Ar,topk:hN,transpose:ot,truncatedNormal:x1,unique:dN,unsortedSegmentSum:b1,unstack:Br,upperBound:oV,variable:fN,where:Hn,whereAsync:pN,zeros:En,zerosLike:ct},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pme=(t,e,n,s=fs)=>{switch(t.op){case"BiasAdd":case"AddV2":case"Add":return[s.add(E("a",t,e,n),E("b",t,e,n))];case"AddN":return[s.addN(E("tensors",t,e,n))];case"FloorMod":case"Mod":return[s.mod(E("a",t,e,n),E("b",t,e,n))];case"Mul":return[s.mul(E("a",t,e,n),E("b",t,e,n))];case"RealDiv":case"Div":return[s.div(E("a",t,e,n),E("b",t,e,n))];case"DivNoNan":return[s.divNoNan(E("a",t,e,n),E("b",t,e,n))];case"FloorDiv":return[s.floorDiv(E("a",t,e,n),E("b",t,e,n))];case"Sub":return[s.sub(E("a",t,e,n),E("b",t,e,n))];case"Minimum":return[s.minimum(E("a",t,e,n),E("b",t,e,n))];case"Maximum":return[s.maximum(E("a",t,e,n),E("b",t,e,n))];case"Pow":return[s.pow(E("a",t,e,n),E("b",t,e,n))];case"SquaredDifference":return[s.squaredDifference(E("a",t,e,n),E("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fme=(t,e,n,s=fs)=>{switch(t.op){case"Abs":case"ComplexAbs":return[s.abs(E("x",t,e,n))];case"Acos":return[s.acos(E("x",t,e,n))];case"Acosh":return[s.acosh(E("x",t,e,n))];case"Asin":return[s.asin(E("x",t,e,n))];case"Asinh":return[s.asinh(E("x",t,e,n))];case"Atan":return[s.atan(E("x",t,e,n))];case"Atan2":return[s.atan2(E("x",t,e,n),E("y",t,e,n))];case"Atanh":return[s.atanh(E("x",t,e,n))];case"Ceil":return[s.ceil(E("x",t,e,n))];case"Complex":return[s.complex(E("real",t,e,n),E("imag",t,e,n))];case"Cos":return[s.cos(E("x",t,e,n))];case"Cosh":return[s.cosh(E("x",t,e,n))];case"Elu":return[s.elu(E("x",t,e,n))];case"Erf":return[s.erf(E("x",t,e,n))];case"Exp":return[s.exp(E("x",t,e,n))];case"Expm1":return[s.expm1(E("x",t,e,n))];case"Floor":return[s.floor(E("x",t,e,n))];case"Log":return[s.log(E("x",t,e,n))];case"Log1p":return[s.log1p(E("x",t,e,n))];case"Imag":return[s.imag(E("x",t,e,n))];case"Neg":return[s.neg(E("x",t,e,n))];case"Reciprocal":return[s.reciprocal(E("x",t,e,n))];case"Real":return[s.real(E("x",t,e,n))];case"Relu":return[s.relu(E("x",t,e,n))];case"Round":return[s.round(E("x",t,e,n))];case"Selu":return[s.selu(E("x",t,e,n))];case"Sigmoid":return[s.sigmoid(E("x",t,e,n))];case"Sin":return[s.sin(E("x",t,e,n))];case"Sign":return[s.sign(E("x",t,e,n))];case"Sinh":return[s.sinh(E("x",t,e,n))];case"Softplus":return[s.softplus(E("x",t,e,n))];case"Sqrt":return[s.sqrt(E("x",t,e,n))];case"Square":return[s.square(E("x",t,e,n))];case"Tanh":return[s.tanh(E("x",t,e,n))];case"Tan":return[s.tan(E("x",t,e,n))];case"ClipByValue":return[s.clipByValue(E("x",t,e,n),E("clipValueMin",t,e,n),E("clipValueMax",t,e,n))];case"Relu6":return[s.relu6(E("x",t,e,n))];case"Rsqrt":return[s.rsqrt(rs(t.inputNames[0],e,n))];case"LeakyRelu":return[s.leakyRelu(E("x",t,e,n),E("alpha",t,e,n))];case"Prelu":return[s.prelu(E("x",t,e,n),E("alpha",t,e,n))];case"IsNan":return[s.isNaN(rs(t.inputNames[0],e,n))];case"IsInf":return[s.isInf(rs(t.inputNames[0],e,n))];case"IsFinite":return[s.isFinite(rs(t.inputNames[0],e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yr(t,e,n=""){if(!(typeof t=="number"||typeof e=="number")){O(t.length===e.length,()=>n+` Shapes ${t} and ${e} must match`);for(let s=0;s<t.length;s++){const r=t[s],i=e[s];O(r<0||i<0||r===i,()=>n+` Shapes ${t} and ${e} must match`)}}}function XP(t){return!(typeof t=="number"||t.some(e=>e<0))}function ip(t,e,n){let s=O_(t,n);const r=!XP(s);if(r&&e.length===0)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${s}`);if(r&&e.forEach(i=>{s=O_(i.shape,s)}),!XP(s))throw new Error(`Non-fully-defined elementShape: ${s}`);return s}function O_(t,e){if(typeof t=="number")return e;if(typeof e=="number")return t;if(t.length!==e.length)throw new Error(`Incompatible ranks during merge: ${t} vs. ${e}`);const n=[];for(let s=0;s<t.length;++s){const r=t[s],i=e[s];if(r>=0&&i>=0&&r!==i)throw new Error(`Incompatible shape during merge: ${t} vs. ${e}`);n[s]=r>=0?r:i}return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lme{constructor(e,n,s,r,i,o,a){this.name=e,this.dtype=n,this.maxSize=s,this.elementShape=r,this.identicalElementShapes=i,this.dynamicSize=o,this.clearAfterRead=a,this.tensors=[],this.closed_=!1,this.idTensor=Le(0),On(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(e){this.tensors.forEach(n=>{(e==null||!e.has(n.tensor.id))&&n.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||e>=this.size())throw new Error(`Tried to read from index ${e}, but array size is: ${this.size()}`);const n=this.tensors[e];if(n.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${e} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(n.cleared=!0),n.read=!0,n.tensor}readMany(e){return e.map(n=>this.read(n))}write(e,n){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error(`Tried to write to index ${e}, but array is not resizeable and size is: ${this.maxSize}`);const s=this.tensors[e]||{};if(n.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e},
          because the value dtype is ${n.dtype}, but TensorArray dtype is ${this.dtype}.`);if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=n.shape),Yr(this.elementShape,n.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${e}.`),s.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been read.`);if(s.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been written.`);s.tensor=n,On(n),s.written=!0,this.tensors[e]=s}writeMany(e,n){if(e.length!==n.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${e.length} is not the same as tensors size: ${n.length}.`);e.forEach((s,r)=>this.write(s,n[r]))}gather(e,n){if(n&&n!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${n}`);if(e)e=e.slice(0,this.size());else{e=[];for(let r=0;r<this.size();r++)e.push(r)}if(e.length===0)return gr([],[0].concat(this.elementShape));const s=this.readMany(e);return Yr(this.elementShape,s[0].shape,"TensorArray shape mismatch: "),Ps(s,0)}concat(e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${e}`);if(this.size()===0)return gr([],[0].concat(this.elementShape));const n=[];for(let r=0;r<this.size();r++)n.push(r);const s=this.readMany(n);return Yr(this.elementShape,s[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${s[0].shape})`),wn(s,0)}scatter(e,n){if(n.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${n.dtype}`);if(e.length!==n.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${n.shape[0]}`);const s=Math.max(...e);if(!this.dynamicSize&&s>=this.maxSize)throw new Error(`Max index must be < array size (${s}  vs. ${this.maxSize})`);this.writeMany(e,Br(n,0))}split(e,n){if(n.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${n.dtype}`);let s=0;const r=e.map(l=>(s+=l,s));if(s!==n.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${s}, and tensor's shape is: ${n.shape}`);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${e.length}), and the TensorArray is not marked as dynamically resizeable`);const i=s===0?0:n.size/s,o=[];J(()=>{n=H(n,[1,s,i]);for(let l=0;l<e.length;++l){const c=[0,l===0?0:r[l-1],0],h=[1,e[l],i];o[l]=H(lt(n,c,h),this.elementShape)}return o});const a=[];for(let l=0;l<e.length;l++)a[l]=l;this.writeMany(a,o)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ic{get id(){return this.idTensor.id}constructor(e,n,s,r=-1){this.tensors=e,this.elementShape=n,this.elementDtype=s,e!=null&&e.forEach(i=>{if(s!==i.dtype)throw new Error(`Invalid data types; op elements ${s}, but list elements ${i.dtype}`);Yr(n,i.shape,"TensorList shape mismatch: "),On(i)}),this.idTensor=Le(0),this.maxNumElements=r,On(this.idTensor)}copy(){return new ic([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(e){this.tensors.forEach(n=>{(e==null||!e.has(n.id))&&n.dispose()}),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(e,n,s=-1){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(s!==-1&&this.tensors.length!==s)throw new Error(`Operation expected a list with ${s} elements but got a list with ${this.tensors.length} elements.`);Yr(e,this.elementShape,"TensorList shape mismatch: ");const r=ip(this.elementShape,this.tensors,e);return J(()=>{const i=this.tensors.map(o=>H(o,r));return Ps(i,0)})}popBack(e,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(this.size()===0)throw new Error("Trying to pop from an empty list.");const s=ip(this.elementShape,this.tensors,e),r=this.tensors.pop();return r.kept=!1,Yr(r.shape,e,"TensorList shape mismatch: "),H(r,s)}pushBack(e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(Yr(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");On(e),this.tensors.push(e)}resize(e){if(e<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${e}`);if(this.maxNumElements!==-1&&e>this.maxNumElements)throw new Error(`TensorListResize input size ${e} is greater maxNumElement ${this.maxNumElements}.`);const n=new ic([],this.elementShape,this.elementDtype,this.maxNumElements);n.tensors.length=e;for(let s=0;s<Math.min(this.tensors.length,e);++s)n.tensors[s]=this.tensors[s];return n}getItem(e,n,s){if(s!==this.elementDtype)throw new Error(`Invalid data types; op elements ${s}, but list elements ${this.elementDtype}`);if(e<0||e>this.tensors.length)throw new Error(`Trying to access element ${e} in a list with ${this.tensors.length} elements.`);if(this.tensors[e]==null)throw new Error(`element at index ${e} is null.`);Yr(this.tensors[e].shape,n,"TensorList shape mismatch: ");const r=ip(this.elementShape,this.tensors,n);return H(this.tensors[e],r)}setItem(e,n){if(n.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n.dtype}, but list elements ${this.elementDtype}`);if(e<0||this.maxNumElements!==-1&&e>=this.maxNumElements)throw new Error(`Trying to set element ${e} in a list with max ${this.maxNumElements} elements.`);Yr(this.elementShape,n.shape,"TensorList shape mismatch: "),On(n),this.tensors[e]!=null&&(this.tensors[e].kept=!1),this.tensors[e]=n}gather(e,n,s){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);Yr(this.elementShape,s,"TensorList shape mismatch: "),e=e.slice(0,this.size());const r=ip(this.elementShape,this.tensors,s);return e.length===0?gr([],[0].concat(r)):J(()=>{const i=e.map(o=>H(this.tensors[o],r));return Ps(i,0)})}concat(e,n){if(e&&e!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${e}`);Yr(this.elementShape,n,"TensorList shape mismatch: ");const s=ip(this.elementShape,this.tensors,n);return this.size()===0?gr([],[0].concat(s)):J(()=>{const r=this.tensors.map(i=>H(i,s));return wn(r,0)})}}function Mme(t,e,n){const s=t.dtype;if(t.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${t.shape}`);if(t.dtype!==n)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${n}`);const r=t.shape.slice(1);Yr(r,e,"TensorList shape mismatch: ");const i=Br(t);return new ic(i,e,s)}function zme(t,e,n,s){return new ic([],t,e,s)}function Bme(t,e,n,s){if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const r=Math.max(...e);if(s!=null&&s!==-1&&r>=s)throw new Error(`Max index must be < array size (${r}  vs. ${s})`);const i=new ic([],n,t.dtype,s),o=Br(t,0);return e.forEach((a,l)=>{i.setItem(a,o[l])}),i}function Vme(t,e,n){let s=0;const r=e.map(c=>(s+=c,s));if(s!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${s}, and tensor's shape is: ${t.shape}`);const i=t.shape.slice(1),o=O_(i,n),a=s===0?0:t.size/s,l=J(()=>{const c=[];t=H(t,[1,s,a]);for(let h=0;h<e.length;++h){const f=[0,h===0?0:r[h-1],0],p=[1,e[h],a];c[h]=H(lt(t,f,p),o)}return t.dispose(),c}),u=new ic([],n,t.dtype,e.length);for(let c=0;c<l.length;c++)u.setItem(c,l[c]);return u}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ume=async(t,e,n)=>{switch(t.op){case"If":case"StatelessIf":{const s=E("thenBranch",t,e,n),r=E("elseBranch",t,e,n),i=E("cond",t,e,n),o=E("args",t,e,n);return(await i.data())[0]?n.functionMap[s].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap):n.functionMap[r].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{const s=E("body",t,e,n),r=E("cond",t,e,n),i=E("args",t,e,n),o=await n.functionMap[r].executeFunctionAsync(i,n.tensorArrayMap,n.tensorListMap),a=i.map(c=>c.id);let l=await o[0].data();o.forEach(c=>{!c.kept&&a.indexOf(c.id)===-1&&c.dispose()});let u=i;for(;l[0];){const c=u;u=await n.functionMap[s].executeFunctionAsync(u,n.tensorArrayMap,n.tensorListMap);const h=u.map(f=>f.id);c.forEach(f=>{!f.kept&&a.indexOf(f.id)===-1&&h.indexOf(f.id)===-1&&f.dispose()});const d=await n.functionMap[r].executeFunctionAsync(u,n.tensorArrayMap,n.tensorListMap);l=await d[0].data(),d.forEach(f=>{!f.kept&&a.indexOf(f.id)===-1&&h.indexOf(f.id)===-1&&f.dispose()})}return u}case"LoopCond":{const s=E("pred",t,e,n);return[Wo(s)]}case"Switch":{const s=E("pred",t,e,n);let r=E("data",t,e,n);return r.kept||(r=Wo(r)),(await s.data())[0]?[void 0,r]:[r,void 0]}case"Merge":{const s=t.inputNames.find(r=>rs(r,e,n)!==void 0);if(s){const r=rs(s,e,n);return[Wo(r)]}return}case"Enter":{const s=E("frameName",t,e,n),r=E("tensor",t,e,n);return n.enterFrame(s),[Wo(r)]}case"Exit":{const s=E("tensor",t,e,n);return n.exitFrame(),[Wo(s)]}case"NextIteration":{const s=E("tensor",t,e,n);return n.nextIteration(),[Wo(s)]}case"TensorArrayV3":{const s=E("size",t,e,n),r=E("dtype",t,e,n),i=E("elementShape",t,e,n),o=E("dynamicSize",t,e,n),a=E("clearAfterRead",t,e,n),l=E("identicalElementShapes",t,e,n),u=E("name",t,e,n),c=new Lme(u,r,s,i,l,o,a);return n.addTensorArray(c),[c.idTensor,Le(1)]}case"TensorArrayWriteV3":{const s=E("tensorArrayId",t,e,n),r=E("index",t,e,n),i=E("tensor",t,e,n),o=n.getTensorArray(s.id);return o.write(r,i),[o.idTensor]}case"TensorArrayReadV3":{const s=E("tensorArrayId",t,e,n),r=E("index",t,e,n);return[n.getTensorArray(s.id).read(r)]}case"TensorArrayGatherV3":{const s=E("tensorArrayId",t,e,n),r=E("indices",t,e,n),i=E("dtype",t,e,n);return[n.getTensorArray(s.id).gather(r,i)]}case"TensorArrayScatterV3":{const s=E("tensorArrayId",t,e,n),r=E("indices",t,e,n),i=E("tensor",t,e,n),o=n.getTensorArray(s.id);return o.scatter(r,i),[o.idTensor]}case"TensorArrayConcatV3":{const s=E("tensorArrayId",t,e,n),r=n.getTensorArray(s.id),i=E("dtype",t,e,n);return[r.concat(i)]}case"TensorArraySplitV3":{const s=E("tensorArrayId",t,e,n),r=E("tensor",t,e,n),i=E("lengths",t,e,n),o=n.getTensorArray(s.id);return o.split(i,r),[o.idTensor]}case"TensorArraySizeV3":{const s=E("tensorArrayId",t,e,n),r=n.getTensorArray(s.id);return[Le(r.size(),"int32")]}case"TensorArrayCloseV3":{const s=E("tensorArrayId",t,e,n),r=n.getTensorArray(s.id);return r.clearAndClose(),[r.idTensor]}case"TensorListSetItem":{const s=E("tensorListId",t,e,n),r=E("index",t,e,n),i=E("tensor",t,e,n),o=n.getTensorList(s.id);return o.setItem(r,i),[o.idTensor]}case"TensorListGetItem":{const s=E("tensorListId",t,e,n),r=E("index",t,e,n),i=E("elementShape",t,e,n),o=E("elementDType",t,e,n);return[n.getTensorList(s.id).getItem(r,i,o)]}case"TensorListScatterV2":case"TensorListScatter":{const s=E("indices",t,e,n),r=E("tensor",t,e,n),i=E("elementShape",t,e,n),o=E("numElements",t,e,n),a=Bme(r,s,i,o);return n.addTensorList(a),[a.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const s=E("elementShape",t,e,n),r=E("elementDType",t,e,n);let i;t.op==="TensorListReserve"?i="numElements":i="maxNumElements";const o=E(i,t,e,n),a=t.op==="TensorListReserve"?-1:o,l=zme(s,r,o,a);return n.addTensorList(l),[l.idTensor]}case"TensorListGather":{const s=E("tensorListId",t,e,n),r=E("indices",t,e,n),i=E("elementShape",t,e,n),o=E("elementDType",t,e,n);return[n.getTensorList(s.id).gather(r,o,i)]}case"TensorListStack":{const s=E("tensorListId",t,e,n),r=E("elementShape",t,e,n),i=E("elementDType",t,e,n),o=E("numElements",t,e,n);return[n.getTensorList(s.id).stack(r,i,o)]}case"TensorListFromTensor":{const s=E("tensor",t,e,n),r=E("elementShape",t,e,n),i=E("elementDType",t,e,n),o=Mme(s,r,i);return n.addTensorList(o),[o.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const s=E("tensorListId",t,e,n),r=n.getTensorList(s.id),i=E("dtype",t,e,n),o=E("elementShape",t,e,n);return[r.concat(i,o)]}case"TensorListPushBack":{const s=E("tensorListId",t,e,n),r=E("tensor",t,e,n),i=n.getTensorList(s.id);return i.pushBack(r),[i.idTensor]}case"TensorListPopBack":{const s=E("tensorListId",t,e,n),r=E("elementShape",t,e,n),i=E("elementDType",t,e,n);return[n.getTensorList(s.id).popBack(r,i)]}case"TensorListSplit":{const s=E("tensor",t,e,n),r=E("elementShape",t,e,n),i=E("lengths",t,e,n),o=Vme(s,i,r);return n.addTensorList(o),[o.idTensor]}case"TensorListLength":{const s=E("tensorListId",t,e,n),r=n.getTensorList(s.id);return[Le(r.size(),"int32")]}case"TensorListResize":{const s=E("tensorListId",t,e,n),r=E("size",t,e,n),o=n.getTensorList(s.id).resize(r);return n.addTensorList(o),[o.idTensor]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YP(t,e,n){const[s,r]=E("fusedOps",t,e,n),i=s==="biasadd",o=!i,a=r==="prelu",l=s==="fusedbatchnorm",u=E("numArgs",t,e,n);if(i){if(a&&u!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&i&&u!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(l)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const c=E("strides",t,e,n),h=pv(t,e,n),d=E("dataFormat",t,e,n).toUpperCase(),f=E("dilations",t,e,n);let[p,m]=E("args",t,e,n);o&&(m=p,p=void 0);const v=E("leakyreluAlpha",t,e,n);return{stride:c,pad:h,dataFormat:d,dilations:f,biasArg:p,preluArg:m,activationFunc:r,leakyreluAlpha:v}}const Wme=(t,e,n,s=fs)=>{switch(t.op){case"Conv1D":{const r=E("stride",t,e,n),i=E("pad",t,e,n),o=E("dataFormat",t,e,n).toUpperCase(),a=E("dilation",t,e,n);return[s.conv1d(E("x",t,e,n),E("filter",t,e,n),r,i,o,a)]}case"Conv2D":{const r=E("strides",t,e,n),i=pv(t,e,n),o=E("dataFormat",t,e,n).toUpperCase(),a=E("dilations",t,e,n);return[s.conv2d(E("x",t,e,n),E("filter",t,e,n),[r[1],r[2]],i,o,[a[1],a[2]])]}case"_FusedConv2D":{const{stride:r,pad:i,dataFormat:o,dilations:a,biasArg:l,preluArg:u,activationFunc:c,leakyreluAlpha:h}=YP(t,e,n);return[s.fused.conv2d({x:E("x",t,e,n),filter:E("filter",t,e,n),strides:[r[1],r[2]],pad:i,dataFormat:o,dilations:[a[1],a[2]],bias:l,activation:c,preluActivationWeights:u,leakyreluAlpha:h})]}case"FusedDepthwiseConv2dNative":{const{stride:r,pad:i,dataFormat:o,dilations:a,biasArg:l,preluArg:u,activationFunc:c,leakyreluAlpha:h}=YP(t,e,n);return[s.fused.depthwiseConv2d({x:E("x",t,e,n),filter:E("filter",t,e,n),strides:[r[1],r[2]],pad:i,dataFormat:o,dilations:[a[1],a[2]],bias:l,activation:c,preluActivationWeights:u,leakyreluAlpha:h})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const r=E("outputShape",t,e,n),i=E("strides",t,e,n),o=pv(t,e,n);return[s.conv2dTranspose(E("x",t,e,n),E("filter",t,e,n),r,[i[1],i[2]],o)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const r=E("strides",t,e,n),i=pv(t,e,n),o=E("dilations",t,e,n),a=E("dataFormat",t,e,n).toUpperCase();return[s.depthwiseConv2d(E("input",t,e,n),E("filter",t,e,n),[r[1],r[2]],i,a,[o[1],o[2]])]}case"Conv3D":{const r=E("strides",t,e,n),i=E("pad",t,e,n),o=E("dataFormat",t,e,n).toUpperCase(),a=E("dilations",t,e,n);return[s.conv3d(E("x",t,e,n),E("filter",t,e,n),[r[1],r[2],r[3]],i,o,[a[1],a[2],a[3]])]}case"AvgPool":{const r=E("strides",t,e,n),i=E("pad",t,e,n),o=E("kernelSize",t,e,n);return[s.avgPool(E("x",t,e,n),[o[1],o[2]],[r[1],r[2]],i)]}case"MaxPool":{const r=E("strides",t,e,n),i=E("pad",t,e,n),o=E("kernelSize",t,e,n);return[s.maxPool(E("x",t,e,n),[o[1],o[2]],[r[1],r[2]],i)]}case"MaxPoolWithArgmax":{const r=E("strides",t,e,n),i=E("pad",t,e,n),o=E("kernelSize",t,e,n),a=E("includeBatchInIndex",t,e,n),{result:l,indexes:u}=s.maxPoolWithArgmax(E("x",t,e,n),[o[1],o[2]],[r[1],r[2]],i,a);return[l,u]}case"AvgPool3D":{const r=E("strides",t,e,n),i=E("pad",t,e,n),o=E("kernelSize",t,e,n);return[s.avgPool3d(E("x",t,e,n),[o[1],o[2],o[3]],[r[1],r[2],r[3]],i)]}case"MaxPool3D":{const r=E("strides",t,e,n),i=E("pad",t,e,n),o=E("kernelSize",t,e,n);return[s.maxPool3d(E("x",t,e,n),[o[1],o[2],o[3]],[r[1],r[2],r[3]],i)]}case"Dilation2D":{const r=E("strides",t,e,n),i=E("pad",t,e,n),o=E("dilations",t,e,n),a=r[1],l=r[2],u=o[1],c=o[2];return[s.dilation2d(E("x",t,e,n),E("filter",t,e,n),[a,l],i,[u,c],"NHWC")]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jme=(t,e,n,s=fs)=>{switch(t.op){case"Fill":{const r=E("shape",t,e,n),i=E("dtype",t,e,n),o=E("value",t,e,n);return[s.fill(r,o,i)]}case"LinSpace":{const r=E("start",t,e,n),i=E("stop",t,e,n),o=E("num",t,e,n);return[s.linspace(r,i,o)]}case"Multinomial":{const r=E("logits",t,e,n),i=E("numSamples",t,e,n),o=E("seed",t,e,n);return[s.multinomial(r,i,o)]}case"OneHot":{const r=E("indices",t,e,n),i=E("depth",t,e,n),o=E("onValue",t,e,n),a=E("offValue",t,e,n),l=E("dtype",t,e,n);return[s.oneHot(r,i,o,a,l)]}case"Ones":return[s.ones(E("shape",t,e,n),E("dtype",t,e,n))];case"OnesLike":return[s.onesLike(E("x",t,e,n))];case"RandomStandardNormal":return[s.randomStandardNormal(E("shape",t,e,n),E("dtype",t,e,n),E("seed",t,e,n))];case"RandomUniform":return[s.randomUniform(E("shape",t,e,n),E("minval",t,e,n),E("maxval",t,e,n),E("dtype",t,e,n))];case"RandomUniformInt":return[s.randomUniformInt(E("shape",t,e,n),E("minval",t,e,n),E("maxval",t,e,n),E("seed",t,e,n))];case"Range":{const r=E("start",t,e,n),i=E("stop",t,e,n),o=E("step",t,e,n);return[s.range(r,i,o,E("dtype",t,e,n))]}case"TruncatedNormal":{const r=E("shape",t,e,n),i=E("mean",t,e,n),o=E("stdDev",t,e,n),a=E("seed",t,e,n);return[s.truncatedNormal(r,i,o,E("dtype",t,e,n),a)]}case"Zeros":return[s.zeros(E("shape",t,e,n),E("dtype",t,e,n))];case"ZerosLike":return[s.zerosLike(E("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bC(t,e,n){const s=E("boxes",t,e,n),r=E("scores",t,e,n),i=E("maxOutputSize",t,e,n),o=E("iouThreshold",t,e,n),a=E("scoreThreshold",t,e,n),l=E("softNmsSigma",t,e,n);return{boxes:s,scores:r,maxOutputSize:i,iouThreshold:o,scoreThreshold:a,softNmsSigma:l}}const Gme=async(t,e,n,s,r=fs)=>{switch(t.op){case"NonMaxSuppressionV5":{const{boxes:i,scores:o,maxOutputSize:a,iouThreshold:l,scoreThreshold:u,softNmsSigma:c}=bC(t,e,n),h=await r.image.nonMaxSuppressionWithScoreAsync(i,o,a,l,u,c);return[h.selectedIndices,h.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:i,scores:o,maxOutputSize:a,iouThreshold:l,scoreThreshold:u}=bC(t,e,n),c=E("padToMaxOutputSize",t,e,n),h=await r.image.nonMaxSuppressionPaddedAsync(i,o,a,l,u,c);return[h.selectedIndices,h.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:i,scores:o,maxOutputSize:a,iouThreshold:l,scoreThreshold:u}=bC(t,e,n);return[await r.image.nonMaxSuppressionAsync(i,o,a,l,u)]}case"Where":{const i=r.cast(E("condition",t,e,n),"bool"),o=[await r.whereAsync(i)];return i.dispose(),o}case"ListDiff":return r.setdiff1dAsync(E("x",t,e,n),E("y",t,e,n));default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hme=(t,e,n,s=fs)=>{switch(t.op){case"LowerBound":{const r=E("sortedSequence",t,e,n),i=E("values",t,e,n);return[s.lowerBound(r,i)]}case"TopKV2":{const r=E("x",t,e,n),i=E("k",t,e,n),o=E("sorted",t,e,n),a=s.topk(r,i,o);return[a.values,a.indices]}case"UpperBound":{const r=E("sortedSequence",t,e,n),i=E("values",t,e,n);return[s.upperBound(r,i)]}case"Unique":{const r=E("x",t,e,n),i=s.unique(r);return[i.values,i.indices]}case"UniqueV2":{const r=E("x",t,e,n),i=E("axis",t,e,n),o=s.unique(r,i);return[o.values,o.indices]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qme=(t,e,n,s=fs)=>{switch(t.op){case"Const":return e[t.name];case"PlaceholderWithDefault":const r=E("default",t,e,n);return[rs(t.name,e,n)||r];case"Placeholder":return[rs(t.name,e,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{const c=E("x",t,e,n);return[Wo(c)]}case"IdentityN":return E("x",t,e,n).map(c=>Wo(c));case"Snapshot":const i=E("x",t,e,n);return[Wo(i)];case"Shape":return[s.tensor1d(E("x",t,e,n).shape,"int32")];case"ShapeN":return E("x",t,e,n).map(c=>s.tensor1d(c.shape));case"Size":return[s.scalar(E("x",t,e,n).size,"int32")];case"Rank":return[s.scalar(E("x",t,e,n).rank,"int32")];case"NoOp":return[s.scalar(1)];case"Print":const o=E("x",t,e,n),a=E("data",t,e,n),l=E("message",t,e,n),u=E("summarize",t,e,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(l);for(let c=0;c<a.length;c++)console.log(Array.prototype.slice.call(a[c].dataSync()).slice(0,u));return[o];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kme{get id(){return this.handle.id}constructor(e,n){this.keyDType=e,this.valueDType=n,this.handle=Le(0),this.tensorMap=new Map,On(this.handle)}clearAndClose(){this.tensorMap.forEach(e=>e.dispose()),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return Le(this.size(),"int32")}async import(e,n){this.checkKeyAndValueTensor(e,n);const s=await e.data();return this.tensorMap.forEach(r=>r.dispose()),this.tensorMap.clear(),J(()=>{const r=Br(n),i=s.length,o=r.length;O(i===o,()=>`The number of elements doesn't match, keys has ${i} elements, the values has ${o} elements.`);for(let a=0;a<i;a++){const l=s[a],u=r[a];On(u),this.tensorMap.set(l,u)}return this.handle})}async find(e,n){this.checkKeyAndValueTensor(e,n);const s=await e.data();return J(()=>{const r=[];for(let i=0;i<s.length;i++){const o=s[i],a=this.findWithDefault(o,n);r.push(a)}return Ps(r)})}findWithDefault(e,n){const s=this.tensorMap.get(e);return s??n}checkKeyAndValueTensor(e,n){if(e.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${e.dtype}`);if(n.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${n.dtype}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xme=async(t,e,n,s)=>{switch(t.op){case"HashTable":case"HashTableV2":{const r=s.getHashTableHandleByName(t.name);if(r!=null)return[r];{const i=E("keyDType",t,e,n),o=E("valueDType",t,e,n),a=new Kme(i,o);return s.addHashTable(t.name,a),[a.handle]}}case"InitializeTable":case"InitializeTableV2":case"LookupTableImport":case"LookupTableImportV2":{const r=E("tableHandle",t,e,n,s),i=E("keys",t,e,n),o=E("values",t,e,n);return[await s.getHashTableById(r.id).import(i,o)]}case"LookupTableFind":case"LookupTableFindV2":{const r=E("tableHandle",t,e,n,s),i=E("keys",t,e,n),o=E("defaultValue",t,e,n);return[await s.getHashTableById(r.id).find(i,o)]}case"LookupTableSize":case"LookupTableSizeV2":{const r=E("tableHandle",t,e,n,s);return[s.getHashTableById(r.id).tensorSize()]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yme=(t,e,n,s=fs)=>{switch(t.op){case"ResizeBilinear":{const r=E("images",t,e,n),i=E("size",t,e,n),o=E("alignCorners",t,e,n),a=E("halfPixelCenters",t,e,n);return[s.image.resizeBilinear(r,[i[0],i[1]],o,a)]}case"ResizeNearestNeighbor":{const r=E("images",t,e,n),i=E("size",t,e,n),o=E("alignCorners",t,e,n),a=E("halfPixelCenters",t,e,n);return[s.image.resizeNearestNeighbor(r,[i[0],i[1]],o,a)]}case"CropAndResize":{const r=E("image",t,e,n),i=E("boxes",t,e,n),o=E("boxInd",t,e,n),a=E("cropSize",t,e,n),l=E("method",t,e,n),u=E("extrapolationValue",t,e,n);return[s.image.cropAndResize(r,i,o,a,l,u)]}case"ImageProjectiveTransformV3":{const r=E("images",t,e,n),i=E("transforms",t,e,n),o=E("outputShape",t,e,n),a=E("fillValue",t,e,n),l=E("interpolation",t,e,n),u=E("fillMode",t,e,n);return[s.image.transform(r,i,l.toLowerCase(),u.toLowerCase(),a,o)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qme=(t,e,n,s=fs)=>{switch(t.op){case"Equal":return[s.equal(E("a",t,e,n),E("b",t,e,n))];case"NotEqual":return[s.notEqual(E("a",t,e,n),E("b",t,e,n))];case"Greater":return[s.greater(E("a",t,e,n),E("b",t,e,n))];case"GreaterEqual":return[s.greaterEqual(E("a",t,e,n),E("b",t,e,n))];case"Less":return[s.less(E("a",t,e,n),E("b",t,e,n))];case"LessEqual":return[s.lessEqual(E("a",t,e,n),E("b",t,e,n))];case"LogicalAnd":return[s.logicalAnd(E("a",t,e,n),E("b",t,e,n))];case"LogicalNot":return[s.logicalNot(E("a",t,e,n))];case"LogicalOr":return[s.logicalOr(E("a",t,e,n),E("b",t,e,n))];case"Select":case"SelectV2":return[s.where(E("condition",t,e,n),E("a",t,e,n),E("b",t,e,n))];case"BitwiseAnd":return[s.bitwiseAnd(E("a",t,e,n),E("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jme=(t,e,n,s=fs)=>{switch(t.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[s.matMul(E("a",t,e,n),E("b",t,e,n),E("transposeA",t,e,n),E("transposeB",t,e,n))];case"Einsum":return[s.einsum(E("equation",t,e,n),...E("tensors",t,e,n))];case"Transpose":return[s.transpose(E("x",t,e,n),E("perm",t,e,n))];case"_FusedMatMul":const[r,i]=E("fusedOps",t,e,n),o=r==="biasadd",a=i==="prelu",l=E("numArgs",t,e,n),u=E("leakyreluAlpha",t,e,n);if(o){if(a&&l!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&l!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[c,h]=E("args",t,e,n);return[s.fused.matMul({a:E("a",t,e,n),b:E("b",t,e,n),transposeA:E("transposeA",t,e,n),transposeB:E("transposeB",t,e,n),bias:c,activation:i,preluActivationWeights:h,leakyreluAlpha:u})];case"MatrixBandPart":return[s.linalg.bandPart(E("a",t,e,n),E("numLower",t,e,n),E("numUpper",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zme=(t,e,n,s=fs)=>{switch(t.op){case"EuclideanNorm":return[s.euclideanNorm(E("x",t,e,n),E("axis",t,e,n),E("keepDims",t,e,n))];case"FusedBatchNorm":case"FusedBatchNormV2":return[s.batchNorm(E("x",t,e,n),E("mean",t,e,n),E("variance",t,e,n),E("offset",t,e,n),E("scale",t,e,n),E("epsilon",t,e,n))];case"FusedBatchNormV3":return[s.batchNorm(E("x",t,e,n),E("mean",t,e,n),E("variance",t,e,n),E("offset",t,e,n),E("scale",t,e,n),E("epsilon",t,e,n))];case"LRN":return[s.localResponseNormalization(E("x",t,e,n),E("radius",t,e,n),E("bias",t,e,n),E("alpha",t,e,n),E("beta",t,e,n))];case"Softmax":return[s.softmax(E("x",t,e,n))];case"LogSoftmax":return[s.logSoftmax(E("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ege=(t,e,n,s=fs)=>{switch(t.op){case"RaggedGather":{const{outputNestedSplits:r,outputDenseValues:i}=s.raggedGather(E("paramsNestedSplits",t,e,n),E("paramsDenseValues",t,e,n),E("indices",t,e,n),E("outputRaggedRank",t,e,n));return r.concat(i)}case"RaggedRange":{const{rtNestedSplits:r,rtDenseValues:i}=s.raggedRange(E("starts",t,e,n),E("limits",t,e,n),E("splits",t,e,n));return[r,i]}case"RaggedTensorToTensor":return[s.raggedTensorToTensor(E("shape",t,e,n),E("values",t,e,n),E("defaultValue",t,e,n),E("rowPartitionTensors",t,e,n),E("rowPartitionTypes",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tge=(t,e,n,s=fs)=>{switch(t.op){case"Max":{const a=E("axis",t,e,n),l=E("keepDims",t,e,n);return[s.max(E("x",t,e,n),a,l)]}case"Mean":{const a=E("axis",t,e,n),l=E("keepDims",t,e,n);return[s.mean(E("x",t,e,n),a,l)]}case"Min":{const a=E("axis",t,e,n),l=E("keepDims",t,e,n);return[s.min(E("x",t,e,n),a,l)]}case"Sum":{const a=E("axis",t,e,n),l=E("keepDims",t,e,n);return[s.sum(E("x",t,e,n),a,l)]}case"All":{const a=E("axis",t,e,n),l=E("keepDims",t,e,n);return[s.all(E("x",t,e,n),a,l)]}case"Any":{const a=E("axis",t,e,n),l=E("keepDims",t,e,n);return[s.any(E("x",t,e,n),a,l)]}case"ArgMax":{const a=E("axis",t,e,n);return[s.argMax(E("x",t,e,n),a)]}case"ArgMin":{const a=E("axis",t,e,n);return[s.argMin(E("x",t,e,n),a)]}case"Prod":{const a=E("axis",t,e,n),l=E("keepDims",t,e,n);return[s.prod(E("x",t,e,n),a,l)]}case"Cumprod":{const a=E("axis",t,e,n),l=E("exclusive",t,e,n),u=E("reverse",t,e,n);return[s.cumprod(E("x",t,e,n),a,l,u)]}case"Cumsum":{const a=E("axis",t,e,n),l=E("exclusive",t,e,n),u=E("reverse",t,e,n);return[s.cumsum(E("x",t,e,n),a,l,u)]}case"Bincount":const r=E("x",t,e,n),i=E("weights",t,e,n),o=E("size",t,e,n);return[s.bincount(r,i,o)];case"DenseBincount":{const a=E("x",t,e,n),l=E("weights",t,e,n),u=E("size",t,e,n),c=E("binaryOutput",t,e,n);return[s.denseBincount(a,l,u,c)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nge=(t,e,n,s=fs)=>{switch(t.op){case"ConcatV2":case"Concat":{const r=E("n",t,e,n),i=E("axis",t,e,n);let o=E("tensors",t,e,n);return o=o.slice(0,r),[s.concat(o,i)]}case"Gather":{const r=E("x",t,e,n),i=E("indices",t,e,n);return[s.gather(r,s.cast(i,"int32"),0)]}case"GatherV2":{const r=E("axis",t,e,n),i=E("batchDims",t,e,n),o=E("x",t,e,n),a=E("indices",t,e,n);return[s.gather(o,s.cast(a,"int32"),r,i)]}case"Reverse":{const r=E("dims",t,e,n),i=[];for(let a=0;a<r.length;a++)r[a]&&i.push(a);const o=E("x",t,e,n);return[s.reverse(o,i)]}case"ReverseV2":{const r=E("axis",t,e,n),i=E("x",t,e,n);return[s.reverse(i,r)]}case"Slice":{const r=E("begin",t,e,n),i=E("size",t,e,n);return[s.slice(E("x",t,e,n),r,i)]}case"StridedSlice":{const r=E("begin",t,e,n),i=E("end",t,e,n),o=E("strides",t,e,n),a=E("beginMask",t,e,n),l=E("endMask",t,e,n),u=E("ellipsisMask",t,e,n),c=E("newAxisMask",t,e,n),h=E("shrinkAxisMask",t,e,n),d=E("x",t,e,n);return[s.stridedSlice(d,r,i,o,a,l,u,c,h)]}case"Pack":return J(()=>{const r=E("axis",t,e,n),i=E("tensors",t,e,n),o=i[0].shape,a=s.squeeze(i[0]).shape,l=i.map(u=>{const c=st(u.shape,o);if(!c&&!st(s.squeeze(u).shape,a))throw new Error("the input tensors shape does not match");return c?u:s.reshape(u,o)});return[s.stack(l,r)]});case"Unpack":{const r=E("axis",t,e,n),i=E("tensor",t,e,n);return s.unstack(i,r)}case"Tile":{const r=E("reps",t,e,n);return[s.tile(E("x",t,e,n),r)]}case"Split":case"SplitV":{const r=E("axis",t,e,n),i=E("numOrSizeSplits",t,e,n),o=E("x",t,e,n);return s.split(o,i,r)}case"ScatterNd":{const r=E("indices",t,e,n),i=E("values",t,e,n),o=E("shape",t,e,n);return[s.scatterND(r,i,o)]}case"GatherNd":{const r=E("x",t,e,n),i=E("indices",t,e,n);return[s.gatherND(r,i)]}case"SparseToDense":{const r=E("sparseIndices",t,e,n),i=E("outputShape",t,e,n),o=E("sparseValues",t,e,n),a=E("defaultValue",t,e,n);return[s.sparseToDense(r,o,i,o.dtype===a.dtype?a:s.cast(a,o.dtype))]}case"TensorScatterUpdate":{const r=E("indices",t,e,n),i=E("values",t,e,n),o=E("tensor",t,e,n);return[s.tensorScatterUpdate(o,r,i)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sge=(t,e,n,s=fs)=>{switch(t.op){case"SparseFillEmptyRows":{const{outputIndices:r,outputValues:i,emptyRowIndicator:o,reverseIndexMap:a}=s.sparse.sparseFillEmptyRows(E("indices",t,e,n),E("values",t,e,n),E("denseShape",t,e,n),E("defaultValue",t,e,n));return[r,i,o,a]}case"SparseReshape":{const{outputIndices:r,outputShape:i}=s.sparse.sparseReshape(E("inputIndices",t,e,n),E("inputShape",t,e,n),E("newShape",t,e,n));return[r,i]}case"SparseSegmentMean":return[s.sparse.sparseSegmentMean(E("data",t,e,n),E("indices",t,e,n),E("segmentIds",t,e,n))];case"SparseSegmentSum":return[s.sparse.sparseSegmentSum(E("data",t,e,n),E("indices",t,e,n),E("segmentIds",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rge=(t,e,n,s=fs)=>{switch(t.op){case"FFT":return[s.fft(E("x",t,e,n))];case"IFFT":return[s.ifft(E("x",t,e,n))];case"RFFT":return[s.rfft(E("x",t,e,n))];case"IRFFT":return[s.irfft(E("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ige=(t,e,n,s=fs)=>{switch(t.op){case"StaticRegexReplace":return[s.string.staticRegexReplace(E("input",t,e,n),E("pattern",t,e,n),E("rewrite",t,e,n),E("replaceGlobal",t,e,n))];case"StringNGrams":{const{nGrams:r,nGramsSplits:i}=s.string.stringNGrams(E("data",t,e,n),E("dataSplits",t,e,n),E("separator",t,e,n),E("nGramWidths",t,e,n),E("leftPad",t,e,n),E("rightPad",t,e,n),E("padWidth",t,e,n),E("preserveShortSequences",t,e,n));return[r,i]}case"StringSplit":{const{indices:r,values:i,shape:o}=s.string.stringSplit(E("input",t,e,n),E("delimiter",t,e,n),E("skipEmpty",t,e,n));return[r,i,o]}case"StringToHashBucketFast":return[s.string.stringToHashBucketFast(E("input",t,e,n),E("numBuckets",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oge=(t,e,n,s=fs)=>{switch(t.op){case"Cast":return[s.cast(E("x",t,e,n),E("dtype",t,e,n))];case"ExpandDims":{const r=E("axis",t,e,n);return[s.expandDims(E("x",t,e,n),r)]}case"Squeeze":{const r=E("axis",t,e,n);return[s.squeeze(E("x",t,e,n),r)]}case"Reshape":return[s.reshape(E("x",t,e,n),E("shape",t,e,n))];case"EnsureShape":return[s.ensureShape(E("x",t,e,n),E("shape",t,e,n))];case"MirrorPad":return[s.mirrorPad(E("x",t,e,n),E("padding",t,e,n),E("mode",t,e,n))];case"PadV2":case"Pad":return[s.pad(E("x",t,e,n),E("padding",t,e,n),E("constantValue",t,e,n))];case"SpaceToBatchND":{const r=E("blockShape",t,e,n),i=E("paddings",t,e,n);return[s.spaceToBatchND(E("x",t,e,n),r,i)]}case"BatchToSpaceND":{const r=E("blockShape",t,e,n),i=E("crops",t,e,n);return[s.batchToSpaceND(E("x",t,e,n),r,i)]}case"DepthToSpace":{const r=E("blockSize",t,e,n),i=E("dataFormat",t,e,n).toUpperCase();return[s.depthToSpace(E("x",t,e,n),r,i)]}case"BroadcastTo":return[s.broadcastTo(E("x",t,e,n),E("shape",t,e,n))];case"BroadcastArgs":return[s.broadcastArgs(E("s0",t,e,n),E("s1",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QP(t,e,n,s,r=J){const i=((o,a,l)=>{switch(o.category){case"arithmetic":return r(()=>Pme(o,a,l));case"basic_math":return r(()=>Fme(o,a,l));case"control":return Ume(o,a,l);case"convolution":return r(()=>Wme(o,a,l));case"creation":return r(()=>jme(o,a,l));case"dynamic":return Gme(o,a,l);case"evaluation":return r(()=>Hme(o,a,l));case"image":return r(()=>Yme(o,a,l));case"graph":return r(()=>qme(o,a,l));case"logical":return r(()=>Qme(o,a,l));case"matrices":return r(()=>Jme(o,a,l));case"normalization":return r(()=>Zme(o,a,l));case"ragged":return r(()=>ege(o,a,l));case"reduction":return r(()=>tge(o,a,l));case"slice_join":return r(()=>nge(o,a,l));case"sparse":return r(()=>sge(o,a,l));case"spectral":return r(()=>rge(o,a,l));case"string":return r(()=>ige(o,a,l));case"transformation":return r(()=>oge(o,a,l));case"hash_table":return Xme(o,a,l,s);case"custom":const u=AW(o.op);if(u&&u.customExecutor)return u.customExecutor(new Ome(o,a,l));throw TypeError(`Custom op ${o.op} is not registered.`);default:throw TypeError(`Unknown op '${o.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(t,e,n);return ua(i)?i.then(o=>[].concat(o)):[].concat(i)}class JP{constructor(e={},n={},s={},r={},i){this.weightMap=e,this.tensorArrayMap=n,this.tensorListMap=s,this.functionMap=r,this.parseNodeNameCache=i,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(e,n){return{id:e,frameName:n,iterationId:0}}set currentContext(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const e=[];for(let n=0;n<this.contexts.length-1;n++){const s=this.contexts.slice(0,this.contexts.length-n);e.push(this.contextIdforContexts(s))}e.push(""),this._currentContextIds=e}contextIdforContexts(e){return e?e.map(n=>n.id===0&&n.iterationId===0?"":`${n.frameName}-${n.iterationId}`).join("/"):""}enterFrame(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")}nextIteration(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;const e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")}getWeight(e){return this.weightMap[e]}addTensorArray(e){this.tensorArrayMap[e.id]=e}getTensorArray(e){return this.tensorArrayMap[e]}addTensorList(e){this.tensorListMap[e.id]=e}getTensorList(e){return this.tensorListMap[e]}dispose(e){for(const n in this.tensorArrayMap)this.tensorArrayMap[n].clearAndClose(e);for(const n in this.tensorListMap)this.tensorListMap[n].clearAndClose(e)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZP(t,e,n,s){const r=new Set,i=[];let o=null,a=null;const l=new Set,u=new Set(Object.keys(t).map(d=>ar(d)[0]));s=s||[];const c=new Set(s.map(d=>ar(d.name)[0])),h=[...e];for(;h.length>0;){const d=h.pop();if((vu(d)||pge(d)||mge(d))&&o==null&&(o=d,a=o.children.map(f=>f.name).filter(f=>r.has(f))),r.add(d.name),n[d.name]==null&&!u.has(d.name)&&!c.has(d.name)){if(d.inputs.length===0){i.push(d.name);continue}d.inputs.forEach(f=>{l.has(f.name)||(l.add(f.name),h.push(f))})}}return{inputs:t,outputs:e,usedNodes:r,missingInputs:i,dynamicNode:o,syncInputs:a}}function age(t,e){const{usedNodes:n,inputs:s}=e,r=Object.keys(s).map(v=>ar(v)[0]).map(v=>t.nodes[v]),i=t.initNodes||[],o=v=>n.has(typeof v=="string"?v:v.name);function a(v){return[...new Map(v.map(g=>[g.name,g])).values()]}const l=a([...r,...t.weights,...i]).filter(o),u=a([...l,...Object.values(t.nodes)]).filter(o),c=new Map(u.map(v=>[v.name,v])),h={};for(const v of u){h[v.name]=h[v.name]||0;for(const g of v.children)o(g)||(h[g.name]=Number.POSITIVE_INFINITY),h[g.name]=(h[g.name]||0)+1}const d=Object.entries(h).filter(([,v])=>v===0).map(([v])=>v),f=[...d];for(;d.length>0;){const v=d.pop(),g=c.get(v);for(const w of g.children.filter(o))--h[w.name]===0&&(f.push(w.name),d.push(w.name))}const p=f.map(v=>c.get(v)),m=lge(p,l);return uge(m,l),m}function lge(t,e){const n=new Map(t.map(o=>[o.name,o])),s=e.map(o=>o.name),r=new Set(s);for(;s.length>0;){const o=s.pop(),a=n.get(o);for(const l of a.children)!n.has(l.name)||r.has(l.name)||(r.add(l.name),s.push(l.name))}return t.filter(o=>r.has(o.name))}class M0 extends Error{constructor(e){super(`NodesExecutionOrderError: ${e}`)}}function uge(t,e){const n=new Map(t.map((a,l)=>[a.name,l])),s=new Set(e.map(a=>a.name)),r=a=>s.has(typeof a=="string"?a:a.name),i=new Set(t.map(a=>a.name)),o=a=>i.has(typeof a=="string"?a:a.name);for(const a of t){for(const l of a.children.filter(o)){if(!n.has(l.name))throw new M0(`Child ${l.name} of node ${a.name} is unreachable.`);if(n.get(a.name)>n.get(l.name))throw new M0(`Node ${a.name} is scheduled to run after its child ${l.name}.`)}if(!r(a))for(const l of a.inputs){if(!n.has(l.name))throw new M0(`Input ${l.name} of node ${a.name} is unreachable.`);if(n.get(l.name)>n.get(a.name))throw new M0(`Node ${a.name} is scheduled to run before its input ${l.name}.`)}}}function cge(t){const e=new Map(t.map((a,l)=>[a.name,l])),n=Number.MAX_SAFE_INTEGER,s=t.map((a,l)=>vu(a)?n:l),r=a=>{const l=s[e.get(a.name)];return l??-1},i=t.map((a,l)=>a.children.map(r).reduce((u,c)=>Math.max(u,c),s[l])),o=new Map;for(let a=0;a<t.length;++a){const l=i[a];if(l===n)continue;const u=t[a],c=t[l];o.has(c.name)||o.set(c.name,[]),o.get(c.name).push(u)}return o}const hge=new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),dge=new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),fge=new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function vu(t){return hge.has(t.op)}function pge(t){return dge.has(t.op)}function mge(t){return fge.has(t.op)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vw{get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(e){const n=Object.keys(e).map(s=>e[s].map(r=>r.id));this._weightIds=[].concat(...n),this._weightMap=e}set resourceManager(e){this._resourceManager=e}get inputs(){return this._inputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get outputs(){return this._outputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get inputNodes(){return this._inputs.map(e=>e.signatureKey||e.name)}get outputNodes(){return this._outputs.map(e=>{const n=e.signatureKey||e.name;return e.defaultOutput?`${n}:${e.defaultOutput}`:n})}get functions(){return Object.keys(this._functions).reduce((e,n)=>(e[n]=this._functions[n].signature,e),{})}constructor(e,n){this.graph=e,this.parent=n,this.compiledMap=new Map,this.parseNodeNameCache=new Map,this._weightMap={},this.SEPARATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,e.functions!=null&&Object.keys(e.functions).forEach(s=>{this._functionExecutorMap[s]=new Vw(e.functions[s],this)})}getCompilationKey(e,n){const s=e.map(i=>i.name).sort(),r=n.map(i=>i.name).sort();return s.join(this.SEPARATOR)+"--"+r.join(this.SEPARATOR)}compile(e,n){const s=ZP(e,n,this.weightMap,this._initNodes),{missingInputs:r,dynamicNode:i,syncInputs:o}=s;if(i!=null)throw new Error(`This execution contains the node '${i.name}', which has the dynamic op '${i.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${o}]`);if(r.length>0){const u=n.map(h=>h.name),c=Object.keys(e);throw new Error(`Cannot compute the outputs [${u}] from the provided inputs [${c}]. Missing the following inputs: [${r}]`)}const a=age(this.graph,s),l=cge(a);return{orderedNodes:a,nodeLiveUntilMap:l}}cloneAndKeepTensor(e){if(e==null)return null;const n=e.clone();return On(n),n}cloneTensorList(e){return e?e.map(s=>this.cloneAndKeepTensor(s)):null}cloneTensorMap(e){return Object.fromEntries(Object.entries(e).map(([n,s])=>[n,this.cloneTensorList(s)]))}execute(e,n){this.disposeIntermediateTensors(),e=this.mapInputs(e);const s=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),n=this.mapOutputs(n),this.checkOutputs(n);const r=s.map(d=>this.graph.nodes[ar(d)[0]]),i=n.map(d=>ar(d)[0]),o=new Set(i);let a=i.map(d=>this.graph.nodes[d]);a.length===0&&(a=this._outputs);const l=this.getCompilationKey(r,a);let u=this.compiledMap.get(l);u==null&&(u=this.compile(e,a),this.compiledMap.set(l,u));try{this.keepIntermediateTensors=Z().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(d){this.keepIntermediateTensors=!1,console.warn(d.message)}const c={},h={};return J(()=>{const d=new JP(this.weightMap,c,h,this.functionExecutorMap,this.parseNodeNameCache),f=Object.assign({},this.weightMap);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),Object.keys(e).forEach(g=>{const[w,b]=ar(g,d),x=[];x[b]=e[g],f[w]=x,this.keepIntermediateTensors&&(this.clonedTensorsMap[w]=this.cloneTensorList(x))});const p=this.getFrozenTensorIds(f),{orderedNodes:m,nodeLiveUntilMap:v}=u;for(const g of m){if(f[g.name])continue;const w=QP(g,f,d,this._resourceManager);if(ua(w))throw new Error(`The execution of the op '${g.op}' returned a promise. Please use model.executeAsync() instead.`);f[g.name]=w,this.keepIntermediateTensors&&(this.clonedTensorsMap[g.name]=this.cloneTensorList(w)),this.checkTensorForDisposalWithNodeLiveUntilInfo(g,f,d,p,o,v.get(g.name))}return this.parent==null&&d.dispose(p),n.map(g=>rs(g,f,d))})}getFrozenTensorIds(e){const n=[].concat.apply([],Object.keys(e).map(s=>e[s]).map(s=>s.map(r=>r.id)));return new Set(n)}checkTensorForDisposal(e,n,s,r,i,o,a){if(!(vu(n)||o.has(e))){for(const l of s[e])l!=null&&(a[l.id]=(a[l.id]||0)+n.children.length);for(const l of n.inputs){if(vu(l))continue;const u=HP(l.name,s,r);if(u!=null)for(const c of u){if(!c||c.kept||i.has(c.id))continue;const h=a[c.id];h===1?(c.dispose(),delete a[c.id]):h!=null&&a[c.id]--}}}}checkTensorForDisposalWithNodeLiveUntilInfo(e,n,s,r,i,o){function a(l){return vu(l)||i.has(l.name)}if(!(vu(e)||o==null))for(const l of o){if(a(l))continue;const u=HP(l.name,n,s);for(const c of u)!c||c.kept||r.has(c.id)||c.dispose()}}async executeAsync(e,n){return this._executeAsync(e,n)}disposeIntermediateTensors(){this.clonedTensorsMap&&(Object.values(this.clonedTensorsMap).forEach(e=>{for(const n of e)n&&!n.isDisposed&&n.dispose()}),this.clonedTensorsMap=null)}getIntermediateTensors(){return this.clonedTensorsMap}async _executeAsync(e,n,s=!1,r={},i={}){this.disposeIntermediateTensors(),s||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),n=this.mapOutputs(n),this.checkOutputs(n));try{this.keepIntermediateTensors=Z().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(d){this.keepIntermediateTensors=!1,console.warn(d.message)}const o=new JP(this.weightMap,r,i,this.functionExecutorMap,this.parseNodeNameCache);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap));const a=await this.executeWithControlFlow(e,o,n,s),l=n.map(d=>rs(d,a,o)),u=l.map(d=>d.id),c=Object.keys(e).map(d=>e[d].id),h=new Set([...u,...c,...this.weightIds]);return Object.values(a).forEach(d=>{d.forEach(f=>{f&&!f.isDisposed&&!h.has(f.id)&&f.dispose()})}),this.parent==null&&o.dispose(h),l}async executeFunctionAsync(e,n,s){const r=e.reduce((i,o,a)=>(i[this.inputs[a].name]=o,i),{});return this._executeAsync(r,this.outputNodes,!0,n,s)}async executeWithControlFlow(e,n,s,r){const i=Object.keys(e),o=i.map(x=>this.graph.nodes[ar(x)[0]]),a=s.map(x=>ar(x)[0]),l=new Set(a);let u=a.map(x=>this.graph.nodes[x]);u.length===0&&(u=this._outputs);const{usedNodes:c,missingInputs:h,dynamicNode:d,syncInputs:f}=ZP(e,u,this.weightMap,this._initNodes),p=[...o,...this.graph.weights,...this._initNodes||[]].map(x=>({node:x,contexts:n.currentContext})),m=Object.assign({},this.weightMap);Object.keys(e).forEach(x=>{const[S,N]=ar(x),I=[];I[N]=e[x],m[S]=I});const v={},g=this.getFrozenTensorIds(m),w={};for(;p.length>0;){const x=this.processStack(o,p,n,m,w,g,l,v,c);await Promise.all(x)}d==null&&!r&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const b=u.filter(x=>!vu(x)&&!rs(x.name,m,n)).map(x=>x.name);if(b.length>0){let x="";throw d!=null&&(x=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${f}]`),new Error(`Cannot compute the outputs [${b}] from the provided inputs [${i}]. Consider providing the following inputs: [${h}]. ${x}`)}return m}processStack(e,n,s,r,i,o,a,l,u){const c=[];for(;n.length>0;){const h=n.pop();s.currentContext=h.contexts;let d="";if(h.node.op==="Enter"&&E("isConstant",h.node,r,s)&&([d]=Uo(h.node.name,s)),r[h.node.name]==null){const f=QP(h.node,r,s,this._resourceManager);d||([d]=Uo(h.node.name,s));const p=s.currentContext;ua(f)?c.push(f.then(m=>(r[d]=m,this.keepIntermediateTensors&&(this.clonedTensorsMap[d]=this.cloneTensorList(m)),s.currentContext=p,this.checkTensorForDisposal(d,h.node,r,s,o,a,l),this.processChildNodes(h.node,n,s,r,i,u),m))):(r[d]=f,this.keepIntermediateTensors&&(this.clonedTensorsMap[d]=this.cloneTensorList(f)),this.checkTensorForDisposal(d,h.node,r,s,o,a,l),this.processChildNodes(h.node,n,s,r,i,u))}else this.processChildNodes(h.node,n,s,r,i,u)}return c}processChildNodes(e,n,s,r,i,o){e.children.forEach(a=>{const[l]=Uo(a.name,s);i[l]||!o.has(a.name)||(a.op==="Merge"?a.inputNames.some(u=>!!rs(u,r,s))&&(i[l]=!0,n.push({contexts:s.currentContext,node:a})):a.inputNames.every(u=>!!rs(u,r,s))&&(i[l]=!0,n.push({contexts:s.currentContext,node:a})))})}dispose(){Object.keys(this.weightMap).forEach(e=>this.weightMap[e].forEach(n=>n.dispose()))}checkInputShapeAndType(e){Object.keys(e).forEach(n=>{const s=e[n],[r]=ar(n),i=this.graph.nodes[r];if(i.attrParams.shape&&i.attrParams.shape.value){const o=i.attrParams.shape.value,a=o.length===s.shape.length&&s.shape.every((l,u)=>o[u]===-1||o[u]===l);O(a,()=>`The shape of dict['${i.name}'] provided in model.execute(dict) must be [${o}], but was [${s.shape}]`)}i.attrParams.dtype&&i.attrParams.dtype.value&&O(s.dtype===i.attrParams.dtype.value,()=>`The dtype of dict['${i.name}'] provided in model.execute(dict) must be ${i.attrParams.dtype.value}, but was ${s.dtype}`)})}mapInputs(e){var n,s;const r={};for(const i in e){const o=(s=(n=this._signature)===null||n===void 0?void 0:n.inputs)===null||s===void 0?void 0:s[i];o!=null?r[o.name]=e[i]:r[i]=e[i]}return r}checkInputs(e){const n=Object.keys(e).filter(s=>{const[r]=ar(s);return this.graph.nodes[r]==null});if(n.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${n}] that are not part of graph`)}mapOutputs(e){return e.map(n=>{var s,r;const i=(r=(s=this._signature)===null||s===void 0?void 0:s.outputs)===null||r===void 0?void 0:r[n];return i!=null?i.name:n},{})}checkOutputs(e){e.forEach(n=>{const[s]=ar(n);if(!this.graph.nodes[s])throw new Error(`The output '${n}' is not found in the graph`)})}}class gge{constructor(e={},n={}){this.hashTableNameToHandle=e,this.hashTableMap=n}addHashTable(e,n){this.hashTableNameToHandle[e]=n.handle,this.hashTableMap[n.id]=n}getHashTableHandleByName(e){return this.hashTableNameToHandle[e]}getHashTableById(e){return this.hashTableMap[e]}dispose(){for(const e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(const e in this.hashTableNameToHandle)this.hashTableNameToHandle[e].dispose(),delete this.hashTableNameToHandle[e]}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yge="?tfjs-format=file",vge="model.json";class $${get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}get modelStructuredOutputKeys(){return this.structuredOutputKeys}constructor(e,n={},s=EN){this.modelUrl=e,this.loadOptions=n,this.version="n/a",this.io=s,n==null&&(this.loadOptions={}),this.resourceManager=new gge}findIOHandler(){const e=this.modelUrl;if(e.load!=null)this.handler=e;else if(this.loadOptions.requestInit!=null)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{const n=this.io.getLoadHandlers(e,this.loadOptions);if(n.length===0)n.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(n.length>1)throw new Error(`Found more than one (${n.length}) load handlers for URL '${[e]}'`);this.handler=n[0]}}load(){if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const e=this.handler.load();return ua(e)?e.then(n=>n.getWeightStream==null?this.loadSync(n):this.loadStreaming(n)):this.loadSync(e)}loadSync(e){const n=this.io.decodeWeights(e.weightData,e.weightSpecs);return this.loadWithWeightMap(e,n)}async loadStreaming(e){if(e.getWeightStream==null)throw new Error("Model artifacts missing streamWeights function");const n=await lB(e.getWeightStream(),e.weightSpecs);return this.loadWithWeightMap(e,n)}loadWithWeightMap(e,n){this.artifacts=e;const s=this.artifacts.modelTopology;let r=this.artifacts.signature;if(this.artifacts.userDefinedMetadata!=null){const i=this.artifacts.userDefinedMetadata;i.signature!=null&&(r=i.signature),i.structuredOutputKeys!=null&&(this.structuredOutputKeys=i.structuredOutputKeys)}if(this.signature=r,this.version=`${s.versions.producer}.${s.versions.minConsumer}`,this.executor=new Vw(qP.Instance.transformGraph(s,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(n),this.executor.resourceManager=this.resourceManager,e.modelInitializer!=null&&e.modelInitializer.node!=null){const i=qP.Instance.transformGraph(e.modelInitializer);this.initializer=new Vw(i),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0}async save(e,n){if(typeof e=="string"){const s=this.io.getSaveHandlers(e);if(s.length===0)throw new Error(`Cannot find any save handlers for URL '${e}'`);if(s.length>1)throw new Error(`Found more than one (${s.length}) save handlers for URL '${e}'`);e=s[0]}if(e.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return e.save(this.artifacts)}addStructuredOutputNames(e){if(this.structuredOutputKeys){const n=e instanceof pt?[e]:e,s={};return n.forEach((r,i)=>s[this.structuredOutputKeys[i]]=r),s}return e}predict(e,n){const s=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(s)}async predictAsync(e,n){const s=await this.executeAsync(e,this.outputNodes);return this.addStructuredOutputNames(s)}normalizeInputs(e){var n;if(!(e instanceof pt)&&!Array.isArray(e)){const i=(n=this.signature)===null||n===void 0?void 0:n.inputs;if(i!=null)for(const o in i){const a=i[o];a.resourceId!=null&&(e[o]=this.resourceIdToCapturedInput[a.resourceId])}return e}e=Array.isArray(e)?e:[e];const s=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+s!==this.inputNodes.length)throw new Error(`Input tensor count mismatch, the graph model has ${this.inputNodes.length-s} non-resource placeholders, while there are ${e.length} input tensors provided.`);let r=0;return this.inputNodes.reduce((i,o)=>{var a,l,u;const c=(u=(l=(a=this.signature)===null||a===void 0?void 0:a.inputs)===null||l===void 0?void 0:l[o])===null||u===void 0?void 0:u.resourceId;return c!=null?i[o]=this.resourceIdToCapturedInput[c]:i[o]=e[r++],i},{})}normalizeOutputs(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}executeInitializerGraph(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))}async executeInitializerGraphAsync(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.executeAsync({},[]):this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs))}setResourceIdToCapturedInput(e){if(this.resourceIdToCapturedInput={},this.initializerSignature){const n=this.initializerSignature.outputs,s=Object.keys(n);for(let r=0;r<s.length;r++){const i=s[r],o=n[i];this.resourceIdToCapturedInput[o.resourceId]=e[r]}}}execute(e,n){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),n=this.normalizeOutputs(n);const s=this.executor.execute(e,n);return s.length>1?s:s[0]}async executeAsync(e,n){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(await this.executeInitializerGraphAsync()),e=this.normalizeInputs(e),n=this.normalizeOutputs(n);const s=await this.executor.executeAsync(e,n);return s.length>1?s:s[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(e){return Object.keys(e).reduce((n,s)=>(n[s]=[e[s]],n),{})}dispose(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&je(this.resourceIdToCapturedInput)),this.resourceManager.dispose()}}async function wge(t,e={},n=EN){if(t==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");e==null&&(e={}),e.fromTFHub&&typeof t=="string"&&(t=bge(t));const s=new $$(t,e,n);return await s.load(),s}function xge(t){if(t==null)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide model artifacts or an IOHandler that loads the model");let e;if(t instanceof Array){const[s,r]=t;if(!s)throw new Error("modelJSON must be the first element of the array");if(!r||!(r instanceof ArrayBuffer))throw new Error("An ArrayBuffer of weights must be the second element of the array");if(!("modelTopology"in s))throw new Error("Model JSON is missing 'modelTopology'");if(!("weightsManifest"in s))throw new Error("Model JSON is missing 'weightsManifest'");const i=Ew(s.weightsManifest),o=oE(s,i,r);e=$w(o)}else if("load"in t)e=t;else if("modelTopology"in t&&"weightSpecs"in t&&"weightData"in t)e=$w(t);else throw new Error("Unknown model format");const n=new $$(e);return n.load(),n}function bge(t){return t.endsWith("/")||(t=t+"/"),`${t}${vge}${yge}`}/** @license See the LICENSE file. */const PW="4.22.0";var R$={exports:{}};R$.exports;(function(t){(function(e,n,s){function r(l){var u=this,c=a();u.next=function(){var h=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=h-(u.c=h|0)},u.c=1,u.s0=c(" "),u.s1=c(" "),u.s2=c(" "),u.s0-=c(l),u.s0<0&&(u.s0+=1),u.s1-=c(l),u.s1<0&&(u.s1+=1),u.s2-=c(l),u.s2<0&&(u.s2+=1),c=null}function i(l,u){return u.c=l.c,u.s0=l.s0,u.s1=l.s1,u.s2=l.s2,u}function o(l,u){var c=new r(l),h=u&&u.state,d=c.next;return d.int32=function(){return c.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,h&&(typeof h=="object"&&i(h,c),d.state=function(){return i(c,{})}),d}function a(){var l=4022871197,u=function(c){c=String(c);for(var h=0;h<c.length;h++){l+=c.charCodeAt(h);var d=.02519603282416938*l;l=d>>>0,d-=l,d*=l,l=d>>>0,d-=l,l+=d*4294967296}return(l>>>0)*23283064365386963e-26};return u}n&&n.exports?n.exports=o:this.alea=o})(qe,t)})(R$);var Sge=R$.exports,A$={exports:{}};A$.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var h=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^h^h>>>8},a===(a|0)?l.x=a:u+=a;for(var c=0;c<u.length+64;c++)l.x^=u.charCodeAt(c)|0,l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function o(a,l){var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:this.xor128=o})(qe,t)})(A$);var Cge=A$.exports,D$={exports:{}};D$.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.next=function(){var h=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(h^h<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:u+=a;for(var c=0;c<u.length+64;c++)l.x^=u.charCodeAt(c)|0,c==u.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function o(a,l){var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:this.xorwow=o})(qe,t)})(D$);var Ige=D$.exports,O$={exports:{}};O$.exports;(function(t){(function(e,n,s){function r(a){var l=this;l.next=function(){var c=l.x,h=l.i,d,f;return d=c[h],d^=d>>>7,f=d^d<<24,d=c[h+1&7],f^=d^d>>>10,d=c[h+3&7],f^=d^d>>>3,d=c[h+4&7],f^=d^d<<7,d=c[h+7&7],d=d^d<<13,f^=d^d<<9,c[h]=f,l.i=h+1&7,f};function u(c,h){var d,f=[];if(h===(h|0))f[0]=h;else for(h=""+h,d=0;d<h.length;++d)f[d&7]=f[d&7]<<15^h.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?f[7]=-1:f[d],c.x=f,c.i=0,d=256;d>0;--d)c.next()}u(l,a)}function i(a,l){return l.x=a.x.slice(),l.i=a.i,l}function o(a,l){a==null&&(a=+new Date);var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(c.x&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:this.xorshift7=o})(qe,t)})(O$);var _ge=O$.exports,P$={exports:{}};P$.exports;(function(t){(function(e,n,s){function r(a){var l=this;l.next=function(){var c=l.w,h=l.X,d=l.i,f,p;return l.w=c=c+1640531527|0,p=h[d+34&127],f=h[d=d+1&127],p^=p<<13,f^=f<<17,p^=p>>>15,f^=f>>>12,p=h[d]=p^f,l.i=d,p+(c^c>>>16)|0};function u(c,h){var d,f,p,m,v,g=[],w=128;for(h===(h|0)?(f=h,h=null):(h=h+"\0",f=0,w=Math.max(w,h.length)),p=0,m=-32;m<w;++m)h&&(f^=h.charCodeAt((m+32)%h.length)),m===0&&(v=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,m>=0&&(v=v+1640531527|0,d=g[m&127]^=f+v,p=d==0?p+1:0);for(p>=128&&(g[(h&&h.length||0)&127]=-1),p=127,m=4*128;m>0;--m)f=g[p+34&127],d=g[p=p+1&127],f^=f<<13,d^=d<<17,f^=f>>>15,d^=d>>>12,g[p]=f^d;c.w=v,c.X=g,c.i=p}u(l,a)}function i(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function o(a,l){a==null&&(a=+new Date);var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(c.X&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:this.xor4096=o})(qe,t)})(P$);var Tge=P$.exports,F$={exports:{}};F$.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.next=function(){var h=l.b,d=l.c,f=l.d,p=l.a;return h=h<<25^h>>>7^d,d=d-f|0,f=f<<24^f>>>8^p,p=p-h|0,l.b=h=h<<20^h>>>12^d,l.c=d=d-f|0,l.d=f<<16^d>>>16^p,l.a=p-h|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):u+=a;for(var c=0;c<u.length+20;c++)l.b^=u.charCodeAt(c)|0,l.next()}function i(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function o(a,l){var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:this.tychei=o})(qe,t)})(F$);var kge=F$.exports,FW={exports:{}};(function(t){(function(e,n,s){var r=256,i=6,o=52,a="random",l=s.pow(r,i),u=s.pow(2,o),c=u*2,h=r-1,d;function f(x,S,N){var I=[];S=S==!0?{entropy:!0}:S||{};var C=g(v(S.entropy?[x,b(n)]:x??w(),3),I),_=new p(I),k=function(){for(var A=_.g(i),D=l,R=0;A<u;)A=(A+R)*r,D*=r,R=_.g(1);for(;A>=c;)A/=2,D/=2,R>>>=1;return(A+R)/D};return k.int32=function(){return _.g(4)|0},k.quick=function(){return _.g(4)/4294967296},k.double=k,g(b(_.S),n),(S.pass||N||function(A,D,R,W){return W&&(W.S&&m(W,_),A.state=function(){return m(_,{})}),R?(s[a]=A,D):A})(k,C,"global"in S?S.global:this==s,S.state)}function p(x){var S,N=x.length,I=this,C=0,_=I.i=I.j=0,k=I.S=[];for(N||(x=[N++]);C<r;)k[C]=C++;for(C=0;C<r;C++)k[C]=k[_=h&_+x[C%N]+(S=k[C])],k[_]=S;(I.g=function(A){for(var D,R=0,W=I.i,B=I.j,M=I.S;A--;)D=M[W=h&W+1],R=R*r+M[h&(M[W]=M[B=h&B+D])+(M[B]=D)];return I.i=W,I.j=B,R})(r)}function m(x,S){return S.i=x.i,S.j=x.j,S.S=x.S.slice(),S}function v(x,S){var N=[],I=typeof x,C;if(S&&I=="object")for(C in x)try{N.push(v(x[C],S-1))}catch{}return N.length?N:I=="string"?x:x+"\0"}function g(x,S){for(var N=x+"",I,C=0;C<N.length;)S[h&C]=h&(I^=S[h&C]*19)+N.charCodeAt(C++);return b(S)}function w(){try{var x;return d&&(x=d.randomBytes)?x=x(r):(x=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(x)),b(x)}catch{var S=e.navigator,N=S&&S.plugins;return[+new Date,e,N,e.screen,b(n)]}}function b(x){return String.fromCharCode.apply(0,x)}if(g(s.random(),n),t.exports){t.exports=f;try{d=a1}catch{}}else s["seed"+a]=f})(typeof self<"u"?self:qe,[],Math)})(FW);var Ege=FW.exports,Nge=Sge,$ge=Cge,Rge=Ige,Age=_ge,Dge=Tge,Oge=kge,Ac=Ege;Ac.alea=Nge;Ac.xor128=$ge;Ac.xorwow=Rge;Ac.xorshift7=Age;Ac.xor4096=Dge;Ac.tychei=Oge;var LW=Ac;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */function Pge(t,e){return Uw(t,e)}function Uw(t,e,n=new Map,s=new Set){if(t==null)return null;if(typeof Blob=="function"&&t instanceof Blob)return t.slice();if(s.has(t))throw new Error("Circular references are not supported.");if(n.has(t))return n.get(t);const r=e(t);if(r.recurse&&r.value!==null)throw new Error("A deep map function may not return both a value and recurse=true.");if(r.recurse)if(Jh(t)){const i=Array.isArray(t)?[]:{};s.add(t);for(const o in t){const a=t[o],l=Uw(a,e,n,s);i[o]=l}return s.delete(t),t.__proto__&&(i.__proto__=t.__proto__),i}else throw new Error(`Can't recurse into non-iterable type: ${t}`);else return n.set(t,r.value),r.value}function Fge(t,e=zW){return MW(t,e)}function MW(t,e,n=new Set){const s=t[0];if(n.has(s))throw new Error("Circular references are not supported.");const r=e(t);if(r.recurse&&r.value!==null)throw new Error("A deep zip function may not return both a value and recurse=true.");if(r.recurse)if(Jh(s)){const i=Array.isArray(s)?[]:{};n.add(s);for(const o in s){const a=t.map(u=>u[o]),l=MW(a,e,n);i[o]=l}return n.delete(s),i}else throw new Error(`Can't recurse into non-iterable type: ${s}`);else return r.value}function zW(t){return t===null?null:Jh(t[0])?{value:null,recurse:!0}:{value:t,recurse:!1}}async function BW(t,e){const n=new Map;Uw(t,e,n);for(const r of Array.from(n.keys())){const i=n.get(r);if(ua(i)){const o=await i;n.set(r,o)}}return Uw(t,e,n)}function Jh(t){let e=!1;if(Z().get("IS_BROWSER"))e=t instanceof TextDecoder;else{const{StringDecoder:n}=require("string_decoder");e=t instanceof n}return t!=null&&!ArrayBuffer.isView(t)&&(Array.isArray(t)||typeof t=="object"&&!(t instanceof pt)&&!(t instanceof Promise)&&!e)}function Lge(t){return t==null||Mge(t)||Array.isArray(t)||typeof t=="object"&&t instanceof pt||An(t)}function Mge(t){return t===null||typeof t!="object"&&typeof t!="function"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */function zge(t){return Pge(t,Bge)}function Bge(t){return t instanceof pt?{value:t.clone(),recurse:!1}:Jh(t)?{value:null,recurse:!0}:{value:t,recurse:!1}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class VW{constructor(e){if(this.capacity=e,this.begin=0,this.end=0,e==null)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}wrap(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}get(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}set(e,n){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=n}length(){let e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}isFull(){return this.length()===this.capacity}isEmpty(){return this.length()===0}push(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}pushAll(e){for(const n of e)this.push(n)}pop(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);const e=this.get(this.end);return this.set(this.end,void 0),e}unshift(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}shift(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}shuffleExcise(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const n=this.wrap(this.begin+e),s=this.get(n);return this.set(n,this.pop()),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class sS extends VW{constructor(){super(sS.INITIAL_CAPACITY)}isFull(){return!1}push(e){super.isFull()&&this.expand(),super.push(e)}unshift(e){super.isFull()&&this.expand(),super.unshift(e)}expand(){const e=this.capacity*2,n=new Array(e),s=this.length();for(let r=0;r<s;r++)n[r]=this.get(this.wrap(this.begin+r));this.data=n,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=s}}sS.INITIAL_CAPACITY=32;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */function UW(t){return new Wge(t)}function L$(t){return new jge(t)}function Vge(t,e){return new WW(t,e)}function Uge(t,e=nl.FAIL){return new Zge(t,e)}class Xn{async toArray(){const e=[];let n=await this.next();for(;!n.done;)e.push(n.value),n=await this.next();return e}async toArrayForTest(){const e=this.prefetch(100),n=[];let s=await e.next();for(;!s.done;)n.push(s.value),s=await e.next();return n}async resolveFully(){let e=await this.next();for(;!e.done;)e=await this.next()}async resolveWhile(e){let n=await this.next(),s=e(n.value);for(;!n.done&&s;)n=await this.next(),s=e(n.value)}handleErrors(e){return new Qge(this,e)}filter(e){return new Xge(this,e)}map(e){return new Yge(this,e)}mapAsync(e){return new eF(this,e)}serialMapAsync(e){return new eF(this,e).serial()}flatmap(e){return new Jge(this,e)}async forEachAsync(e){return this.map(e).resolveFully()}async serialForEach(e){return this.serialMapAsync(e).resolveWhile(n=>n===!0)}rowMajorBatch(e,n=!0){return new Kge(this,e,n)}columnMajorBatch(e,n=!0,s=zW){return this.rowMajorBatch(e,n).map(i=>Fge(i,s))}concatenate(e,n){return new WW(UW([this,e]),n)}take(e){return e<0||e==null?this:new qge(this,e)}skip(e){return e<0||e==null?this:new Hge(this,e)}prefetch(e){return new jW(this,e)}shuffle(e,n){return new eye(this,e,n)}serial(){return new Gge(this)}}class Wge extends Xn{constructor(e){super(),this.items=e,this.trav=0}summary(){return`Array of ${this.items.length} items`}async next(){if(this.trav>=this.items.length)return{value:null,done:!0};const e=this.items[this.trav];return this.trav++,{value:zge(e),done:!1}}}class jge extends Xn{constructor(e){super(),this.nextFn=e}summary(){return"Function call"}async next(){try{return this.nextFn()}catch(e){throw e.message=`Error thrown while iterating through a dataset: ${e.message}`,e}}}class Gge extends Xn{constructor(e){super(),this.upstream=e,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Serial`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){return this.upstream.next()}}class Hge extends Xn{constructor(e,n){super(),this.upstream=e,this.maxCount=n,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Skip`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.count++<this.maxCount;){const e=await this.upstream.next();if(e.done)return e;je(e.value)}return this.upstream.next()}}class qge extends Xn{constructor(e,n){super(),this.upstream=e,this.maxCount=n,this.count=0}summary(){return`${this.upstream.summary()} -> Take`}async next(){return this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next()}}class Kge extends Xn{constructor(e,n,s=!0){super(),this.upstream=e,this.batchSize=n,this.enableSmallLastBatch=s,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> RowMajorBatch`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){const e=[];for(;e.length<this.batchSize;){const n=await this.upstream.next();if(n.done)return this.enableSmallLastBatch&&e.length>0?{value:e,done:!1}:{value:null,done:!0};e.push(n.value)}return{value:e,done:!1}}}class Xge extends Xn{constructor(e,n){super(),this.upstream=e,this.predicate=n,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Filter`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;){const e=await this.upstream.next();if(e.done||this.predicate(e.value))return e;je(e.value)}}}class Yge extends Xn{constructor(e,n){super(),this.upstream=e,this.transform=n}summary(){return`${this.upstream.summary()} -> Map`}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const n=ha(e.value),s=this.transform(e.value),r=ha(s);for(const i of n)Kb(i,r)||i.dispose();return{value:s,done:!1}}}class Qge extends Xn{constructor(e,n){super(),this.upstream=e,this.handler=n,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> handleErrors`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;)try{return await this.upstream.next()}catch(e){if(!this.handler(e))return{value:null,done:!0}}}}class eF extends Xn{constructor(e,n){super(),this.upstream=e,this.transform=n}summary(){return`${this.upstream.summary()} -> AsyncMap`}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const n=ha(e.value),s=await this.transform(e.value),r=ha(s);for(const i of n)Kb(i,r)||i.dispose();return{value:s,done:!1}}}class M$ extends Xn{constructor(){super(),this.outputQueue=new sS,this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.outputQueue.length()===0;)if(!await this.pump())return{value:null,done:!0};return{value:this.outputQueue.shift(),done:!1}}}class Jge extends M${constructor(e,n){super(),this.upstream=e,this.transform=n}summary(){return`${this.upstream.summary()} -> Flatmap`}async pump(){const e=await this.upstream.next();if(e.done)return!1;const n=ha(e.value),s=this.transform(e.value),r=ha(s);this.outputQueue.pushAll(s);for(const i of n)Kb(i,r)||i.dispose();return!0}}class WW extends Xn{constructor(e,n){super(),this.baseErrorHandler=n,this.lastRead=null,this.iterator=null,this.moreIterators=e}summary(){return"TODO: fill in upstream of chained summaries -> Chained"}async next(){return this.lastRead=this.readFromChain(this.lastRead),this.lastRead}async readFromChain(e){if(await e,this.iterator==null){const s=await this.moreIterators.next();if(s.done)return{value:null,done:!0};this.iterator=s.value,this.baseErrorHandler!=null&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler))}const n=await this.iterator.next();return n.done?(this.iterator=null,this.readFromChain(e)):n}}var nl;(function(t){t[t.FAIL=0]="FAIL",t[t.SHORTEST=1]="SHORTEST",t[t.LONGEST=2]="LONGEST"})(nl||(nl={}));class Zge extends Xn{constructor(e,n=nl.FAIL){super(),this.iterators=e,this.mismatchMode=n,this.count=0,this.currentPromise=null}summary(){return"{TODO: fill in upstream of zip summaries} -> Zip"}async nextState(e){await e;let n=0,s=0;function r(o){return o instanceof Xn?{value:o.next().then(l=>(n++,l.done&&s++,l.value)),recurse:!1}:{value:null,recurse:!0}}const i=await BW(this.iterators,r);if(n===s)return{value:null,done:!0};if(s>0)switch(this.mismatchMode){case nl.FAIL:throw new Error(`Zipped streams should have the same length. Mismatched at element ${this.count}.`);case nl.SHORTEST:return{value:null,done:!0};case nl.LONGEST:}return this.count++,{value:i,done:!1}}async next(){return this.currentPromise=this.nextState(this.currentPromise),this.currentPromise}}class jW extends Xn{constructor(e,n){super(),this.upstream=e,this.bufferSize=n,this.buffer=new VW(n)}summary(){return`${this.upstream.summary()} -> Prefetch`}refill(){for(;!this.buffer.isFull();){const e=this.upstream.next();this.buffer.push(e)}}next(){return this.refill(),this.buffer.shift()}}class eye extends jW{constructor(e,n,s){super(e,n),this.upstream=e,this.windowSize=n,this.upstreamExhausted=!1,this.random=LW.alea(s||ns().toString()),this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}randomInt(e){return Math.floor(this.random()*e)}chooseIndex(){return this.randomInt(this.buffer.length())}async serialNext(){for(this.upstreamExhausted||this.refill();!this.buffer.isEmpty();){const e=this.chooseIndex(),n=await this.buffer.shuffleExcise(e);if(n.done)this.upstreamExhausted=!0;else return this.refill(),n}return{value:null,done:!0}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class Sf{constructor(){this.size=null}batch(e,n=!0){const s=this;O(e>0,()=>`batchSize needs to be positive, but it is
      ${e}`);let r;return this.size===1/0||this.size==null?r=this.size:n?r=Math.ceil(this.size/e):r=Math.floor(this.size/e),or(async()=>(await s.iterator()).columnMajorBatch(e,n,sye),r)}concatenate(e){const n=this;let s;return this.size===1/0||e.size===1/0?s=1/0:this.size!=null&&e.size!=null?s=this.size+e.size:s=null,or(async()=>(await n.iterator()).concatenate(await e.iterator()),s)}filter(e){const n=this;let s;return this.size===1/0?s=1/0:s=null,or(async()=>(await n.iterator()).filter(r=>J(()=>e(r))),s)}async forEachAsync(e){return(await this.iterator()).forEachAsync(e)}map(e){const n=this;return or(async()=>(await n.iterator()).map(s=>J(()=>e(s))),this.size)}mapAsync(e){const n=this;return or(async()=>(await n.iterator()).mapAsync(e),this.size)}prefetch(e){if(e==null)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");const n=this;return or(async()=>(await n.iterator()).prefetch(e),this.size)}repeat(e){const n=this;let s;return this.size!=null&&e>0?s=this.size*e:e===0?s=0:this.size!=null&&(e===void 0||e<0)?s=1/0:s=null,or(async()=>{const r=L$(async()=>({value:await n.iterator(),done:!1}));return Vge(r.take(e))},s)}skip(e){const n=this;let s;return this.size!=null&&e>=0&&this.size>=e?s=this.size-e:this.size!=null&&(this.size<e||e===void 0||e<0)?s=0:s=null,or(async()=>(await n.iterator()).skip(e),s)}shuffle(e,n,s=!0){if(e==null||e<0)throw this.size==null?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError(`\`Dataset.shuffle()\` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for \`tf.Tensor\`s), consider setting bufferSize to the dataset size (${this.size} elements)`);const r=this,i=LW.alea(n||ns().toString());return or(async()=>{let o=i.int32();return s&&(o+=i.int32()),(await r.iterator()).shuffle(e,o.toString())},this.size)}take(e){const n=this;let s;return this.size!=null&&this.size>e?s=e:this.size!=null&&this.size<=e?s=this.size:s=null,or(async()=>(await n.iterator()).take(e),s)}async toArray(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArray()}async toArrayForTest(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArrayForTest()}}Sf.MAX_BUFFER_SIZE=1e4;function or(t,e=null){return new class extends Sf{constructor(){super(...arguments),this.size=e}async iterator(){return t()}}}function tye(t){return or(async()=>UW(t),t.length)}function nye(t){if(!Jh(t))throw new Error("The argument to zip() must be an object or array.");let e;if(Array.isArray(t))for(let n=0;n<t.length;n++)e=e==null?t[n].size:Math.min(e,t[n].size);else if(t instanceof Object)for(const n in t)e=e==null?t[n].size:Math.min(e,t[n].size);return or(async()=>{const n=await BW(t,s=>{if(s instanceof Sf)return{value:s.iterator(),recurse:!1};if(Jh(s))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")});return Uge(n,nl.SHORTEST)},e)}function sye(t){if(t===null)return null;const e=t[0];return Lge(e)?{value:rye(t),recurse:!1}:{value:null,recurse:!0}}function rye(t){if(t.length===0)throw new Error("Can't make a batch of zero elements.");return t[0]instanceof pt?Ps(t):gr(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class GW extends Sf{constructor(e){super(),this.input=e}async iterator(){return(await this.input.iterator()).decodeUTF8().split(`
`).map(r=>(r.endsWith("\r")&&(r=r.slice(0,-1)),r))}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */const z0='"',op=Symbol("out"),tF=Symbol("field"),B0=Symbol("quote"),SC=Symbol("quoteafterquote"),nF=Symbol("quoteinquote");class HW extends Sf{async columnNames(){return this.columnNamesValidated||await this.setColumnNames(),this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames}async setColumnNames(){const e=await this.maybeReadHeaderLine();if(!this.fullColumnNames&&!e)throw new Error("Column names must be provided if there is no header line.");this.fullColumnNames&&e&&O(e.length===this.fullColumnNames.length,()=>"The length of provided columnNames ("+this.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+e.length.toString()+")."),this.fullColumnNames||(this.fullColumnNames=e);const n=this.fullColumnNames.reduce((r,i)=>(r[i]=r[i]+1||1,r),{}),s=Object.keys(n).filter(r=>n[r]>1);if(O(s.length===0,()=>"Duplicate column names found: "+s.toString()),this.columnConfigs){for(const r of Object.keys(this.columnConfigs))if(this.fullColumnNames.indexOf(r)===-1)throw new Error('The key "'+r+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").")}this.columnNamesValidated=!0}async maybeReadHeaderLine(){if(this.hasHeader){const n=await(await this.base.iterator()).next();if(n.done)throw new Error("No data was found for CSV parsing.");const s=n.value;return this.parseRow(s,!1)}else return null}constructor(e,n){super(),this.input=e,this.hasHeader=!0,this.fullColumnNames=null,this.columnNamesValidated=!1,this.columnConfigs=null,this.configuredColumnsOnly=!1,this.delimiter=",",this.delimWhitespace=!1,this.base=new GW(e),n||(n={}),this.hasHeader=n.hasHeader!==!1,this.fullColumnNames=n.columnNames,this.columnConfigs=n.columnConfigs,this.configuredColumnsOnly=n.configuredColumnsOnly,n.delimWhitespace?(O(n.delimiter==null,()=>"Delimiter should not be provided when delimWhitespace is true."),this.delimWhitespace=!0,this.delimiter=" "):this.delimiter=n.delimiter?n.delimiter:","}async iterator(){this.columnNamesValidated||await this.setColumnNames();let e=await this.base.iterator();return this.hasHeader&&(e=e.skip(1)),e.map(n=>this.makeDataElement(n))}makeDataElement(e){const n=this.parseRow(e),s={},r={};for(let i=0;i<this.fullColumnNames.length;i++){const o=this.fullColumnNames[i],a=this.columnConfigs?this.columnConfigs[o]:null;if(!(this.configuredColumnsOnly&&!a)){const l=n[i];let u=null;if(l==="")if(a&&a.default!==void 0)u=a.default;else{if(a&&(a.required||a.isLabel))throw new Error(`Required column ${o} is empty in this line: ${e}`);u=void 0}else{const c=Number(l);if(isNaN(c))a&&a.dtype==="bool"?u=this.getBoolean(l):u=l;else if(!a||!a.dtype)u=c;else switch(a.dtype){case"float32":u=c;break;case"int32":u=Math.floor(c);break;case"bool":u=this.getBoolean(l);break;default:u=c}}a&&a.isLabel?r[o]=u:s[o]=u}}return Object.keys(r).length===0?s:{xs:s,ys:r}}getBoolean(e){return e==="1"||e.toLowerCase()==="true"?1:0}parseRow(e,n=!0){const s=[];let r=0;const i=e.length;let o=op;for(let a=0;a<i;a++)switch(o){case op:switch(e.charAt(a)){case z0:r=a+1,o=B0;break;case this.delimiter:if(r=a+1,this.delimiter===" "&&this.delimWhitespace)break;s.push(""),o=op;break;default:o=tF,r=a;break}break;case tF:switch(e.charAt(a)){case this.delimiter:s.push(e.substring(r,a)),o=op,r=a+1;break}break;case B0:switch(e.charAt(a)){case z0:o=SC;break}break;case SC:switch(e.charAt(a)){case this.delimiter:s.push(e.substring(r,a-1)),o=op,r=a+1;break;case z0:o=B0;break;default:o=nF;break}break;case nF:switch(e.charAt(a)){case z0:o=B0;break}break}if(o===SC?s.push(e.substring(r,i-1)):s.push(e.substring(r)),n&&s.length!==this.fullColumnNames.length)throw new Error(`Invalid row in csv file. Should have ${this.fullColumnNames.length} elements in a row, but got ${s}`);return s}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class z$ extends Xn{constructor(e){super(),this.microphoneConfig=e,this.isClosed=!1,this.fftSize=e.fftSize||1024;const n=Math.log2(this.fftSize);if(this.fftSize<0||n<4||n>14||!Number.isInteger(n))throw new Error(`Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got ${this.fftSize}`);if(this.numFrames=e.numFramesPerSpectrogram||43,this.sampleRateHz=e.sampleRateHz,this.columnTruncateLength=e.columnTruncateLength||this.fftSize,this.audioTrackConstraints=e.audioTrackConstraints,this.smoothingTimeConstant=e.smoothingTimeConstant||0,this.includeSpectrogram=e.includeSpectrogram!==!1,this.includeWaveform=e.includeWaveform===!0,!this.includeSpectrogram&&!this.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.")}summary(){return"microphone"}static async create(e={}){if(!Z().get("IS_BROWSER"))throw new Error("microphone API is only supported in browser environment.");const n=new z$(e);return await n.start(),n}async start(){try{this.stream=await navigator.mediaDevices.getUserMedia({audio:this.audioTrackConstraints==null?!0:this.audioTrackConstraints,video:!1})}catch(s){throw new Error(`Error thrown while initializing video stream: ${s.message}`)}if(!this.stream)throw new Error("Could not obtain audio from microphone.");const e=window.AudioContext||window.webkitAudioContext;if(this.audioContext=new e,!this.sampleRateHz)this.sampleRateHz=this.audioContext.sampleRate;else if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error(`Mismatch in sampling rate: Expected: ${this.sampleRateHz}; Actual: ${this.audioContext.sampleRate}`);const n=this.audioContext.createMediaStreamSource(this.stream);this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=this.fftSize*2,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,n.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize)}async next(){if(this.isClosed)return{value:null,done:!0};let e,n;const s=await this.getAudioData();if(this.includeSpectrogram){const r=this.flattenQueue(s.freqDataQueue);e=this.getTensorFromAudioDataArray(r,[this.numFrames,this.columnTruncateLength,1])}if(this.includeWaveform){const r=this.flattenQueue(s.timeDataQueue);n=this.getTensorFromAudioDataArray(r,[this.numFrames*this.fftSize,1])}return{value:{spectrogram:e,waveform:n},done:!1}}async capture(){return(await this.next()).value}async getAudioData(){const e=[],n=[];let s=0;return new Promise(r=>{const i=setInterval(()=>{this.includeSpectrogram&&(this.analyser.getFloatFrequencyData(this.freqData),this.freqData[0]===-1/0&&r({freqDataQueue:e,timeDataQueue:n}),e.push(this.freqData.slice(0,this.columnTruncateLength))),this.includeWaveform&&(this.analyser.getFloatTimeDomainData(this.timeData),n.push(this.timeData.slice())),++s===this.numFrames&&(clearInterval(i),r({freqDataQueue:e,timeDataQueue:n}))},this.fftSize/this.sampleRateHz*1e3)})}stop(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())}toArray(){throw new Error("Can not convert infinite audio stream to array.")}getSampleRate(){return this.sampleRateHz}flattenQueue(e){const n=e[0].length,s=new Float32Array(e.length*n);return e.forEach((r,i)=>s.set(r,i*n)),s}getTensorFromAudioDataArray(e,n){const s=new Float32Array(re(n));return s.set(e,s.length-e.length),gr(s,n)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class B$ extends Xn{constructor(e,n){if(super(),this.webcamVideoElement=e,this.webcamConfig=n,this.isClosed=!0,this.resize=!1,this.needToResize())if(this.resize=!0,this.cropSize=[this.webcamConfig.resizeHeight,this.webcamConfig.resizeWidth],this.cropBoxInd=os([0],"int32"),this.webcamConfig.centerCrop){const s=this.webcamConfig.resizeWidth*1/this.webcamVideoElement.width,r=this.webcamConfig.resizeHeight*1/this.webcamVideoElement.height,i=(1-s)/2,o=(1-r)/2,a=i+s,l=r+o;this.cropBox=yl([o,i,l,a],[1,4])}else this.cropBox=yl([0,0,1,1],[1,4])}summary(){return"webcam"}static async create(e,n={}){if(!Z().get("IS_BROWSER"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!e){if(e=document.createElement("video"),!n.resizeWidth||!n.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");e.width=n.resizeWidth,e.height=n.resizeHeight}const s=new B$(e,n);return await s.start(),s}async start(){this.webcamConfig.facingMode&&O(this.webcamConfig.facingMode==="user"||this.webcamConfig.facingMode==="environment",()=>`Invalid webcam facing mode: ${this.webcamConfig.facingMode}. Please provide 'user' or 'environment'`);try{this.stream=await navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})}catch(e){throw e.message=`Error thrown while initializing video stream: ${e.message}`,e}if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(e){console.log(e),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,new Promise(e=>{this.webcamVideoElement.onloadedmetadata=()=>{e()}})}async next(){if(this.isClosed)return{value:null,done:!0};let e;try{e=OV(this.webcamVideoElement)}catch(n){throw new Error(`Error thrown converting video to pixels: ${JSON.stringify(n)}`)}if(this.resize)try{return{value:this.cropAndResizeFrame(e),done:!1}}catch(n){throw new Error(`Error thrown cropping the video: ${n.message}`)}finally{e.dispose()}else return{value:e,done:!1}}needToResize(){return!!(this.webcamConfig.resizeWidth&&this.webcamConfig.resizeHeight&&(this.webcamVideoElement.width!==this.webcamConfig.resizeWidth||this.webcamVideoElement.height!==this.webcamConfig.resizeHeight))}cropAndResizeFrame(e){return J(()=>{const n=ss(ge(e,"float32"),0);let s;s=ri.cropAndResize(n,this.cropBox,this.cropBoxInd,this.cropSize,"bilinear");const r=s.shape;return H(s,r.slice(1))})}async capture(){return(await this.next()).value}stop(){this.stream.getTracks().forEach(n=>n.stop());try{this.webcamVideoElement.srcObject=null}catch(n){console.log(n),this.webcamVideoElement.src=null}this.isClosed=!0}toArray(){throw new Error("Can not convert infinite video stream to array.")}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class qW{}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class KW extends Xn{split(e){return new iye(this,e)}}class iye extends KW{constructor(e,n){super(),this.upstream=e,this.impl=new oye(e,n)}summary(){return this.impl.summary()}async next(){return this.impl.next()}}class oye extends M${constructor(e,n){super(),this.upstream=e,this.separator=n,this.carryover=""}summary(){return`${this.upstream.summary()} -> Split('${this.separator}')`}async pump(){const e=await this.upstream.next();if(e.done)return this.carryover===""?!1:(this.outputQueue.push(this.carryover),this.carryover="",!0);const n=e.value.split(this.separator);n[0]=this.carryover+n[0];for(const s of n.slice(0,-1))this.outputQueue.push(s);return this.carryover=n[n.length-1],!0}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class aye extends Xn{decodeUTF8(){return new lye(this)}}class lye extends KW{constructor(e){super(),this.upstream=e,this.impl=new uye(e)}summary(){return this.impl.summary()}async next(){return this.impl.next()}}class uye extends M${constructor(e){if(super(),this.upstream=e,Z().get("IS_BROWSER"))this.decoder=new TextDecoder("utf-8");else{const{StringDecoder:n}=require("string_decoder");this.decoder=new n("utf8")}}summary(){return`${this.upstream.summary()} -> Utf8`}async pump(){const e=await this.upstream.next();let n;if(e.done)return!1;n=e.value;let s;return Z().get("IS_BROWSER")?s=this.decoder.decode(n,{stream:!0}):s=this.decoder.write(Buffer.from(n.buffer)),this.outputQueue.push(s),!0}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class XW extends aye{constructor(e,n={}){super(),this.file=e,this.options=n,O(e instanceof Uint8Array||(Z().get("IS_BROWSER")?e instanceof File||e instanceof Blob:!1),()=>"FileChunkIterator only supports File, Blob and Uint8Array right now."),this.offset=n.offset||0,this.chunkSize=n.chunkSize||1024*1024}summary(){return`FileChunks ${this.file}`}async next(){return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?{value:null,done:!0}:{value:await new Promise((n,s)=>{const r=this.offset+this.chunkSize;if(this.file instanceof Uint8Array)n(new Uint8Array(this.file.slice(this.offset,r)));else{const i=new FileReader;i.onload=a=>{let l=i.result;if(l instanceof ArrayBuffer&&(l=new Uint8Array(l)),!(l instanceof Uint8Array))return s(new TypeError("FileReader returned unknown type."));n(l)},i.onabort=a=>s(new Error("Aborted")),i.onerror=a=>s(new Error(a.type));const o=this.file.slice(this.offset,r);i.readAsArrayBuffer(o)}this.offset=r}),done:!1}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */async function cye(t,e={},n){let s,r;typeof t=="string"?s=t:(s=t.url,r=hye(t));const i=await J4(s,r);if(i.ok){const o=new Uint8Array(await i.arrayBuffer());return new XW(o,e)}else throw new Error(i.statusText)}const hye=t=>({method:t.method,headers:t.headers,body:t.body,mode:t.mode,credentials:t.credentials,cache:t.cache,redirect:t.redirect,referrer:t.referrer,integrity:t.integrity});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */function YW(t){return typeof t=="string"&&t.slice(0,7)==="file://"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class QW extends qW{constructor(e,n={}){super(),this.input=e,this.options=n}async iterator(){if(YW(this.input)&&Z().get("IS_NODE")){const e=require("fs");this.input=e.readFileSync(this.input.slice(7))}return new XW(this.input,this.options)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class JW extends qW{constructor(e,n={}){super(),this.url=e,this.fileOptions=n}async iterator(){return YW(this.url)?new QW(this.url,this.fileOptions).iterator():cye(this.url,this.fileOptions)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */function dye(t,e={}){return new HW(new JW(t),e)}function fye(t){const e=L$(t);return or(async()=>e)}function pye(t){return or(async()=>{const e=await t();return L$(()=>e.next())})}async function mye(t,e){return B$.create(t,e)}async function gye(t){return z$.create(t)}/** @license See the LICENSE file. */const ZW="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yye=Object.freeze(Object.defineProperty({__proto__:null,CSVDataset:HW,Dataset:Sf,FileDataSource:QW,TextLineDataset:GW,URLDataSource:JW,array:tye,csv:dye,func:fye,generator:pye,microphone:gye,version_data:ZW,webcam:mye,zip:nye},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ne(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&O(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vye=S1;class zy extends Mx{nextDataId(){return zy.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new jk(this,xi())}write(e,n,s){this.firstUse&&(this.firstUse=!1,Z().get("IS_NODE")&&Nr(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:s,refCount:1}),r}makeTensorInfo(e,n,s){let r;if(n==="string"&&s!=null&&s.length>0&&ao(s[0])){const i=s.map(o=>go(o));r=this.write(i,e,n)}else r=this.write(s,e,n);return{dataId:r,shape:e,dtype:n}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const n=this.data.get(e);n.refCount++}decRef(e){if(this.data.has(e)){const n=this.data.get(e);n.refCount--}}move(e,n,s,r,i){this.data.set(e,{values:n,dtype:r,refCount:i})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:n,complexTensorInfos:s}=this.data.get(e);if(n==="complex64"){const r=this.readSync(s.real.dataId),i=this.readSync(s.imag.dataId);return pa(r,i)}return F4(this.data.get(e).values,n)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const s=n.map(r=>ca(r));return Xe(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Xe(e.shape,e.dtype,n)}makeOutput(e,n,s){return xi().makeTensorFromTensorInfo(this.makeTensorInfo(n,s,e),this)}disposeData(e,n=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!n&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(e);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const n=ns();return e(),{kernelMs:ns()-n}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){Ne([e],"where");const n=this.readSync(e.dataId);return vye(e.shape,n)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}zy.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ej(t){const e=new Float32Array(t.length);for(let n=0;n<t.length;++n)e[n]=Math.abs(t[n]);return e}const wye=t=>{const{x:e}=t.inputs,n=t.backend;Ne(e,"abs");let s=new Float32Array(re(e.shape));const r=n.data.get(e.dataId).values;return s=ej(r),n.makeOutput(s,e.shape,e.dtype)},xye={kernelName:rg,backendName:"cpu",kernelFunc:wye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cn(t){return(e,n,s,r,i)=>{const o=Ge(e,n),a=o.length,l=Me(o),u=re(o),c=qn(i,u),h=e.length,d=n.length,f=Me(e),p=Me(n),m=Zu(e,o),v=Zu(n,o);if(m.length+v.length===0)for(let g=0;g<c.length;++g)c[g]=t(s[g%s.length],r[g%r.length]);else for(let g=0;g<c.length;++g){const w=bc(g,a,l),b=w.slice(-h);m.forEach(I=>b[I]=0);const x=Pi(b,h,f),S=w.slice(-d);v.forEach(I=>S[I]=0);const N=Pi(S,d,p);c[g]=t(s[x],r[N])}return[c,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ur(t){const{inputs:e,backend:n}=t,{real:s,imag:r}=e,i=n.data.get(s.dataId).values,o=n.data.get(r.dataId).values,a=n.makeTensorInfo(s.shape,"complex64"),l=n.data.get(a.dataId);return l.complexTensorInfos={real:n.makeTensorInfo(s.shape,"float32",i),imag:n.makeTensorInfo(r.shape,"float32",o)},a}const bye={kernelName:qx,backendName:"cpu",kernelFunc:ur};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ww(t,e,n="float32"){if(n==="complex64"){const r=Ww(t,e,"float32"),i=Ww(t,e,"float32");return ur({inputs:{real:r,imag:i},backend:t})}const s=us(re(e),n);return t.makeTensorInfo(e,n,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _o(t){const{inputs:e,backend:n}=t,{x:s}=e;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const Sye={kernelName:Od,backendName:"cpu",kernelFunc:_o};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oc(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.data.get(s.dataId).complexTensorInfos.real,i=n.data.get(r.dataId).values;return n.makeTensorInfo(r.shape,r.dtype,i)}const Cye={kernelName:Tb,backendName:"cpu",kernelFunc:oc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tj(t,e,n,s){if(s==="int32"){const r=Int32Array.from(t);return[e,"int32",r]}if(s==="bool"){const r=Gl([0],n),[i,o]=Cn((a,l)=>a!==l?1:0)(e,[],t,r,"bool");return[o,"bool",i]}throw new Error(`Error in Cast: failed to cast ${n} to ${s}`)}function Ll(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return _o({inputs:{x:r},backend:n});const c=Ww(n,r.shape,r.dtype),h=Ll({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),d=ur({inputs:{real:h,imag:c},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),d}if(r.dtype==="complex64"){const c=oc({inputs:{input:r},backend:n}),h=Ll({inputs:{x:c},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(c),h}if(!qk(r.dtype,i)){const c=_o({inputs:{x:r},backend:n});return{dataId:c.dataId,shape:c.shape,dtype:i}}const o=n.data.get(r.dataId).values,[a,l,u]=tj(o,r.shape,r.dtype,i);return n.makeTensorInfo(a,l,u)}const Iye={kernelName:bd,backendName:"cpu",kernelFunc:Ll};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mn(t,e,n,s){return n==null?({inputs:r,backend:i})=>{const{a:o,b:a}=r,l=i;Ne([o,a],t);const u=l.data.get(o.dataId).values,c=l.data.get(a.dataId).values,h=o.dtype==="string"?ma(u):u,d=o.dtype==="string"?ma(c):c,f=s||o.dtype,[p,m]=e(o.shape,a.shape,h,d,f);return l.makeTensorInfo(m,f,p)}:({inputs:r,backend:i})=>{const{a:o,b:a}=r,l=i;if(o.dtype==="complex64"||a.dtype==="complex64"){const u=Ll({inputs:{x:o},backend:l,attrs:{dtype:"complex64"}}),c=l.data.get(u.dataId),h=c.complexTensorInfos.real,d=c.complexTensorInfos.imag,f=l.data.get(h.dataId).values,p=l.data.get(d.dataId).values,m=Ll({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),v=l.data.get(m.dataId),g=v.complexTensorInfos.real,w=v.complexTensorInfos.imag,b=l.data.get(g.dataId).values,x=l.data.get(w.dataId).values,[S,N,I]=n(o.shape,a.shape,f,p,b,x),C=l.makeTensorInfo(I,"float32",S),_=l.makeTensorInfo(I,"float32",N),k=ur({inputs:{real:C,imag:_},backend:l});return l.disposeIntermediateTensorInfo(u),l.disposeIntermediateTensorInfo(m),l.disposeIntermediateTensorInfo(C),l.disposeIntermediateTensorInfo(_),k}else{const u=l.data.get(o.dataId).values,c=l.data.get(a.dataId).values,h=s||o.dtype,[d,f]=e(o.shape,a.shape,u,c,h);return l.makeTensorInfo(f,h,d)}}}function V$(t){return(e,n,s,r,i,o)=>{const a=Ge(e,n),l=re(a),u=a.length,c=Me(a),h=qn("float32",l),d=qn("float32",l),f=Zu(e,a),p=Zu(n,a),m=pa(s,r),v=pa(i,o),g=e.length,w=Me(e),b=n.length,x=Me(n);if(f.length+p.length===0)for(let S=0;S<h.length;S++){const N=S%m.length,I=S%v.length,C=t(m[N*2],m[N*2+1],v[I*2],v[I*2+1]);h[S]=C.real,d[S]=C.imag}else for(let S=0;S<h.length;S++){const N=bc(S,u,c),I=N.slice(-g);f.forEach(D=>I[D]=0);const C=Pi(I,g,w),_=N.slice(-b);p.forEach(D=>_[D]=0);const k=Pi(_,b,x),A=t(m[C*2],m[C*2+1],v[k*2],v[k*2+1]);h[S]=A.real,d[S]=A.imag}return[h,d,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nj=Cn((t,e)=>t+e),_ye=V$((t,e,n,s)=>({real:t+n,imag:e+s})),Zh=Mn(Sc,nj,_ye),Tye={kernelName:Sc,backendName:"cpu",kernelFunc:Zh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U$(t,e,n,s,r){const i=re(s),o=us(r,n);for(let a=0;a<t.length;a++){const l=t[a];if(l<0)throw new Error("Input x must be non-negative!");l>=r||(i>0?o[l]+=e[a]:o[l]+=1)}return o}function sj(t,e,n,s=!1){const r=t.shape[0],i=t.shape[1],o=Xe([r,n],e.dtype);for(let a=0;a<r;a++)for(let l=0;l<i;l++){const u=t.get(a,l);if(u<0)throw new Error("Input x must be non-negative!");u>=n||(s?o.set(1,a,u):e.size>0?o.set(o.get(a,u)+e.get(a,l),a,u):o.set(o.get(a,u)+1,a,u))}return o}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rj=Cn((t,e)=>t&e),kye=Mn(dg,rj),Eye={kernelName:dg,backendName:"cpu",kernelFunc:kye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function No(t){return(e,n,s)=>{const r=cn(n,e.length);for(let i=0;i<e.length;++i)r[i]=t(e[i],s);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Et(t,e,n){const s=No(e);return Zl(t,s,n)}function Zl(t,e,n){return({inputs:s,attrs:r,backend:i})=>{const{x:o}=s;Ne(o,t);const a=i,l=a.data.get(o.dataId).values;let u;if(o.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");u=ma(l)}else u=l;const c=n||o.dtype,h=e(u,c,r);return a.makeTensorInfo(o.shape,c,h)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ij=No(t=>Math.ceil(t)),Nye=Zl(Sd,ij),$ye={kernelName:Sd,backendName:"cpu",kernelFunc:Nye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oj(t,e,n,s){const r=cn(n,re(e));if(s&&n!=="string"){let i=0;t.forEach(o=>{const a=re(o.shape);r.set(o.vals,i),i+=a})}else{let i=0;t.forEach(o=>{const a=n==="string"?ma(o.vals):o.vals;let l=0;for(let u=0;u<o.shape[0];++u){const c=u*e[1]+i;for(let h=0;h<o.shape[1];++h)r[c+h]=a[l++]}i+=o.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aj=Cn((t,e)=>t===e?1:0),lj=Mn(bg,aj,null,"bool"),Rye={kernelName:bg,backendName:"cpu",kernelFunc:lj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uj=No(t=>Math.exp(t)),cj=Zl(Nd,uj,"float32"),Aye={kernelName:Nd,backendName:"cpu",kernelFunc:cj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hj=No(t=>Math.expm1(t)),Dye=Zl($d,hj),Oye={kernelName:$d,backendName:"cpu",kernelFunc:Dye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dj=No(t=>Math.floor(t)),Pye=Zl(Rd,dj),Fye={kernelName:Rd,backendName:"cpu",kernelFunc:Pye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fj=Cn((t,e)=>Math.floor(t/e)),Lye=Mn(Ad,fj,null,"int32"),Mye={kernelName:Ad,backendName:"cpu",kernelFunc:Lye};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pj(t,e,n,s,r,i,o,a,l){const u=Xe([s,i],n);for(let c=0;c<s;c++){const h=[];let d=0;for(let f=0;f<r;f++){const p=t[c*r+f];d+=p*o[f],h.push(p)}if(d<0||d>=l/i)throw new Error(`Invalid indices: ${h} does not index into ${a}`);for(let f=0;f<i;f++)u.values[c*i+f]=e.get(...e.indexToLoc(d*i+f))}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mj(t,e,n){const s=Xe(n,t.dtype);for(let r=0;r<s.size;++r){const o=s.indexToLoc(r).slice(),a=o[0],l=o[2],u=e.locToIndex([a,l]);o[2]=e.values[u];const c=t.locToIndex(o);0<=c&&c<t.values.length&&(s.values[r]=t.values[c])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gj=Cn((t,e)=>t>e?1:0),zye=Mn(_g,gj,null,"bool"),Bye={kernelName:_g,backendName:"cpu",kernelFunc:zye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yj=Cn((t,e)=>t>=e?1:0),Vye=Mn(Dd,yj,null,"bool"),Uye={kernelName:Dd,backendName:"cpu",kernelFunc:Vye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vj=Cn((t,e)=>t<e?1:0),Wye=Mn(kg,vj,null,"bool"),jye={kernelName:kg,backendName:"cpu",kernelFunc:Wye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wj=Cn((t,e)=>t<=e?1:0),Gye=Mn(Eg,wj,null,"bool"),Hye={kernelName:Eg,backendName:"cpu",kernelFunc:Gye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xj(t,e,n){const s=(e-t)/(n-1),r=us(n,"float32");r[0]=t;for(let i=1;i<r.length;i++)r[i]=r[i-1]+s;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bj=No(t=>Math.log(t)),qye=Zl(Md,bj),Kye={kernelName:Md,backendName:"cpu",kernelFunc:qye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sj(t,e,n,s){const r=qn(s,re(n));for(let i=0;i<r.length;++i){const o=i*e;let a=t[o];for(let l=0;l<e;++l){const u=t[o+l];(Number.isNaN(u)||u>a)&&(a=u)}r[i]=a}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cj=Cn((t,e)=>Math.max(t,e)),Xye=Mn(Bd,Cj),Yye={kernelName:Bd,backendName:"cpu",kernelFunc:Xye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ij=Cn((t,e)=>Math.min(t,e)),Qye=Mn(Vd,Ij),Jye={kernelName:Vd,backendName:"cpu",kernelFunc:Qye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W$=Cn((t,e)=>t*e),Zye=V$((t,e,n,s)=>({real:t*n-e*s,imag:t*s+e*n})),rS=Mn(Wd,W$,Zye),e0e={kernelName:Wd,backendName:"cpu",kernelFunc:rS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _j(t,e,n){const s=xa(-1,n);return W$([],e,s,t,n)}function t0e(t){const{inputs:e,backend:n}=t,{x:s}=e;Ne(s,"neg");const r=n.data.get(s.dataId).values,[i,o]=_j(r,s.shape,s.dtype);return n.makeTensorInfo(o,s.dtype,i)}const n0e={kernelName:zg,backendName:"cpu",kernelFunc:t0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tj=Cn((t,e)=>t!==e?1:0),s0e=Mn(Bg,Tj,null,"bool"),r0e={kernelName:Bg,backendName:"cpu",kernelFunc:s0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j$(t,e,n,s,r){const i=e.length,o=re(e),a=Me(e),l=Me(r),u=qn(n,re(r));for(let c=0;c<o;++c){const h=bc(c,i,a),d=new Array(h.length);for(let p=0;p<d.length;p++)d[p]=h[s[p]];const f=Pi(d,i,l);u[f]=t[c]}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function er(t){const{inputs:e,attrs:n,backend:s}=t,{x:r}=e,{perm:i}=n;Ne(r,"transpose");const o=r.shape.length,a=new Array(o);for(let h=0;h<a.length;h++)a[h]=r.shape[i[h]];const l=s.data.get(r.dataId).values,u=j$(l,r.shape,r.dtype,i,a);return{dataId:s.write(u,a,r.dtype),shape:a,dtype:r.dtype}}const i0e={kernelName:Au,backendName:"cpu",kernelFunc:er};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kj(t,e,n,s){const[r,i]=Qn(t,s),o=Xs(e,"int32"),a=us(re(r),o),l=re(i);for(let u=0;u<a.length;++u){const c=u*l;let h=1;for(let d=0;d<l;++d)h*=n[c+d];a[u]=h}return{outVals:a,outShape:r,outDtype:o}}function o0e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;Ne(r,"prod");const a=r.shape.length,l=Ze(i,r.shape),u=on(l,a);let c=l,h=r;const d=[];u!=null&&(h=er({inputs:{x:r},backend:n,attrs:{perm:u}}),d.push(h),c=bn(c.length,a));const f=n.data.get(h.dataId).values,{outVals:p,outShape:m,outDtype:v}=kj(h.shape,h.dtype,f,c);let g=m;return o&&(g=xn(m,l)),d.forEach(w=>n.disposeIntermediateTensorInfo(w)),n.makeTensorInfo(g,v,p)}const a0e={kernelName:Hg,backendName:"cpu",kernelFunc:o0e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l0e(t,e,n){t.forEach((s,r)=>{if(s<0||s>=n){const i=bc(r,e.length,Me(e)).join(",");throw new Error(`indices[${i}] = ${s} is not in [0, ${n})`)}})}function u0e(t,e){for(let n=0;n<t.length;++n){const s=t[n],r=n===t.length-1?e:t[n+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>r)throw new Error("Ragged splits must not point past values");for(let i=1;i<s.length;++i)if(s[i-1]>s[i])throw new Error("Ragged splits must be sorted in ascending order")}}function c0e(t,e,n,s){const r=[];let i=0;const o=e.length-1+n.length,a=new Array(o).fill(null).map(()=>[0]);u0e(n,s);let l=1;for(let u=0;u<e.length-1;++u){l*=e[u];const c=e[u+1];for(let h=1;h<l+1;++h)a[u].push(h*c)}for(let u=0;u<t.length;++u){let c=t[u],h=t[u]+1;for(let d=0;d<n.length;++d){const f=n[d],p=d+e.length-1;if(p>=0){const m=a[p],v=m[m.length-1]-f[c];for(let g=c;g<h;++g)a[p].push(f[g+1]+v)}c=f[c],h=f[h]}h!==c&&(r.push([c,h]),i+=h-c)}return{outSplits:a,valueSlices:r,numValues:i}}function h0e(t){const e=[];for(let n=0;n<t.length;++n){const s=t[n].length,r=cn("int32",s);e.push(r),t[n].forEach((i,o)=>r[o]=i)}return e}function sF(t,e){const n=t.slice(0,e);for(;n.length<e;)n.push(1);for(let s=e;s<t.length;s++)n[e-1]*=t[s];return n}function d0e(t,e,n,s,r,i){const o=sF(e,2)[1],a=sF(i,2)[1];let l=0;for(const u of n)for(let c=u[0];c<u[1];++c){for(let h=0;h<s;++h)r[l*a+h]=t[c*o+h];++l}}function f0e(t,e,n,s,r){const i=e.slice();i[0]=r;const o=cn(n,re(i)),a=t.length,l=a===0?0:a/e[0];return d0e(t,e,s,l,o,i),[o,i]}function Ej(t,e,n,s,r,i,o,a){if(t.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(l0e(i,o,l),s.length===0)throw new Error("params.rank must be nonzero");const u=s[0],{outSplits:c,valueSlices:h,numValues:d}=c0e(i,o,t,u),f=h0e(c),p=f0e(n,s,r,h,d);return[f,p[0],p[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rF=2147483647;function Nj(t,e,n,s,r,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,l=r.length===0,u=o.length===0,c=[];a||c.push(e[0]),l||c.push(r[0]),u||c.push(o[0]);for(let v=1;v<c.length;++v)if(c[v]!==c[v-1])throw new Error("starts, limits, and deltas must have the same shape");const h=c.length===0?1:c[0],d=cn("int32",h+1);d[0]=0;for(let v=0;v<h;++v){const g=a?t[0]:t[v],w=l?s[0]:s[v],b=u?i[0]:i[v];if(b===0)throw new Error("Requires delta != 0");let x;if(b>0&&w<g||b<0&&w>g)x=0;else if(x=Math.ceil(Math.abs((w-g)/b)),x>rF)throw new Error(`Requires ((limit - start) / delta) <= ${rF}`);d[v+1]=d[v]+x}const f=d[h],p=cn(n,f);let m=0;for(let v=0;v<h;++v){const g=d[v+1]-d[v];let w=a?t[0]:t[v];const b=u?i[0]:i[v];for(let x=0;x<g;++x)p[m++]=w,w+=b}return[d,p]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Kr=_i;class jw{constructor(e,n,s,r,i,o,a,l,u,c){this.shape=e,this.shapeShape=n,this.values=s,this.valuesShape=r,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=u,this.rowPartitionTypes=qV(c),this.raggedRank=KV(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===Kr.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===Kr.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const n=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Kr.VALUE_ROWIDS:return jw.getMaxWidthValueRowID(n);case Kr.ROW_SPLITS:return jw.getMaxWidthRowSplit(n);default:throw new Error(`Cannot handle partition type ${Kr[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const n=e.length;if(n===0||n===1)return 0;let s=0;for(let r=0;r<n-1;++r){const i=e[r+1]-e[r];i>s&&(s=i)}return s}static getMaxWidthValueRowID(e){const n=e.length;if(n===0)return 0;let s=0,r=e[0],i=0;for(let o=1;o<n;++o){const a=e[o];a!==r&&(r=a,i=Math.max(o-s,i),s=o)}return Math.max(n-s,i)}tensorShapeFromTensor(e,n,s=!0){if(n.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return oF(e,s)}calculateOutputSize(e){const n=this.valuesShape,s=this.defaultValueShape;XV(s,n);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=HV(this.raggedRank,r,n);o[0]<0&&(o[0]=e);for(let a=1;a<=this.raggedRank;++a)o[a]<0&&(o[a]=this.getMaxWidth(a));return o}calculateFirstParentOutputIndex(e,n,s){const r=Math.min(e,s),i=[];let o=0;for(let a=0;a<r;++a,o+=n)i.push(o);for(let a=r;a<e;++a)i.push(-1);return O(i.length===e,()=>"Final length of result must be equal to firstDimension."),i}calculateOutputIndexRowSplit(e,n,s,r){const i=e.length,o=[];for(let a=0;a<i-1;++a){const l=e[a+1]-e[a];let u=Math.min(r,l),c=n[a];c===-1&&(u=0);for(let h=0;h<u;++h)o.push(c),c+=s;for(let h=0;h<l-u;++h)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(e,n,s,r){const i=e.length,o=[];if(i===0)return[];let a=0,l=e[0];if(l>=n.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${n.length}`);let u=n[l];o.push(u);for(let c=1;c<i;++c){const h=e[c];if(h===l)u>=0&&(++a,a<r?u+=s:u=-1);else{if(a=0,l=h,h>=n.length)throw new Error(`Got nextValueRowId=${h} which is not less than ${n.length}`);u=n[h]}o.push(u)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(e,n,s,r){const i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case Kr.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,n,s,r);case Kr.ROW_SPLITS:if(i.length-1>n.length)throw new Error(`Row partition size is greater than output size: ${i.length-1} > ${n.length}`);return this.calculateOutputIndexRowSplit(i,n,s,r);default:throw new Error(`Unsupported partition type: ${Kr[o]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const n=this.rowPartitionTypes[0];switch(n){case Kr.FIRST_DIM_SIZE:return e[0];case Kr.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Kr.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${Kr[n]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const n=this.getFirstDimensionSize(),s=this.calculateOutputSize(n),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let l=r.length-2;l>=0;--l)r[l]=r[l+1]*s[l+1];const i=oF(s,!1),o=cn(this.valuesDType,re(i));if(r[0]*s[0]>0){let l=this.calculateFirstParentOutputIndex(n,r[0],s[0]);for(let u=1;u<=this.raggedRank;++u)l=this.calculateOutputIndex(u-1,l,r[u],s[u]);this.setOutput(this.raggedRank,l,o,i)}return[i,o]}setOutput(e,n,s,r){if(s.length===0)return;const i=this.values,o=s;let a=r.slice();a=a.slice(e+1);const l=re(a),u=n.length;let c=this.defaultValue;if(c.length!==l&&c.length!==1){const p=this.defaultValueShape;J(()=>{const m=H(c,p);c=Du(m,a).dataSync()})}let h=0,d=0,f=0;for(let p=0;p<=u;++p){let m=p<u?n[p]:-1;if(m===f){++f;continue}if(d<f){const v=i.subarray(h*l),g=o.subarray(d*l),w=(f-d)*l;iF(g,v,w)}if(p>=u){const v=s.length;m=Math.floor(v/l)}if(m>f)if(this.defaultValue.length===1)o.subarray(f*l,m*l).fill(this.defaultValue[0]),f=m;else for(;m>f;){const v=o.slice(f*l);iF(v,c,l),++f}m<0?(h=p+1,d=f):(h=p,d=f,f=d+1)}}}function iF(t,e,n){for(let s=0;s<n;s++)t[s]=e[s]}function oF(t,e){const n=[];for(let s of t){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}n.push(s)}return n}function $j(t,e,n,s,r,i,o,a,l,u){return new jw(t,e,n,s,r,i,o,a,l,u).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rj(t,e,n,s){const r=t===e,i=t<e&&n<0,o=e<t&&n>1;if(r||i||o)return us(0,s);const a=Math.abs(Math.ceil((e-t)/n)),l=us(a,s);e<t&&n===1&&(n=-1),l[0]=t;for(let u=1;u<l.length;u++)l[u]=l[u-1]+n;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aj=No(t=>1/Math.sqrt(t)),p0e=Zl(Xd,Aj),m0e={kernelName:Xd,backendName:"cpu",kernelFunc:p0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ku(t,e,n,s,r,i,o,a,l,u){const c=[s/r,r],h=t.values,d=e.values;if(s===0)return Xe(n,e.dtype);const f=l instanceof $n?l:Xe(c,e.dtype);typeof l=="string"||typeof l=="number"?f.values.fill(l):typeof l=="boolean"&&f.values.fill(+l);for(let p=0;p<i;p++){const m=[];let v=0;for(let g=0;g<o;g++){const w=h[p*o+g];m.push(w),v+=w*a[g]}if(v<0||v>=s/r)throw new Error(`Invalid indices: ${m} does not index into ${n}`);for(let g=0;g<r;g++)u?f.values[v*r+g]+=d[p*r+g]:f.values[v*r+g]=e.rank===0?d[0]:d[p*r+g]}return f}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g0e=No(t=>1/(1+Math.exp(-t))),Dj=Et(ef,t=>1/(1+Math.exp(-t))),y0e={kernelName:ef,backendName:"cpu",kernelFunc:Dj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oj(t,e,n,s,r){const i=RN(s,e,n),o=re(n),a=Me(s);if(i){const h=AN(e,a);return r==="string"?t.slice(h,h+o):t.subarray(h,h+o)}const l=r==="string"?ma(t):t,u=Xe(s,r,l),c=Xe(n,r);for(let h=0;h<c.size;++h){const d=c.indexToLoc(h),f=d.map((p,m)=>p+e[m]);c.set(u.get(...f),...d)}return r==="string"?mU(c.values):c.values}function ac(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:i,size:o}=s;Ne(r,"slice");const[a,l]=D1(r,i,o);NN(r,a,l);const u=n.data.get(r.dataId).values,c=Oj(u,a,l,r.shape,r.dtype);return n.makeTensorInfo(l,r.dtype,c)}const v0e={kernelName:Jg,backendName:"cpu",kernelFunc:ac};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pj(t,e,n,s,r,i,o){const a=e[0],l=i[0],u=new Array(l),c=new Array(a),h=e[1];if(l===0){if(a!==0)throw new Error(nU(a));const v=cn(n,0),g=cn(r,0);return[v,[0,h],g,u,c]}let d=!0,f=0;const p=new Array(l).fill(0);for(let v=0;v<a;++v){const g=t[v*h];if(g<0)throw new Error(sU(v,g));if(g>=l)throw new Error(rU(v,g,l));++p[g],d=d&&g>=f,f=g}let m=!0;for(let v=0;v<l;++v){const g=p[v]===0;u[v]=g,m=m&&!g,p[v]=Math.max(p[v],1),v>0&&(p[v]+=p[v-1])}if(m&&d){const v=t,g=s;for(let w=0;w<a;++w)c[w]=w;return[v,[a,h],g,u,c]}else{const v=p[l-1],g=cn(n,v*h),w=cn(r,v),b=new Array(l).fill(0);for(let x=0;x<a;++x){const S=t[x*h],N=b[S],I=(S===0?0:p[S-1])+N;b[S]++;for(let C=0;C<h;++C)g[I*h+C]=t[x*h+C];w[I]=s[x],c[x]=I}for(let x=0;x<l;++x)if(b[x]===0){const N=x===0?0:p[x-1];g[N*h+0]=x;for(let I=1;I<h;++I)g[N*h+I]=0;w[N]=o}return[g,[v,h],w,u,c]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fj(t,e,n,s,r){const i=re(s),o=e[0],a=r.length,l=[];let u=1,c=-1;for(let v=0;v<a;++v){const g=r[v];if(g===-1){if(c!==-1)throw new Error(iU(c,v));c=v,l.push(1)}else{if(g<0)throw new Error(oU(v,g));u*=g,l.push(g)}}if(c!==-1){if(u<=0)throw new Error(aU());const v=Math.trunc(i/u);if(u*v!==i)throw new Error(lU(s,l));l[c]=v}if(re(l)!==i)throw new Error(uU(s,l));const d=s.length,f=[];if(d>0){f[d-1]=1;for(let v=d-2;v>=0;--v)f[v]=f[v+1]*s[v+1]}const p=[];if(a>0){p[a-1]=1;for(let v=a-2;v>=0;--v)p[v]=p[v+1]*l[v+1]}const m=cn(n,o*a);for(let v=0;v<o;++v){let g=0;for(let w=0;w<d;++w)g+=t[v*d+w]*f[w];for(let w=0;w<a;++w)m[v*a+w]=Math.trunc(g/p[w]),g%=p[w]}return[m,[o,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G$(t,e,n,s,r,i=!1,o=0){const a=s.length,l=[e[0],t.length/e[0]],u=l[1],h=a>0?r[a-1]+1:0;if(h<0)throw new Error(p_());const d=e.slice();d[0]=h;const f=d.reduce((b,x)=>b*x,1),p=cn(n,f);if(a===0)return h>0&&p.fill(o),[p,d];if(h<=0)throw new Error(p_());let m=0,v=1,g=0,w=r[m];for(;;){let b=0;if(v<a){if(b=r[v],w===b){++v;continue}if(w>=b)throw new Error(cU())}if(w<0||w>=h)throw new Error(hU(w,h));w>g&&p.fill(o,g*u,w*u);for(let x=m;x<v;++x){const S=s[x];if(S<0||S>=l[0])throw new Error(dU(x,s[x],l[0]));for(let N=0;N<u;N++)p[w*u+N]+=t[S*u+N]}if(i)for(let x=0;x<u;x++)p[w*u+x]/=v-m;if(m=v,++v,g=w+1,w=b,v>a)break}return g<h&&p.fill(o,g*u,h*u),[p,d]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w0e=No(t=>Math.sqrt(t)),x0e=Et(nf,t=>Math.sqrt(t)),b0e={kernelName:nf,backendName:"cpu",kernelFunc:x0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lj=Cn((t,e)=>{const n=t-e;return n*n}),S0e=Mn(sf,Lj),C0e={kernelName:sf,backendName:"cpu",kernelFunc:S0e};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mj=No((t,e)=>{const{pattern:n,replaceGlobal:s,rewrite:r}=e;return t.replace(new RegExp(n,s?"g":""),r)}),I0e=Zl(sy,Mj),_0e={kernelName:sy,backendName:"cpu",kernelFunc:I0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zj(t,e,n,s){const r=Xe(t,e.dtype);for(let i=0;i<r.size;i++){const o=r.indexToLoc(i),a=new Array(o.length);for(let l=0;l<a.length;l++)a[l]=o[l]*n[l]+s[l];r.set(e.get(...a),...o)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class T0e{constructor(e,n,s,r,i,o){this.separator=go(e),this.nGramWidths=n,this.leftPad=go(s),this.rightPad=go(r),this.padWidth=i,this.preserveShort=o}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,n){const s=this.getPadWidth(n);return Math.max(0,e+2*s-n+1)}createNGrams(e,n,s,r,i,o){for(let a=0;a<i;++a){const l=this.getPadWidth(o),u=Math.max(0,l-a),c=Math.max(0,l-(i-(a+1))),h=o-(u+c),d=n+(u>0?0:a-l);let f=0;f+=u*this.leftPad.length;for(let w=0;w<h;++w)f+=e[d+w].length;f+=c*this.rightPad.length;const p=u+c+h-1;f+=p*this.separator.length,s[r+a]=new Uint8Array(f);const m=s[r+a];let v=0;const g=w=>w.forEach(b=>m[v++]=b);for(let w=0;w<u;++w)g(this.leftPad),g(this.separator);for(let w=0;w<h-1;++w)g(e[d+w]),g(this.separator);if(h>0){g(e[d+h-1]);for(let w=0;w<c;++w)g(this.separator),g(this.rightPad)}else{for(let w=0;w<c-1;++w)g(this.rightPad),g(this.separator);g(this.rightPad)}}}compute(e,n){const s=e.length,r=n.length;if(r>0){let l=n[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let u=1;u<r;++u){let c=n[u]>=l;if(c=c&&n[u]<=s,!c)throw new Error(`Invalid split value ${n[u]}, must be in [${l}, ${s}]`);l=n[u]}if(l!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${l}`)}const i=r-1,o=cn("int32",r);if(s===0||r===0){const l=new Array(s);for(let u=0;u<=i;++u)o[u]=0;return[l,o]}o[0]=0;for(let l=1;l<=i;++l){const u=n[l]-n[l-1];let c=0;this.nGramWidths.forEach(h=>{c+=this.getNumNGrams(u,h)}),this.preserveShort&&u>0&&c===0&&(c=1),o[l]=o[l-1]+c}const a=new Array(o[i]);for(let l=0;l<i;++l){const u=n[l];let c=o[l];if(this.nGramWidths.forEach(h=>{const d=n[l+1]-n[l],f=this.getNumNGrams(d,h);this.createNGrams(e,u,a,c,f,h),c+=f}),this.preserveShort&&c===o[l]){const h=n[l+1]-n[l];if(h===0)continue;const d=h+2*this.padWidth;this.createNGrams(e,u,a,c,1,d)}}return[a,o]}}function Bj(t,e,n,s,r,i,o,a){return new T0e(n,s,r,i,o,a).compute(t,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k0e(t,e,n,s){if(!t.length)return;if(e.length===0){for(let i=0;i<t.length;++i)s.push(t.subarray(i,i+1));return}if(e.length===1){const i=e[0];let o=t.indexOf(i);for(;o!==-1;){const a=t.subarray(0,o);(!n||a.length!==0)&&s.push(a),t=t.subarray(o+1),o=t.indexOf(i)}(!n||t.length!==0)&&s.push(t);return}let r=0;for(let i=0;i<t.length+1;i++)if(i===t.length||e.indexOf(t[i])!==-1){const o=t.subarray(r,i);(!n||o.length!==0)&&s.push(o),r=i+1}}function Vj(t,e,n){const s=t.length,r=[];let i=0,o=0;const a=new Array(s);for(let d=0;d<s;++d){const f=r.length;k0e(t[d],e,n,r);const p=r.length-f;a[d]=p,i+=p,o=Math.max(o,p)}const l=cn("int32",i*2),u=new Array(i),c=[s,o];let h=0;for(let d=0;d<s;++d)for(let f=0;f<a[d];++f)l[h*2]=d,l[h*2+1]=f,u[h]=r[h],++h;return[l,u,c]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uj(t,e){const n=cn("int32",t.length);for(let s=0;s<t.length;++s)n[s]=Q4(t[s]).modulo(e).getLowBitsUnsigned();return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wj=Cn((t,e)=>t-e),E0e=V$((t,e,n,s)=>({real:t-n,imag:e-s})),H$=Mn(rf,Wj,E0e),N0e={kernelName:rf,backendName:"cpu",kernelFunc:H$};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jj(t,e){const n=new Array(t.rank);for(let r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];const s=Xe(n,t.dtype);for(let r=0;r<s.values.length;++r){const i=s.indexToLoc(r),o=new Array(t.rank);for(let l=0;l<o.length;l++)o[l]=i[l]%t.shape[l];const a=t.locToIndex(o);s.values[r]=t.values[a]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yp=(t,e)=>{const n=e.value-t.value;return n===0?t.index-e.index:n};function Gj(t,e,n=0,s=t.length-1){for(;s>n;){if(s-n>600){const a=s-n+1,l=e-n+1,u=Math.log(a),c=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*c*(a-c)/a)*Math.sign(l-a/2),d=Math.max(n,Math.floor(e-l*c/a+h)),f=Math.min(s,Math.floor(e+(a-l)*c/a+h));Gj(t,e,d,f)}const r=t[e];let i=n,o=s;for(jo(t,n,e),yp(t[s],r)>0&&jo(t,n,s);i<o;){for(jo(t,i,o),i++,o--;yp(t[i],r)<0;)i=i+1;for(;yp(t[o],r)>0;)o=o-1}yp(t[n],r)===0?jo(t,n,o):(o=o+1,jo(t,o,s)),o<=e&&(n=o+1),e<=o&&(s=o-1)}}function Hj(t,e,n,s,r){const i=e[e.length-1],[o,a]=[t.length/i,i],l=qn(n,o*s),u=qn("int32",o*s);for(let h=0;h<o;h++){const d=h*a,f=t.subarray(d,d+a);let p=new Array(f.length);f.forEach((w,b)=>p[b]={value:w,index:b}),s<p.length&&(Gj(p,s),p=p.slice(0,s)),r&&p.sort(yp);const m=h*s,v=l.subarray(m,m+s),g=u.subarray(m,m+s);for(let w=0;w<s;w++)v[w]=p[w].value,g[w]=p[w].index}const c=e.slice();return c[c.length-1]=s,[Xe(c,n,l),Xe(c,"int32",u)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qj(t,e,n,s){const r=Ze(e,n)[0],i=[1,n[0],1];for(let p=0;p<r;p++)i[0]*=n[p];i[1]=n[r];for(let p=r+1;p<n.length;p++)i[2]*=n[p];const o=new Map,a=new Int32Array(n[r]),l=new $n(i,s,t),u=[],c=i[0]===1&&i[2]===1;for(let p=0;p<n[r];p++){let m;if(c)m=t[p].toString();else{const g=[];for(let w=0;w<i[0];w++)for(let b=0;b<i[2];b++)g.push(l.get(w,p,b));m=g.join(",")}const v=o.get(m);if(v!=null)a[p]=v;else{const g=o.size;o.set(m,g),a[p]=g,u.push(p)}}const h=i.slice();h[1]=o.size;const d=new $n(h,s);u.forEach((p,m)=>{for(let v=0;v<i[0];v++)for(let g=0;g<i[2];g++)d.set(l.get(v,p,g),v,m,g)});const f=n.slice();return f[r]=h[1],{outputValues:d.values,outputShape:f,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kj=Object.freeze(Object.defineProperty({__proto__:null,addImpl:nj,bincountImpl:U$,bincountReduceImpl:sj,bitwiseAndImpl:rj,castImpl:tj,ceilImpl:ij,concatImpl:oj,equalImpl:aj,expImpl:uj,expm1Impl:hj,floorDivImpl:fj,floorImpl:dj,gatherNdImpl:pj,gatherV2Impl:mj,greaterEqualImpl:yj,greaterImpl:gj,lessEqualImpl:wj,lessImpl:vj,linSpaceImpl:xj,logImpl:bj,maxImpl:Sj,maximumImpl:Cj,minimumImpl:Ij,multiplyImpl:W$,negImpl:_j,notEqualImpl:Tj,prodImpl:kj,raggedGatherImpl:Ej,raggedRangeImpl:Nj,raggedTensorToTensorImpl:$j,rangeImpl:Rj,rsqrtImpl:Aj,scatterImpl:ku,sigmoidImpl:g0e,simpleAbsImpl:ej,sliceImpl:Oj,sparseFillEmptyRowsImpl:Pj,sparseReshapeImpl:Fj,sparseSegmentReductionImpl:G$,sqrtImpl:w0e,squaredDifferenceImpl:Lj,staticRegexReplaceImpl:Mj,stridedSliceImpl:zj,stringNGramsImpl:Bj,stringSplitImpl:Vj,stringToHashBucketFastImpl:Uj,subImpl:Wj,tileImpl:jj,topKImpl:Hj,transposeImpl:j$,uniqueImpl:qj},Symbol.toStringTag,{value:"Module"}));/** @license See the LICENSE file. */const Xj="4.22.0";/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nE("cpu",()=>new zy,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yj=Et(kd,t=>t>=0?t:Math.exp(t)-1),$0e={kernelName:kd,backendName:"cpu",kernelFunc:Yj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qj(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{alpha:i}=s;Ne([r],"leakyRelu");const o=re(r.shape),a=n.data.get(r.dataId).values,l=qn("float32",o);for(let u=0;u<a.length;u++)l[u]=a[u]<0?i*a[u]:a[u];return n.makeTensorInfo(r.shape,"float32",l)}const R0e={kernelName:Tg,backendName:"cpu",kernelFunc:Qj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A0e=Cn((t,e)=>t<0?e*t:t);function Jj(t){const{inputs:e,backend:n}=t,{x:s,alpha:r}=e;Ne([s,r],"prelu");const i=n.data.get(s.dataId).values,o=n.data.get(r.dataId).values,[a,l]=A0e(s.shape,r.shape,i,o,"float32");return n.makeTensorInfo(l,"float32",a)}const D0e={kernelName:Gg,backendName:"cpu",kernelFunc:Jj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zj=Et(Hd,t=>Math.max(0,t)),O0e={kernelName:Hd,backendName:"cpu",kernelFunc:Zj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eG=Et(qd,t=>Math.min(Math.max(0,t),6)),P0e={kernelName:qd,backendName:"cpu",kernelFunc:eG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gw(t,e,n,s,r){if(n==="linear")return _o({inputs:{x:e},backend:t});if(n==="relu")return Zj({inputs:{x:e},backend:t});if(n==="elu")return Yj({inputs:{x:e},backend:t});if(n==="relu6")return eG({inputs:{x:e},backend:t});if(n==="prelu")return Jj({inputs:{x:e,alpha:s},backend:t});if(n==="leakyrelu")return Qj({inputs:{x:e},backend:t,attrs:{alpha:r}});if(n==="sigmoid")return Dj({inputs:{x:e},backend:t});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vt(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{shape:i}=s,o=re(r.shape),a=Hk(i,o),l=re(a);O(o===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${r.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`),n.incRef(r.dataId);const u=n.data.get(r.dataId);if(u.complexTensorInfos!=null){const c=u.complexTensorInfos.real,h=u.complexTensorInfos.imag;c.shape=a,h.shape=a}return{dataId:r.dataId,shape:a,dtype:r.dtype}}const F0e={kernelName:qg,backendName:"cpu",kernelFunc:Vt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tG(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:i}=e,{transposeA:o,transposeB:a}=s;Ne([r,i],"matMul");const l=r.shape.length,u=i.shape.length,c=o?r.shape[l-2]:r.shape[l-1],h=a?i.shape[u-1]:i.shape[u-2],d=o?r.shape[l-1]:r.shape[l-2],f=a?i.shape[u-2]:i.shape[u-1],p=r.shape.slice(0,-2),m=i.shape.slice(0,-2),v=re(p),g=re(m),b=Ge(r.shape.slice(0,-2),i.shape.slice(0,-2)).concat([d,f]);O(c===h,()=>`Error in matMul: inner shapes (${c}) and (${h}) of Tensors with shapes ${r.shape} and ${i.shape} and transposeA=${o} and transposeB=${a} must match.`);const x=o?[v,c,d]:[v,d,c],S=a?[g,f,h]:[g,h,f],N=Vt({inputs:{x:r},backend:n,attrs:{shape:x}}),I=Vt({inputs:{x:i},backend:n,attrs:{shape:S}}),C=o?N.shape[1]:N.shape[2],_=o?N.shape[2]:N.shape[1],k=a?I.shape[1]:I.shape[2],A=Math.max(v,g),D=n.data.get(N.dataId).values,R=n.data.get(I.dataId).values,W=Me(N.shape),B=Me(I.shape),[M,X,z]=o?[W[0],1,W[1]]:[W[0],W[1],1],[Y,L,le]=a?[1,B[1],B[0]]:[B[1],1,B[0]],Q=_*k,se=Xe([A,_,k],N.dtype),de=se.values,ue=n.blockSize;for(let fe=0;fe<A;fe++){const ve=fe%v,De=fe%g;for(let Ie=0;Ie<_;Ie+=ue){const Oe=Math.min(Ie+ue,_);for(let ze=0;ze<k;ze+=ue){const Ye=Math.min(ze+ue,k);for(let Qe=0;Qe<C;Qe+=ue){const xt=Math.min(Qe+ue,C);for(let ft=Ie;ft<Oe;ft++)for(let at=ze;at<Ye;at++){let Ct=0;for(let vt=Qe;vt<xt;vt++){const Jn=D[ve*M+ft*X+vt*z],Ut=R[vt*Y+at*L+De*le];Ct+=Jn*Ut}de[fe*Q+(ft*k+at)]+=Ct}}}}}return n.disposeIntermediateTensorInfo(N),n.disposeIntermediateTensorInfo(I),n.makeTensorInfo(b,se.dtype,se.values)}const L0e={kernelName:cg,backendName:"cpu",kernelFunc:tG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M0e(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:c,leakyreluAlpha:h}=s;let d,f,p;const m=[];d=tG({inputs:{a:r,b:i},attrs:{transposeA:l,transposeB:u},backend:n}),o&&(f=Zh({inputs:{a:d,b:o},backend:n}),m.push(d),d=f),c&&(p=Gw(n,d,c,a,h),m.push(d),d=p);for(const g of m)n.disposeIntermediateTensorInfo(g);return d}const z0e={kernelName:wm,backendName:"cpu",kernelFunc:M0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B0e=Et(pd,t=>Math.acos(t)),V0e={kernelName:pd,backendName:"cpu",kernelFunc:B0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U0e=Et(md,t=>Math.acosh(t)),W0e={kernelName:md,backendName:"cpu",kernelFunc:U0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j0e(t){const{inputs:e,backend:n}=t,s=e;Ne(e,"addN");const r=s.map(a=>n.data.get(a.dataId).values),i=Xe(s[0].shape,s[0].dtype),o=i.values;for(let a=0;a<s.length;a++){const l=r[a];for(let u=0;u<o.length;u++)o[u]+=l[u]}return n.makeTensorInfo(i.shape,i.dtype,i.values)}const G0e={kernelName:ig,backendName:"cpu",kernelFunc:j0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H0e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;Ne(r,"all");const a=Ze(i,r.shape);let l=a;const u=on(l,r.shape.length);let c=r;u!=null&&(c=er({inputs:{x:r},backend:n,attrs:{perm:u}}),l=bn(l.length,r.shape.length)),ds("all",l,c.shape.length);const[h,d]=Qn(c.shape,l),f=re(d),p=us(re(h),c.dtype),m=n.data.get(c.dataId).values;for(let g=0;g<p.length;++g){const w=g*f;let b=m[w];for(let x=0;x<f;++x){const S=m[w+x];b=b&&S}p[g]=b}u!=null&&n.disposeIntermediateTensorInfo(c);const v=n.makeTensorInfo(h,c.dtype,p);if(o){const g=xn(h,a),w=Vt({inputs:{x:v},backend:n,attrs:{shape:g}});return n.disposeIntermediateTensorInfo(v),w}return v}const q0e={kernelName:Vx,backendName:"cpu",kernelFunc:H0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K0e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;Ne(r,"any");const a=Ze(i,r.shape);let l=a;const u=on(l,r.shape.length);let c=r;u!=null&&(c=er({inputs:{x:r},backend:n,attrs:{perm:u}}),l=bn(l.length,r.shape.length)),ds("any",l,c.shape.length);const[h,d]=Qn(c.shape,l),f=re(d),p=us(re(h),c.dtype),m=n.data.get(c.dataId).values;for(let g=0;g<p.length;++g){const w=g*f;let b=m[w];for(let x=0;x<f;++x){const S=m[w+x];b=b||S}p[g]=b}u!=null&&n.disposeIntermediateTensorInfo(c);const v=n.makeTensorInfo(h,c.dtype,p);if(o){const g=xn(h,a),w=Vt({inputs:{x:v},backend:n,attrs:{shape:g}});return n.disposeIntermediateTensorInfo(v),w}return v}const X0e={kernelName:Ux,backendName:"cpu",kernelFunc:K0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y0e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i}=s;Ne(r,"argMax");let o=Ze(i,r.shape);const a=on(o,r.shape.length);let l=r;const u=[];a!=null&&(l=er({inputs:{x:r},backend:n,attrs:{perm:a}}),u.push(l),o=bn(o.length,l.shape.length)),o=[o[0]],ds("argMax",o,l.shape.length);const[c,h]=Qn(l.shape,o),d=re(c),f=us(d,"int32"),p=re(h),m=n.data.get(l.dataId).values;for(let v=0;v<f.length;++v){const g=v*p;let w=m[g],b=0;for(let x=0;x<p;++x){const S=m[g+x];S>w&&(w=S,b=x)}f[v]=b}return u.forEach(v=>n.disposeIntermediateTensorInfo(v)),n.makeTensorInfo(c,"int32",f)}const Q0e={kernelName:og,backendName:"cpu",kernelFunc:Y0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J0e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i}=s;Ne(r,"argMin");let o=Ze(i,r.shape);const a=on(o,r.shape.length);let l=r;const u=[];a!=null&&(l=er({inputs:{x:r},backend:n,attrs:{perm:a}}),u.push(l),o=bn(o.length,l.shape.length)),o=[o[0]],ds("argMin",o,l.shape.length);const[c,h]=Qn(l.shape,o),d=re(c),f=us(d,"int32"),p=re(h),m=n.data.get(l.dataId).values;for(let v=0;v<f.length;++v){const g=v*p;let w=m[g],b=0;for(let x=0;x<p;++x){const S=m[g+x];S<w&&(w=S,b=x)}f[v]=b}return u.forEach(v=>n.disposeIntermediateTensorInfo(v)),n.makeTensorInfo(c,"int32",f)}const Z0e={kernelName:ag,backendName:"cpu",kernelFunc:J0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eve=Et(gd,t=>Math.asin(t)),tve={kernelName:gd,backendName:"cpu",kernelFunc:eve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nve=Et(yd,t=>Math.asinh(t)),sve={kernelName:yd,backendName:"cpu",kernelFunc:nve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rve=Et(vd,t=>Math.atan(t)),ive={kernelName:vd,backendName:"cpu",kernelFunc:rve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ove=Cn((t,e)=>Math.atan2(t,e)),ave=Mn(xd,ove),lve={kernelName:xd,backendName:"cpu",kernelFunc:ave};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uve=Et(wd,t=>Math.atanh(t)),cve={kernelName:wd,backendName:"cpu",kernelFunc:uve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q$(t,e,n,s,r,i){const o=r.strideHeight,a=r.strideWidth,l=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,h=r.effectiveFilterWidth,d=r.padInfo.top,f=r.padInfo.left,p=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=Xe(r.outShape,n),v=m.values,g=r.outShape[1]*r.outShape[2]*r.outShape[3],w=r.outShape[2]*r.outShape[3],b=r.outShape[3];for(let x=0;x<r.batchSize;++x){const S=x*g,N=x*s[0];for(let I=0;I<r.inChannels;++I)for(let C=0;C<r.outHeight;++C){const _=C*o-d,k=Math.max(0,_),A=Math.min(r.inHeight,c+_),D=S+C*w;for(let R=0;R<r.outWidth;++R){const W=R*a-f,B=Math.max(0,W),M=Math.min(r.inWidth,h+W);let X=p,z=0,Y=0;for(let le=k;le<A;le+=l){const Q=N+le*s[1];for(let se=B;se<M;se+=u){const de=Q+se*s[2],ue=t[de+I];i==="max"&&ue>X?X=ue:i==="avg"&&(z+=ue,Y++)}if(isNaN(X))break}const L=D+R*b+I;v[L]=i==="avg"?z/Y:X}}}return m}function nG(t,e,n,s,r=!1,i=!1){const o=Xe(s.outShape,"int32"),a=s.strideHeight,l=s.strideWidth,u=s.dilationHeight,c=s.dilationWidth,h=s.effectiveFilterHeight,d=s.effectiveFilterWidth,f=s.padInfo.top,p=s.padInfo.left,m=Xe(e,n,t);for(let v=0;v<s.batchSize;++v)for(let g=0;g<s.inChannels;++g)for(let w=0;w<s.outHeight;++w){const b=w*a-f;let x=b;for(;x<0;)x+=u;const S=Math.min(s.inHeight,h+b);for(let N=0;N<s.outWidth;++N){const I=N*l-p;let C=I;for(;C<0;)C+=c;const _=Math.min(s.inWidth,d+I);let k=Number.NEGATIVE_INFINITY,A=-1;for(let D=x;D<S;D+=u){const R=D-b;for(let W=C;W<_;W+=c){const B=W-I,M=m.get(v,D,W,g);M>k&&(k=M,r?A=i?((v*s.inHeight+D)*s.inWidth+W)*s.inChannels+g:(D*s.inWidth+W)*s.inChannels+g:A=R*d+B)}}o.set(A,v,w,N,g)}}return o}function sG(t,e,n,s,r,i){const o=r.strideDepth,a=r.strideHeight,l=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,h=r.dilationWidth,d=r.effectiveFilterDepth,f=r.effectiveFilterHeight,p=r.effectiveFilterWidth,m=r.padInfo.front,v=r.padInfo.top,g=r.padInfo.left,w=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=Xe(r.outShape,n),x=b.values,S=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],N=r.outShape[2]*r.outShape[3]*r.outShape[4],I=r.outShape[3]*r.outShape[4],C=r.outShape[4];for(let _=0;_<r.batchSize;++_){const k=_*S,A=_*s[0];for(let D=0;D<r.inChannels;++D)for(let R=0;R<r.outDepth;++R){const W=R*o-m;let B=W;for(;B<0;)B+=u;const M=Math.min(r.inDepth,d+W),X=k+R*N;for(let z=0;z<r.outHeight;++z){const Y=z*a-v;let L=Y;for(;L<0;)L+=c;const le=Math.min(r.inHeight,f+Y),Q=X+z*I;for(let se=0;se<r.outWidth;++se){const de=se*l-g;let ue=de;for(;ue<0;)ue+=h;const fe=Math.min(r.inWidth,p+de),ve=Q+se*C;let De=w,Ie=0,Oe=0;for(let Ye=B;Ye<M;Ye+=u){const Qe=A+Ye*s[1];for(let xt=L;xt<le;xt+=c){const ft=Qe+xt*s[2];for(let at=ue;at<fe;at+=h){const Ct=ft+at*s[3],vt=t[Ct+D];if(i==="max"&&vt>De?De=vt:i==="avg"&&(Ie+=vt,Oe++),isNaN(De))break}if(isNaN(De))break}if(isNaN(De))break}const ze=ve+D;x[ze]=i==="avg"?Ie/Math.max(Oe,1):De}}}}return b}function hve(t,e){const n=Xe(e.outShape,"int32"),s=e.strideDepth,r=e.strideHeight,i=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,u=e.effectiveFilterDepth,c=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=e.padInfo.front,f=e.padInfo.top,p=e.padInfo.left;for(let m=0;m<e.batchSize;++m)for(let v=0;v<e.inChannels;++v)for(let g=0;g<e.outDepth;++g){const w=g*s-d;let b=w;for(;b<0;)b+=o;const x=Math.min(e.inDepth,u+w);for(let S=0;S<e.outHeight;++S){const N=S*r-f;let I=N;for(;I<0;)I+=a;const C=Math.min(e.inHeight,c+N);for(let _=0;_<e.outWidth;++_){const k=_*i-p;let A=k;for(;A<0;)A+=l;const D=Math.min(e.inWidth,h+k);let R=Number.NEGATIVE_INFINITY,W=-1;for(let B=b;B<x;B+=o){const M=B-w;for(let X=I;X<C;X+=a){const z=X-N;for(let Y=A;Y<D;Y+=l){const L=Y-k,le=t.get(m,B,X,Y,v);le>=R&&(R=le,W=M*c*h+z*c+L)}}}n.set(W,m,g,S,_,v)}}}return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dve(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;Ne(r,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;O(hs(o,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const c=hi(r.shape,i,o,u,a,l);let h;if(c.filterWidth===1&&c.filterHeight===1&&st(c.inShape,c.outShape))h=_o({inputs:{x:r},backend:n});else{const d=n.data.get(r.dataId).values,f=Me(r.shape),p=q$(d,r.shape,r.dtype,f,c,"avg");h=n.makeTensorInfo(c.outShape,r.dtype,p.values)}return h}const fve={kernelName:lg,backendName:"cpu",kernelFunc:dve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pve(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=s;Ne(r,"avgPool3d");const c=ba(r.shape,i,o,1,a,l,u),h=n.data.get(r.dataId).values,d=sG(h,r.shape,r.dtype,Me(r.shape),c,"avg");return n.makeTensorInfo(d.shape,"float32",d.values)}const mve={kernelName:ug,backendName:"cpu",kernelFunc:pve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gve(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:u}=s;Ne([r,i],"avgPool3DGrad");const c=ba(i.shape,o,a,1,l,u),h=c.strideDepth,d=c.strideHeight,f=c.strideWidth,p=c.filterDepth,m=c.filterHeight,v=c.filterWidth,g=c.dilationDepth,w=c.dilationHeight,b=c.dilationWidth,x=c.effectiveFilterDepth,S=c.effectiveFilterHeight,N=c.effectiveFilterWidth,I=x-1-c.padInfo.front,C=N-1-c.padInfo.left,_=S-1-c.padInfo.top,k=Xe(i.shape,"float32"),A=1/(p*m*v),D=n.bufferSync(r);for(let R=0;R<c.batchSize;++R)for(let W=0;W<c.inChannels;++W)for(let B=0;B<c.inDepth;++B)for(let M=0;M<c.inHeight;++M)for(let X=0;X<c.inWidth;++X){const z=B-I,Y=M-_,L=X-C;let le=0;for(let Q=0;Q<x;Q+=g){const se=(z+Q)/h;if(!(se<0||se>=c.outDepth||Math.floor(se)!==se))for(let de=0;de<S;de+=w){const ue=(Y+de)/d;if(!(ue<0||ue>=c.outHeight||Math.floor(ue)!==ue))for(let fe=0;fe<N;fe+=b){const ve=(L+fe)/f;if(ve<0||ve>=c.outWidth||Math.floor(ve)!==ve)continue;const De=D.get(R,se,ue,ve,W);le+=De}}}k.set(le*A,R,B,M,X,W)}return n.makeTensorInfo(k.shape,k.dtype,k.values)}const yve={kernelName:jx,backendName:"cpu",kernelFunc:gve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vve(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,o=i;Ne([r,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,c=hi(o.shape,a,l,1,u),h=c.strideHeight,d=c.strideWidth,f=c.filterHeight,p=c.filterWidth,m=c.dilationHeight,v=c.dilationWidth,g=c.effectiveFilterHeight,w=c.effectiveFilterWidth,b=w-1-c.padInfo.left,x=g-1-c.padInfo.top,S=Xe(o.shape,"float32"),N=1/(f*p),I=n.data.get(r.dataId).values,C=Xe(r.shape,"float32",I);for(let _=0;_<c.batchSize;++_)for(let k=0;k<c.inChannels;++k)for(let A=0;A<c.inHeight;++A)for(let D=0;D<c.inWidth;++D){const R=A-x,W=D-b;let B=0;for(let M=0;M<g;M+=m){const X=(R+M)/h;if(!(X<0||X>=c.outHeight||Math.floor(X)!==X))for(let z=0;z<w;z+=v){const Y=(W+z)/d;if(Y<0||Y>=c.outWidth||Math.floor(Y)!==Y)continue;const L=C.get(_,X,Y,k);B+=L}}S.set(B*N,_,A,D,k)}return n.makeTensorInfo(S.shape,S.dtype,S.values)}const wve={kernelName:Wx,backendName:"cpu",kernelFunc:vve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xve(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,scale:i,offset:o,mean:a,variance:l}=e;O(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),O(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),O(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Ne([r,a,l,i,o],"batchNorm");let{varianceEpsilon:u}=s;u==null&&(u=.001);const c=n.data.get(r.dataId).values,h=n.data.get(a.dataId).values,d=n.data.get(l.dataId).values,f=i?n.data.get(i.dataId).values:new Float32Array([1]),p=o?n.data.get(o.dataId).values:new Float32Array([0]),m=new Float32Array(c.length),v=p.length,g=f.length,w=d.length,b=h.length;let x=0,S=0,N=0,I=0;for(let C=0;C<c.length;++C)m[C]=p[x++]+(c[C]-h[S++])*f[N++]/Math.sqrt(d[I++]+u),x>=v&&(x=0),S>=b&&(S=0),N>=g&&(N=0),I>=w&&(I=0);return n.makeTensorInfo(r.shape,r.dtype,m)}const bve={kernelName:Cg,backendName:"cpu",kernelFunc:xve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sve(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:i,crops:o}=s;Ne([r],"batchToSpaceND");const a=i.reduce((g,w)=>g*w),l=ky(r.shape,i,a),u=Ey(l.length,i.length),c=Ny(r.shape,i,a),h=MN(o,i.length),d=zN(c,o,i.length),f=Vt({inputs:{x:r},backend:n,attrs:{shape:l}}),p=er({inputs:{x:f},backend:n,attrs:{perm:u}}),m=Vt({inputs:{x:p},backend:n,attrs:{shape:c}}),v=ac({inputs:{x:m},backend:n,attrs:{begin:h,size:d}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),v}const Cve={kernelName:hg,backendName:"cpu",kernelFunc:Sve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ive(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:i}=e,{size:o}=s,a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,u=U$(a,l,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,u)}const _ve={kernelName:Gx,backendName:"cpu",kernelFunc:Ive};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tve(t){const{inputs:e,backend:n}=t,{s0:s,s1:r}=e,i=n.data.get(s.dataId).values,o=n.data.get(r.dataId).values,a=Ge(Array.from(i),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const kve={kernelName:Hx,backendName:"cpu",kernelFunc:Tve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eve=Et(Cd,(t,e)=>{const n=e;return t>n.clipValueMax?n.clipValueMax:t<n.clipValueMin?n.clipValueMin:t}),Nve={kernelName:Cd,backendName:"cpu",kernelFunc:Eve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $ve=t=>{const{x:e}=t.inputs,n=t.backend,s=new Float32Array(re(e.shape)),r=n.data.get(e.dataId),i=r.complexTensorInfos.real,o=r.complexTensorInfos.imag,a=n.data.get(i.dataId).values,l=n.data.get(o.dataId).values;for(let u=0;u<a.length;u++){const c=a[u],h=l[u];s[u]=Math.hypot(c,h)}return n.makeOutput(s,e.shape,"float32")},Rve={kernelName:fg,backendName:"cpu",kernelFunc:$ve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ed(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.data.get(s.dataId).complexTensorInfos.imag,i=n.data.get(r.dataId).values;return n.makeTensorInfo(r.shape,r.dtype,i)}const Ave={kernelName:db,backendName:"cpu",kernelFunc:ed};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function td(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s,i=Ze(r,e[0].shape)[0],o=e.map(m=>m.shape);PN(o,i);let a=vo(e.map(m=>m.shape),i);if(re(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(m=>re(m.shape)>0);if(l.length===1)return _o({inputs:{x:l[0]},backend:n});if(l[0].dtype==="complex64"){const m=l.map(x=>oc({inputs:{input:x},backend:n})),v=l.map(x=>ed({inputs:{input:x},backend:n})),g=td({inputs:m,backend:n,attrs:{axis:i}}),w=td({inputs:v,backend:n,attrs:{axis:i}}),b=ur({inputs:{real:g,imag:w},backend:n});return m.forEach(x=>n.disposeIntermediateTensorInfo(x)),v.forEach(x=>n.disposeIntermediateTensorInfo(x)),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(w),b}const u=l.map(m=>{const g=[-1,re(m.shape.slice(i))];return Vt({inputs:{x:m},backend:n,attrs:{shape:g}})}),c=u.map(m=>({vals:n.data.get(m.dataId).values,shape:m.shape}));a=vo(u.map(m=>m.shape),1);const h=u[0].shape[0]===1,d=oj(c,a,e[0].dtype,h),f=vo(l.map(m=>m.shape),i),p=n.makeTensorInfo(f,e[0].dtype,d);return u.forEach(m=>n.disposeIntermediateTensorInfo(m)),p}const Dve={kernelName:pg,backendName:"cpu",kernelFunc:td};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rG(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:u,dimRoundingMode:c}=s;Ne([r,i],"conv2d");const h=Sa(l),d=Yn(r.shape,i.shape,o,u,a,c,!1,h),f=d.filterHeight,p=d.filterWidth,m=d.dilationHeight,v=d.dilationWidth,g=d.padInfo.left,w=d.padInfo.top,b=d.dataFormat==="channelsLast",x=new $n(d.outShape,r.dtype),S=Me(r.shape),N=Me(i.shape),I=S[0],C=b?S[1]:S[2],_=b?S[2]:1,k=b?1:S[1],A=x.strides[0],D=b?x.strides[1]:x.strides[2],R=b?x.strides[2]:1,W=b?1:x.strides[1],B=n.data.get(r.dataId).values,M=n.data.get(i.dataId).values,X=x.values;for(let z=0;z<d.batchSize;++z){const Y=z*I,L=z*A;for(let le=0;le<d.outHeight;++le){const Q=L+le*D,se=le*d.strideHeight-w;for(let de=0;de<f;++de){const ue=se+de*m;if(ue<0||ue>=d.inHeight)continue;const fe=de*N[0],ve=Y+ue*C;for(let De=0;De<d.outWidth;++De){const Ie=Q+De*R,Oe=De*d.strideWidth-g;for(let ze=0;ze<p;++ze){const Ye=Oe+ze*v;if(Ye<0||Ye>=d.inWidth)continue;const Qe=fe+ze*N[1],xt=ve+Ye*_;let ft=Qe;for(let at=0;at<d.inChannels;++at){const Ct=B[xt+at*k];for(let vt=0;vt<d.outChannels;++vt)X[Ie+vt*W]+=Ct*M[ft+vt];ft+=d.outChannels}}}}}}return n.makeTensorInfo(x.shape,x.dtype,X)}const Ove={kernelName:mg,backendName:"cpu",kernelFunc:rG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pve(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:c}=s;Ne([r,i],"conv2dBackpropFilter");const h=Sa(l),d=Yn(r.shape,c,o,1,a,u,!1,h),{strideHeight:f,strideWidth:p,filterHeight:m,filterWidth:v}=d,g=d.dataFormat==="channelsLast",w=new $n(d.filterShape,"float32"),b=d.padInfo.left,x=d.padInfo.top,S=n.data.get(r.dataId).values,N=n.data.get(i.dataId).values,I=new $n(r.shape,r.dtype,S),C=new $n(i.shape,i.dtype,N);for(let _=0;_<m;++_){const k=Math.max(0,Math.ceil((x-_)/f)),A=Math.min(d.outHeight,(d.inHeight+x-_)/f);for(let D=0;D<v;++D){const R=Math.max(0,Math.ceil((b-D)/p)),W=Math.min(d.outWidth,(d.inWidth+b-D)/p);for(let B=0;B<d.inChannels;++B)for(let M=0;M<d.outChannels;++M){let X=0;for(let z=0;z<d.batchSize;++z)for(let Y=k;Y<A;++Y){const L=_+Y*f-x;for(let le=R;le<W;++le){const Q=D+le*p-b;g?X+=I.get(z,L,Q,B)*C.get(z,Y,le,M):X+=I.get(z,B,L,Q)*C.get(z,M,Y,le)}}w.set(X,_,D,B,M)}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}const Fve={kernelName:Kx,backendName:"cpu",kernelFunc:Pve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lve(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:u,dimRoundingMode:c}=s;Ne([r,i],"conv2dBackpropInput");const h=Me(i.shape),d=Me(r.shape);let f=Sa(u);const p=Yn(o,i.shape,a,1,l,c,!1,f),m=new $n(p.inShape,"float32"),v=m.values,g=n.data.get(r.dataId).values,w=n.data.get(i.dataId).values,[b,x,S]=h,{batchSize:N,filterHeight:I,filterWidth:C,inChannels:_,inHeight:k,inWidth:A,outChannels:D,outHeight:R,outWidth:W,strideHeight:B,strideWidth:M}=p;f=p.dataFormat;const X=I-1-p.padInfo.top,z=C-1-p.padInfo.left,Y=f==="channelsLast",L=m.strides[0],le=Y?m.strides[1]:m.strides[2],Q=Y?m.strides[2]:1,se=Y?1:m.strides[1],de=d[0],ue=Y?d[1]:d[2],fe=Y?d[2]:1,ve=Y?1:d[1];for(let De=0;De<N;++De)for(let Ie=0;Ie<_;++Ie)for(let Oe=0;Oe<k;++Oe){const ze=Oe-X,Ye=Math.max(0,Math.ceil(ze/B)),Qe=Math.min(R,(I+ze)/B);for(let xt=0;xt<A;++xt){const ft=xt-z,at=Math.max(0,Math.ceil(ft/M)),Ct=Math.min(W,(C+ft)/M);let vt=0;for(let Ut=Ye;Ut<Qe;++Ut){const an=Ut*B-ze;for(let Wt=at;Wt<Ct;++Wt){const ms=Wt*M-ft,In=de*De+ue*Ut+fe*Wt,ln=b*(I-1-an)+x*(C-1-ms)+S*Ie;for(let nt=0;nt<D;++nt){const Nt=g[In+ve*nt],fn=w[ln+nt];vt+=Nt*fn}}}const Jn=L*De+le*Oe+Q*xt+se*Ie;v[Jn]=vt}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}const Mve={kernelName:gg,backendName:"cpu",kernelFunc:Lve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zve(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s;Ne([r,i],"conv3d");const u=ql(r.shape,i.shape,o,l,a),{filterDepth:c,filterHeight:h,filterWidth:d,dilationDepth:f,dilationHeight:p,dilationWidth:m,padInfo:v}=u,g=v.front,w=v.left,b=v.top,x=new $n(u.outShape,r.dtype),S=n.data.get(r.dataId).values,N=n.data.get(i.dataId).values,I=x.values,C=Me(r.shape),_=Me(i.shape);for(let k=0;k<u.batchSize;++k){const A=k*C[0],D=k*x.strides[0];for(let R=0;R<u.outDepth;++R){const W=D+R*x.strides[1],B=R*u.strideDepth-g;for(let M=0;M<c;++M){const X=B+M*f;if(X<0||X>=u.inDepth)continue;const z=M*_[0],Y=A+X*C[1];for(let L=0;L<u.outHeight;++L){const le=W+L*x.strides[2],Q=L*u.strideHeight-b;for(let se=0;se<h;++se){const de=Q+se*p;if(de<0||de>=u.inHeight)continue;const ue=z+se*_[1],fe=Y+de*C[2];for(let ve=0;ve<u.outWidth;++ve){const De=le+ve*u.outChannels,Ie=ve*u.strideWidth-w;for(let Oe=0;Oe<d;++Oe){const ze=Ie+Oe*m;if(ze<0||ze>=u.inWidth)continue;const Ye=ue+Oe*_[2],Qe=fe+ze*u.inChannels;let xt=Ye;for(let ft=0;ft<u.inChannels;++ft){const at=S[Qe+ft];for(let Ct=0;Ct<u.outChannels;++Ct)I[De+Ct]+=at*N[xt+Ct];xt+=u.outChannels}}}}}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}const Bve={kernelName:yg,backendName:"cpu",kernelFunc:zve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vve(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,pad:a,filterShape:l}=s;Ne([r,i],"conv3dBackpropFilterV2");const u=Me(r.shape),c=Me(i.shape),h=ql(r.shape,l,o,1,a),d=h.strideDepth,f=h.strideHeight,p=h.strideWidth,m=h.filterDepth,v=h.filterHeight,g=h.filterWidth,w=new $n(h.filterShape,"float32"),b=w.values,[x,S,N,I]=w.strides,C=n.data.get(i.dataId).values,[_,k,A,D]=c,R=n.data.get(r.dataId).values,[W,B,M,X]=u,z=h.padInfo.front,Y=h.padInfo.left,L=h.padInfo.top;for(let le=0;le<m;++le){const Q=Math.max(0,Math.ceil((z-le)/d)),se=Math.min(h.outDepth,(h.inDepth+z-le)/d),de=le*x;for(let ue=0;ue<v;++ue){const fe=Math.max(0,Math.ceil((L-ue)/f)),ve=Math.min(h.outHeight,(h.inHeight+L-ue)/f),De=ue*S+de;for(let Ie=0;Ie<g;++Ie){const Oe=Math.max(0,Math.ceil((Y-Ie)/p)),ze=Math.min(h.outWidth,(h.inWidth+Y-Ie)/p),Ye=Ie*N+De;for(let Qe=0;Qe<h.inChannels;++Qe){const xt=Qe*I+Ye;for(let ft=0;ft<h.outChannels;++ft){let at=0;for(let Ct=0;Ct<h.batchSize;++Ct){const vt=Ct*W,Jn=Ct*_;for(let Ut=Q;Ut<se;++Ut){const Wt=(le+Ut*d-z)*B+vt,ms=Ut*k+Jn;for(let In=fe;In<ve;++In){const nt=(ue+In*f-L)*M+Wt,Nt=In*A+ms;for(let fn=Oe;fn<ze;++fn){const Bs=(Ie+fn*p-Y)*X+nt,Ea=fn*D+Nt;at+=R[Bs+Qe]*C[Ea+ft]}}}}b[xt+ft]=at}}}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}const Uve={kernelName:Xx,backendName:"cpu",kernelFunc:Vve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wve(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{pad:o,strides:a,inputShape:l}=s;Ne([r],"conv3dBackpropInputV2");const u=Me(r.shape),c=Me(i.shape),h=ql(l,i.shape,a,1,o),d=new $n(h.inShape,"float32"),f=d.values,[p,m,v,g]=d.strides,w=n.data.get(r.dataId).values,[b,x,S,N]=u,I=n.data.get(i.dataId).values,[C,_,k,A]=c,{batchSize:D,filterDepth:R,filterHeight:W,filterWidth:B,inChannels:M,inDepth:X,inHeight:z,inWidth:Y,outChannels:L,outDepth:le,outHeight:Q,outWidth:se,strideDepth:de,strideHeight:ue,strideWidth:fe}=h,ve=R-1-h.padInfo.front,De=W-1-h.padInfo.top,Ie=B-1-h.padInfo.left;for(let Oe=0;Oe<D;++Oe)for(let ze=0;ze<M;++ze)for(let Ye=0;Ye<X;++Ye){const Qe=Ye-ve,xt=Math.max(0,Math.ceil(Qe/de)),ft=Math.min(le,(R+Qe)/de);for(let at=0;at<z;++at){const Ct=at-De,vt=Math.max(0,Math.ceil(Ct/ue)),Jn=Math.min(Q,(W+Ct)/ue);for(let Ut=0;Ut<Y;++Ut){const an=Ut-Ie,Wt=Math.max(0,Math.ceil(an/fe)),ms=Math.min(se,(B+an)/fe);let In=0;for(let ln=xt;ln<ft;++ln){const nt=ln*de-Qe;for(let Nt=vt;Nt<Jn;++Nt){const fn=Nt*ue-Ct;for(let jr=Wt;jr<ms;++jr){const Bs=jr*fe-an,Ea=b*Oe+x*ln+S*Nt+N*jr,Ji=C*(R-1-nt)+_*(W-1-fn)+k*(B-1-Bs)+A*ze;for(let Zi=0;Zi<L;++Zi){const zc=w[Ea+Zi],Na=I[Ji+Zi];In+=zc*Na}}}}f[p*Oe+m*Ye+v*at+g*Ut+ze]=In}}}return n.makeTensorInfo(d.shape,d.dtype,d.values)}const jve={kernelName:Yx,backendName:"cpu",kernelFunc:Wve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gve=Et(Id,t=>Math.cos(t)),Hve={kernelName:Id,backendName:"cpu",kernelFunc:Gve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qve=Et(_d,t=>Math.cosh(t)),Kve={kernelName:_d,backendName:"cpu",kernelFunc:qve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xve(t){const{inputs:e,backend:n,attrs:s}=t,{image:r,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:u}=s,[c,h,d,f]=r.shape,p=i.shape[0],[m,v]=a,g=Xe([p,m,v,f],"float32"),w=n.data.get(i.dataId).values,b=n.data.get(o.dataId).values,x=n.data.get(r.dataId).values,S=Me(r.shape),N=Me(g.shape);for(let I=0;I<p;I++){const C=I*4,_=w[C],k=w[C+1],A=w[C+2],D=w[C+3],R=b[I];if(R>=c)continue;const W=m>1?(A-_)*(h-1)/(m-1):0,B=v>1?(D-k)*(d-1)/(v-1):0;for(let M=0;M<m;M++){const X=m>1?_*(h-1)+M*W:.5*(_+A)*(h-1);if(X<0||X>h-1){for(let z=0;z<v;z++)for(let Y=0;Y<f;Y++){const L=Y+z*N[2]+M*N[1]+I*N[0];g.values[L]=u}continue}if(l==="bilinear"){const z=Math.floor(X),Y=Math.ceil(X),L=X-z;for(let le=0;le<v;le++){const Q=v>1?k*(d-1)+le*B:.5*(k+D)*(d-1);if(Q<0||Q>d-1){for(let fe=0;fe<f;fe++){const ve=fe+le*N[2]+M*N[1]+I*N[0];g.values[ve]=u}continue}const se=Math.floor(Q),de=Math.ceil(Q),ue=Q-se;for(let fe=0;fe<f;fe++){let ve=fe+se*S[2]+z*S[1]+R*S[0];const De=x[ve];ve=fe+de*S[2]+z*S[1]+R*S[0];const Ie=x[ve];ve=fe+se*S[2]+Y*S[1]+R*S[0];const Oe=x[ve];ve=fe+de*S[2]+Y*S[1]+R*S[0];const ze=x[ve],Ye=De+(Ie-De)*ue,Qe=Oe+(ze-Oe)*ue;ve=fe+le*N[2]+M*N[1]+I*N[0],g.values[ve]=Ye+(Qe-Ye)*L}}}else for(let z=0;z<v;++z){const Y=v>1?k*(d-1)+z*B:.5*(k+D)*(d-1);if(Y<0||Y>d-1){for(let Q=0;Q<f;Q++){const se=Q+z*N[2]+M*N[1]+I*N[0];g.values[se]=u}continue}const L=Math.round(Y),le=Math.round(X);for(let Q=0;Q<f;Q++){const se=Q+L*S[2]+le*S[1]+R*S[0],de=Q+z*N[2]+M*N[1]+I*N[0];g.values[de]=x[se]}}}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}const Yve={kernelName:Jx,backendName:"cpu",kernelFunc:Xve};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qve(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;Ne(r,"cumprod");const l=on([i],r.shape.length);let u=r;l!=null&&(u=er({inputs:{x:r},backend:n,attrs:{perm:l}}));const c=bn(1,r.shape.length)[0];if(c!==u.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${c}`);const h=Xs(u.dtype,"int32"),d=Bx(re(u.shape),h),f=n.data.get(u.dataId).values,p=u.shape[u.shape.length-1],m=a?(g,w)=>g+p-w-1:(g,w)=>g+w;for(let g=0;g<f.length;g+=p)for(let w=0;w<p;w++){const b=m(g,w);if(w===0)d[b]=o?1:f[b];else{const x=m(g,w-1);d[b]=o?f[x]*d[x]:f[b]*d[x]}}const v=n.makeTensorInfo(u.shape,h,d);if(l!=null){const g=Kl(l),w=er({inputs:{x:v},backend:n,attrs:{perm:g}});return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(u),w}return v}const Jve={kernelName:Qx,backendName:"cpu",kernelFunc:Qve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zve(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;Ne(r,"cumsum");const l=on([i],r.shape.length);let u=r;l!=null&&(u=er({inputs:{x:r},backend:n,attrs:{perm:l}}));const c=bn(1,r.shape.length)[0];if(c!==u.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${c}`);const h=Xs(u.dtype,"int32"),d=us(re(u.shape),h),f=n.data.get(u.dataId).values,p=u.shape[u.shape.length-1],m=a?(g,w)=>g+p-w-1:(g,w)=>g+w;for(let g=0;g<f.length;g+=p)for(let w=0;w<p;w++){const b=m(g,w);if(w===0)d[b]=o?0:f[b];else{const x=m(g,w-1);d[b]=o?f[x]+d[x]:f[b]+d[x]}}const v=n.makeTensorInfo(u.shape,h,d);if(l!=null){const g=Kl(l),w=er({inputs:{x:v},backend:n,attrs:{perm:g}});return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(u),w}return v}const ewe={kernelName:vg,backendName:"cpu",kernelFunc:Zve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function twe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:i}=e,{size:o,binaryOutput:a}=s;if(r.shape.length===1){const l=n.data.get(r.dataId).values,u=n.data.get(i.dataId).values,c=U$(l,u,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,c)}else if(r.shape.length===2){const l=n.bufferSync(r),u=n.bufferSync(i),c=sj(l,u,o,a);return n.makeTensorInfo(c.shape,i.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const nwe={kernelName:Zx,backendName:"cpu",kernelFunc:twe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function swe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockSize:i,dataFormat:o}=s;O(o==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`);const a=r.shape[0],l=r.shape[1],u=r.shape[2],c=r.shape[3],h=l*i,d=u*i,f=c/(i*i),p=n.data.get(r.dataId).values,m=new Float32Array(a*h*d*f);let v=0;for(let g=0;g<a;++g)for(let w=0;w<h;++w){const b=Math.floor(w/i),x=w%i;for(let S=0;S<d;++S){const N=Math.floor(S/i),I=S%i,C=(x*i+I)*f;for(let _=0;_<f;++_){const A=_+C+c*(N+u*(b+l*g));m[v++]=p[A]}}}return n.makeTensorInfo([a,h,d,f],r.dtype,m)}const rwe={kernelName:eb,backendName:"cpu",kernelFunc:swe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iG(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:u}=s;Ne([r,i],"depthwiseConv2DNative");const c=Me(r.shape),h=Me(i.shape);let d=l;d==null&&(d=[1,1]),O(hs(o,d),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${d}'`);const f=Yn(r.shape,i.shape,o,d,a,u,!0),{filterHeight:p,filterWidth:m,dilationHeight:v,dilationWidth:g,padInfo:w}=f,b=w.left,x=w.top,S=f.outChannels/f.inChannels,N=new $n(f.outShape,r.dtype),I=n.data.get(r.dataId).values,C=n.data.get(i.dataId).values,_=N.values;for(let k=0;k<f.batchSize;++k){const A=k*c[0],D=k*N.strides[0];for(let R=0;R<f.outHeight;++R){const W=D+R*N.strides[1],B=R*f.strideHeight-x;for(let M=0;M<p;++M){const X=B+M*v;if(X<0||X>=f.inHeight)continue;const z=M*h[0],Y=A+X*c[1];for(let L=0;L<f.outWidth;++L){const le=W+L*N.strides[2],Q=L*f.strideWidth-b;for(let se=0;se<m;++se){const de=Q+se*g;if(de<0||de>=f.inWidth)continue;const ue=z+se*h[1],fe=Y+de*f.inChannels;let ve=le,De=ue;for(let Ie=0;Ie<f.inChannels;++Ie){const Oe=I[fe+Ie];for(let ze=0;ze<S;++ze)_[ve+ze]+=Oe*C[De+ze];ve+=S,De+=S}}}}}}return n.makeTensorInfo(N.shape,N.dtype,N.values)}const iwe={kernelName:wg,backendName:"cpu",kernelFunc:iG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function owe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,filterShape:c}=s;Ne([r,i],"depthwiseConv2dNativeBackpropFilter");const h=Yn(r.shape,c,o,a,l,u,!0),{strideHeight:d,strideWidth:f,filterHeight:p,filterWidth:m}=h,v=new $n(h.filterShape,"float32"),g=h.padInfo.left,w=h.padInfo.top,b=h.outChannels/h.inChannels,x=n.data.get(r.dataId).values,S=new $n(r.shape,r.dtype,x),N=n.data.get(i.dataId).values,I=new $n(i.shape,i.dtype,N);for(let C=0;C<p;++C){const _=Math.max(0,Math.ceil((w-C)/d)),k=Math.min(h.outHeight,(h.inHeight+w-C)/d);for(let A=0;A<m;++A){const D=Math.max(0,Math.ceil((g-A)/f)),R=Math.min(h.outWidth,(h.inWidth+g-A)/f);for(let W=0;W<h.outChannels;++W){const B=Math.trunc(W/b),M=W%b;let X=0;for(let z=0;z<h.batchSize;++z)for(let Y=_;Y<k;++Y){const L=C+Y*d-w;for(let le=D;le<R;++le){const Q=A+le*f-g;X+=S.get(z,L,Q,B)*I.get(z,Y,le,W)}}v.set(X,C,A,B,M)}}}return n.makeTensorInfo(v.shape,v.dtype,v.values)}const awe={kernelName:tb,backendName:"cpu",kernelFunc:owe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lwe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,inputShape:c}=s;Ne([r,i],"depthwiseConv2DNativeBackpropInput");const h=Me(r.shape),d=Me(i.shape),f=Yn(c,i.shape,o,a,l,u,!0),p=new $n(f.inShape,"float32"),m=p.values,[v,g,w]=p.strides,b=n.data.get(r.dataId).values,[x,S,N]=h,I=n.data.get(i.dataId).values,[C,_,k]=d,{batchSize:A,filterHeight:D,filterWidth:R,inChannels:W,inHeight:B,inWidth:M,outChannels:X,outHeight:z,outWidth:Y,strideHeight:L,strideWidth:le}=f,Q=D-1-f.padInfo.top,se=R-1-f.padInfo.left,de=X/W;for(let ue=0;ue<A;++ue)for(let fe=0;fe<W;++fe)for(let ve=0;ve<B;++ve){const De=ve-Q,Ie=Math.max(0,Math.ceil(De/L)),Oe=Math.min(z,(D+De)/L);for(let ze=0;ze<M;++ze){const Ye=ze-se,Qe=Math.max(0,Math.ceil(Ye/le)),xt=Math.min(Y,(R+Ye)/le);let ft=0;for(let at=Ie;at<Oe;++at){const Ct=at*L-De;for(let vt=Qe;vt<xt;++vt){const Jn=vt*le-Ye,Ut=x*ue+S*at+N*vt,an=C*(D-1-Ct)+_*(R-1-Jn)+k*fe;for(let Wt=0;Wt<de;++Wt){const ms=fe*de+Wt,In=b[Ut+ms],ln=I[an+Wt];ft+=In*ln}}}m[v*ue+g*ve+w*ze+fe]=ft}}return n.makeTensorInfo(p.shape,p.dtype,p.values)}const uwe={kernelName:nb,backendName:"cpu",kernelFunc:lwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cwe(t){const{inputs:e,backend:n}=t,{x:s}=e,r=re(s.shape),i=n.data.get(s.dataId).values,o=Xe([r,r],s.dtype),a=o.values;for(let u=0;u<i.length;u++)a[u*r+u]=i[u];const l=[...s.shape,...s.shape];return n.makeTensorInfo(l,o.dtype,o.values)}const hwe={kernelName:sb,backendName:"cpu",kernelFunc:cwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dwe={kernelName:xg,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:r}=t,{strides:i,pad:o,dilations:a}=n,l=e,u=l.data.get(s.dataId).values,c=s.shape.length,h=l.data.get(r.dataId).values,d=r.shape.length,{batchSize:f,inHeight:p,inWidth:m,inChannels:v,outHeight:g,outWidth:w,padInfo:b,strideHeight:x,strideWidth:S,filterHeight:N,filterWidth:I,dilationHeight:C,dilationWidth:_,outShape:k}=uy(s.shape,r.shape,i,o,"NHWC",a),A=re(k),D=k.length,R=cn(s.dtype,A);for(let B=0;B<f;++B)for(let M=0;M<g;++M){const X=M*x-b.top;for(let z=0;z<w;++z){const Y=z*S-b.left;for(let L=0;L<v;++L){let le=Number.MIN_SAFE_INTEGER;for(let se=0;se<N;++se){const de=X+se*C;if(de>=0&&de<p)for(let ue=0;ue<I;++ue){const fe=Y+ue*_;if(fe>=0&&fe<m){const ve=Pi([B,de,fe,L],c,Me(s.shape)),De=Pi([se,ue,L],d,Me(r.shape)),Ie=u[ve]+h[De];Ie>le&&(le=Ie)}}}const Q=Pi([B,M,z,L],D,Me(k));R[Q]=le}}}return{dataId:l.write(Gl(R,s.dtype),k,s.dtype),shape:k,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fwe={kernelName:Iw,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:r,dy:i}=t,{strides:o,pad:a,dilations:l}=n,u=e,c=Fr(s.shape,u.data.get(s.dataId).values),h=Fr(r.shape,u.data.get(r.dataId).values),{batchSize:d,inHeight:f,inWidth:p,inChannels:m,outHeight:v,outWidth:g,padInfo:w,strideHeight:b,strideWidth:x,filterHeight:S,filterWidth:N,dilationHeight:I,dilationWidth:C,outShape:_}=uy(s.shape,r.shape,o,a,"NHWC",l);O(i.rank===_.length,()=>`Error in ${Iw}, dy must have the same rank as output ${_.length}, but got ${i.rank}`);const k=Fr(_,u.data.get(i.dataId).values),A=Kk(r.shape,r.dtype);for(let R=0;R<d;++R)for(let W=0;W<v;++W){const B=W*b-w.top;for(let M=0;M<g;++M){const X=M*x-w.left;for(let z=0;z<m;++z){let Y=Number.MIN_SAFE_INTEGER,L=0,le=0;for(let Q=0;Q<S;++Q){const se=B+Q*I;if(se>=0&&se<f)for(let de=0;de<N;++de){const ue=X+de*C;if(ue>=0&&ue<p){const fe=c[R][se][ue][z]+h[Q][de][z];fe>Y&&(Y=fe,L=Q,le=de)}}}A[L][le][z]+=k[R][W][M][z]}}}return{dataId:u.write(Gl(A,s.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pwe={kernelName:Cw,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:r,dy:i}=t,{strides:o,pad:a,dilations:l}=n,u=e,c=Fr(s.shape,u.data.get(s.dataId).values),h=Fr(r.shape,u.data.get(r.dataId).values),{batchSize:d,inHeight:f,inWidth:p,inChannels:m,outHeight:v,outWidth:g,padInfo:w,strideHeight:b,strideWidth:x,filterHeight:S,filterWidth:N,dilationHeight:I,dilationWidth:C,outShape:_}=uy(s.shape,r.shape,o,a,"NHWC",l);O(i.rank===_.length,()=>`Error in ${Cw}, dy must have the same rank as output ${_.length}, but got ${i.rank}`);const k=Fr(_,u.data.get(i.dataId).values),A=Kk(s.shape,s.dtype);for(let R=0;R<d;++R)for(let W=0;W<v;++W){const B=W*b-w.top;for(let M=0;M<g;++M){const X=M*x-w.left;for(let z=0;z<m;++z){let Y=Number.MIN_SAFE_INTEGER,L=B<0?0:B,le=X<0?0:X;for(let Q=0;Q<S;++Q){const se=B+Q*I;if(se>=0&&se<f)for(let de=0;de<N;++de){const ue=X+de*C;if(ue>=0&&ue<p){const fe=c[R][se][ue][z]+h[Q][de][z];fe>Y&&(Y=fe,L=se,le=ue)}}}A[R][L][le][z]+=k[R][W][M][z]}}}return{dataId:u.write(Gl(A,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mwe(t){const{inputs:e,backend:n,attrs:s}=t,{image:r}=e,{canvas:i,options:o}=s,{contextOptions:a,imageOptions:l}=o||{},u=(l==null?void 0:l.alpha)||1,c=(a==null?void 0:a.contextType)||"2d";if(c!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const h=i.getContext(c,(a==null?void 0:a.contextAttributes)||{});if(h==null)throw new Error(`Could not get the context with ${c} type.`);const[d,f]=r.shape.slice(0,2),p=r.shape.length===2?1:r.shape[2],m=n.data.get(r.dataId).values,v=r.dtype==="float32"?255:1,g=new Uint8ClampedArray(f*d*4);for(let b=0;b<d*f;++b){const x=[0,0,0,255*u];for(let N=0;N<p;N++){const I=m[b*p+N];if(r.dtype==="float32"){if(I<0||I>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${I}.`)}else if(r.dtype==="int32"&&(I<0||I>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${I}.`);p===1?(x[0]=I*v,x[1]=I*v,x[2]=I*v):x[N]=I*v}const S=b*4;g[S+0]=Math.round(x[0]),g[S+1]=Math.round(x[1]),g[S+2]=Math.round(x[2]),g[S+3]=Math.round(x[3])}i.width=f,i.height=d;const w=new ImageData(g,f,d);return h.putImageData(w,0,0),r}const gwe={kernelName:rb,backendName:"cpu",kernelFunc:mwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function By(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;Ne(r,"sum");let a;r.dtype==="bool"?a=Ll({inputs:{x:r},backend:n,attrs:{dtype:"int32"}}):a=_o({inputs:{x:r},backend:n});const l=a.shape.length,u=Ze(i,a.shape),c=on(u,l);let h=u,d=a;c!=null&&(d=er({inputs:{x:a},backend:n,attrs:{perm:c}}),h=bn(h.length,l)),ds("sum",h,d.shape.length);const[f,p]=Qn(d.shape,h),m=Xs(d.dtype,"int32");let v=Ww(n,f,m);const g=re(p),w=n.data.get(v.dataId).values,b=n.data.get(d.dataId).values;for(let x=0;x<w.length;++x){const S=x*g;let N=0;for(let I=0;I<g;++I)N+=b[S+I];w[x]=N}if(o){const x=xn(v.shape,u),S=v;v=Vt({inputs:{x:v},backend:n,attrs:{shape:x}}),n.disposeIntermediateTensorInfo(S)}return n.disposeIntermediateTensorInfo(a),c!=null&&n.disposeIntermediateTensorInfo(d),v}const ywe={kernelName:Zg,backendName:"cpu",kernelFunc:By};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vwe(t){const{inputs:e,backend:n,attrs:s}=t,{equation:r}=s,i=e,{allDims:o,summedDims:a,idDims:l}=qN(r,i.length);XN(o.length,l,i);const{path:u,steps:c}=YN(a,l),h=c.length;let d=null,f=o.length;const p=[];for(let m=0;m<h;++m){for(const v of c[m]){const{permutationIndices:g,expandDims:w}=KN(f,l[v]);let b;QN(g)?b=i[v]:(b=er({inputs:{x:i[v]},backend:n,attrs:{perm:g}}),p.push(b));const x=b.shape.slice();for(let S=0;S<w.length;++S)x.splice(w[S],0,1);st(b.shape,x)||(b=Vt({inputs:{x:b},backend:n,attrs:{shape:x}}),p.push(b)),d===null?d=b:(d=rS({inputs:{a:b,b:d},backend:n}),p.push(d))}m<h-1&&(u[m]>=0&&(d=By({inputs:{x:d},backend:n,attrs:{axis:u[m]-(o.length-f),keepDims:!1}}),p.push(d)),f--)}for(const m of p)m!==d&&n.disposeIntermediateTensorInfo(m);return d}const wwe={kernelName:ib,backendName:"cpu",kernelFunc:vwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xwe(t){const{inputs:e,backend:n}=t,{dy:s,y:r}=e;Ne([s,r],"eluGrad");const i=new Float32Array(re(r.shape)),o=n.data.get(r.dataId).values,a=n.data.get(s.dataId).values;for(let l=0;l<o.length;++l){const u=o[l];u>=0?i[l]=a[l]:i[l]=a[l]*(u+1)}return n.makeTensorInfo(r.shape,"float32",i)}const bwe={kernelName:ob,backendName:"cpu",kernelFunc:xwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Swe=BN,Cwe=VN,Iwe=UN,_we=WN,Twe=jN,kwe=GN,Ewe=Et(Ed,t=>{const e=Math.sign(t),n=Math.abs(t),s=1/(1+Swe*n);return e*(1-((((kwe*s+Twe)*s+_we)*s+Iwe)*s+Cwe)*s*Math.exp(-n*n))}),Nwe={kernelName:Ed,backendName:"cpu",kernelFunc:Ewe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hw(t){const{inputs:e,backend:n,attrs:s}=t,{input:r}=e,{dim:i}=s,o=r.shape.length,a=r.shape.slice();let l=i;return i<0&&(O(-(o+1)<=i,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+i+1),a.splice(l,0,1),Vt({inputs:{x:r},backend:n,attrs:{shape:a}})}const $we={kernelName:Sg,backendName:"cpu",kernelFunc:Hw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rwe=Cn((t,e)=>t/e),K$=Mn(Td,Rwe),P_={kernelName:Td,backendName:"cpu",kernelFunc:K$};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oG(t,e,n){const s=t.shape,r=s[0],i=s[1],o=n.data.get(t.dataId),a=o.complexTensorInfos.real,l=o.complexTensorInfos.imag,u=[r,i],c=re(u),h=qn("float32",c),d=qn("float32",c);for(let v=0;v<r;v++){const g=ac({inputs:{x:a},backend:n,attrs:{begin:[v,0],size:[1,i]}}),w=ac({inputs:{x:l},backend:n,attrs:{begin:[v,0],size:[1,i]}}),b=ur({inputs:{real:g,imag:w},backend:n}),{real:x,imag:S}=Awe(b,e,n),N=pa(x,S);for(let I=0;I<i;I++){const C=HN(N,I);h[v*i+I]=C.real,d[v*i+I]=C.imag}n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(w),n.disposeIntermediateTensorInfo(b)}const f=n.makeTensorInfo(u,"float32",h),p=n.makeTensorInfo(u,"float32",d),m=ur({inputs:{real:f,imag:p},backend:n});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),m}function Awe(t,e,n){const s=re(t.shape),r=n.data.get(t.dataId),i=n.data.get(r.complexTensorInfos.real.dataId).values,o=n.data.get(r.complexTensorInfos.imag.dataId).values;if(Dwe(s)){const a=F_(i,o,s,e,n),l=[t.shape[0],t.shape[1]];if(e){const u=n.makeTensorInfo(l,"float32",a.real),c=n.makeTensorInfo(l,"float32",a.imag),h=n.makeTensorInfo([],"float32",xa(s,"float32")),d=_o({inputs:{x:h},backend:n}),f=P_.kernelFunc({inputs:{a:u,b:h},backend:n}),p=P_.kernelFunc({inputs:{a:c,b:d},backend:n}),m=n.data.get(f.dataId).values,v=n.data.get(p.dataId).values;return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),{real:m,imag:v}}return a}else{const a=pa(i,o),l=Owe(a,s,e);return YV(l)}}function Dwe(t){return(t&t-1)===0}function F_(t,e,n,s,r){if(n===1)return{real:t,imag:e};const i=pa(t,e),o=n/2,a=QV(i),l=a.real,u=a.imag,c=[l.length],h=r.makeTensorInfo(c,"float32",l),d=r.makeTensorInfo(c,"float32",u),f=ur({inputs:{real:h,imag:d},backend:r}),p=JV(i),m=p.real,v=p.imag,g=[m.length],w=r.makeTensorInfo(g,"float32",m),b=r.makeTensorInfo(g,"float32",v),x=ur({inputs:{real:w,imag:b},backend:r}),S=F_(l,u,o,s,r),N=S.real,I=S.imag,C=[N.length],_=r.makeTensorInfo(C,"float32",N),k=r.makeTensorInfo(C,"float32",I),A=ur({inputs:{real:_,imag:k},backend:r}),D=F_(m,v,o,s,r),R=D.real,W=D.imag,B=[R.length],M=r.makeTensorInfo(B,"float32",R),X=r.makeTensorInfo(B,"float32",W),z=ur({inputs:{real:M,imag:X},backend:r}),Y=eU(n,s),L=[Y.real.length],le=r.makeTensorInfo(L,"float32",Y.real),Q=r.makeTensorInfo(L,"float32",Y.imag),se=ur({inputs:{real:le,imag:Q},backend:r}),de=rS({inputs:{a:se,b:z},backend:r}),ue=Zh({inputs:{a:A,b:de},backend:r}),fe=H$({inputs:{a:A,b:de},backend:r}),ve=oc({inputs:{input:ue},backend:r}),De=oc({inputs:{input:fe},backend:r}),Ie=ed({inputs:{input:ue},backend:r}),Oe=ed({inputs:{input:fe},backend:r}),ze=td({inputs:[ve,De],backend:r,attrs:{axis:0}}),Ye=td({inputs:[Ie,Oe],backend:r,attrs:{axis:0}}),Qe=r.data.get(ze.dataId).values,xt=r.data.get(Ye.dataId).values;return r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(w),r.disposeIntermediateTensorInfo(b),r.disposeIntermediateTensorInfo(x),r.disposeIntermediateTensorInfo(_),r.disposeIntermediateTensorInfo(k),r.disposeIntermediateTensorInfo(A),r.disposeIntermediateTensorInfo(M),r.disposeIntermediateTensorInfo(X),r.disposeIntermediateTensorInfo(z),r.disposeIntermediateTensorInfo(le),r.disposeIntermediateTensorInfo(Q),r.disposeIntermediateTensorInfo(se),r.disposeIntermediateTensorInfo(de),r.disposeIntermediateTensorInfo(ue),r.disposeIntermediateTensorInfo(fe),r.disposeIntermediateTensorInfo(ve),r.disposeIntermediateTensorInfo(Ie),r.disposeIntermediateTensorInfo(De),r.disposeIntermediateTensorInfo(Oe),r.disposeIntermediateTensorInfo(ze),r.disposeIntermediateTensorInfo(Ye),{real:Qe,imag:xt}}function Owe(t,e,n){const s=new Float32Array(e*2);for(let r=0;r<e;r++){let i=0,o=0;for(let a=0;a<e;a++){const l=tU(r*a,e,n),u=HN(t,a);i+=u.real*l.real-u.imag*l.imag,o+=u.real*l.imag+u.imag*l.real}n&&(i/=e,o/=e),ZV(s,i,o,r)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pwe(t){const{inputs:e,backend:n}=t,{input:s}=e,r=re(s.shape),i=s.shape[s.shape.length-1],o=r/i,a=Vt({inputs:{x:s},backend:n,attrs:{shape:[o,i]}}),l=oG(a,!1,n),u=Vt({inputs:{x:l},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),u}const Fwe={kernelName:ab,backendName:"cpu",kernelFunc:Pwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X$(t){const{backend:e,attrs:n}=t,{shape:s,value:r,dtype:i}=n,o=i||xc(r),a=cn(o,re(s));return Mwe(a,r,o),e.makeTensorInfo(s,o,a)}const Lwe={kernelName:lb,backendName:"cpu",kernelFunc:X$};function Mwe(t,e,n){t.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zwe={kernelName:ub,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,r=n,i=qn(s.dtype,re(s.shape)),[o,a,l,u]=s.shape,c=r.data.get(s.dataId).values;for(let d=0;d<o;d++){const f=d*l*a*u;for(let p=0;p<a;p++){const m=p*(l*u);for(let v=0;v<l;v++){const g=v*u;for(let w=0;w<u;w++){const b=Math.round(l-v-1),x=f+m+g+w;let S=c[x];if(b>=0&&b<l){const N=b*u,I=f+m+N+w;S=c[I]}i[x]=S}}}}return{dataId:r.write(i,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bwe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d,activation:f,leakyreluAlpha:p}=s;let m=rG({inputs:{x:r,filter:i},backend:n,attrs:{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d}});if(o){const v=m;if(c==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){const g=Vt({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});m=Zh({inputs:{a:m,b:g},backend:n}),n.disposeIntermediateTensorInfo(g)}else m=Zh({inputs:{a:m,b:o},backend:n});n.disposeIntermediateTensorInfo(v)}if(f){const v=m;if(c==="NCHW"&&f==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const g=Vt({inputs:{x:a},backend:n,attrs:{shape:[a.shape[0],1,1]}});m=Gw(n,m,f,g,p),n.disposeIntermediateTensorInfo(g)}else m=Gw(n,m,f,a,p);n.disposeIntermediateTensorInfo(v)}return m}const Vwe={kernelName:xm,backendName:"cpu",kernelFunc:Bwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uwe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d,activation:f,leakyreluAlpha:p}=s;let m=iG({inputs:{x:r,filter:i},backend:n,attrs:{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d}});if(o){const v=m;m=Zh({inputs:{a:m,b:o},backend:n}),n.disposeIntermediateTensorInfo(v)}if(f){const v=m;m=Gw(n,m,f,a,p),n.disposeIntermediateTensorInfo(v)}return m}const Wwe={kernelName:bm,backendName:"cpu",kernelFunc:Uwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jwe(t){const{inputs:e,backend:n}=t,{params:s,indices:r}=e,i=re(s.shape),o=r.shape,a=o[o.length-1],[l,u,c,h]=A1(s,r);if(u===0)return n.makeTensorInfo(l,s.dtype,[]);const d=n.data.get(r.dataId).values,f=n.bufferSync(s),p=pj(d,f,s.dtype,u,a,c,h,s.shape,i);return n.makeTensorInfo(l,s.dtype,p.values)}const Gwe={kernelName:cb,backendName:"cpu",kernelFunc:jwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hwe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,indices:i}=e,{axis:o,batchDims:a}=s;Ne([r,i],"gatherV2");const l=Ze(o,r.shape)[0],u=n.data.get(i.dataId).values,c=r.shape[l];for(let x=0;x<u.length;++x){const S=u[x];O(S<=c-1&&S>=0,()=>`GatherV2: the index value ${S} is not in [0, ${c-1}]`)}let h=a;a==null&&(h=0);const d=re(i.shape),f=ZN(r,i,l,h),p=Vt({inputs:{x:r},backend:n,attrs:{shape:[f.batchSize,f.outerSize,f.dimSize,f.sliceSize]}}),m=Vt({inputs:{x:i},backend:n,attrs:{shape:[f.batchSize,d/f.batchSize]}}),v=[f.batchSize,f.outerSize,d/f.batchSize,f.sliceSize],g=n.bufferSync(m),w=n.bufferSync(p),b=mj(w,g,v);return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.makeTensorInfo(f.outputShape,b.dtype,b.values)}const qwe={kernelName:Ig,backendName:"cpu",kernelFunc:Hwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kwe(t){const{inputs:e,backend:n}=t,{input:s}=e,r=re(s.shape),i=s.shape[s.shape.length-1],o=r/i,a=Vt({inputs:{x:s},backend:n,attrs:{shape:[o,i]}}),l=oG(a,!0,n),u=Vt({inputs:{x:l},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),u}const Xwe={kernelName:hb,backendName:"cpu",kernelFunc:Kwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ywe=Et(Pd,t=>Number.isFinite(t)?1:0,"bool"),Qwe={kernelName:Pd,backendName:"cpu",kernelFunc:Ywe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jwe=Et(Fd,t=>Math.abs(t)===1/0?1:0,"bool"),Zwe={kernelName:Fd,backendName:"cpu",kernelFunc:Jwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const exe=Et(Ld,t=>Number.isNaN(t)?1:0,"bool"),txe={kernelName:Ld,backendName:"cpu",kernelFunc:exe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nxe(t){const{backend:e,attrs:n}=t,{start:s,stop:r,num:i}=n,o=xj(s,r,i);return e.makeTensorInfo([o.length],"float32",o)}const sxe={kernelName:fb,backendName:"cpu",kernelFunc:nxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rxe=Et(zd,t=>Math.log1p(t)),ixe={kernelName:zd,backendName:"cpu",kernelFunc:rxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oxe=Cn((t,e)=>t&&e),axe=Mn(Ng,oxe,null,"bool"),lxe={kernelName:Ng,backendName:"cpu",kernelFunc:axe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uxe=Et($g,t=>t?0:1,"bool"),cxe={kernelName:$g,backendName:"cpu",kernelFunc:uxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hxe=Cn((t,e)=>t||e),dxe=Mn(Rg,hxe,null,"bool"),fxe={kernelName:Rg,backendName:"cpu",kernelFunc:dxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pxe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=s;Ne(r,"LRN");const u=r.shape[3],c=u-1,h=n.data.get(r.dataId).values,d=re(r.shape),f=new Float32Array(d);function p(m){const v=m%u;let g=m-v+Math.max(0,v-i);const w=m-v+Math.min(v+i,c);let b=0;for(;g<=w;g++){const x=h[g];b+=x*x}return b}for(let m=0;m<d;m++){const v=p(m),g=h[m]*Math.pow(o+a*v,-l);f[m]=g}return n.makeTensorInfo(r.shape,r.dtype,f)}const mxe={kernelName:Ag,backendName:"cpu",kernelFunc:pxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gxe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:u,beta:c}=s;Ne(o,"LRNGrad");const h=re(o.shape),d=o.shape[3],f=n.data.get(o.dataId).values,p=n.data.get(r.dataId).values,m=n.data.get(i.dataId).values,v=new Float32Array(h),g=h;for(let w=0;w<g;w++){const b=w%d,x=w-b+Math.max(0,b-a),S=w-b+Math.min(d,b+a+1);let N=0;for(let I=x;I<S;I++)N+=Math.pow(p[I],2);N=u*N+l;for(let I=x;I<S;I++){let C=-2*u*c*p[I]*m[w]/N;w===I&&(C+=Math.pow(N,-c)),C*=f[w],v[I]+=C}}return n.makeTensorInfo(o.shape,r.dtype,v)}const yxe={kernelName:pb,backendName:"cpu",kernelFunc:gxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aG(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reductionIndices:i,keepDims:o}=s,a=n;let l=r.shape;const u=l.length,c=Ze(i,l);let h=c;const d=on(h,u);let f=a.data.get(r.dataId).values;if(d!=null){const x=new Array(u);for(let S=0;S<x.length;S++)x[S]=l[d[S]];f=j$(f,l,r.dtype,d,x),h=bn(h.length,u),l=x}Ne(r,"max"),ds("max",h,u);const[p,m]=Qn(l,h),v=re(m),g=Sj(f,v,p,r.dtype),w=a.write(g,p,r.dtype);let b=p;return o&&(b=xn(p,c)),{dataId:w,shape:b,dtype:r.dtype}}const vxe={kernelName:Dg,backendName:"cpu",kernelFunc:aG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wxe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;Ne(r,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;O(hs(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const c=hi(r.shape,i,o,u,a,l);let h;if(c.filterWidth===1&&c.filterHeight===1&&st(c.inShape,c.outShape))h=_o({inputs:{x:r},backend:n});else{const d=n.data.get(r.dataId).values,f=Me(r.shape),p=q$(d,r.shape,r.dtype,f,c,"max");h=n.makeTensorInfo(c.outShape,r.dtype,p.values)}return h}const xxe={kernelName:Og,backendName:"cpu",kernelFunc:wxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bxe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=s;Ne(r,"maxPool3d");const c=ba(r.shape,i,o,1,a,l,u),h=n.data.get(r.dataId).values,d=sG(h,r.shape,r.dtype,Me(r.shape),c,"max");return n.makeTensorInfo(d.shape,"float32",d.values)}const Sxe={kernelName:Pg,backendName:"cpu",kernelFunc:bxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cxe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:u}=s;Ne([r,i],"maxPool3DGrad");const c=ba(i.shape,o,a,1,l,u),h=n.bufferSync(i),d=hve(h,c),f=c.strideDepth,p=c.strideHeight,m=c.strideWidth,v=c.dilationDepth,g=c.dilationHeight,w=c.dilationWidth,b=c.effectiveFilterDepth,x=c.effectiveFilterHeight,S=c.effectiveFilterWidth,N=b-1-c.padInfo.front,I=S-1-c.padInfo.left,C=x-1-c.padInfo.top,_=Xe(i.shape,"float32"),k=n.bufferSync(r);for(let A=0;A<c.batchSize;++A)for(let D=0;D<c.inChannels;++D)for(let R=0;R<c.inDepth;++R)for(let W=0;W<c.inHeight;++W)for(let B=0;B<c.inWidth;++B){const M=R-N,X=W-C,z=B-I;let Y=0;for(let L=0;L<b;L+=v){const le=(M+L)/f;if(!(le<0||le>=c.outDepth||Math.floor(le)!==le))for(let Q=0;Q<x;Q+=g){const se=(X+Q)/p;if(!(se<0||se>=c.outHeight||Math.floor(se)!==se))for(let de=0;de<S;de+=w){const ue=(z+de)/m;if(ue<0||ue>=c.outWidth||Math.floor(ue)!==ue)continue;const fe=b*x*S-1-d.get(A,le,se,ue,D),ve=L*x*S+Q*S+de,De=fe===ve?1:0;if(De===0)continue;const Ie=k.get(A,le,se,ue,D);Y+=Ie*De}}}_.set(Y,A,R,W,B,D)}return n.makeTensorInfo(_.shape,_.dtype,_.values)}const Ixe={kernelName:gb,backendName:"cpu",kernelFunc:Cxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _xe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i,output:o}=e,a=i;Ne([i,o],"maxPoolGrad");const{filterSize:l,strides:u,pad:c,dimRoundingMode:h}=s,d=hi(a.shape,l,u,1,c,h),f=n.data.get(a.dataId).values,p=Xe(d.outShape,a.dtype,nG(f,a.shape,a.dtype,d).values),m=d.strideHeight,v=d.strideWidth,g=d.dilationHeight,w=d.dilationWidth,b=d.effectiveFilterHeight,x=d.effectiveFilterWidth,S=x-1-d.padInfo.left,N=b-1-d.padInfo.top,I=Xe(a.shape,"float32"),C=n.data.get(r.dataId).values,_=Xe(r.shape,"float32",C);for(let k=0;k<d.batchSize;++k)for(let A=0;A<d.inChannels;++A)for(let D=0;D<d.inHeight;++D)for(let R=0;R<d.inWidth;++R){const W=D-N,B=R-S;let M=0;for(let X=0;X<b;X+=g){const z=(W+X)/m;if(!(z<0||z>=d.outHeight||Math.floor(z)!==z))for(let Y=0;Y<x;Y+=w){const L=(B+Y)/v;if(L<0||L>=d.outWidth||Math.floor(L)!==L)continue;const le=b*x-1-p.get(k,z,L,A),Q=X*x+Y,se=le===Q?1:0;if(se===0)continue;const de=_.get(k,z,L,A);M+=de*se}}I.set(M,k,D,R,A)}return n.makeTensorInfo(I.shape,I.dtype,I.values)}const Txe={kernelName:mb,backendName:"cpu",kernelFunc:_xe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kxe(t,e,n,s,r){const i=Me(e),o=q$(t,e,n,i,r,"max"),a=nG(t,e,n,r,!0,s);return[o.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Exe={kernelName:yb,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{filterSize:r,strides:i,pad:o,includeBatchInIndex:a}=e,l=n;Ne(s,"MaxPoolWithArgmax");const u=l.data.get(s.dataId).values,c=hi(s.shape,r,i,[1,1],o),[h,d]=kxe(u,s.shape,s.dtype,a,c),f=l.write(h,c.outShape,s.dtype),p=l.write(d,c.outShape,s.dtype);return[{dataId:f,shape:c.outShape,dtype:s.dtype},{dataId:p,shape:c.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nxe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s,a=Ze(i,r.shape),u=Qn(r.shape,a)[1],c=re(u),h=[],d=n.makeTensorInfo([],"float32",new Float32Array([c]));h.push(d);const f=Ll({inputs:{x:r},backend:n,attrs:{dtype:"float32"}});h.push(f);const p=K$({inputs:{a:f,b:d},backend:n});h.push(p);const m=By({inputs:{x:p},backend:n,attrs:{axis:i,keepDims:o}});return h.forEach(v=>n.disposeIntermediateTensorInfo(v)),m}const $xe={kernelName:Fg,backendName:"cpu",kernelFunc:Nxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rxe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;Ne(r,"min");const a=Ze(i,r.shape);let l=a;const u=on(l,r.shape.length);let c=r;u!=null&&(c=er({inputs:{x:r},backend:n,attrs:{perm:u}}),l=bn(l.length,r.shape.length)),ds("min",l,c.shape.length);const[h,d]=Qn(c.shape,l),f=re(d),p=us(re(h),c.dtype),m=n.data.get(c.dataId).values;for(let g=0;g<p.length;++g){const w=g*f;let b=m[w];for(let x=0;x<f;++x){const S=m[w+x];(Number.isNaN(S)||S<b)&&(b=S)}p[g]=b}u!=null&&n.disposeIntermediateTensorInfo(c);const v=n.makeTensorInfo(h,c.dtype,p);if(o){const g=xn(h,a),w=Vt({inputs:{x:v},backend:n,attrs:{shape:g}});return n.disposeIntermediateTensorInfo(v),w}return v}const Axe={kernelName:Lg,backendName:"cpu",kernelFunc:Rxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dxe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{paddings:i,mode:o}=s;Ne(r,"mirrorPad");const a=i.map((b,x)=>b[0]+r.shape[x]+b[1]),l=i.map(b=>b[0]),u=i.map((b,x)=>b[0]+r.shape[x]),c=o==="reflect"?0:1,h=n.data.get(r.dataId).values,d=r.shape.length,f=Me(r.shape),p=re(a),m=a.length,v=Me(a),g=qn(r.dtype,p);for(let b=0;b<p;b++){let x=bc(b,m,v);for(let N=0;N<m;N++)x[N]<l[N]?x[N]=l[N]*2-x[N]-c:x[N]>=u[N]&&(x[N]=(u[N]-1)*2-x[N]+c);x=x.map((N,I)=>N-l[I]);const S=Pi(x,d,f);g[b]=h[S]}return{dataId:n.write(g,a,r.dtype),shape:a,dtype:r.dtype}}const Oxe={kernelName:Mg,backendName:"cpu",kernelFunc:Dxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pxe=Cn((t,e)=>{const n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e}),Fxe=Mn(Ud,Pxe),Lxe={kernelName:Ud,backendName:"cpu",kernelFunc:Fxe};var Y$={exports:{}};Y$.exports;(function(t){(function(e,n,s){function r(l){var u=this,c=a();u.next=function(){var h=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=h-(u.c=h|0)},u.c=1,u.s0=c(" "),u.s1=c(" "),u.s2=c(" "),u.s0-=c(l),u.s0<0&&(u.s0+=1),u.s1-=c(l),u.s1<0&&(u.s1+=1),u.s2-=c(l),u.s2<0&&(u.s2+=1),c=null}function i(l,u){return u.c=l.c,u.s0=l.s0,u.s1=l.s1,u.s2=l.s2,u}function o(l,u){var c=new r(l),h=u&&u.state,d=c.next;return d.int32=function(){return c.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,h&&(typeof h=="object"&&i(h,c),d.state=function(){return i(c,{})}),d}function a(){var l=4022871197,u=function(c){c=String(c);for(var h=0;h<c.length;h++){l+=c.charCodeAt(h);var d=.02519603282416938*l;l=d>>>0,d-=l,d*=l,l=d>>>0,d-=l,l+=d*4294967296}return(l>>>0)*23283064365386963e-26};return u}n&&n.exports?n.exports=o:this.alea=o})(qe,t)})(Y$);var Mxe=Y$.exports,Q$={exports:{}};Q$.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var h=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^h^h>>>8},a===(a|0)?l.x=a:u+=a;for(var c=0;c<u.length+64;c++)l.x^=u.charCodeAt(c)|0,l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function o(a,l){var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:this.xor128=o})(qe,t)})(Q$);var zxe=Q$.exports,J$={exports:{}};J$.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.next=function(){var h=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(h^h<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:u+=a;for(var c=0;c<u.length+64;c++)l.x^=u.charCodeAt(c)|0,c==u.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function o(a,l){var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:this.xorwow=o})(qe,t)})(J$);var Bxe=J$.exports,Z$={exports:{}};Z$.exports;(function(t){(function(e,n,s){function r(a){var l=this;l.next=function(){var c=l.x,h=l.i,d,f;return d=c[h],d^=d>>>7,f=d^d<<24,d=c[h+1&7],f^=d^d>>>10,d=c[h+3&7],f^=d^d>>>3,d=c[h+4&7],f^=d^d<<7,d=c[h+7&7],d=d^d<<13,f^=d^d<<9,c[h]=f,l.i=h+1&7,f};function u(c,h){var d,f=[];if(h===(h|0))f[0]=h;else for(h=""+h,d=0;d<h.length;++d)f[d&7]=f[d&7]<<15^h.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?f[7]=-1:f[d],c.x=f,c.i=0,d=256;d>0;--d)c.next()}u(l,a)}function i(a,l){return l.x=a.x.slice(),l.i=a.i,l}function o(a,l){a==null&&(a=+new Date);var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(c.x&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:this.xorshift7=o})(qe,t)})(Z$);var Vxe=Z$.exports,eR={exports:{}};eR.exports;(function(t){(function(e,n,s){function r(a){var l=this;l.next=function(){var c=l.w,h=l.X,d=l.i,f,p;return l.w=c=c+1640531527|0,p=h[d+34&127],f=h[d=d+1&127],p^=p<<13,f^=f<<17,p^=p>>>15,f^=f>>>12,p=h[d]=p^f,l.i=d,p+(c^c>>>16)|0};function u(c,h){var d,f,p,m,v,g=[],w=128;for(h===(h|0)?(f=h,h=null):(h=h+"\0",f=0,w=Math.max(w,h.length)),p=0,m=-32;m<w;++m)h&&(f^=h.charCodeAt((m+32)%h.length)),m===0&&(v=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,m>=0&&(v=v+1640531527|0,d=g[m&127]^=f+v,p=d==0?p+1:0);for(p>=128&&(g[(h&&h.length||0)&127]=-1),p=127,m=4*128;m>0;--m)f=g[p+34&127],d=g[p=p+1&127],f^=f<<13,d^=d<<17,f^=f>>>15,d^=d>>>12,g[p]=f^d;c.w=v,c.X=g,c.i=p}u(l,a)}function i(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function o(a,l){a==null&&(a=+new Date);var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(c.X&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:this.xor4096=o})(qe,t)})(eR);var Uxe=eR.exports,tR={exports:{}};tR.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.next=function(){var h=l.b,d=l.c,f=l.d,p=l.a;return h=h<<25^h>>>7^d,d=d-f|0,f=f<<24^f>>>8^p,p=p-h|0,l.b=h=h<<20^h>>>12^d,l.c=d=d-f|0,l.d=f<<16^d>>>16^p,l.a=p-h|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):u+=a;for(var c=0;c<u.length+20;c++)l.b^=u.charCodeAt(c)|0,l.next()}function i(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function o(a,l){var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:this.tychei=o})(qe,t)})(tR);var Wxe=tR.exports,lG={exports:{}};(function(t){(function(e,n,s){var r=256,i=6,o=52,a="random",l=s.pow(r,i),u=s.pow(2,o),c=u*2,h=r-1,d;function f(x,S,N){var I=[];S=S==!0?{entropy:!0}:S||{};var C=g(v(S.entropy?[x,b(n)]:x??w(),3),I),_=new p(I),k=function(){for(var A=_.g(i),D=l,R=0;A<u;)A=(A+R)*r,D*=r,R=_.g(1);for(;A>=c;)A/=2,D/=2,R>>>=1;return(A+R)/D};return k.int32=function(){return _.g(4)|0},k.quick=function(){return _.g(4)/4294967296},k.double=k,g(b(_.S),n),(S.pass||N||function(A,D,R,W){return W&&(W.S&&m(W,_),A.state=function(){return m(_,{})}),R?(s[a]=A,D):A})(k,C,"global"in S?S.global:this==s,S.state)}function p(x){var S,N=x.length,I=this,C=0,_=I.i=I.j=0,k=I.S=[];for(N||(x=[N++]);C<r;)k[C]=C++;for(C=0;C<r;C++)k[C]=k[_=h&_+x[C%N]+(S=k[C])],k[_]=S;(I.g=function(A){for(var D,R=0,W=I.i,B=I.j,M=I.S;A--;)D=M[W=h&W+1],R=R*r+M[h&(M[W]=M[B=h&B+D])+(M[B]=D)];return I.i=W,I.j=B,R})(r)}function m(x,S){return S.i=x.i,S.j=x.j,S.S=x.S.slice(),S}function v(x,S){var N=[],I=typeof x,C;if(S&&I=="object")for(C in x)try{N.push(v(x[C],S-1))}catch{}return N.length?N:I=="string"?x:x+"\0"}function g(x,S){for(var N=x+"",I,C=0;C<N.length;)S[h&C]=h&(I^=S[h&C]*19)+N.charCodeAt(C++);return b(S)}function w(){try{var x;return d&&(x=d.randomBytes)?x=x(r):(x=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(x)),b(x)}catch{var S=e.navigator,N=S&&S.plugins;return[+new Date,e,N,e.screen,b(n)]}}function b(x){return String.fromCharCode.apply(0,x)}if(g(s.random(),n),t.exports){t.exports=f;try{d=a1}catch{}}else s["seed"+a]=f})(typeof self<"u"?self:qe,[],Math)})(lG);var jxe=lG.exports,Gxe=Mxe,Hxe=zxe,qxe=Bxe,Kxe=Vxe,Xxe=Uxe,Yxe=Wxe,Dc=jxe;Dc.alea=Gxe;Dc.xor128=Hxe;Dc.xorwow=qxe;Dc.xorshift7=Kxe;Dc.xor4096=Xxe;Dc.tychei=Yxe;var Qxe=Dc;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uG(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{dim:i}=s,o=r.shape.length;let a=i;if(a===-1&&(a=o-1),a!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${a}`);const l=Ze([a],r.shape),u=aG({inputs:{x:r},backend:n,attrs:{reductionIndices:l,keepDims:!1}}),c=xn(u.shape,l),h=Vt({inputs:{x:u},backend:n,attrs:{shape:c}}),d=H$({inputs:{a:r,b:h},backend:n}),f=cj({inputs:{x:d},backend:n}),p=By({inputs:{x:f},backend:n,attrs:{axis:l,keepDims:!1}}),m=Vt({inputs:{x:p},backend:n,attrs:{shape:c}}),v=K$({inputs:{a:f,b:m},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),v}const Jxe={kernelName:ny,backendName:"cpu",kernelFunc:uG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zxe(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{numSamples:i,seed:o,normalized:a}=s;Ne(r,"multinomial");const l=a?r:uG({inputs:{logits:r},backend:n,attrs:{dim:-1}}),u=l.shape[0],c=l.shape[1],h=n.data.get(l.dataId).values,d=[u,i],f=us(re(d),"int32");for(let p=0;p<u;++p){const m=p*c,v=new Float32Array(c-1);v[0]=h[m];for(let b=1;b<v.length;++b)v[b]=v[b-1]+h[m+b];const g=Qxe.alea(o.toString()),w=p*i;for(let b=0;b<i;++b){const x=g();f[w+b]=v.length;for(let S=0;S<v.length;S++)if(x<v[S]){f[w+b]=S;break}}}return a||n.disposeIntermediateTensorInfo(l),n.makeTensorInfo(d,"int32",f)}const ebe={kernelName:vb,backendName:"cpu",kernelFunc:Zxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tbe=E1;function nbe(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=s;Ne(r,"NonMaxSuppression");const u=n.data.get(r.dataId).values,c=n.data.get(i.dataId).values,{selectedIndices:h}=tbe(u,c,o,a,l);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}const sbe={kernelName:wb,backendName:"cpu",kernelFunc:nbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rbe=N1;function ibe(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=s;Ne(r,"NonMaxSuppressionPadded");const c=n.data.get(r.dataId).values,h=n.data.get(i.dataId).values,{selectedIndices:d,validOutputs:f}=rbe(c,h,o,a,l,u);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}const obe={kernelName:xb,backendName:"cpu",kernelFunc:ibe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const abe=$1;function lbe(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s;Ne(r,"NonMaxSuppressionWithScore");const c=n.data.get(r.dataId).values,h=n.data.get(i.dataId).values,d=o,f=a,p=l,m=u,{selectedIndices:v,selectedScores:g}=abe(c,h,d,f,p,m);return[n.makeTensorInfo([v.length],"int32",new Int32Array(v)),n.makeTensorInfo([g.length],"float32",new Float32Array(g))]}const ube={kernelName:bb,backendName:"cpu",kernelFunc:lbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cbe(t){const{inputs:e,backend:n,attrs:s}=t,{indices:r}=e,{dtype:i,depth:o,onValue:a,offValue:l}=s;Ne(r,"oneHot");const u=re(r.shape),c=new Float32Array(u*o);c.fill(l);const h=n.data.get(r.dataId).values;for(let d=0;d<u;++d)h[d]>=0&&h[d]<o&&(c[d*o+h[d]]=a);return n.makeTensorInfo([...r.shape,o],i,c)}const hbe={kernelName:Ug,backendName:"cpu",kernelFunc:cbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qw(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const r=oc({inputs:{input:s},backend:n}),i=qw({inputs:{x:r},backend:n}),o=ed({inputs:{input:s},backend:n}),a=qw({inputs:{x:o},backend:n}),l=ur({inputs:{real:i,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return X$({backend:n,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const dbe={kernelName:oy,backendName:"cpu",kernelFunc:qw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cG(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const r=oc({inputs:{input:s},backend:n}),i=cG({inputs:{x:r},backend:n}),o=ed({inputs:{input:s},backend:n}),a=qw({inputs:{x:o},backend:n}),l=ur({inputs:{real:i,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return X$({backend:n,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const fbe={kernelName:Vg,backendName:"cpu",kernelFunc:cG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hG(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s;if(e.length===1)return Hw({inputs:{input:e[0]},backend:n,attrs:{dim:r}});const i=e[0].shape,o=e[0].dtype;e.forEach(c=>{cs(i,c.shape,"All tensors passed to stack must have matching shapes"),O(o===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(c=>{const h=Hw({inputs:{input:c},backend:n,attrs:{dim:r}});return a.push(h),h}),u=td({inputs:l,backend:n,attrs:{axis:r}});return a.forEach(c=>n.disposeIntermediateTensorInfo(c)),u}const pbe={kernelName:Wg,backendName:"cpu",kernelFunc:hG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mbe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{paddings:i,constantValue:o}=s;Ne(r,"pad");const a=i.map((w,b)=>w[0]+r.shape[b]+w[1]),l=i.map(w=>w[0]),u=n.data.get(r.dataId).values,c=re(r.shape),h=r.shape.length,d=Me(r.shape),f=re(a),p=a.length,m=Me(a),v=qn(r.dtype,f);o!==0&&v.fill(o);for(let w=0;w<c;w++){const x=bc(w,h,d).map((N,I)=>N+l[I]),S=Pi(x,p,m);v[S]=u[w]}return{dataId:n.write(v,a,r.dtype),shape:a,dtype:r.dtype}}const dG={kernelName:jg,backendName:"cpu",kernelFunc:mbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gbe=Cn((t,e)=>Math.pow(t,e)),ybe=Mn(jd,gbe),vbe={kernelName:jd,backendName:"cpu",kernelFunc:ybe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wbe(t){const{inputs:e,backend:n,attrs:s}=t,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=e,a=r.map(v=>n.data.get(v.dataId).values),l=r.map(v=>v.shape),u=n.data.get(i.dataId).values,c=n.data.get(o.dataId).values,[h,d,f]=Ej(a,l,u,i.shape,i.dtype,c,o.shape),p=h.map(v=>n.makeTensorInfo([v.length],"int32",v)),m=n.makeTensorInfo(f,i.dtype,d);return p.concat([m])}const xbe={kernelName:Sb,backendName:"cpu",kernelFunc:wbe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bbe(t){const{inputs:e,backend:n}=t,{starts:s,limits:r,deltas:i}=e,o=n.data.get(s.dataId).values,a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,[u,c]=Nj(o,s.shape,s.dtype,a,r.shape,l,i.shape),h=n.makeTensorInfo([u.length],"int32",u),d=n.makeTensorInfo([c.length],s.dtype,c);return[h,d]}const Sbe={kernelName:Cb,backendName:"cpu",kernelFunc:bbe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cbe(t){const{inputs:e,backend:n,attrs:s}=t,{shape:r,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,u=n.data.get(r.dataId).values,c=n.data.get(i.dataId).values,h=n.data.get(o.dataId).values,d=a.map(v=>n.data.get(v.dataId).values),f=a.map(v=>v.shape),[p,m]=$j(u,r.shape,c,i.shape,i.dtype,h,o.shape,d,f,l);return n.makeTensorInfo(p,i.dtype,m)}const Ibe={kernelName:Ib,backendName:"cpu",kernelFunc:Cbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _be(t){const{backend:e,attrs:n}=t,{start:s,stop:r,dtype:i,step:o}=n,a=Rj(s,r,o,i);return e.makeTensorInfo([a.length],i,a)}const Tbe={kernelName:_b,backendName:"cpu",kernelFunc:_be};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kbe=Et(Gd,t=>1/t),Ebe={kernelName:Gd,backendName:"cpu",kernelFunc:kbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nbe(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s;Ne(r,"resizeBilinear");const l=Me(r.shape),[u,c]=a,[h,d,f,p]=r.shape,m=n.data.get(r.dataId).values,v=new Float32Array(re([h,u,c,p])),g=[i&&u>1?d-1:d,i&&c>1?f-1:f],w=[i&&u>1?u-1:u,i&&c>1?c-1:c];let b=0;const x=g[0]/w[0],S=g[1]/w[1];for(let N=0;N<h;N++)for(let I=0;I<u;I++){let C;o?C=x*(I+.5)-.5:C=x*I;const _=Math.max(0,Math.floor(C)),k=C-_,A=Math.min(d-1,Math.ceil(C)),D=N*l[0]+_*l[1],R=N*l[0]+A*l[1];for(let W=0;W<c;W++){let B;o?B=S*(W+.5)-.5:B=S*W;const M=Math.max(0,Math.floor(B)),X=B-M,z=Math.min(f-1,Math.ceil(B)),Y=D+M*l[2],L=R+M*l[2],le=D+z*l[2],Q=R+z*l[2];for(let se=0;se<p;se++){const de=m[Y+se],ue=m[L+se],fe=m[le+se],ve=m[Q+se],De=de+(fe-de)*X,Ie=ue+(ve-ue)*X,Oe=De+(Ie-De)*k;v[b++]=Oe}}}return n.makeTensorInfo([h,u,c,p],"float32",v)}const $be={kernelName:Xg,backendName:"cpu",kernelFunc:Nbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rbe(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:i}=e,{alignCorners:o}=s;Ne([i,r],"resizeBilinearGrad");const a=Me(r.shape),[l,u,c,h]=r.shape,[,d,f]=i.shape,p=new Float32Array(l*u*c*h),m=[o&&d>1?u-1:u,o&&f>1?c-1:c],v=[o&&d>1?d-1:d,o&&f>1?f-1:f],g=m[0]/v[0],w=m[1]/v[1],b=n.data.get(i.dataId).values;let x=0;for(let S=0;S<l;S++){const N=S*a[0];for(let I=0;I<d;I++){const C=I*g,_=Math.floor(C),k=Math.min(Math.ceil(C),u-1),A=N+_*a[1],D=N+k*a[1],R=C-_,W=1-R;for(let B=0;B<f;B++){const M=B*w,X=Math.floor(M),z=Math.min(Math.ceil(M),c-1),Y=M-X,L=1-Y,le=A+X*a[2],Q=A+z*a[2],se=D+X*a[2],de=D+z*a[2],ue=W*L,fe=W*Y,ve=R*L,De=R*Y;for(let Ie=0;Ie<h;Ie++){const Oe=b[x++];p[le+Ie]+=Oe*ue,p[Q+Ie]+=Oe*fe,p[se+Ie]+=Oe*ve,p[de+Ie]+=Oe*De}}}}return n.makeTensorInfo([l,c,u,h],"float32",p)}const Abe={kernelName:Eb,backendName:"cpu",kernelFunc:Rbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dbe(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s;Ne(r,"resizeNearestNeighbor");const l=Me(r.shape),[u,c]=a,[h,d,f,p]=r.shape,m=n.data.get(r.dataId).values,v=new Float32Array(h*u*c*p),g=[i&&u>1?d-1:d,i&&c>1?f-1:f],w=[i&&u>1?u-1:u,i&&c>1?c-1:c],b=g[0]/w[0],x=g[1]/w[1];let S=0;for(let N=0;N<h;N++){const I=N*l[0];for(let C=0;C<u;C++){const _=o?b*(C+.5):b*C;let k=Math.min(d-1,i?Math.round(_):Math.floor(_));o&&(k=Math.max(0,k));const A=I+k*l[1];for(let D=0;D<c;D++){const R=o?x*(D+.5):x*D;let W=Math.min(f-1,i?Math.round(R):Math.floor(R));o&&(W=Math.max(0,W));const B=A+W*l[2];for(let M=0;M<p;M++){const X=m[B+M];v[S++]=X}}}}return n.makeTensorInfo([h,u,c,p],r.dtype,v)}const Obe={kernelName:Kg,backendName:"cpu",kernelFunc:Dbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pbe(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:i}=e,{alignCorners:o}=s;Ne([i,r],"resizeNearestNeighborGrad");const a=Me(r.shape),l=Me(i.shape),[u,c,h,d]=r.shape,[,f,p]=i.shape,m=new Float32Array(u*c*h*d),v=n.data.get(i.dataId).values,g=[o&&f>1?c-1:c,o&&p>1?h-1:h],w=[o&&f>1?f-1:f,o&&p>1?p-1:p],b=g[0]/w[0],x=g[1]/w[1],S=1/b,N=1/x,I=Math.ceil(S)*2+2,C=Math.ceil(N)*2+2;for(let _=0;_<u;_++){const k=_*a[0];for(let A=0;A<c;A++){const D=k+A*a[1],R=Math.floor(A*S),W=Math.floor(R-I/2);for(let B=0;B<h;B++){const M=D+B*a[2],X=Math.floor(B*N),z=Math.floor(X-C/2);for(let Y=0;Y<d;Y++){let L=0;for(let le=0;le<I;le++){const Q=le+W;if(Q<0||Q>=f)continue;const se=k+Q*l[1],de=Q*b,ue=Math.min(c-1,o?Math.round(de):Math.floor(de));if(A===ue)for(let fe=0;fe<C;fe++){const ve=fe+z;if(ve<0||ve>=p)continue;const De=se+ve*l[2],Ie=ve*x,Oe=Math.min(h-1,o?Math.round(Ie):Math.floor(Ie));B===Oe&&(L+=v[De+Y])}}m[M+Y]=L}}}}return n.makeTensorInfo(r.shape,r.dtype,m)}const Fbe={kernelName:kb,backendName:"cpu",kernelFunc:Pbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lbe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dims:i}=s;Ne(r,"reverse");const o=r.shape.length,a=Ze(i,r.shape);if(o===0)return _o({inputs:{x:r},backend:n});const l=new $n(r.shape,r.dtype),u=n.bufferSync(r);for(let c=0;c<l.size;c++){const h=l.indexToLoc(c),d=h.slice();a.forEach(f=>d[f]=r.shape[f]-1-d[f]),l.set(u.get(...d),...h)}return n.makeTensorInfo(l.shape,l.dtype,l.values)}const Mbe={kernelName:Yg,backendName:"cpu",kernelFunc:Lbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zbe={kernelName:Gb,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,{radians:r,fillValue:i,center:o}=e,a=n,l=qn(s.dtype,re(s.shape)),[u,c,h,d]=s.shape,[f,p]=LN(o,c,h),m=255,v=Math.sin(r),g=Math.cos(r),w=a.data.get(s.dataId).values;for(let x=0;x<u;x++){const S=x*h*c*d;for(let N=0;N<c;N++){const I=N*(h*d);for(let C=0;C<h;C++){const _=C*d;for(let k=0;k<d;k++){const A=[u,N,C,k],D=A[2],R=A[1];let W=(D-f)*g-(R-p)*v,B=(D-f)*v+(R-p)*g;W=Math.round(W+f),B=Math.round(B+p);let M=i;if(typeof i!="number"&&(k===3?M=m:M=i[k]),W>=0&&W<h&&B>=0&&B<c){const z=B*(h*d),Y=W*d,L=S+z+Y+k;M=w[L]}const X=S+I+_+k;l[X]=M}}}}return{dataId:a.write(l,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bbe=Et(Kd,t=>{const e=Math.floor(t);return t-e<.5?Math.floor(t):t-e>.5?Math.ceil(t):e%2===0?e:e+1}),Vbe={kernelName:Kd,backendName:"cpu",kernelFunc:Bbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ube(t){const{inputs:e,backend:n,attrs:s}=t,{indices:r,updates:i}=e,{shape:o}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:c,outputSize:h}=Jl(i,r,o),d=!0,f=n.bufferSync(r),p=n.bufferSync(i),m=ku(f,p,o,h,u,l,a,c,0,d);return n.makeTensorInfo(o,m.dtype,m.values)}const Wbe={kernelName:Nb,backendName:"cpu",kernelFunc:Ube};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jbe(t,e){let n=0,s=t.length,r=0;for(;n<s;)r=Math.floor((n+s)/2),t[r]<e?n=r+1:s=r;return s}function Gbe(t,e){let n=0,s=t.length,r=0;for(;n<s;)r=Math.floor((n+s)/2),t[r]<=e?n=r+1:s=r;return s}function Hbe(t,e,n,s,r,i){const o=cn("int32",n*r);for(let a=0;a<n;++a){const l=t.slice(a*s,(a+1)*s),u=a*r;for(let c=0;c<r;++c)o[u+c]=i==="left"?jbe(l,e[c+u]):Gbe(l,e[c+u])}return o}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qbe(t){const{inputs:e,backend:n,attrs:s}=t,{sortedSequence:r,values:i}=e,{side:o}=s,a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,u=Hbe(a,l,r.shape[0],r.shape[1],i.shape[1],o);return n.makeTensorInfo(i.shape,"int32",u)}const Kbe={kernelName:Rb,backendName:"cpu",kernelFunc:qbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xbe(t){const{inputs:e,backend:n}=t,{condition:s,t:r,e:i}=e;Ne([s,r,i],"select");const o=s.shape.length,a=n.data.get(s.dataId).values,l=n.data.get(r.dataId).values,u=n.data.get(i.dataId).values,c=Xs(r.dtype,i.dtype),h=us(re(r.shape),c);let d=0;const f=o===0||o>1||r.shape.length===1?1:re(r.shape.slice(1));for(let p=0;p<a.length;p++)for(let m=0;m<f;m++)a[p]===1?h[d++]=l[p]:h[d++]=u[p];return n.makeTensorInfo(r.shape,c,h)}const Ybe={kernelName:Qg,backendName:"cpu",kernelFunc:Xbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qbe=P1,Jbe=F1,Zbe=Et(Yd,t=>t>=0?Jbe*t:Qbe*(Math.exp(t)-1)),e1e={kernelName:Yd,backendName:"cpu",kernelFunc:Zbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t1e=Et(Zd,t=>t<0?-1:t>0?1:0),n1e={kernelName:Zd,backendName:"cpu",kernelFunc:t1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s1e=Et(Qd,t=>Math.sin(t)),r1e={kernelName:Qd,backendName:"cpu",kernelFunc:s1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i1e=Et(Jd,t=>Math.sinh(t)),o1e={kernelName:Jd,backendName:"cpu",kernelFunc:i1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a1e=11920928955078125e-23,aF=Math.log(a1e)+2,l1e=Et(tf,t=>{const e=t>-aF,n=t<aF,s=Math.exp(t);let r;return n?r=s:e?r=t:r=Math.log(1+s),r}),u1e={kernelName:tf,backendName:"cpu",kernelFunc:l1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:i,paddings:o}=s;Ne([r],"spaceToBatchND");const a=re(i),l=[[0,0]];l.push(...o);for(let N=1+i.length;N<r.shape.length;++N)l.push([0,0]);const u=dG.kernelFunc({inputs:{x:r},backend:n,attrs:{paddings:l,constantValue:0}}),c=ky(u.shape,i,a,!1),h=Ey(c.length,i.length,!1),d=Ny(u.shape,i,a,!1),m=Vt({inputs:{x:u},backend:n,attrs:{shape:c}}),w=er({inputs:{x:m},backend:n,attrs:{perm:h}}),S=Vt({inputs:{x:w},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(w),S}const h1e={kernelName:ey,backendName:"cpu",kernelFunc:c1e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d1e(t){const{inputs:e,backend:n}=t,{indices:s,values:r,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=n.data.get(s.dataId).values,l=n.data.get(r.dataId).values,u=n.data.get(i.dataId).values,c=n.data.get(o.dataId).values[0],[h,d,f,p,m]=Pj(a,s.shape,s.dtype,l,r.dtype,u,c);return[n.makeTensorInfo(d,s.dtype,h),n.makeTensorInfo([d[0]],r.dtype,f),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(v=>Number(v)))),n.makeTensorInfo([m.length],s.dtype,new Int32Array(m))]}const f1e={kernelName:Ab,backendName:"cpu",kernelFunc:d1e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p1e(t){const{inputs:e,backend:n}=t,{inputIndices:s,inputShape:r,newShape:i}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(n.data.get(r.dataId).values),a=n.data.get(s.dataId).values,l=Array.from(n.data.get(i.dataId).values),[u,c,h]=Fj(a,s.shape,s.dtype,o,l);return[n.makeTensorInfo(c,s.dtype,u),n.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}const m1e={kernelName:Db,backendName:"cpu",kernelFunc:p1e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g1e(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(s.dataId).values,a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,[u,c]=G$(o,s.shape,s.dtype,a,l,!0);return n.makeTensorInfo(c,s.dtype,u)}const y1e={kernelName:Ob,backendName:"cpu",kernelFunc:g1e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v1e(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(s.dataId).values,a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,[u,c]=G$(o,s.shape,s.dtype,a,l);return n.makeTensorInfo(c,s.dtype,u)}const w1e={kernelName:Pb,backendName:"cpu",kernelFunc:v1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x1e(t){const{inputs:e,backend:n,attrs:s}=t,{sparseIndices:r,sparseValues:i,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:c,strides:h,outputSize:d}=Jl(i,r,a),f=!1,p=n.bufferSync(r);let m;switch(i.dtype){case"bool":{const v=n.bufferSync(i),g=!!n.data.get(o.dataId).values[0];m=ku(p,v,a,d,c,u,l,h,g,f);break}case"float32":{const v=n.bufferSync(i),g=n.data.get(o.dataId).values[0];m=ku(p,v,a,d,c,u,l,h,g,f);break}case"int32":{const v=n.bufferSync(i),g=n.data.get(o.dataId).values[0];m=ku(p,v,a,d,c,u,l,h,g,f);break}case"string":{const v=n.bufferSync(i),g=ca(n.data.get(o.dataId).values[0]);m=ku(p,v,a,d,c,u,l,h,g,f);break}default:throw new Error(`Unsupported type ${i.dtype}`)}return n.makeTensorInfo(a,m.dtype,m.values)}const b1e={kernelName:Fb,backendName:"cpu",kernelFunc:x1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{numOrSizeSplits:i,axis:o}=s,a=Ze(o,r.shape)[0],l=JN(r,i,a),u=new Array(r.shape.length).fill(0),c=r.shape.slice();return l.map(h=>{const d=[...c];d[a]=h;const f=ac({inputs:{x:r},backend:n,attrs:{begin:u,size:d}});return u[a]+=h,f})}const C1e={kernelName:ty,backendName:"cpu",kernelFunc:S1e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I1e={kernelName:Lb,backendName:"cpu",kernelFunc:({inputs:t,backend:e})=>{const{x:n}=t,s=e;Ne(n,"square");const r=s.data.get(n.dataId).values,i=new Float32Array(r.length);for(let a=0;a<r.length;++a){const l=r[a];i[a]=l*l}return{dataId:s.write(i,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _1e=Et(uf,(t,e)=>{const n=e;return isNaN(t)?NaN:t>0?1:n.alpha}),T1e={kernelName:uf,backendName:"cpu",kernelFunc:_1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:u,ellipsisMask:c,newAxisMask:h,shrinkAxisMask:d}=s;Ne(r,"stridedSlice");const{finalShapeSparse:f,finalShape:p,isIdentity:m,sliceDim0:v,isSimpleSlice:g,begin:w,end:b,strides:x}=DN(r.shape,i,o,a,l,u,c,h,d);let S;if(m)S=Vt({inputs:{x:r},backend:n,attrs:{shape:p}});else if(v||g){O(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const N=$N(w,b,x),I=ac({inputs:{x:r},backend:n,attrs:{begin:w,size:N}});S=Vt({inputs:{x:I},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(I)}else{const N=n.bufferSync(r),I=zj(f,N,x,w);S=n.makeTensorInfo(p,I.dtype,I.values)}return S}const E1e={kernelName:Mb,backendName:"cpu",kernelFunc:k1e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N1e(t){const{inputs:e,backend:n,attrs:s}=t,{separator:r,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:c,dataSplits:h}=e,d=n.data.get(c.dataId).values,f=n.data.get(h.dataId).values,[p,m]=Bj(d,f,r,i,o,a,l,u);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(h.shape,"int32",m)]}const $1e={kernelName:zb,backendName:"cpu",kernelFunc:N1e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R1e(t){const{inputs:e,backend:n,attrs:s}=t,{skipEmpty:r}=s,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.data.get(i.dataId).values,l=n.data.get(o.dataId).values[0],[u,c,h]=Vj(a,l,r),d=c.length;return[n.makeTensorInfo([d,2],"int32",u),n.makeTensorInfo([d],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(h))]}const A1e={kernelName:Bb,backendName:"cpu",kernelFunc:R1e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D1e(t){const{inputs:e,backend:n,attrs:s}=t,{numBuckets:r}=s,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=n.data.get(i.dataId).values,a=Uj(o,r);return n.makeTensorInfo(i.shape,"int32",a)}const O1e={kernelName:Vb,backendName:"cpu",kernelFunc:D1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P1e=Et(of,t=>Math.tan(t)),F1e={kernelName:of,backendName:"cpu",kernelFunc:P1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L1e=Et(af,t=>Math.tanh(t)),M1e={kernelName:af,backendName:"cpu",kernelFunc:L1e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z1e(t){const{inputs:e,backend:n}=t,{tensor:s,indices:r,updates:i}=e,{sliceRank:o,numUpdates:a,sliceSize:l,strides:u,outputSize:c}=Jl(i,r,s.shape),h=!1,d=n.bufferSync(r),f=n.bufferSync(i),p=n.bufferSync(s),m=ku(d,f,s.shape,c,l,a,o,u,p,h);return n.makeTensorInfo(s.shape,m.dtype,m.values)}const B1e={kernelName:$b,backendName:"cpu",kernelFunc:z1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reps:i}=s;Ne(r,"tile");const o=jj(n.bufferSync(r),i);return n.makeTensorInfo(o.shape,o.dtype,o.values)}const U1e={kernelName:lf,backendName:"cpu",kernelFunc:V1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{k:i,sorted:o}=s;Ne(r,"topk");const a=n.data.get(r.dataId).values,[l,u]=Hj(a,r.shape,r.dtype,i,o);return[n.makeTensorInfo(l.shape,l.dtype,l.values),n.makeTensorInfo(u.shape,u.dtype,u.values)]}const j1e={kernelName:Ub,backendName:"cpu",kernelFunc:W1e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G1e(t){const{inputs:e,attrs:n,backend:s}=t,{image:r,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:u}=n,[c,h,d,f]=r.shape,[p,m]=u??[h,d],v=[c,p,m,f],g=Me(r.shape),w=g[0],b=g[1],x=g[2],S=Me(v),N=S[0],I=S[1],C=S[2],_=qn(r.dtype,re(v));_.fill(l);const k=s.data.get(r.dataId).values,A=s.data.get(i.dataId).values;for(let R=0;R<c;++R){const W=i.shape[0]===1?A:A.subarray(R*8,R*8+8);for(let B=0;B<p;++B)for(let M=0;M<m;++M)for(let X=0;X<f;++X){let z;const Y=W[6]*M+W[7]*B+1;if(Y===0)continue;const L=(W[0]*M+W[1]*B+W[2])/Y,le=(W[3]*M+W[4]*B+W[5])/Y,Q=lF(L,d,a),se=lF(le,h,a);switch(o){case"nearest":z=Q1e(k,h,d,w,b,x,R,se,Q,X,l);break;case"bilinear":z=J1e(k,h,d,w,b,x,R,se,Q,X,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}const de=R*N+B*I+M*C+X;_[de]=z}return s.makeTensorInfo(v,r.dtype,_)}return{dataId:s.write(_,v,r.dtype),shape:r.shape,dtype:r.dtype}}const H1e={kernelName:Wb,backendName:"cpu",kernelFunc:G1e};function lF(t,e,n){switch(n){case"reflect":return q1e(t,e);case"wrap":return K1e(t,e);case"nearest":return Y1e(t,e);case"constant":default:return X1e(t)}}function q1e(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const s=2*e;n<s&&(n=s*Math.trunc(-n/s)+n),n=n<-e?n+s:-n-1}else if(n>e-1)if(e<=1)n=0;else{const s=2*e;n-=s*Math.trunc(n/s),n>=e&&(n=s-n-1)}return kl(0,n,e-1)}function K1e(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const s=e-1;n+=e*(Math.trunc(-n/s)+1)}else if(n>e-1)if(e<=1)n=0;else{const s=e-1;n-=e*Math.trunc(n/s)}return kl(0,n,e-1)}function X1e(t,e){return t}function Y1e(t,e){return kl(0,t,e-1)}function vp(t,e,n,s,r,i,o,a,l,u,c){const h=o*s+a*r+l*i+u;return 0<=a&&a<e&&0<=l&&l<n?t[h]:c}function Q1e(t,e,n,s,r,i,o,a,l,u,c){const h=Math.round(a),d=Math.round(l);return vp(t,e,n,s,r,i,o,h,d,u,c)}function J1e(t,e,n,s,r,i,o,a,l,u,c){const h=Math.floor(a),d=Math.floor(l),f=h+1,p=d+1,m=(p-l)*vp(t,e,n,s,r,i,o,h,d,u,c)+(l-d)*vp(t,e,n,s,r,i,o,h,p,u,c),v=(p-l)*vp(t,e,n,s,r,i,o,f,d,u,c)+(l-d)*vp(t,e,n,s,r,i,o,f,p,u,c);return(f-a)*m+(a-h)*v}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z1e(t){const{inputs:e,attrs:n,backend:s}=t,{axis:r}=n,{x:i}=e;Ne(i,"unique");const o=s.data.get(i.dataId).values,{outputValues:a,outputShape:l,indices:u}=qj(o,r,i.shape,i.dtype);return[s.makeTensorInfo(l,i.dtype,a),s.makeTensorInfo([u.length],"int32",u)]}const eSe={kernelName:jb,backendName:"cpu",kernelFunc:Z1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tSe(t){const{inputs:e,backend:n,attrs:s}=t,{value:r}=e;let{axis:i}=s;i<0&&(i+=r.shape.length);const o=r.shape.length,a=r.shape[i],l=new Array(o-1);let u=0;for(let f=0;f<o;f++)f!==i&&(l[u++]=r.shape[f]);const c=new Array(o).fill(0),h=r.shape.slice();h[i]=1;const d=new Array(a);for(let f=0;f<d.length;f++){c[i]=f;const p=ac({inputs:{x:r},backend:n,attrs:{begin:c,size:h}});d[f]=Vt({inputs:{x:p},backend:n,attrs:{shape:l}}),n.disposeIntermediateTensorInfo(p)}return d}const nSe={kernelName:ry,backendName:"cpu",kernelFunc:tSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sSe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,segmentIds:i}=e,{numSegments:o}=s;Ne(r,"unsortedSegmentSum");const a=r.shape.length,l=i.shape.length,u=[],c=[],h=a-l;let d=i;for(let p=0;p<h;++p){const m=Hw({inputs:{input:d},backend:n,attrs:{dim:p+1}});d=m,c.push(m)}for(let p=0;p<o;++p){const m=xa(p,"int32"),v=n.makeTensorInfo([],"int32",m),g=lj({inputs:{a:v,b:d},backend:n}),w=Ll({inputs:{x:g},backend:n,attrs:{dtype:"float32"}}),b=rS({inputs:{a:w,b:r},backend:n}),x=By({inputs:{x:b},backend:n,attrs:{axis:0,keepDims:!1}});u.push(x),c.push(v),c.push(g),c.push(w),c.push(b),c.push(x)}const f=hG({inputs:u,backend:n,attrs:{axis:0}});return c.forEach(p=>n.disposeIntermediateTensorInfo(p)),f}const rSe={kernelName:iy,backendName:"cpu",kernelFunc:sSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iSe=[z0e,xye,V0e,W0e,Tye,G0e,q0e,X0e,Q0e,Z0e,tve,sve,ive,lve,cve,fve,mve,yve,wve,L0e,bve,Cve,_ve,Eye,kve,Iye,$ye,Nve,bye,Rve,Dve,Ove,Fve,Mve,Bve,Uve,jve,Hve,Kve,Yve,Jve,ewe,nwe,rwe,iwe,awe,uwe,hwe,dwe,fwe,pwe,gwe,wwe,$0e,bwe,Rye,Nwe,Aye,$we,Oye,Fwe,Lwe,zwe,Fye,Mye,Vwe,Wwe,Gwe,qwe,Bye,Uye,Sye,Xwe,Ave,Qwe,Zwe,txe,R0e,jye,Hye,sxe,Kye,ixe,lxe,cxe,fxe,mxe,yxe,vxe,Yye,xxe,Sxe,Ixe,Txe,Exe,$xe,Axe,Jye,Oxe,Lxe,ebe,e0e,n0e,sbe,obe,ube,r0e,hbe,fbe,pbe,dG,vbe,D0e,a0e,xbe,Sbe,Ibe,Tbe,Cye,P_,Ebe,O0e,P0e,F0e,$be,Abe,Obe,Fbe,Mbe,zbe,Vbe,m0e,Wbe,Kbe,Ybe,e1e,y0e,n1e,r1e,o1e,v0e,Jxe,u1e,h1e,f1e,m1e,y1e,w1e,b1e,C1e,b0e,I1e,C0e,_0e,T1e,E1e,$1e,A1e,O1e,N0e,ywe,F1e,M1e,B1e,U1e,j1e,H1e,i0e,eSe,nSe,rSe,dbe];for(const t of iSe)Hb(t);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wu={},V0={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function fG(t,e){wu[t]=e}function Gi(t,e){if(!(t in wu)||e!=null){const s=aSe(t,e);if(s!==null)wu[t]=s;else return console.log("Could not get context for WebGL version",t),null}const n=wu[t];return n==null||n.isContextLost()?(delete wu[t],Gi(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),wu[t])}function oSe(t){if(!Z().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&t===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function aSe(t,e){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=e??oSe(t);return n.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete wu[t]},!1),Z().getBool("SOFTWARE_WEBGL_ENABLED")&&(V0.failIfMajorPerformanceCaveat=!1),t===1?n.getContext("webgl",V0)||n.getContext("experimental-webgl",V0):n.getContext("webgl2",V0)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Dm;(function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"})(Dm||(Dm={}));var Dr;(function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"})(Dr||(Dr={}));var is;(function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(is||(is={}));function Vy(t,e){return[e,t]}function lSe(t,e){return t*e}function U0(t){const e=re(t),n=Math.ceil(e/4);return xw(n)}function Cf(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function uSe(t,e){const[n,s]=Cf(t,e);return n*s*4}function nR(t,e){const n=t;let s,r,i,o,a,l,u,c,h,d;return Z().getNumber("WEBGL_VERSION")===2?(s=n.R32F,r=n.R16F,i=n.RGBA16F,o=n.RGBA32F,a=n.RED,u=4,c=1,h=n.HALF_FLOAT,d=n.FLOAT,l=n.RGBA8):(s=t.RGBA,r=t.RGBA,i=t.RGBA,o=n.RGBA,a=t.RGBA,u=4,c=4,h=e!=null?e.HALF_FLOAT_OES:null,d=t.FLOAT,l=t.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:h,textureTypeFloat:d}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function be(t,e){const n=e();return Z().getBool("DEBUG")&&cSe(t),n}function cSe(t){const e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+mG(t,e))}const hSe=596e-10,dSe=65504;function pG(t){return!!(Z().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||hSe<Math.abs(t)&&Math.abs(t)<dSe)}function mG(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function wp(t,e){return ka(t,()=>t.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function gG(t,e){const n=ka(t,()=>t.createShader(t.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(be(t,()=>t.shaderSource(n,e)),be(t,()=>t.compileShader(n)),t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function yG(t,e){const n=ka(t,()=>t.createShader(t.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(be(t,()=>t.shaderSource(n,e)),be(t,()=>t.compileShader(n)),Z().get("ENGINE_COMPILE_ONLY"))return n;if(t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw sR(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}const fSe=/ERROR: [0-9]+:([0-9]+):/g;function sR(t,e){const n=fSe.exec(e);if(n==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(t);return}const s=+n[1],r=t.split(`
`),i=r.length.toString().length+2,o=r.map((h,d)=>Ru((d+1).toString(),i)+h);let a=0;for(let h=0;h<o.length;h++)a=Math.max(o[h].length,a);const l=o.slice(0,s-1),u=o.slice(s-1,s),c=o.slice(s);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${Ru(u[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(c.join(`
`))}function vG(t){return ka(t,()=>t.createProgram(),"Unable to create WebGLProgram.")}function wG(t,e){if(be(t,()=>t.linkProgram(e)),!Z().get("ENGINE_COMPILE_ONLY")&&t.getProgramParameter(e,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function mv(t,e){if(be(t,()=>t.validateProgram(e)),t.getProgramParameter(e,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function xG(t,e){const n=ka(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return be(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),be(t,()=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function bG(t,e){const n=ka(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return be(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n)),be(t,()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function pSe(){return Z().getNumber("WEBGL_VERSION")===2?1:4}function SG(t){return ka(t,()=>t.createTexture(),"Unable to create WebGLTexture.")}function CG(t,e){const n=Z().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){const s=`[${t}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(t>n||e>n){const s=`[${t}x${e}]`,r=`[${n}x${n}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+r+".")}}function IG(t){return ka(t,()=>t.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function L_(t,e,n,s,r,i,o){const a=t.getAttribLocation(e,n);return a===-1?!1:(be(t,()=>t.bindBuffer(t.ARRAY_BUFFER,s)),be(t,()=>t.vertexAttribPointer(a,r,t.FLOAT,!1,i,o)),be(t,()=>t.enableVertexAttribArray(a)),!0)}function _G(t,e,n){$G(t,n),be(t,()=>t.activeTexture(t.TEXTURE0+n)),be(t,()=>t.bindTexture(t.TEXTURE_2D,e))}function mSe(t,e){$G(t,e),be(t,()=>t.activeTexture(t.TEXTURE0+e)),be(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function TG(t,e,n){return ka(t,()=>t.getUniformLocation(e,n),'uniform "'+n+'" not present in program.')}function kG(t,e,n){return t.getUniformLocation(e,n)}function EG(t,e,n,s){be(t,()=>_G(t,e,s)),be(t,()=>t.uniform1i(n,s))}function gSe(t){be(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,null)),be(t,()=>t.viewport(0,0,t.canvas.width,t.canvas.height)),be(t,()=>t.scissor(0,0,t.canvas.width,t.canvas.height))}function gv(t,e,n){be(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,n)),be(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0))}function M_(t,e){be(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,e)),be(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0))}function xp(t){const e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+NG(t,e))}function NG(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function ka(t,e,n){const s=be(t,()=>e());if(s==null)throw new Error(n);return s}function $G(t,e){const n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+t.TEXTURE0;if(s<t.TEXTURE0||s>n){const r=`[gl.TEXTURE0, gl.TEXTURE${n}]`;throw new Error(`textureUnit must be in ${r}.`)}}function lc(t,e=2){return re(t.slice(0,t.length-e))}function uc(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function bp(t){let e=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(e=[lc(t),...uc(t)]),e}function RG(t,e=!1){let n=Z().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=Z().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&Z().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=n/2),e&&(n=n*2,s=s*2,t=t.map((a,l)=>l>=t.length-2?zx(t[l]):t[l]),t.length===1&&(t=[2,t[0]])),t.length!==2&&(t=wa(t).newShape);let r=re(t),i=null;t.length<=1&&r<=n?i=[1,r]:t.length===2&&t[0]<=n&&t[1]<=n?i=t:t.length===3&&t[0]*t[1]<=n&&t[2]<=n?i=[t[0]*t[1],t[2]]:t.length===3&&t[0]<=n&&t[1]*t[2]<=n?i=[t[0],t[1]*t[2]]:t.length===4&&t[0]*t[1]*t[2]<=n&&t[3]<=n?i=[t[0]*t[1]*t[2],t[3]]:t.length===4&&t[0]<=n&&t[1]*t[2]*t[3]<=n&&(i=[t[0],t[1]*t[2]*t[3]]);const o=i!=null&&Math.max(...i)>s&&Math.min(...i)<=(e?2:1)&&Math.min(...i)>0;if(i==null||o)if(e){const a=lc(t);let l=2,u=2;t.length&&([l,u]=uc(t)),r=a*(l/2)*(u/2),i=xw(r).map(c=>c*2)}else i=xw(r);return i}function W0(t){return t%2===0}function Om(t,e){if(t=t.slice(-2),e=e.slice(-2),st(t,e)||!t.length||!e.length||t[0]===0||t[1]===0||e[0]===0||e[1]===0)return!0;if(t.length!==e.length){const n=t[t.length-1],s=e[e.length-1];if(n===s||W0(n)&&W0(s)&&(t[0]===1||e[0]===1))return!0}return t[1]===e[1]&&W0(t[0])&&W0(e[0])}let yv,vv;function AG(t){if(yv==null){const e=Gi(t);yv=e.getParameter(e.MAX_TEXTURE_SIZE)}return yv}function ySe(){yv=null}function vSe(){vv=null}function DG(t){if(vv==null){const e=Gi(t);vv=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,vv)}function OG(t){if(t===0)return 0;let e;const n=Gi(t);return Or(n,"EXT_disjoint_timer_query_webgl2")&&t===2?e=2:Or(n,"EXT_disjoint_timer_query")?e=1:e=0,e}function Or(t,e){return t.getExtension(e)!=null}function z_(t){try{if(Gi(t)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function PG(t){if(t===0)return!1;const e=Gi(t);if(t===1){if(!Or(e,"OES_texture_float"))return!1}else if(!Or(e,"EXT_color_buffer_float"))return!1;return B_(e)}function FG(t){if(t===0)return!1;const e=Gi(t);if(t===1){if(!Or(e,"OES_texture_float")||!Or(e,"WEBGL_color_buffer_float"))return!1}else{if(Or(e,"EXT_color_buffer_float"))return B_(e);const s="EXT_color_buffer_half_float";if(Or(e,s)){const r=e.getExtension(s);return wSe(e,r)}return!1}return B_(e)}function B_(t){const e=nR(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);const o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(i),o}function wSe(t,e){const n=nR(t,e),s=t.createTexture();t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const o=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0);const a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(s),t.deleteFramebuffer(o),a}function LG(t){return t!==2?!1:Gi(t).fenceSync!=null}function If(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&O(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}const xSe=Object.freeze(Object.defineProperty({__proto__:null,assertNotComplex:If,bindCanvasToFramebuffer:gSe,bindColorTextureToFramebuffer:gv,bindTextureToProgramUniformSampler:EG,bindTextureUnit:_G,bindVertexBufferToProgramAttribute:L_,callAndCheck:be,canBeRepresented:pG,createFragmentShader:yG,createFramebuffer:IG,createProgram:vG,createStaticIndexBuffer:bG,createStaticVertexBuffer:xG,createTexture:SG,createVertexShader:gG,getBatchDim:lc,getExtensionOrThrow:wp,getFramebufferErrorMessage:NG,getMaxTexturesInShader:DG,getNumChannels:pSe,getProgramUniformLocation:kG,getProgramUniformLocationOrThrow:TG,getRowsCols:uc,getShapeAs3D:bp,getTextureShapeFromLogicalShape:RG,getWebGLDisjointQueryTimerVersion:OG,getWebGLErrorMessage:mG,getWebGLMaxTextureSize:AG,hasExtension:Or,isCapableOfRenderingToFloatTexture:PG,isDownloadFloatTextureEnabled:FG,isReshapeFree:Om,isWebGLFenceEnabled:LG,isWebGLVersionEnabled:z_,linkProgram:wG,logShaderSourceAndInfoLog:sR,resetMaxTextureSize:ySe,resetMaxTexturesInShader:vSe,unbindColorTextureFromFramebuffer:M_,unbindTextureUnit:mSe,validateFramebuffer:xp,validateProgram:mv,validateTextureSize:CG},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ae=Z();Ae.registerFlag("HAS_WEBGL",()=>Ae.getNumber("WEBGL_VERSION")>0);Ae.registerFlag("WEBGL_VERSION",()=>z_(2)?2:z_(1)?1:0);Ae.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Ae.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Ae.get("WEBGL_VERSION")===2);Ae.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Ae.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Ae.registerFlag("WEBGL_PACK",()=>Ae.getBool("HAS_WEBGL"));Ae.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Ae.getBool("WEBGL_PACK"));Ae.registerFlag("WEBGL_PACK_CLIP",()=>Ae.getBool("WEBGL_PACK"));Ae.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Ae.getBool("WEBGL_PACK"));Ae.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Ae.getBool("WEBGL_PACK"));Ae.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Ae.getBool("WEBGL_PACK"));Ae.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Ae.getBool("WEBGL_PACK"));Ae.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Ae.getBool("WEBGL_PACK"));Ae.registerFlag("WEBGL_PACK_REDUCE",()=>Ae.getBool("WEBGL_PACK"));Ae.registerFlag("WEBGL_LAZILY_UNPACK",()=>Ae.getBool("WEBGL_PACK"));Ae.registerFlag("WEBGL_CONV_IM2COL",()=>Ae.getBool("WEBGL_PACK"));Ae.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>Ae.getBool("WEBGL_PACK"));Ae.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>AG(Ae.getNumber("WEBGL_VERSION")));Ae.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>DG(Ae.getNumber("WEBGL_VERSION")));Ae.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const t=Ae.getNumber("WEBGL_VERSION");return t===0?0:OG(t)});Ae.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Ae.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Zk());Ae.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>PG(Ae.getNumber("WEBGL_VERSION")));Ae.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Ae.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Ae.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Ae.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>FG(Ae.getNumber("WEBGL_VERSION")));Ae.registerFlag("WEBGL_FENCE_API_ENABLED",()=>LG(Ae.getNumber("WEBGL_VERSION")));Ae.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Ae.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Ae.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)});Ae.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>Zk()?1:-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)});Ae.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Ae.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Ae.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Ae.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);Ae.registerFlag("WEBGL_EXP_CONV",()=>!1);Ae.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Ae.getBool("IS_TEST"));Ae.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);Ae.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);Ae.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);Ae.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zs(){let t,e,n,s,r,i,o,a,l,u;return Z().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",e="in",n="out",s="in",r="texture",i="outputColor",o="out vec4 outputColor;",a=Z().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",u=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",e="attribute",n="varying",s="varying",r="texture2D",i="gl_FragColor",o="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,u=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:e,varyingVs:n,varyingFs:s,texture2D:r,output:i,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:l,defineRound:u}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oc(t,e,n="index"){const s=Me(e);return s.map((r,i)=>{const o=`int ${t[i]} = ${n} / ${r}`,a=i===s.length-1?`int ${t[i+1]} = ${n} - ${t[i]} * ${r}`:`index -= ${t[i]} * ${r}`;return`${o}; ${a};`}).join("")}function iS(t,e,n="index"){const s=Me(e);return s.map((r,i)=>{const o=`int ${t[i]} = ${n} / outShapeStrides[${i}]`,a=i===s.length-1?`int ${t[i+1]} = ${n} - ${t[i]} * outShapeStrides[${i}]`:`index -= ${t[i]} * outShapeStrides[${i}]`;return`${o}; ${a};`}).join("")}function bSe(t,e){const n=t.length,s=t.map(i=>`${e}[${i}]`),r=new Array(n-1);r[n-2]=s[n-1];for(let i=n-3;i>=0;--i)r[i]=`(${r[i+1]} * ${s[i+1]})`;return r}function SSe(t,e,n="index"){const s=t.map((i,o)=>o),r=bSe(s,e);return r.map((i,o)=>{const a=`int ${t[o]} = ${n} / ${r[o]}`,l=o===r.length-1?`int ${t[o+1]} = ${n} - ${t[o]} * ${r[o]}`:`index -= ${t[o]} * ${r[o]}`;return`${a}; ${l};`}).join("")}function rR(t){const e=Me(t).map(n=>n.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function iR(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const MG=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:zG}=gU;function CSe(t,e,n){const s=[];if(t.forEach(f=>{const p=re(f.shapeInfo.logicalShape);if(f.shapeInfo.isUniform?s.push(`uniform float ${f.name}${p>1?`[${p}]`:""};`):(s.push(`uniform sampler2D ${f.name};`),s.push(`uniform int offset${f.name};`)),n.enableShapeUniforms){const{uniformShape:m}=oR(n.packedInputs,f.shapeInfo.logicalShape,f.shapeInfo.texShape);switch(m.length){case 1:s.push(`uniform int ${f.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${f.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${f.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${f.name}Shape;`);break}s.push(`uniform ivec2 ${f.name}TexShape;`)}}),n.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(f=>{s.push(`uniform ${f.type} ${f.name}${f.arrayIndex?`[${f.arrayIndex}]`:""};`)});const r=s.join(`
`),i=t.map(f=>ISe(f,e,n.packedInputs,n.enableShapeUniforms)).join(`
`),o=e.texShape,a=zs(),l=kSe(a);let u,c,h=$Se(a);return e.isPacked?(u=_Se(e.logicalShape,o,n.enableShapeUniforms),c=NSe(a)):(u=TSe(e.logicalShape,o,n.enableShapeUniforms),c=ESe(a)),n.packedInputs&&(h+=OSe),[h,l,c,r,u,i,n.userCode].join(`
`)}function _f(t,e=!1){const n=t.shapeInfo.logicalShape;switch(n.length){case 0:return HSe(t,e);case 1:return KSe(t,e);case 2:return YSe(t,e);case 3:return JSe(t,e);case 4:return eCe(t,e);case 5:return tCe(t);case 6:return nCe(t);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function BG(t,e){switch(t.shapeInfo.logicalShape.length){case 0:return GSe(t);case 1:return qSe(t,e);case 2:return XSe(t,e);case 3:return QSe(t,e);default:return ZSe(t,e)}}function ISe(t,e,n=!1,s){let r="";n?r+=BG(t,s):r+=_f(t,s);const i=t.shapeInfo.logicalShape,o=e.logicalShape;return i.length<=o.length&&(n?r+=sCe(t,e):r+=rCe(t,e)),r}function _Se(t,e,n){switch(t.length){case 0:return VG();case 1:return PSe(t,e,n);case 2:return WSe(t,e,n);case 3:return LSe(t,e,n);default:return zSe(t,e,n)}}function TSe(t,e,n){switch(t.length){case 0:return VG();case 1:return FSe(t,e,n);case 2:return jSe(t,e,n);case 3:return MSe(t,e,n);case 4:return BSe(t,e,n);case 5:return VSe(t,e);case 6:return USe(t,e);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}function kSe(t){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${t.texture2D}(textureSampler, uv).r;
    }
  `}function ESe(t){return`
    void setOutput(float val) {
      ${t.output} = vec4(val, 0, 0, 0);
    }
  `}function NSe(t){return`
    void setOutput(vec4 val) {
      ${t.output} = val;
    }
  `}function $Se(t){return`${t.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${t.varyingFs} vec2 resultUV;
    ${t.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${t.defineSpecialNaN}
    ${t.defineSpecialInf}
    ${t.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${RSe}
    ${ASe}
    ${DSe}
  `}const RSe=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,ASe=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,DSe=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,OSe=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function VG(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function PSe(t,e,n){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function FSe(t,e,n){return e[0]===1?n?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?n?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function LSe(t,e,n){if(n)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[2]/2),i=r*Math.ceil(t[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function MSe(t,e,n){if(n)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${iS(["r","c","d"],t)}
    return ivec3(r, c, d);
  }
`;const s=Oc(["r","c","d"],t);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function zSe(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[t.length-1]/2),i=r*Math.ceil(t[t.length-2]/2);let o=i,a="",l="b, r, c";for(let u=2;u<t.length-1;u++)o*=t[t.length-u-1],a=`
      int b${u} = index / ${o};
      index -= b${u} * ${o};
    `+a,l=`b${u}, `+l;return`
    ivec${t.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${a}

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${t.length}(${l});
    }
  `}function BSe(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${iS(["r","c","d","d2"],t)}
      return ivec4(r, c, d, d2);
    }
  `;const s=Oc(["r","c","d","d2"],t);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function VSe(t,e){const n=Oc(["r","c","d","d2","d3"],t);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function USe(t,e){const n=Oc(["r","c","d","d2","d3","d4"],t);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function WSe(t,e,n){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(st(t,e))return n?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const r=Math.ceil(t[1]/2);return n?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function jSe(t,e,n){return st(t,e)?n?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:t[1]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:t[0]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:n?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${t[1]};
      int c = index - r * ${t[1]};
      return ivec2(r, c);
    }
  `}function Pc(t){return`offset${t}`}function GSe(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),s=zs();return`
    vec4 ${n}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function HSe(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`float ${s}() {return ${n};}`;const[r,i]=t.shapeInfo.texShape;if(r===1&&i===1)return`
      float ${s}() {
        return sampleTexture(${n}, halfCR);
      }
    `;const o=Pc(n);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${o});
      return sampleTexture(${n}, uv);
    }
  `;const[a,l]=t.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${o});
      return sampleTexture(${n}, uv);
    }
  `}function qSe(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),r=t.shapeInfo.texShape,i=zs();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${i.texture2D}(${n}, uv);
    }
  `;const o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${i.texture2D}(${n}, uv);
    }
  `}function KSe(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${Tf(t)}
      }
    `;const r=t.shapeInfo.texShape,i=r[0],o=r[1];if(o===1&&i===1)return`
      float ${s}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;const a=Pc(n);return o===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${i}.0);
        return sampleTexture(${n}, uv);
      }
    `:i===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${a});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${i}, ${o}, index + ${a});
      return sampleTexture(${n}, uv);
    }
  `}function XSe(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t.shapeInfo.texShape,o=i[0],a=i[1],l=zs();if(i!=null&&st(n,i))return e?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${l.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);

        return ${l.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `;const u=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],c=Math.ceil(n[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${c}, ${u[0]}, ${u[1]}, row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `}function YSe(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t.shapeInfo.texShape;if(i!=null&&st(n,i)){if(e)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const d=i[0],f=i[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${f}.0, ${d}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:o,keptDims:a}=wa(n),l=o;if(l.length<n.length){const d=kf(t,l),f=["row","col"];return`
      ${_f(d,e)}
      float ${r}(int row, int col) {
        return ${r}(${Ef(f,a)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${Tf(t)}
      }
    `;const u=i[0],c=i[1],h=Pc(s);return c===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${u}.0);
      return sampleTexture(${s}, uv);
    }
  `:u===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${h};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${h};
    vec2 uv = uvFromFlat(${u}, ${c}, index);
    return sampleTexture(${s}, uv);
  }
`}function QSe(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(n[0]===1){const d=n.slice(1),f=[1,2],p=kf(t,d),m=["b","row","col"];return`
        ${BG(p,e)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${Ef(m,f)});
        }
      `}const a=zs();if(e)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `;const l=o[0],u=o[1],c=Math.ceil(n[2]/2),h=c*Math.ceil(n[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${u}, ${h}, ${c}, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `}function JSe(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n[1]*n[2],o=n[2],{newShape:a,keptDims:l}=wa(n),u=a;if(u.length<n.length){const m=kf(t,u),v=["row","col","depth"];return`
        ${_f(m,e)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${Ef(v,l)});
        }
      `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${i}, ${o}, 1)));
        ${Tf(t)}
      }
    `;const c=t.shapeInfo.texShape,h=c[0],d=c[1],f=t.shapeInfo.flatOffset;if(d===i&&f==null)return e?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${d}.0, ${h}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(d===o&&f==null)return e?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}.0, ${h}.0);
      return sampleTexture(${s}, uv);
    }
  `;const p=Pc(s);return e?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${p};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${i} + col * ${o} + depth + ${p};
        vec2 uv = uvFromFlat(${h}, ${d}, index);
        return sampleTexture(${s}, uv);
      }
  `}function ZSe(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),r=zs();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${n}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${n}, uv);
    }
  `;const i=t.shapeInfo.logicalShape,o=i.length,a=t.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],u=l[0],c=l[1],h=Math.ceil(i[o-1]/2);let d=h*Math.ceil(i[o-2]/2),f="int b, int row, int col",p=`b * ${d} + (row / 2) * ${h} + (col / 2)`;for(let m=2;m<o-1;m++)f=`int b${m}, `+f,d*=i[o-m-1],p=`b${m} * ${d} + `+p;return`
    vec4 ${s}(${f}) {
      int index = ${p};
      int texR = index / ${c};
      int texC = index - texR * ${c};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${c}, ${u});
      return ${r.texture2D}(${n}, uv);
    }
  `}function eCe(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n[3],o=n[2]*i,a=n[1]*o,{newShape:l,keptDims:u}=wa(n);if(l.length<n.length){const w=kf(t,l),b=["row","col","depth","depth2"];return`
      ${_f(w,e)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${Ef(b,u)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${o}, ${i}, 1)));
        ${Tf(t)}
      }
    `;const c=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,d=h[0],f=h[1],p=`int stride2 = ${s}Shape[3];`,m=`int stride1 = ${s}Shape[2] * stride2;`,v=`int stride0 = ${s}Shape[1] * stride1;`;if(f===a&&c==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${p}
        ${m}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${d}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(f===i&&c==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${d}.0);
        return sampleTexture(${s}, uv);
      }
    `;const g=Pc(s);return e?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${p}
      ${m}
      ${v}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${g});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} +
          depth * ${i} + depth2;
      vec2 uv = uvFromFlat(${d}, ${f}, index + ${g});
      return sampleTexture(${s}, uv);
    }
  `}function tCe(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),r=e[4],i=e[3]*r,o=e[2]*i,a=e[1]*o,{newShape:l,keptDims:u}=wa(e);if(l.length<e.length){const m=kf(t,l),v=["row","col","depth","depth2","depth3"];return`
      ${_f(m)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${Ef(v,u)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${o}, ${i}, ${r})) +
          depth3;
        ${Tf(t)}
      }
    `;const c=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,d=h[0],f=h[1];if(f===a&&c==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${i}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${d}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(f===r&&c==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${d}.0);
        return sampleTexture(${n}, uv);
      }
    `;const p=Pc(n);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} + depth * ${i} +
          depth2 * ${r} + depth3 + ${p};
      vec2 uv = uvFromFlat(${d}, ${f}, index);
      return sampleTexture(${n}, uv);
    }
  `}function nCe(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:r,keptDims:i}=wa(e);if(r.length<e.length){const v=kf(t,r),g=["row","col","depth","depth2","depth3","depth4"];return`
      ${_f(v)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${Ef(g,i)});
      }
    `}const o=e[5],a=e[4]*o,l=e[3]*a,u=e[2]*l,c=e[1]*u;if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${c}, ${u}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${Tf(t)}
      }
    `;const h=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,f=d[0],p=d[1];if(p===c&&h==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${u}, ${l}, ${a}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(p===o&&h==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;const m=Pc(n);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${c} + col * ${u} + depth * ${l} +
          depth2 * ${a} + depth3 * ${o} + depth4 + ${m};
      vec2 uv = uvFromFlat(${f}, ${p}, index);
      return sampleTexture(${n}, uv);
    }
  `}function Tf(t){const e=t.name,n=re(t.shapeInfo.logicalShape);return n<2?`return ${e};`:`
    for (int i = 0; i < ${n}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function sCe(t,e){const n=t.name,s=n.charAt(0).toUpperCase()+n.slice(1),r="get"+s+"AtOutCoords",i=t.shapeInfo.logicalShape.length,o=e.logicalShape.length,a=zG(t.shapeInfo.logicalShape,e.logicalShape),l=At(o),u=o-i;let c;const h=["x","y","z","w","u","v"];i===0?c="":o<2&&a.length>=1?c="coords = 0;":c=a.map(w=>`coords.${h[w+u]} = 0;`).join(`
`);let d="";o<2&&i>0?d="coords":d=t.shapeInfo.logicalShape.map((w,b)=>`coords.${h[b+u]}`).join(", ");let f="return outputValue;";const m=re(t.shapeInfo.logicalShape)===1,g=re(e.logicalShape)===1;if(i===1&&!m&&!g)f=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(m&&!g)o===1?f=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:f=`
        return vec4(outputValue.x);
      `;else if(a.length){const w=i-2,b=i-1;a.indexOf(w)>-1&&a.indexOf(b)>-1?f="return vec4(outputValue.x);":a.indexOf(w)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(b)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${l} coords = getOutputCoords();
      ${c}
      vec4 outputValue = get${s}(${d});
      ${f}
    }
  `}function rCe(t,e){const n=t.name,s=n.charAt(0).toUpperCase()+n.slice(1),r="get"+s+"AtOutCoords",i=e.texShape,o=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!t.shapeInfo.isUniform&&a===l&&t.shapeInfo.flatOffset==null&&st(o,i))return`
      float ${r}() {
        return sampleTexture(${n}, resultUV);
      }
    `;const u=At(l),c=zG(t.shapeInfo.logicalShape,e.logicalShape),h=l-a;let d;const f=["x","y","z","w","u","v"];a===0?d="":l<2&&c.length>=1?d="coords = 0;":d=c.map(m=>`coords.${f[m+h]} = 0;`).join(`
`);let p="";return l<2&&a>0?p="coords":p=t.shapeInfo.logicalShape.map((m,v)=>`coords.${f[v+h]}`).join(", "),`
    float ${r}() {
      ${u} coords = getOutputCoords();
      ${d}
      return get${s}(${p});
    }
  `}function At(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function oR(t,e,n){const{newShape:s,keptDims:r}=wa(e),i=e.length,o=t&&i===3&&e[0]===1,a=o?e.slice(1):s,l=!t&&i>1&&!st(e,n)&&s.length<i||o;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:r}}function kf(t,e){const n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function Ef(t,e){return e.map(n=>t[n]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iCe(t,e,n,s){const r=n.map((c,h)=>{const d={logicalShape:c.shape,texShape:c.isUniform?null:c.texData.texShape,isUniform:c.isUniform,isPacked:c.isUniform?!1:c.texData.isPacked,flatOffset:null};return c.texData!=null&&c.texData.slice!=null&&c.texData.slice.flatOffset>0&&(d.flatOffset=c.texData.slice.flatOffset),{name:e.variableNames[h],shapeInfo:d}}),i=r.map(c=>c.shapeInfo),o={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},a=CSe(r,o,e),l=yG(t.gl,a),u=t.createProgram(l);return Z().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:i,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(t.buildVao(u),Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:i,outShapeInfo:o},UG(t,e,u)))}function UG(t,e,n){const s=[],r=[];let i,o,a,l=null,u=null;u=t.getUniformLocation(n,"NAN",!1),Z().getNumber("WEBGL_VERSION")===1&&(l=t.getUniformLocation(n,"INFINITY",!1));const c=!1;for(const h of e.variableNames){const d={name:h,uniform:t.getUniformLocation(n,h,c),offset:t.getUniformLocation(n,`offset${h}`,c)};e.enableShapeUniforms&&(d.shape=t.getUniformLocation(n,`${h}Shape`,c),d.texShape=t.getUniformLocation(n,`${h}TexShape`,c)),s.push(d)}if(e.enableShapeUniforms&&(i=t.getUniformLocation(n,"outShape",c),a=t.getUniformLocation(n,"outShapeStrides",c),o=t.getUniformLocation(n,"outTexShape",c)),e.customUniforms)for(const h of e.customUniforms)r.push(t.getUniformLocation(n,h.name,c));return{variablesLocations:s,customUniformLocations:r,infLoc:l,nanLoc:u,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:o}}function uF(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach((n,s)=>{const r=n.logicalShape,i=e[s],o=i.shape;if(!st(r,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${o} must match`);if(n.isUniform&&i.isUniform)return;const a=n.texShape,l=i.isUniform?null:i.texData.texShape;if(!st(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function oCe(t,e,n,s,r){e.program.enableShapeUniforms||(uF(e.inShapeInfos,n),uF([e.outShapeInfo],[s]));const i=s.texData.texture,o=s.texData.texShape;s.texData.isPacked?t.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):t.setOutputMatrixTexture(i.texture,o[0],o[1]),t.setProgram(e.webGLProgram),t.bindVertexArray(e.webGLProgram.vao),Z().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&t.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&t.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<n.length;++l){const u=n[l],{uniform:c,offset:h,shape:d,texShape:f}=e.variablesLocations[l];if(d){const{uniformShape:p}=oR(e.program.packedInputs,u.shape,u.texData.texShape);switch(p.length){case 1:t.gl.uniform1iv(d,new Int32Array(p));break;case 2:t.gl.uniform2iv(d,new Int32Array(p));break;case 3:t.gl.uniform3iv(d,new Int32Array(p));break;case 4:t.gl.uniform4iv(d,new Int32Array(p));break}}if(f&&t.gl.uniform2i(f,u.texData.texShape[0],u.texData.texShape[1]),c!=null){if(u.isUniform){if(re(u.shape)<2)t.gl.uniform1f(c,u.uniformValues[0]);else{let p=u.uniformValues;p instanceof Float32Array||(p=new Float32Array(p)),t.gl.uniform1fv(c,p)}continue}u.texData.slice!=null&&h!=null&&t.gl.uniform1i(h,u.texData.slice.flatOffset),t.setInputMatrixTexture(u.texData.texture.texture,c,l)}}const a=e.outShapeLocation;if(a)switch(s.shape.length){case 1:t.gl.uniform1iv(a,new Int32Array(s.shape));break;case 2:t.gl.uniform2iv(a,new Int32Array(s.shape));break;case 3:t.gl.uniform3iv(a,new Int32Array(s.shape));break;case 4:t.gl.uniform4iv(a,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const l=Me(s.shape);switch(s.shape.length){case 2:t.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:t.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:t.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&t.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&r)for(let l=0;l<e.program.customUniforms.length;++l){const u=e.program.customUniforms[l],c=e.customUniformLocations[l],h=r[l];if(u.type==="float")t.gl.uniform1fv(c,h);else if(u.type==="vec2")t.gl.uniform2fv(c,h);else if(u.type==="vec3")t.gl.uniform3fv(c,h);else if(u.type==="vec4")t.gl.uniform4fv(c,h);else if(u.type==="int")t.gl.uniform1iv(c,h);else if(u.type==="ivec2")t.gl.uniform2iv(c,h);else if(u.type==="ivec3")t.gl.uniform3iv(c,h);else if(u.type==="ivec4")t.gl.uniform4iv(c,h);else throw Error(`uniform type ${u.type} is not supported yet.`)}t.executeProgram()}function aCe(t,e,n){let s="";e.concat(n).forEach(o=>{const a=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(t.enableShapeUniforms&&!o.isUniform){const l=o.texData.texShape,{useSqueezeShape:u,uniformShape:c,keptDims:h}=oR(t.packedInputs,o.shape,l);let d="",f="",p="";if(c.length===1&&t.packedInputs){const S=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];d=`${S[0]>1}_${S[1]>1}`}else if(c.length===2&&!t.packedInputs)f=`${c[0]>1}_${c[1]>1}`;else if(c.length>2&&!t.packedInputs){const S=Me(c);p=`${S[0]===l[1]}_${S[S.length-1]===l[1]}`}const m=o.shape.length,v=c.length===2&&st(o.shape,l),g=re(o.shape)===1,w=Zu(o.shape,n.shape),b=!t.packedInputs&&m===n.shape.length&&st(l,n.texData.texShape),x=t.packedInputs||c.length>2?"":`${l[0]>1}_${l[1]>1}`;s+=`${m}_${b}_${u?h:""}_${c.length}_${g}_${w}_${v}_${d}_${f}_${p}_${x}_${a}`}else{const l=o.isUniform?"uniform":o.texData.texShape;s+=`${o.shape}_${l}_${a}`}});const r=t.userCode;let i=t.constructor.name;return i+="_"+s+"_"+r+`${Z().getNumber("WEBGL_VERSION")}`,i}function Is(t){return Z().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&t<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lCe{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Dm.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=zs();this.outputShape=e,this.enableShapeUniforms=Is(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?iS(["r","c","d"],e):Oc(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uCe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Dm.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=zs();this.outputShape=e,this.enableShapeUniforms=Is(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?iS(["r","c","d"],e):Oc(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cCe{constructor(e){this.variableNames=["A"],this.outTexUsage=Dr.DOWNLOAD;const n=zs();this.outputShape=e,this.userCode=`
      ${MG}

      void main() {
        float x = getAAtOutCoords();
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hCe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Dr.DOWNLOAD;const n=zs();this.outputShape=e,this.userCode=`
      ${MG}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dCe={R:0,G:1,B:2,A:3};class cF{constructor(e,n=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=zs();this.outputShape=e,this.enableShapeUniforms=Is(this.outputShape.length);let i="result";n&&(i="floor(result * 255. + 0.5)");let o="";for(let a=0;a<s.length;a++){const l=s[a];o+=`
          if(offset == ${a}) {
            result = values[${dCe[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?iR():rR(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${o}
        }
        ${r.output} = vec4(${i}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fCe{constructor(e,n=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=zs();this.outputShape=e,this.enableShapeUniforms=Is(this.outputShape.length);let r="",i="result";n&&(i="floor(result * 255. + 0.5)");for(let o=0;o<=1;o++)for(let a=0;a<=1;a++){const l=o*2+a;r+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${o} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${o};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?iR():rR(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${s.output} = ${i};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WG(t){const e=zs(),n=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return gG(t,n)}function jG(t){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return xG(t,e)}function GG(t){const e=new Uint16Array([0,1,2,2,1,3]);return bG(t,e)}function Uy(t,e,n,s,r,i){CG(e,n);const o=SG(t),a=t.TEXTURE_2D;return be(t,()=>t.bindTexture(a,o)),be(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)),be(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),be(t,()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST)),be(t,()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST)),Z().getNumber("WEBGL_VERSION")===1?be(t,()=>t.texImage2D(a,0,s,e,n,0,r,i,null)):be(t,()=>t.texStorage2D(a,1,s,e,n)),be(t,()=>t.bindTexture(t.TEXTURE_2D,null)),{texture:o,texShape:[n,e]}}function aR(t){return t.internalFormatFloat}function HG(t,e,n,s){const[r,i]=Vy(e,n);return Uy(t,r,i,aR(s),s.textureFormatFloat,t.FLOAT)}function lR(t){return t.internalFormatHalfFloat}function qG(t,e,n,s){const[r,i]=Vy(e,n);return Uy(t,r,i,lR(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function uR(t){return t.downloadTextureFormat}function KG(t,e,n,s){const[r,i]=Vy(e,n);return Uy(t,r,i,uR(s),t.RGBA,t.UNSIGNED_BYTE)}function cR(t){return t.internalFormatPackedFloat}function XG(t,e,n,s){const[r,i]=Cf(e,n);return Uy(t,r,i,cR(s),t.RGBA,t.FLOAT)}function hR(t){return t.internalFormatPackedHalfFloat}function YG(t,e,n,s){const[r,i]=Cf(e,n);return Uy(t,r,i,hR(s),t.RGBA,s.textureTypeHalfFloat)}function QG(t,e,n){return be(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),L_(t,e,"clipSpacePos",n,3,20,0)&&L_(t,e,"uv",n,2,20,12)}function JG(t,e,n,s,r,i){be(t,()=>t.bindTexture(t.TEXTURE_2D,e));let o,a,l;r instanceof Uint8Array?(o=new Uint8Array(n*s*4),a=t.UNSIGNED_BYTE,l=t.RGBA):(o=new Float32Array(n*s*4),a=t.FLOAT,l=i.internalFormatPackedFloat),o.set(r),Z().getNumber("WEBGL_VERSION")===2?be(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,s,t.RGBA,a,o)):be(t,()=>t.texImage2D(t.TEXTURE_2D,0,l,n,s,0,t.RGBA,a,o)),be(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function ZG(t,e,n){be(t,()=>t.bindTexture(t.TEXTURE_2D,e)),n.data instanceof Uint8Array?Z().getNumber("WEBGL_VERSION")===2?be(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n.width,n.height,t.RGBA,t.UNSIGNED_BYTE,n.data)):be(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data)):Z().getNumber("WEBGL_VERSION")===2?be(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,n)):be(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)),be(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function eH(t,e,n,s){const r=t.createBuffer();be(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,r));const a=4*4*e*n;return be(t,()=>t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)),be(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,0)),be(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null)),r}function tH(t,e,n){const s=t,r=new Float32Array(n);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,r),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),r}function nH(t,e,n,s){const[r,i]=Vy(e,n),o=4,a=new Uint8Array(lSe(e*n,o));return be(t,()=>t.readPixels(0,0,r,i,s.downloadTextureFormat,t.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function sH(t,e,n,s,r,i,o,a){const l=t,u=new Float32Array(uSe(i,o));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,u),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),u}function rH(t,e,n){const s=new Float32Array(e*n*4);return be(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,s)),s}const pCe=Object.freeze(Object.defineProperty({__proto__:null,bindVertexProgramAttributeStreams:QG,createBufferFromOutputTexture:eH,createFloat16MatrixTexture:qG,createFloat16PackedMatrixTexture:YG,createFloat32MatrixTexture:HG,createIndexBuffer:GG,createPackedMatrixTexture:XG,createUnsignedBytesMatrixTexture:KG,createVertexBuffer:jG,createVertexShader:WG,downloadByteEncodedFloatMatrixFromOutputTexture:nH,downloadFloat32MatrixFromBuffer:tH,downloadMatrixFromPackedOutputTexture:rH,downloadPackedMatrixFromBuffer:sH,getInternalFormatForFloat16MatrixTexture:lR,getInternalFormatForFloat16PackedMatrixTexture:hR,getInternalFormatForFloat32MatrixTexture:aR,getInternalFormatForPackedMatrixTexture:cR,getInternalFormatForUnsignedBytesMatrixTexture:uR,uploadDenseMatrixToTexture:JG,uploadPixelDataToTexture:ZG},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wv{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const n=Z().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,fG(n,e)):this.gl=Gi(n),e=this.gl,Z().getNumber("WEBGL_VERSION")===2){const i=e;this.createVertexArray=()=>be(i,()=>i.createVertexArray()),this.bindVertexArray=o=>be(i,()=>i.bindVertexArray(o)),this.deleteVertexArray=o=>be(i,()=>i.deleteVertexArray(o)),this.getVertexArray=()=>be(i,()=>i.getParameter(i.VERTEX_ARRAY_BINDING))}else if(e!=null){const i=e.getExtension("OES_vertex_array_object");if(i==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>be(e,()=>i.createVertexArrayOES()),this.bindVertexArray=o=>be(e,()=>i.bindVertexArrayOES(o)),this.deleteVertexArray=o=>be(e,()=>i.deleteVertexArrayOES(o)),this.getVertexArray=()=>be(e,()=>e.getParameter(i.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),Z().getNumber("WEBGL_VERSION")===1){const i="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=wp(this.gl,i),Or(this.gl,o))this.textureHalfFloatExtension=wp(this.gl,o);else if(Z().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),Or(this.gl,r))this.colorBufferHalfFloatExtension=wp(this.gl,r);else if(Z().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",Or(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(Or(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=jG(this.gl),this.indexBuffer=GG(this.gl),this.framebuffer=IG(this.gl),this.textureConfig=nR(this.gl,this.textureHalfFloatExtension)}get debug(){return Z().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;be(e,()=>e.finish()),be(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),be(e,()=>e.deleteFramebuffer(this.framebuffer)),be(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),be(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),be(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,n){return this.throwIfDisposed(),HG(this.gl,e,n,this.textureConfig)}createFloat16MatrixTexture(e,n){return this.throwIfDisposed(),qG(this.gl,e,n,this.textureConfig)}createUnsignedBytesMatrixTexture(e,n){return this.throwIfDisposed(),KG(this.gl,e,n,this.textureConfig)}uploadPixelDataToTexture(e,n){this.throwIfDisposed(),ZG(this.gl,e,n)}uploadDenseMatrixToTexture(e,n,s,r){this.throwIfDisposed(),JG(this.gl,e,n,s,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,n){return this.throwIfDisposed(),YG(this.gl,e,n,this.textureConfig)}createPackedMatrixTexture(e,n){return this.throwIfDisposed(),XG(this.gl,e,n,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(M_(this.gl,this.framebuffer),this.outputTexture=null),be(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,n,s){return this.downloadMatrixDriver(e,()=>nH(this.gl,n,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,n,s,r,i,o){return sH(this.gl,e,n,s,r,i,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,n){return tH(this.gl,e,n)}createBufferFromTexture(e,n,s){this.bindTextureToFrameBuffer(e);const r=eH(this.gl,n,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let n,s;if(Z().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,i=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const o=r.clientWaitSync(i,0,0);return o===r.ALREADY_SIGNALED||o===r.CONDITION_SATISFIED},n=i}else Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(n,Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:n,isFencePassed:s}}downloadMatrixFromPackedTexture(e,n,s){return this.downloadMatrixDriver(e,()=>rH(this.gl,n,s))}createProgram(e){this.throwIfDisposed();const n=this.gl;this.vertexShader==null&&(this.vertexShader=WG(n));const s=vG(n);be(n,()=>n.attachShader(s,this.vertexShader)),be(n,()=>n.attachShader(s,e)),wG(n,s);const r=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&mv(n,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const n=this.gl;be(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),QG(n,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(be(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&mv(this.gl,this.program),be(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,n,s=!0){return this.throwIfDisposed(),s?TG(this.gl,e,n):kG(this.gl,e,n)}getAttributeLocation(e,n){return this.throwIfDisposed(),be(this.gl,()=>this.gl.getAttribLocation(e,n))}getUniformLocationNoThrow(e,n){return this.throwIfDisposed(),this.gl.getUniformLocation(e,n)}setInputMatrixTexture(e,n,s){this.throwIfDisposed(),this.throwIfNoProgram(),EG(this.gl,e,n,s)}setOutputMatrixTexture(e,n,s){this.setOutputMatrixTextureDriver(e,s,n)}setOutputPackedMatrixTexture(e,n,s){this.throwIfDisposed();const[r,i]=Cf(n,s);this.setOutputMatrixTextureDriver(e,r,i)}setOutputMatrixWriteRegion(e,n,s,r){this.setOutputMatrixWriteRegionDriver(s,e,r,n)}setOutputPackedMatrixWriteRegion(e,n,s,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&mv(this.gl,this.program),xp(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const n=this.getVertexArray();console.assert(n===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}be(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),be(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=wp(this.gl,Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.createQuery();return s.beginQuery(r.TIME_ELAPSED_EXT,i),i}const e=this.getQueryTimerExtensionWebGL1(),n=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,n),n}endQuery(){if(Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const n=this.gl,s=this.getQueryTimerExtensionWebGL2();n.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await qI(()=>this.disposed||this.isQueryAvailable(e,Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,n){if(n===0)return null;if(n===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,n){if(n===0)return!0;if(n===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),r=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(n=>{this.addItemToPoll(()=>e.isFencePassed(),()=>n())})}pollItems(){const e=mCe(this.itemsToPoll.map(n=>n.isDoneFn));for(let n=0;n<=e;++n){const{resolveFn:s}=this.itemsToPoll[n];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,n){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:n}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in Z().platform&&(s=Z().platform.setTimeoutCustom.bind(Z().platform)),qI(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),gv(this.gl,e,this.framebuffer),this.debug&&xp(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(gv(this.gl,this.outputTexture,this.framebuffer),this.debug&&xp(this.gl)):M_(this.gl,this.framebuffer)}downloadMatrixDriver(e,n){this.bindTextureToFrameBuffer(e);const s=n();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,n,s){this.throwIfDisposed();const r=this.gl;gv(r,e,this.framebuffer),this.debug&&xp(r),this.outputTexture=e,be(r,()=>r.viewport(0,0,n,s)),be(r,()=>r.scissor(0,0,n,s))}setOutputMatrixWriteRegionDriver(e,n,s,r){this.throwIfDisposed(),be(this.gl,()=>this.gl.scissor(e,n,s,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function mCe(t){let e=0;for(;e<t.length&&t[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:gCe,bincountImpl:iH,bincountReduceImpl:yCe,bitwiseAndImpl:vCe,castImpl:wCe,ceilImpl:xCe,concatImpl:bCe,equalImpl:SCe,expImpl:CCe,expm1Impl:ICe,floorImpl:_Ce,gatherNdImpl:TCe,gatherV2Impl:kCe,greaterImpl:ECe,greaterEqualImpl:NCe,lessImpl:$Ce,lessEqualImpl:RCe,linSpaceImpl:ACe,logImpl:DCe,maxImpl:OCe,maximumImpl:PCe,minimumImpl:FCe,multiplyImpl:LCe,negImpl:MCe,notEqualImpl:zCe,prodImpl:BCe,raggedGatherImpl:VCe,raggedRangeImpl:UCe,raggedTensorToTensorImpl:WCe,rangeImpl:jCe,rsqrtImpl:GCe,scatterImpl:HCe,sigmoidImpl:qCe,simpleAbsImpl:oH,sliceImpl:KCe,sparseFillEmptyRowsImpl:XCe,sparseReshapeImpl:YCe,sparseSegmentReductionImpl:aH,sqrtImpl:QCe,staticRegexReplaceImpl:JCe,stridedSliceImpl:ZCe,stringNGramsImpl:eIe,stringSplitImpl:tIe,stringToHashBucketFastImpl:nIe,subImpl:sIe,tileImpl:rIe,topKImpl:iIe,transposeImpl:dR,uniqueImpl:oIe}=Kj;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lH(t,e){return["x","y","z","w","u","v"].slice(0,e).map(n=>`${t}.${n}`)}function Ds(t,e){return e===1?[t]:lH(t,e)}function aIe(t,e){if(t===1)return"rc";let n="";for(let s=0;s<t;s++)n+=e[s],s<t-1&&(n+=",");return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lIe{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=Is(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const n=Ds("rc",this.rank),s=At(this.rank),r=this.getOutOfBoundsCondition(n),i=this.getSetup(n),o=this.getOutput(n);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${i}

            setOutput(vec4(${o}));
          }
        }
      `}}getSourceCoordsArr(e){const n=[];for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){let i=`${s===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let o=2;o<this.rank;o++)i=`${e[e.length-1-o]},`+i;n.push(i)}return n}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let n="";for(let s=this.rank-2;s<this.rank;s++)n+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(n+="||");return n}getSetup(e){if(this.rank===1)return"";const n=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${n[0]};
      int c = ${n[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){const n=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${n[0]}),
            cEdge ? 0. : getA(${n[1]}),
            rEdge ? 0. : getA(${n[2]}),
            rEdge || cEdge ? 0. : getA(${n[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uH{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=Is(this.outputShape.length);let s="";for(let r=0;r<4;r++){let i="thisRC = rc;";r%2===1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),s+=`
        ${i}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${uIe(n,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?iR():rR(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function uIe(t,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?SSe(["r","c","d"],"inputShape"):Oc(["r","c","d"],t)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cIe{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,n,s){const r=dF(n,s),i=fF(e,r,s);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const o=hF(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const l=this.freeTextures[i].pop();return this.usedTextures[i].push(l),l}let a;return r===is.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===is.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===is.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===is.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===is.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(a),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),a}releaseTexture(e,n,s,r){if(this.freeTextures==null)return;const i=dF(s,r),o=fF(n,i,r);o in this.freeTextures||(this.freeTextures[o]=[]);const a=hF(n,i,this.gpgpu.gl,this.gpgpu.textureConfig,r),l=Z().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const u=this.usedTextures[o],c=u&&u.indexOf(e);if(c==null||c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u[c]=u[u.length-1],u.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const n=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*n)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function hIe(t,e){const n=t;if(e===n.R32F)return 4;if(e===n.R16F)return 2;if(e===n.RGBA32F)return 16;if(e===t.RGBA)return 16;if(e===n.RGBA16F)return 8;if(e===n.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function hF(t,e,n,s,r){const i=dIe(e,s);let o;if(r){const[l,u]=Cf(t[0],t[1]);o=l*u}else{const[l,u]=Vy(t[0],t[1]);o=l*u}const a=hIe(n,i);return o*a}function dIe(t,e){switch(t){case is.PACKED_2X2_FLOAT32:return cR(e);case is.PACKED_2X2_FLOAT16:return hR(e);case is.UNPACKED_FLOAT32:return aR(e);case is.UNPACKED_FLOAT16:return lR(e);case is.PACKED_4X1_UNSIGNED_BYTE:return uR(e);default:throw new Error(`Unknown physical texture type ${t}`)}}function fIe(t){return Z().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?is.PACKED_2X2_FLOAT32:is.UNPACKED_FLOAT32:t?is.PACKED_2X2_FLOAT16:is.UNPACKED_FLOAT16}function dF(t,e){if(t===Dr.UPLOAD)return is.PACKED_2X2_FLOAT32;if(t===Dr.RENDER||t==null)return fIe(e);if(t===Dr.DOWNLOAD||t===Dr.PIXELS)return is.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function fF(t,e,n){return`${t[0]}_${t[1]}_${e}_${n}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lo{constructor(e,n){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=Is(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${n}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const fi="if (isnan(x)) return x;",pIe="return x;",pF="return abs(x);",mIe="return (x >= 0.0) ? x : (exp(x) - 1.0);",gIe=fi+`
  return (x < 0.0) ? 0.0 : x;
`,yIe=fi+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Wa="return x;",vIe="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wIe="return x;",xIe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,bIe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,SIe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,CIe="return 1.0 / (1.0 + exp(-1.0 * x));";class sl{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=Is(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${n}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class IIe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=Is(this.outputShape.length);const n=e.length,s=Ds("rc",n),r=At(n),i=aIe(n,s),o=s.slice(-2),a=n<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${i});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _Ie=S1,TIe=1e-7,kIe=1e-4,j0={};function EIe(t){return t in j0||(j0[t]={}),j0[t]}const NIe=Z().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),$Ie=600;function RIe(){return Z().global.screen==null?1024:Z().global.screen.height*Z().global.screen.width*window.devicePixelRatio*$Ie/1024/1024}class Wy extends Mx{nextDataId(){return Wy.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!Z().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let n;if(e!=null){if(e instanceof wv)n=e;else{const s=Gi(Z().getNumber("WEBGL_VERSION"),e);n=new wv(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=Gi(Z().getNumber("WEBGL_VERSION"));n=new wv(s),this.binaryCache=EIe(Z().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=n,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new cIe(this.gpgpu),this.numMBBeforeWarning=RIe(),this.texData=new jk(this,xi())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,n,s,r,i,o){const a=this.makeTensorInfo(n,s),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[r,i]},l.texShape=[r,i];const u=bp(n),c=new cF(u,!1,o),h=this.runWebGLProgram(c,[a],s,[[r,i]]);return h.shape=n,l.texture=null,this.disposeIntermediateTensorInfo(a),h.dataId}write(e,n,s){if((Z().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||Z().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:n,dtype:s,values:e,usage:Dr.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const n=this.texData.get(e);n.refCount++}decRef(e){if(this.texData.has(e)){const n=this.texData.get(e);n.refCount--}}move(e,n,s,r,i){if(Z().getBool("DEBUG")&&this.checkNumericalProblems(n),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:r,values:n,usage:Dr.UPLOAD,refCount:i})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const n=this.texData.get(e),{values:s,dtype:r,complexTensorInfos:i,slice:o,shape:a,isPacked:l}=n;if(o!=null){let d;l?d=new sl(a,Wa):d=new lo(a,Wa);const f=this.runWebGLProgram(d,[{dataId:e,shape:a,dtype:r}],r),p=this.readSync(f.dataId);return this.disposeIntermediateTensorInfo(f),p}if(s!=null)return this.convertAndCacheOnCPU(e);if(r==="string")return s;const u=this.activeTimers!=null;let c;u&&(c=ns());let h;if(r==="complex64"){const d=this.readSync(i.real.dataId),f=this.readSync(i.imag.dataId);h=pa(d,f)}else h=this.getValuesFromTexture(e);return u&&(this.downloadWaitMs+=ns()-c),this.convertAndCacheOnCPU(e,h)}async read(e){if(this.pendingRead.has(e)){const p=this.pendingRead.get(e);return new Promise(m=>p.push(m))}const n=this.texData.get(e),{values:s,shape:r,slice:i,dtype:o,complexTensorInfos:a,isPacked:l}=n;if(i!=null){let p;l?p=new sl(r,Wa):p=new lo(r,Wa);const m=this.runWebGLProgram(p,[{dataId:e,shape:r,dtype:o}],o),v=this.read(m.dataId);return this.disposeIntermediateTensorInfo(m),v}if(s!=null)return this.convertAndCacheOnCPU(e);if(Z().getBool("DEBUG")&&!Z().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&Z().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u=null,c;if(o!=="complex64"&&Z().get("WEBGL_BUFFER_SUPPORTED")){c=this.decode(e);const p=this.texData.get(c.dataId);u=this.gpgpu.createBufferFromTexture(p.texture.texture,...U0(r))}this.pendingRead.set(e,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let h;if(o==="complex64"){const p=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),m=p[0],v=p[1];h=pa(m,v)}else if(u==null)h=this.getValuesFromTexture(e);else{const p=re(r);h=this.gpgpu.downloadFloat32MatrixFromBuffer(u,p)}if(c!=null&&this.disposeIntermediateTensorInfo(c),u!=null){const p=this.gpgpu.gl;be(p,()=>p.deleteBuffer(u))}const d=this.convertAndCacheOnCPU(e,h),f=this.pendingRead.get(e);return this.pendingRead.delete(e),f.forEach(p=>p(d)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&xi().removeDataId(e,this),this.pendingDeletes--),d}readToGPU(e,n={}){const s=this.texData.get(e),{values:r,shape:i,slice:o,dtype:a,isPacked:l,texture:u}=s;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(o!=null){let f;l?f=new sl(i,Wa):f=new lo(i,Wa);const p=this.runWebGLProgram(f,[{dataId:e,shape:i,dtype:a}],a),m=this.readToGPU(p,n);return this.disposeIntermediateTensorInfo(p),m}if(u==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const c=this.decode(e,n.customTexShape),h=xi().makeTensorFromTensorInfo(c),d=this.texData.get(c.dataId);return Object.assign({tensorRef:h},d.texture)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const s=n.map(r=>ca(r));return Xe(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Xe(e.shape,e.dtype,n)}checkNumericalProblems(e){if(e!=null)for(let n=0;n<e.length;n++){const s=e[n];if(!pG(s))throw Z().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:n,dtype:s,isPacked:r}=this.texData.get(e),i=re(n);if(Z().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const d=this.decode(e),f=this.texData.get(d.dataId),p=this.gpgpu.downloadMatrixFromPackedTexture(f.texture.texture,...U0(n)).subarray(0,i);return this.disposeIntermediateTensorInfo(d),p}const o=Z().getBool("WEBGL_PACK")&&r===!0,a=o?bp(n):n,l=o?new hCe(a):new cCe(a),u=this.runWebGLProgram(l,[{shape:a,dtype:s,dataId:e}],"float32"),c=this.texData.get(u.dataId),h=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(c.texture.texture,c.texShape[0],c.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(u),h}timerAvailable(){return Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const n=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,e();const i=bo(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),o=bo(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=n,r&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(i);a.kernelMs=N4(l),a.getExtraProfileInfo=()=>l.map((u,c)=>({name:o[c],ms:u})).map(u=>`${u.name}: ${u.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:ns(),endMs:null}}endTimer(e){return Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=ns(),e)}async getQueryTime(e){if(Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const n=e;return n.endMs-n.startMs}disposeData(e,n=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(n?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!n&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,n),this.disposeData(s.imag.dataId,n)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:n,dtype:s,texShape:r,usage:i,isPacked:o,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,u=this.dataRefCount.get(l);u>1?this.dataRefCount.set(l,u-1):(this.dataRefCount.delete(l),n!=null&&(this.numBytesInGPU-=this.computeBytes(r,s),this.textureManager.releaseTexture(n,r,i,o)));const c=this.texData.get(e);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,n=NIe){return Z().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&re(s.shape)<n)}getGPGPUContext(){return this.gpgpu}where(e){Nr("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const n=e.dataSync();return _Ie(e.shape,n)}packedUnaryOp(e,n,s){const r=new sl(e.shape,n),i=this.compileAndRun(r,[e],s);return xi().makeTensorFromTensorInfo(i)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const r=oH(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,r)}if(Z().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,pF,e.dtype);const n=new lo(e.shape,pF),s=this.compileAndRun(n,[e]);return xi().makeTensorFromTensorInfo(s)}makeTensorInfo(e,n,s){let r;if(n==="string"&&s!=null&&s.length>0&&ao(s[0])){const i=s.map(o=>go(o));r=this.write(i,e,n)}else r=this.write(s,e,n);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:n}}makeOutput(e,n,s){return xi().makeTensorFromTensorInfo(this.makeTensorInfo(e,n,s),this)}unpackTensor(e){const n=new IIe(e.shape);return this.runWebGLProgram(n,[e],e.dtype)}packTensor(e){const n=new lIe(e.shape);return this.runWebGLProgram(n,[e],e.dtype,null,!0)}packedReshape(e,n){const s=[lc(e.shape),...uc(e.shape)],r={dtype:e.dtype,shape:s,dataId:e.dataId},i=[lc(n),...uc(n)],o=new uH(i,s),a=!0,l=[s],u=this.runWebGLProgram(o,[r],e.dtype,l,a);return{dataId:u.dataId,shape:n,dtype:u.dtype}}decode(e,n){const s=this.texData.get(e),{isPacked:r,shape:i,dtype:o}=s;if(n!=null){const d=re(i),f=n[0]*n[1]*4;O(d<=f,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=bp(i);let l;r?l=new uCe(a):l=new lCe(a);const u=!0,c=[n??U0(a)],h=this.runWebGLProgram(l,[{shape:a,dtype:o,dataId:e}],o,c,u,n);return{dtype:o,shape:i,dataId:h.dataId}}runWebGLProgram(e,n,s,r,i=!1,o){const a=this.makeTensorInfo(e.outputShape,s),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===Dm.DENSE){const g=o??U0(e.outputShape);l.texShape=g.map(w=>w*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),re(a.shape)===0)return l.values=qn(a.dtype,0),a;const u=[],c=n.map(g=>{if(g.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let w=this.texData.get(g.dataId);if(w.texture==null){if(!e.packedInputs&&re(g.shape)<=Z().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:g.shape,texData:null,isUniform:!0,uniformValues:w.values};e.packedInputs&&(w.isPacked=!0,w.shape=g.shape)}if(this.uploadToGPU(g.dataId),!!w.isPacked!=!!e.packedInputs)g=w.isPacked?this.unpackTensor(g):this.packTensor(g),u.push(g),w=this.texData.get(g.dataId);else if(w.isPacked&&!Om(w.shape,g.shape)){const b=g,x=g.shape;g.shape=w.shape,g=this.packedReshape(g,x),u.push(g),w=this.texData.get(g.dataId),b.shape=x}return{shape:g.shape,texData:w,isUniform:!1}});this.uploadToGPU(a.dataId);const h={shape:a.shape,texData:l,isUniform:!1},d=aCe(e,c,h),f=this.getAndSaveBinary(d,()=>iCe(this.gpgpu,e,c,h)),p=this.activeTimers!=null;let m;p&&(m=this.startTimer()),Z().get("ENGINE_COMPILE_ONLY")||oCe(this.gpgpu,f,c,h,r),u.forEach(g=>this.disposeIntermediateTensorInfo(g)),p&&(m=this.endTimer(m),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(m)}));const v=Z().getNumber("WEBGL_FLUSH_THRESHOLD");if(v>0){const g=ns();g-this.lastGlFlushTime>v&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=g)}if(!Z().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&i===!1){const g=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),g}return a}compileAndRun(e,n,s,r,i=!1){return s=s||n[0].dtype,this.runWebGLProgram(e,n,s,r,i)}getAndSaveBinary(e,n){return e in this.binaryCache||(this.binaryCache[e]=n()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(Z().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(n=>{this.gpgpu.deleteProgram(this.binaryCache[n].webGLProgram),delete this.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=J(()=>{if(!Z().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=Z().getBool("DEBUG");Z().set("DEBUG",!1);const n=this.abs(Le(1e-8)).dataSync()[0];if(Z().set("DEBUG",e),n>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?TIe:kIe}uploadToGPU(e){const n=this.texData.get(e),{shape:s,dtype:r,values:i,texture:o,usage:a,isPacked:l}=n;if(o!=null)return;const u=this.activeTimers!=null;let c;u&&(c=ns());let h=n.texShape;if(h==null&&(h=RG(s,l),n.texShape=h),i!=null){const d=bp(s);let f,p=h[1],m=h[0];const v=i instanceof Uint8Array||i instanceof Uint8ClampedArray;(l||!v)&&([p,m]=Cf(h[0],h[1])),l?f=new fCe(d,v):f=new cF(d,v);const g=v?[m,p]:h,w=this.makeTensorInfo(g,r),b=this.texData.get(w.dataId);v?b.usage=Dr.PIXELS:b.usage=Dr.UPLOAD,b.texShape=g,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(w.dataId),p,m,i);const x=[[m,p]],N=this.runWebGLProgram(f,[w],r,x,!0),I=this.texData.get(N.dataId);n.texShape=I.texShape,n.isPacked=I.isPacked,n.usage=I.usage,Z().get("ENGINE_COMPILE_ONLY")?this.disposeData(N.dataId):(n.texture=I.texture,n.values=null,this.texData.delete(N.dataId)),this.disposeIntermediateTensorInfo(w),u&&(this.uploadWaitMs+=ns()-c)}else{const d=this.acquireTexture(h,a,r,l);n.texture=d}}convertAndCacheOnCPU(e,n){const s=this.texData.get(e),{dtype:r}=s;return n!=null&&(s.values=AIe(n,r)),s.values}acquireTexture(e,n,s,r){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${i} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,n,r)}computeBytes(e,n){return e[0]*e[1]*vm(n)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,n]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(n));return Promise.all(e)}else{for(const[,n]of Object.entries(this.binaryCache)){const s=new Promise(r=>{try{this.checkCompletion_(n),r(!0)}catch(i){throw i}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await ON(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(sR(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:n,customUniformLocations:s,infLoc:r,nanLoc:i,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:l}=UG(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=n,e.customUniformLocations=s,e.infLoc=r,e.nanLoc=i,e.outShapeLocation=o,e.outShapeStridesLocation=a,e.outTexShapeLocation=l}}createTensorFromGPUData(e,n,s){e.channels=e.channels||"RGBA";const{texture:r,height:i,width:o,channels:a}=e,l=xi().backend;if(!l.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const u=l.writeTexture(r,n,s,i,o,a);return xi().makeTensorFromDataId(u,n,s,l)}}Wy.nextDataId=0;function AIe(t,e){if(e==="float32"||e==="complex64")return t;if(e==="int32"||e==="bool"){const n=e==="int32"?new Int32Array(t.length):new Uint8Array(t.length);for(let s=0;s<n.length;++s)n[s]=Math.round(t[s]);return n}else throw new Error(`Unknown dtype ${e}`)}/** @license See the LICENSE file. */const cH="4.22.0";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hH(){Z().set("WEBGL_FORCE_F16_TEXTURES",!0)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */eE()&&nE("webgl",()=>new Wy,2);const DIe={forceHalfFloat:hH};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fR=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class cc{constructor(e,n,s){this.variableNames=["A","B"],this.outputShape=Ge(n,s),this.enableShapeUniforms=Is(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fc=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class Nf{constructor(e,n,s,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Ge(n,s);const i=this.outputShape.length;this.enableShapeUniforms=Is(i);let o="";if(r)if(i===0||re(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          ${At(i)} coords = getOutputCoords();
        `,i===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=Ds("coords",i);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= outShape[${i} - 2];
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= outShape[${i} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= ${this.outputShape[i-2]};
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= ${this.outputShape[i-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${o}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xr(t){const{inputs:e,backend:n}=t,{x:s}=e;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const OIe={kernelName:Od,backendName:"webgl",kernelFunc:xr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eu(t){const{inputs:e,backend:n}=t,{real:s,imag:r}=e,i=n.makeTensorInfo(s.shape,"complex64"),o=n.texData.get(i.dataId),a=xr({inputs:{x:s},backend:n}),l=xr({inputs:{x:r},backend:n});return o.complexTensorInfos={real:a,imag:l},i}const PIe={kernelName:qx,backendName:"webgl",kernelFunc:eu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dH="return (a < 0.) ? b * a : a;",fH=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function FIe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{alpha:i}=s,o=n.makeTensorInfo([],"float32",xa(i,"float32")),a=Z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Nf(fH,r.shape,o.shape):new cc(dH,r.shape,o.shape),l=n.runWebGLProgram(a,[r,o],"float32");return n.disposeIntermediateTensorInfo(o),l}const LIe={kernelName:Tg,backendName:"webgl",kernelFunc:FIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pH="return (a < 0.) ? b * a : a;",mH=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function MIe(t){const{inputs:e,backend:n}=t,{x:s,alpha:r}=e,i=Z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Nf(mH,s.shape,r.shape):new cc(pH,s.shape,r.shape);return n.runWebGLProgram(i,[s,r],"float32")}const zIe={kernelName:Gg,backendName:"webgl",kernelFunc:MIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $f="if (isnan(x)) return x;";function mt({opSnippet:t,packedOpSnippet:e,cpuKernelImpl:n,dtype:s}){return({inputs:r,backend:i})=>{const{x:o}=r,a=i,l=s||o.dtype;if(a.shouldExecuteOnCPU([o])&&n!=null){const h=a.texData.get(o.dataId),d=n(h.values,l);return a.makeTensorInfo(o.shape,l,d)}const u=Z().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let c;return u?c=new sl(o.shape,e):c=new lo(o.shape,t),a.runWebGLProgram(c,[o],l)}}function ps({opSnippet:t,packedOpSnippet:e,checkOutOfBounds:n=!1,supportsComplex:s=!1,cpuKernelImpl:r,dtype:i}){return({inputs:o,backend:a})=>{const{a:l,b:u}=o,c=a;if(s&&l.dtype==="complex64"){const p=c.texData.get(l.dataId),m=c.texData.get(u.dataId),[v,g]=[[p.complexTensorInfos.real,m.complexTensorInfos.real],[p.complexTensorInfos.imag,m.complexTensorInfos.imag]].map(b=>{const[x,S]=b,N={dataId:x.dataId,dtype:x.dtype,shape:l.shape},I={dataId:S.dataId,dtype:S.dtype,shape:u.shape},C=new cc(t,l.shape,u.shape);return c.runWebGLProgram(C,[N,I],Xs(x.dtype,S.dtype))}),w=eu({inputs:{real:v,imag:g},backend:c});return c.disposeIntermediateTensorInfo(v),c.disposeIntermediateTensorInfo(g),w}const h=i||Xs(l.dtype,u.dtype);if((l.dtype==="string"||u.dtype==="string"||c.shouldExecuteOnCPU([l,u]))&&r!=null){const p=c.texData.get(l.dataId).values,m=c.texData.get(u.dataId).values,v=l.dtype==="string"?ma(p):p,g=l.dtype==="string"?ma(m):m,[w,b]=r(l.shape,u.shape,v,g,h),x=c.makeTensorInfo(b,h),S=c.texData.get(x.dataId);return S.values=w,x}const d=Z().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let f;return d?f=new Nf(e,l.shape,u.shape,n):f=new cc(t,l.shape,u.shape),c.runWebGLProgram(f,[l,u],h)}}function Pm(t,e=!1){if(t==="linear")return e?wIe:pIe;if(t==="relu")return e?bIe:gIe;if(t==="elu")return e?xIe:mIe;if(t==="relu6")return e?SIe:yIe;if(t==="prelu")return e?mH:pH;if(t==="leakyrelu")return e?fH:dH;if(t==="sigmoid")return e?CIe:vIe;throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gH{constructor(e,n,s,r=!1,i=!1,o=!1,a=null,l=!1,u=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=Is(this.outputShape.length);const c=r?e[1]:e[2],h=Math.ceil(c/2),d=r?"i * 2, rc.y":"rc.y, i * 2",f=i?"rc.z, i * 2":"i * 2, rc.z",p=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let v="",g="";a&&(l?v=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:u?v=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:v=`vec4 activation(vec4 x) {
          ${a}
        }`,g="result = activation(result);");const w=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");let b="rc.x",x="rc.x";e[0]<n[0]?b=`imod(rc.x, ${e[0]})`:n[0]<e[0]&&(x=`imod(rc.x, ${n[0]})`),this.userCode=`
      ${v}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${h}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${b};
        int batchB = ${x};
        for (int i = 0; i < ${h}; i++) {
          vec4 a = getMatrixA(batchA, ${d});
          vec4 b = getMatrixB(batchB, ${f});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${p[0]} * ${m[0]});
          result += (${p[1]} * ${m[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${w}

        ${g}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mF={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class gF{constructor(e,n,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Ge(n,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yF="return a * b;";function pR(t){const{inputs:e,backend:n}=t,{a:s,b:r}=e,i=Xs(s.dtype,r.dtype);if(s.dtype==="complex64"){const a=n.texData.get(s.dataId),l=n.texData.get(r.dataId),u=new gF(mF.REAL,s.shape,r.shape),c=new gF(mF.IMAG,s.shape,r.shape),h=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:r.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:r.shape}],d=n.runWebGLProgram(u,h,"float32"),f=n.runWebGLProgram(c,h,"float32"),p=eu({inputs:{real:d,imag:f},backend:n});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),p}if(n.shouldExecuteOnCPU([s,r])){const a=n.texData.get(s.dataId),l=n.texData.get(r.dataId),[u,c]=LCe(s.shape,r.shape,a.values,l.values,i),h=n.makeTensorInfo(c,i),d=n.texData.get(h.dataId);return d.values=u,h}let o;return Z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new Nf(yF,s.shape,r.shape):o=new cc(yF,s.shape,r.shape),n.runWebGLProgram(o,[s,r],i)}const BIe={kernelName:Wd,backendName:"webgl",kernelFunc:pR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VIe(t,e,n){const s=[lc(t.shape),...uc(t.shape)],r={dtype:t.dtype,shape:s,dataId:t.dataId},i=[lc(e),...uc(e)],o=new uH(i,s),a=!0,l=[s],u=n.runWebGLProgram(o,[r],t.dtype,l,a);return{dataId:u.dataId,shape:e,dtype:u.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{shape:i}=s,o=n,a=re(r.shape),l=Hk(i,a),u=re(l);O(a===u,()=>`The new shape (${l}) has ${u} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const c=o.texData.get(r.dataId);return c.isPacked&&!Om(r.shape,l)&&!(c.texture!==null&&Om(c.shape,l))?VIe(r,l,o):(o.incRef(r.dataId),{dataId:r.dataId,shape:l,dtype:r.dtype})}const UIe={kernelName:qg,backendName:"webgl",kernelFunc:xe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vF{constructor(e,n){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:o}=e;this.outputShape=[r,o];const a=Math.floor(s/4)*4,l=s%4;let u="sumValue += dot(values, ones);";if(n!=null){const h=1/n;u=`sumValue += dot(values * ${qu(h)?h.toPrecision(2):h}, ones);`}let c="";i%s>0&&(c=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${c}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${u}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${u}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${u}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${u}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WIe{constructor(e,n){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:o}=e;this.outputShape=[r,o];let a="0.0",l="";n==="prod"?a="1.0":n==="min"?(a="1.0 / 1e-20",l="min"):n==="max"&&(a="-1.0 / 1e-20",l="max");let u=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="sum"?u="sumValue":n==="prod"?u="prodValue":n==="all"?u="allValue":n==="any"&&(u="anyValue");const c=Math.floor(s/4)*4,h=s%4;let d=`
      if (${n==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${n==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${n==="min"} || ${n==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,f="vec4";n==="all"?(a="1.0",d=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):n==="any"&&(a="0.0",d=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");let p="";i%s>0&&(p=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${d}
        }

        int inIdx = inOffset + ${c};
        if (${h===1}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${d}
        } else if (${h===2}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${d}
        } else if (${h===3}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${d}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jIe(t){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const n=e.length?e[e.length-1].outSize:t[1],s=O1(n);e.push({inSize:n,windowSize:s,outSize:Math.ceil(n/s)})}return e}function Lc(t,e,n,s){const r=jIe(t.shape);let i=t;for(let o=0;o<r.length;o++){const{inSize:a,windowSize:l,outSize:u}=r[o];let c,h;n==="mean"?c=o===0?new vF({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:u},a):new vF({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:u}):c=new WIe({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:u},n),h=i,i=s.runWebGLProgram(c,[i],e),h.dataId!==t.dataId&&s.disposeIntermediateTensorInfo(h)}return i}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GIe{constructor(e,n){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[n[o]];this.outputShape=s,this.rank=s.length;const r=At(this.rank),i=HIe(n);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${i}));
    }
    `}}function HIe(t){const e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let r=0;r<t.length;r++)s[t[r]]=n[r];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qIe{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let c=0;c<s.length;c++)s[c]=e[n[c]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=At(this.rank),i=lH("rc",this.rank),o=new Array(this.rank);for(let c=0;c<n.length;c++)o[n[c]]=i[c];const a=`vec2(${o.slice(-2).join()})`,l=`++${i[this.rank-1]} < ${s[this.rank-1]}`,u=`getChannel(getA(${o.join()}), ${a})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${u};
      if(${l}) {
        result[1] = ${u};
      }
      --${i[this.rank-1]};
      if(++${i[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${u};
        if(${l}) {
          result[3] = ${u};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oS(t,e,n){const s=Z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new qIe(t.shape,e):new GIe(t.shape,e);return n.runWebGLProgram(s,[t],t.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KIe(t,e,n,s){const r=e,i=t.shape.length,o=Ze(r,t.shape);let a=o;const l=on(a,i),u=l!=null;let c=t;u&&(c=oS(t,l,s),a=bn(a.length,i)),ds("sum",a,i);const[h,d]=Qn(c.shape,a);let f=h;n&&(f=xn(h,o));const p=re(d),v=re(t.shape)/p,g=xe({inputs:{x:c},attrs:{shape:[v,p]},backend:s}),w=qb(t.dtype),b=Lc(g,w,"sum",s),x=xe({inputs:{x:b},attrs:{shape:f},backend:s});return s.disposeIntermediateTensorInfo(g),s.disposeIntermediateTensorInfo(b),u&&s.disposeIntermediateTensorInfo(c),x}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aS(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;return KIe(r,i,o,n)}const XIe={kernelName:Zg,backendName:"webgl",kernelFunc:aS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fs(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{perm:i}=s,o=n,a=r.shape.length,l=new Array(a);for(let c=0;c<l.length;c++)l[c]=r.shape[i[c]];let u;if(o.shouldExecuteOnCPU([r])){const h=o.texData.get(r.dataId).values,d=dR(h,r.shape,r.dtype,i,l);u=o.makeTensorInfo(l,r.dtype);const f=o.texData.get(u.dataId);f.values=d}else u=oS(r,i,o);return u}const YIe={kernelName:Au,backendName:"webgl",kernelFunc:Fs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yH=1e3;function Kw({a:t,b:e,transposeA:n,transposeB:s,backend:r,bias:i=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:l=null}){const u=t.shape.length,c=e.shape.length,h=n?t.shape[u-2]:t.shape[u-1],d=s?e.shape[c-1]:e.shape[c-2],f=n?t.shape[u-1]:t.shape[u-2],p=s?e.shape[c-2]:e.shape[c-1],m=t.shape.slice(0,-2),v=e.shape.slice(0,-2),g=re(m),w=re(v),x=Ge(t.shape.slice(0,-2),e.shape.slice(0,-2)).concat([f,p]);O(h===d,()=>`Error in matMul: inner shapes (${h}) and (${d}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${n} and transposeB=${s} must match.`);const S=n?[g,h,f]:[g,f,h],N=s?[w,p,d]:[w,d,p],I=xe({inputs:{x:t},backend:r,attrs:{shape:S}}),C=xe({inputs:{x:e},backend:r,attrs:{shape:N}}),_=[I,C],k=Math.max(g,w),A=n?I.shape[1]:I.shape[2],D=i!=null,R=o!=null,W=l==="leakyrelu",B=l!=null?Pm(l,!0):null,M=D||R||W||B!=null;let X;if((f===1||p===1)&&A>yH&&M===!1){let Y=I,L=C;n&&(Y=Fs({inputs:{x:I},backend:r,attrs:{perm:[0,2,1]}}),_.push(Y)),s&&(L=Fs({inputs:{x:C},backend:r,attrs:{perm:[0,2,1]}}),_.push(L));const le=p!==1,Q=p===1;let se=Y;le&&(se=xe({inputs:{x:Y},backend:r,attrs:{shape:[k,A,1]}}),_.push(se));const de=p===1?2:1;let ue=L;Q&&(ue=xe({inputs:{x:L},backend:r,attrs:{shape:[k,1,A]}}),_.push(ue));const fe=pR({inputs:{a:se,b:ue},backend:r});X=aS({inputs:{x:fe},backend:r,attrs:{axis:de,keepDims:!0}}),_.push(fe)}else{const Y=Xs(t.dtype,e.dtype),L=new gH(S,N,[k,f,p],n,s,D,B,R,W),le=[I,C];if(i!=null&&le.push(i),R&&le.push(o),W){const Q=r.makeTensorInfo([],"float32",xa(a,"float32"));le.push(Q),_.push(Q)}X=r.runWebGLProgram(L,le,Y)}const z=xe({inputs:{x:X},backend:r,attrs:{shape:x}});_.push(X);for(const Y of _)r.disposeIntermediateTensorInfo(Y);return z}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QIe(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:c,leakyreluAlpha:h}=s;return Kw({a:r,b:i,transposeA:l,transposeB:u,backend:n,bias:o,preluActivationWeights:a,leakyreluAlpha:h,activation:c})}const JIe={kernelName:wm,backendName:"webgl",kernelFunc:QIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wF="return abs(x);";function ZIe(t){const{inputs:e,backend:n}=t,{x:s}=e;if(n.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const i=n.texData.get(s.dataId),o=oH(i.values);return n.makeTensorInfo(s.shape,s.dtype,o)}let r;return Z().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new sl(s.shape,wF):r=new lo(s.shape,wF),n.runWebGLProgram(r,[s],s.dtype)}const e_e={kernelName:rg,backendName:"webgl",kernelFunc:ZIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t_e=fi+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,n_e=mt({opSnippet:t_e}),s_e={kernelName:pd,backendName:"webgl",kernelFunc:n_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r_e=fi+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,i_e=mt({opSnippet:r_e}),o_e={kernelName:md,backendName:"webgl",kernelFunc:i_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xF="return a + b;",a_e=ps({opSnippet:xF,packedOpSnippet:xF,supportsComplex:!0,cpuKernelImpl:gCe}),l_e={kernelName:Sc,backendName:"webgl",kernelFunc:a_e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class u_e{constructor(e,n){this.outputShape=[],this.outputShape=e,this.variableNames=n.map((i,o)=>`T${o}`);const s=[];this.variableNames.forEach(i=>{s.push(`float v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class c_e{constructor(e,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=n.map((i,o)=>`T${o}`);const s=[];this.variableNames.forEach(i=>{s.push(`vec4 v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xv(t){const{inputs:e,backend:n}=t,s=e;if(s.length===1)return xr({inputs:{x:s[0]},backend:n});if(s.length>Z().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(s.length/2),u=xv({inputs:s.slice(0,l),backend:n}),c=xv({inputs:s.slice(l),backend:n});return xv({inputs:[u,c],backend:n})}const r=s.map(l=>l.dtype).reduce((l,u)=>Xs(l,u)),i=s.map(l=>l.shape),a=Z().getBool("WEBGL_PACK")?new c_e(s[0].shape,i):new u_e(s[0].shape,i);return n.runWebGLProgram(a,s,r)}const h_e={kernelName:ig,backendName:"webgl",kernelFunc:xv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d_e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=Ze(i,r.shape);let u=l;const c=on(u,a);let h=r;c!=null&&(h=Fs({inputs:{x:r},backend:n,attrs:{perm:c}}),u=bn(u.length,a)),ds("all",u,a);const[d,f]=Qn(h.shape,u),p=re(f),m=xe({inputs:{x:h},backend:n,attrs:{shape:[-1,p]}}),v=Lc(m,m.dtype,"all",n);let g;if(o){const w=xn(d,l);g=xe({inputs:{x:v},backend:n,attrs:{shape:w}})}else g=xe({inputs:{x:v},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),c!=null&&n.disposeIntermediateTensorInfo(h),g}const f_e={kernelName:Vx,backendName:"webgl",kernelFunc:d_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p_e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=Ze(i,r.shape);let u=l;const c=on(u,a);let h=r;c!=null&&(h=Fs({inputs:{x:r},backend:n,attrs:{perm:c}}),u=bn(u.length,a)),ds("any",u,a);const[d,f]=Qn(h.shape,u),p=re(f),m=xe({inputs:{x:h},backend:n,attrs:{shape:[-1,p]}}),v=Lc(m,m.dtype,"any",n);let g;if(o){const w=xn(d,l);g=xe({inputs:{x:v},backend:n,attrs:{shape:w}})}else g=xe({inputs:{x:v},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),c!=null&&n.disposeIntermediateTensorInfo(h),g}const m_e={kernelName:Ux,backendName:"webgl",kernelFunc:p_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class g_e{constructor(e,n,s){this.variableNames=["A"];const{windowSize:r,batchSize:i,outSize:o}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];const a=n==="max"?">":"<",l=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class y_e{constructor(e,n,s,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,O(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const i=e[e.length-1],o=Math.ceil(i/n);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,u=At(l),c=Ds("coords",l);let h,d;if(o===1){d=l+1;const C=At(d);h=`
        ${C} sourceLocR = ${C}(${c.join()}, 0);
        ++${c[l-1]};
        ${C} sourceLocG = ${C}(${c.join()}, 0);
        ++${c[l-2]};
        ${C} sourceLocA = ${C}(${c.join()}, 0);
        --${c[l-1]};
        ${C} sourceLocB = ${C}(${c.join()}, 0);
        --${c[l-2]};`}else d=l,h=`
        ${u} sourceLocR = coords;
        ++${c[l-1]};
        ${u} sourceLocG = coords;
        ++${c[l-2]};
        ${u} sourceLocA = coords;
        --${c[l-1]};
        ${u} sourceLocB = coords;
        --${c[l-2]};`;const f=["x","y","z","w","u","v"].slice(0,d),p="."+f[d-1],m=f.map(C=>"int "+C),v=Ds("sourceLocR",d-1).concat("inIdx.r"),g=Ds("sourceLocG",d-1).concat("inIdx.g"),w=Ds("sourceLocB",d-1).concat("inIdx.b"),b=Ds("sourceLocA",d-1).concat("inIdx.a"),x=s==="max"?"greaterThan":"lessThan",S=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${v.join()}),
                             getBestIndicesAChannel(${g.join()}),
                             getBestIndicesAChannel(${w.join()}),
                             getBestIndicesAChannel(${b.join()})));`,N=`vec4(
            getAChannel(${v.join()}),
            hasNextCol ? getAChannel(${g.join()}) : 0.,
            hasNextRow ? getAChannel(${w.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${b.join()}) : 0.)`,I=r?"":`
      float getBestIndicesAChannel(${m.join()}) {
        return getChannel(getBestIndicesA(${f.join()}),
                                          vec2(${f.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${m.join()}) {
        return getChannel(getA(${f.join()}),
                               vec2(${f.slice(-2).join()}));
      }
      ${I}
      void main() {
        ${u} coords = getOutputCoords();
        bool hasNextCol = ${c[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${c[l-2]} < ${a[l-2]-1};
        ${h}
        ivec4 srcIdx = ivec4(sourceLocR${p}, sourceLocG${p},
          sourceLocB${p}, sourceLocA${p}) * ${n};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${N};

        for (int i = 0; i < ${n}; i++) {
          inIdx = srcIdx;
          ${S}
          vec4 candidate = ${N};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${x}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vH(t,e,n,s=null){let r=e.shape[0],i=e.shape[1];s!=null&&(r=s.shape[0],i=s.shape[1]);const o=O1(i),a={windowSize:o,inSize:i,batchSize:r,outSize:Math.ceil(i/o)},l=new g_e(a,n,s==null),u=[e];s!=null&&u.push(s);const c=t.runWebGLProgram(l,u,"int32");if(c.shape[1]===1)return c;const h=vH(t,e,n,c);return t.disposeIntermediateTensorInfo(c),h}function wH(t,e,n,s=null){const r=s!=null?s.shape:e.shape,i=r[r.length-1],o=O1(i),a=new y_e(r,o,n,s==null),l=s==null?[e]:[e,s],u=t.runWebGLProgram(a,l,"int32");if(u.shape.length===e.shape.length){const c=wH(t,e,n,u);return t.disposeIntermediateTensorInfo(u),c}return u}function xH(t,e,n,s){const r=[n];if(ds("arg"+s.charAt(0).toUpperCase()+s.slice(1),r,e.shape.length),!Z().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const i=[],o=t.texData.get(e.dataId),a=o!==null&&o.isPacked;let l=e;a&&(l=t.unpackTensor(e),i.push(l));const[u,c]=Qn(l.shape,r),h=re(c),d=xe({inputs:{x:l},backend:t,attrs:{shape:[-1,h]}});i.push(d);const f=vH(t,d,s);i.push(f);const p=xe({inputs:{x:f},backend:t,attrs:{shape:u}});return i.forEach(m=>t.disposeIntermediateTensorInfo(m)),p}return wH(t,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v_e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i}=s;let o=Ze(i,r.shape);const a=on(o,r.shape.length);let l=r;const u=[];a!=null&&(l=Fs({inputs:{x:r},backend:n,attrs:{perm:a}}),u.push(l),o=bn(o.length,l.shape.length)),ds("argMax",[o[0]],l.shape.length);const c=xH(n,l,o[0],"max");return u.forEach(h=>n.disposeIntermediateTensorInfo(h)),c}const w_e={kernelName:og,backendName:"webgl",kernelFunc:v_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x_e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i}=s;let o=Ze(i,r.shape);const a=on(o,r.shape.length);let l=r;const u=[];a!=null&&(l=Fs({inputs:{x:r},backend:n,attrs:{perm:a}}),u.push(l),o=bn(o.length,l.shape.length)),ds("argMin",[o[0]],l.shape.length);const c=xH(n,l,o[0],"min");return u.forEach(h=>n.disposeIntermediateTensorInfo(h)),c}const b_e={kernelName:ag,backendName:"webgl",kernelFunc:x_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S_e=fi+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,C_e=mt({opSnippet:S_e}),I_e={kernelName:gd,backendName:"webgl",kernelFunc:C_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const __e=fi+"return log(x + sqrt(x * x + 1.0));",T_e=mt({opSnippet:__e}),k_e={kernelName:yd,backendName:"webgl",kernelFunc:T_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E_e=fi+`
  return atan(x);
`,N_e=mt({opSnippet:E_e}),$_e={kernelName:vd,backendName:"webgl",kernelFunc:N_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R_e=fR+`
  return atan(a, b);
`,A_e=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Fc+`
  return result;
`,D_e=ps({opSnippet:R_e,packedOpSnippet:A_e}),O_e={kernelName:xd,backendName:"webgl",kernelFunc:D_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P_e=fi+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,F_e=mt({opSnippet:P_e}),L_e={kernelName:wd,backendName:"webgl",kernelFunc:F_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fm{constructor(e,n,s,r=!1,i=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideHeight,l=e.strideWidth,u=e.dilationHeight,c=e.dilationWidth,h=e.effectiveFilterHeight,d=e.effectiveFilterWidth,f=e.padInfo.top,p=e.padInfo.left;this.outputShape=e.outShape;const m=n==="avg",v=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,g=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let w="0.0";if(m||(w="-1.0 / 1e-20"),s){const C=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${f}, ${p});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${h};
              wR += ${u}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${d};
                wC += ${c}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${C} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?i?v:g:`wR * ${d} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const b="max";let x=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(x="avgValue / max(count, 1.0)");const S=Math.floor(o/4)*4,N=o%4,I=`
      if (${m}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${b}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${f}, ${p});
      const float initializationValue = ${w};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${w});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${h};
            wR += ${u}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${S}; wC += 4) {
            int xC = xCCorner + wC * ${c};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              getValue(batch, xR, xC + 2 * ${c}, d),
              getValue(batch, xR, xC + 3 * ${c}, d)
            );

            ${I}
          }

          int xC = xCCorner + ${S};
          if (${N===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${I}
          } else if (${N===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              initializationValue,
              initializationValue
            );

            ${I}
          } else if (${N===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              getValue(batch, xR, xC + 2 * ${c}, d),
              initializationValue
            );

            ${I}
          }
        }
        setOutput(${x});
      }
    `}}class mR{constructor(e,n,s,r=!1,i=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideDepth,l=e.strideHeight,u=e.strideWidth,c=e.dilationDepth,h=e.dilationHeight,d=e.dilationWidth,f=e.effectiveFilterDepth,p=e.effectiveFilterHeight,m=e.effectiveFilterWidth,v=e.padInfo.front,g=e.padInfo.top,w=e.padInfo.left;this.outputShape=e.outShape;const b=n==="avg";let x="0.0";if(b||(x="-1.0 / 1e-20"),s){const k=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${u});
        const ivec3 pads = ivec3(${v}, ${g}, ${w});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${f};
              wD += ${c}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${p};
                wR += ${h}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${m};
                  wC += ${d}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${k} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?i?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${p} * ${m} +
                      wR * ${m} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const S="max";let N=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(N="avgValue / max(count, 1.0)");const I=Math.floor(o/4)*4,C=o%4,_=`
      if (${b}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${S}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${u});
      const ivec3 pads = ivec3(${v}, ${g}, ${w});
      const float initializationValue = ${x};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${x});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${c}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p};
            wR += ${h}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${I}; wC += 4) {
              int xC = xCCorner + wC * ${d};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${d}, ch),
                getValue(batch, xD, xR, xC + 2 * ${d}, ch),
                getValue(batch, xD, xR, xC + 3 * ${d}, ch)
              );

              ${_}
            }

            int xC = xCCorner + ${I};
            if (${C===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${_}
            } else if (${C===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${d}, ch),
                initializationValue,
                initializationValue
              );

              ${_}
            } else if (${C===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${d}, ch),
                getValue(batch, xD, xR, xC + 2 * ${d}, ch),
                initializationValue
              );

              ${_}
            }
          }
        }
        setOutput(${N});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M_e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;If(r,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;O(hs(o,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const c=hi(r.shape,i,o,u,a,l);if(c.filterWidth===1&&c.filterHeight===1&&st(c.inShape,c.outShape))return xr({inputs:{x:r},backend:n});const h=new Fm(c,"avg",!1);return n.runWebGLProgram(h,[r],"float32")}const z_e={kernelName:lg,backendName:"webgl",kernelFunc:M_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B_e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=s,c=[1,1,1],h=ba(r.shape,i,o,c,a,l,u),d=new mR(h,"avg",!1);return n.runWebGLProgram(d,[r],"float32")}const V_e={kernelName:ug,backendName:"webgl",kernelFunc:B_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class U_e{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,u=e.effectiveFilterWidth,c=l-1-e.padInfo.top,h=u-1-e.padInfo.left,d=1/(n*s);this.userCode=`
      const ivec2 pads = ivec2(${c}, ${h});
      const float avgMultiplier = float(${d});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${u};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class W_e{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterDepth,s=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,h=e.effectiveFilterDepth,d=e.effectiveFilterHeight,f=e.effectiveFilterWidth,p=h-1-e.padInfo.front,m=d-1-e.padInfo.top,v=f-1-e.padInfo.left,g=1/(n*s*r);this.userCode=`
      const ivec3 pads = ivec3(${p}, ${m}, ${v});
      const float avgMultiplier = float(${g});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${h};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${i}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${d};
              wR += ${u}) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${f};
                wC += ${c}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j_e(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,o=i,{filterSize:a,strides:l,pad:u,dimRoundingMode:c}=s,h=[1,1,1],d=ba(o.shape,a,l,h,u,c),f=new W_e(d);return n.runWebGLProgram(f,[r],o.dtype)}const G_e={kernelName:jx,backendName:"webgl",kernelFunc:j_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H_e(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,o=i;If([r,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,c=hi(o.shape,a,l,1,u),h=new U_e(c);return n.runWebGLProgram(h,[r],o.dtype)}const q_e={kernelName:Wx,backendName:"webgl",kernelFunc:H_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K_e(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:i}=e,{transposeA:o,transposeB:a}=s;return Kw({a:r,b:i,transposeA:o,transposeB:a,backend:n})}const X_e={kernelName:cg,backendName:"webgl",kernelFunc:K_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Y_e{constructor(e,n,s,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],Ge(e,n),Ge(e,s);let a="0.0";r!=null&&(Ge(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";i!=null&&(Ge(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${o}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Q_e{constructor(e,n,s,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Ge(e,n),Ge(e,s);let a="vec4(0.0)";r!=null&&(Ge(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";i!=null&&(Ge(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${o}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J_e=({inputs:t,backend:e,attrs:n})=>{const{x:s,mean:r,variance:i,offset:o,scale:a}=t;O(r.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),O(o==null||r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),O(a==null||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=n;l==null&&(l=.001);const u=[s,r,i];let c=null;o!=null&&(c=o.shape,u.push(o));let h=null;a!=null&&(h=a.shape,u.push(a));const d=Z().getBool("WEBGL_PACK_NORMALIZATION")?new Q_e(s.shape,r.shape,i.shape,c,h,l):new Y_e(s.shape,r.shape,i.shape,c,h,l);return e.runWebGLProgram(d,u,u[0].dtype)},Z_e={kernelName:Cg,backendName:"webgl",kernelFunc:J_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eTe{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const n=At(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=tTe(this.rank);let r;const i=e.map((o,a)=>`sourceLoc.${V_[a]} = start[${a}] + coords.${V_[a]};`);r=`
        ${n} sourceLoc;
        ${n} coords = getOutputCoords();
        ${i.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${s}));
      }
    `}}const V_=["x","y","z","w","u","v"];function tTe(t){if(t===1)return"sourceLoc";if(t<=6)return V_.slice(0,t).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nTe{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=At(this.rank),s=Ds("coords",this.rank),r=Ds("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,o=`getChannel(getSource(${r.join()}), ${i})`,a=`
      result.x = ${o};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${o};
        --${r[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${o};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${o};
        }
      }
    `,u=this.rank<=4?`sourceLoc = coords +
            ${n}(${e.map((c,h)=>`start[${h}]`).join()});`:e.map((c,h)=>`${r[h]} = ${s[h]} + start[${h}];`).join(`
`);this.userCode=`
      void main() {
        ${n} coords = getOutputCoords();
        ${n} sourceLoc;
        ${u}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sTe(t,e,n,s){const r=s.texData.get(t.dataId),i=s.makeTensorInfo(n,t.dtype),o=s.texData.get(i.dataId);Object.assign(o,r),o.refCount=1,o.shape=n,o.dtype=t.dtype;let a=AN(e,Me(t.shape));r.slice&&(a+=r.slice.flatOffset),o.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||t.dataId};const l=s.dataRefCount.get(o.slice.origDataId)||1;return s.dataRefCount.set(o.slice.origDataId,l+1),i}function Rf(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:i,size:o}=s,[a,l]=D1(r,i,o);if(NN(r,a,l),re(l)===0)return n.makeTensorInfo(l,r.dtype,[]);if(n.shouldExecuteOnCPU([r])||r.dtype==="string"){const h=n.texData.get(r.dataId),d=KCe(h.values,a,l,r.shape,r.dtype);return n.makeTensorInfo(l,r.dtype,d)}const{isPacked:u}=n.texData.get(r.dataId),c=RN(r.shape,a,l);if(u||!c){const h=Z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new nTe(l):new eTe(l),d=[a];return n.runWebGLProgram(h,[r],r.dtype,d)}return n.uploadToGPU(r.dataId),sTe(r,a,l,n)}const rTe={kernelName:Jg,backendName:"webgl",kernelFunc:Rf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iTe=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:i,crops:o}=s;O(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((w,b)=>w*b),l=ky(r.shape,i,a),u=Ey(l.length,i.length),c=Ny(r.shape,i,a),h=MN(o,i.length),d=zN(c,o,i.length),f=[],p=xe({inputs:{x:r},backend:n,attrs:{shape:l}}),m=Fs({inputs:{x:p},backend:n,attrs:{perm:u}}),v=xe({inputs:{x:m},backend:n,attrs:{shape:c}}),g=Rf({inputs:{x:v},backend:n,attrs:{begin:h,size:d}});return f.push(p),f.push(m),f.push(v),f.forEach(w=>n.disposeIntermediateTensorInfo(w)),g},oTe={kernelName:hg,backendName:"webgl",kernelFunc:iTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aTe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:i}=e,{size:o}=s,a=n.readSync(r.dataId),l=n.readSync(i.dataId),u=iH(a,l,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,u)}const lTe={kernelName:Gx,backendName:"webgl",kernelFunc:aTe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uTe=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,cTe=`
  return float(int(a.r) & int(b.r));
`;function hTe(t){const{inputs:e,backend:n}=t,{a:s,b:r}=e,i=Z().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=Z().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([s,r])||o===1){const l=n.texData.get(s.dataId).values,u=n.texData.get(r.dataId).values,[c,h]=vCe(s.shape,r.shape,l,u,s.dtype),d=n.makeTensorInfo(h,s.dtype),f=n.texData.get(d.dataId);return f.values=c,d}let a;return i?a=new Nf(uTe,s.shape,r.shape,!1):a=new cc(cTe,s.shape,r.shape),n.runWebGLProgram(a,[s,r],s.dtype)}const dTe={kernelName:dg,backendName:"webgl",kernelFunc:hTe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fTe(t){const{inputs:e,backend:n}=t,{s0:s,s1:r}=e,i=n.readSync(s.dataId),o=n.readSync(r.dataId),a=Ge(Array.from(i),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const pTe={kernelName:Hx,backendName:"webgl",kernelFunc:fTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mTe="return float(a != b);",bH=ps({opSnippet:mTe,cpuKernelImpl:zCe,dtype:"bool"}),gTe={kernelName:Bg,backendName:"webgl",kernelFunc:bH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jy(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.texData.get(s.dataId);return xr({inputs:{x:r.complexTensorInfos.real},backend:n})}const yTe={kernelName:Tb,backendName:"webgl",kernelFunc:jy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vTe="return float(int(x));";function wTe(t,e){const n=new lo(t.shape,vTe),s=e.runWebGLProgram(n,[t],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U_(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return xr({inputs:{x:r},backend:n});const o=En(r.shape),a=U_({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),l=eu({inputs:{real:a,imag:o},backend:n});return o.dispose(),n.disposeIntermediateTensorInfo(a),l}if(r.dtype==="complex64"){const o=jy({inputs:{input:r},backend:n}),a=U_({inputs:{x:o},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(o),a}if(!qk(r.dtype,i)){const o=xr({inputs:{x:r},backend:n});return{dataId:o.dataId,shape:o.shape,dtype:i}}if(n.shouldExecuteOnCPU([r])){const o=n.texData.get(r.dataId).values,[a,l,u]=wCe(o,r.shape,r.dtype,i);return n.makeTensorInfo(a,l,u)}if(i==="int32")return wTe(r,n);if(i==="bool"){const o=n.makeTensorInfo([],"bool",qn("bool",1)),l=bH({inputs:{a:r,b:o},backend:n});return n.disposeIntermediateTensorInfo(o),l}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${i}`)}const xTe={kernelName:bd,backendName:"webgl",kernelFunc:U_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bF="return ceil(x);",bTe=mt({opSnippet:bF,packedOpSnippet:bF,cpuKernelImpl:xCe}),STe={kernelName:Sd,backendName:"webgl",kernelFunc:bTe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CTe{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ITe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Te(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{clipValueMin:i,clipValueMax:o}=s;let a;Z().getBool("WEBGL_PACK_CLIP")?a=new ITe(r.shape):a=new CTe(r.shape);const l=[[i],[o]];return n.runWebGLProgram(a,[r],r.dtype,l)}const TTe={kernelName:Cd,backendName:"webgl",kernelFunc:_Te};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kTe{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SF(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}function ETe(t){const{inputs:e,backend:n}=t,{x:s}=e,r=n.texData.get(s.dataId),i=new kTe(s.shape),o=[SF(s,r.complexTensorInfos.real),SF(s,r.complexTensorInfos.imag)];return n.runWebGLProgram(i,o,o[0].dtype)}const NTe={kernelName:fg,backendName:"webgl",kernelFunc:ETe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $Te{constructor(e){this.outputShape=[],this.outputShape=vo(e,1),this.variableNames=e.map((o,a)=>`T${a}`);const n=new Array(e.length-1);n[0]=e[0][1];for(let o=1;o<n.length;o++)n[o]=n[o-1]+e[o][1];const s=[`if (yC < ${n[0]}) setOutput(getT0(yR, yC));`];for(let o=1;o<n.length;o++){const a=n[o-1];s.push(`else if (yC < ${n[o]}) setOutput(getT${o}(yR, yC-${a}));`)}const r=n.length,i=n[n.length-1];s.push(`else setOutput(getT${r}(yR, yC-${i}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RTe{constructor(e,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=vo(e,n);const s=this.outputShape,r=s.length,i=At(r),o=Ds("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((m,v)=>`T${v}`);const l=new Array(e.length-1);l[0]=e[0][n];for(let m=1;m<l.length;m++)l[m]=l[m-1]+e[m][n];const u=a[n],c=a.slice(-2),h=a.join();let d=`if (${u} < ${l[0]}) {
        return getChannel(
            getT0(${h}), vec2(${c.join()}));
        }`;for(let m=1;m<l.length;m++){const v=l[m-1];d+=`
        if (${u} < ${l[m]}  && ${u} >= ${l[m-1]}) {
          return getChannel(
            getT${m}(${G0(a,u,v)}),
            vec2(${G0(c,u,v)}));
        }`}const f=l.length,p=l[l.length-1];d+=`
        return getChannel(
          getT${f}(${G0(a,u,p)}),
          vec2(${G0(c,u,p)}));`,this.userCode=`
      float getValue(${a.map(m=>"int "+m)}) {
        ${d}
      }

      void main() {
        ${i} coords = getOutputCoords();
        vec4 result = vec4(getValue(${o}), 0., 0., 0.);

        ${o[r-1]} = ${o[r-1]} + 1;
        if (${o[r-1]} < ${s[r-1]}) {
          result.g = getValue(${o});
        }

        ${o[r-2]} = ${o[r-2]} + 1;
        if (${o[r-2]} < ${s[r-2]}) {
          result.a = getValue(${o});
        }

        ${o[r-1]} = ${o[r-1]} - 1;
        if (${o[r-2]} < ${s[r-2]} &&
            ${o[r-1]} < ${s[r-1]}) {
          result.b = getValue(${o});
        }
        setOutput(result);
      }
    `}}function G0(t,e,n){const s=t.indexOf(e);return t.map((i,o)=>o===s?`${i} - ${n}`:i).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lS(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.texData.get(s.dataId);return xr({inputs:{x:r.complexTensorInfos.imag},backend:n})}const ATe={kernelName:db,backendName:"webgl",kernelFunc:lS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sp(t,e,n){const s=t[0].dtype;if(s==="complex64"){const f=t.map(w=>jy({inputs:{input:w},backend:n})),p=t.map(w=>lS({inputs:{input:w},backend:n})),m=Sp(f,e,n),v=Sp(p,e,n),g=eu({inputs:{real:m,imag:v},backend:n});return f.forEach(w=>n.disposeIntermediateTensorInfo(w)),p.forEach(w=>n.disposeIntermediateTensorInfo(w)),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),g}let r=n.shouldExecuteOnCPU(t);if(s==="string"&&(r=!0),r){const f=t.map(x=>{const N=[-1,re(x.shape.slice(e))];return xe({inputs:{x},backend:n,attrs:{shape:N}})}),p=f.map(x=>({vals:n.readSync(x.dataId),shape:x.shape})),m=vo(f.map(x=>x.shape),1),v=f[0].shape[0]===1,g=bCe(p,m,s,v),w=vo(t.map(x=>x.shape),e),b=n.makeTensorInfo(w,s,g);return f.forEach(x=>n.disposeIntermediateTensorInfo(x)),b}const i=t.filter(f=>re(f.shape)>0),o=Z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1;if(i.length===1){const f=o?new lo(t[0].shape,Wa):new sl(t[0].shape,Wa);return n.runWebGLProgram(f,t,s)}const a=Z().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(i.length>a){const f=[];for(let m=0;m<i.length;m+=a){const v=i.slice(m,m+a);f.push(Sp(v,e,n))}const p=Sp(f,e,n);for(const m of f)n.disposeIntermediateTensorInfo(m);return p}if(o){const f=new RTe(i.map(p=>p.shape),e);return n.runWebGLProgram(f,i,s)}const{tensors2D:l,outShape:u}=DTe(i,e,n),c=new $Te(l.map(f=>f.shape)),h=n.runWebGLProgram(c,l,s);l.forEach(f=>n.disposeIntermediateTensorInfo(f));const d=xe({inputs:{x:h},attrs:{shape:u},backend:n});return n.disposeIntermediateTensorInfo(h),d}function DTe(t,e,n){const s=vo(t.map(i=>i.shape),e);return{tensors2D:t.map(i=>xe({inputs:{x:i},attrs:{shape:[-1,re(i.shape.slice(e))]},backend:n})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SH(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s,i=Ze(r,e[0].shape)[0],o=e.map(u=>u.shape);PN(o,i);const a=vo(e.map(u=>u.shape),i);if(re(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(u=>re(u.shape)>0);return l.length===1?xr({inputs:{x:l[0]},backend:n}):Sp(l,i,n)}const OTe={kernelName:pg,backendName:"webgl",kernelFunc:SH};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CH{constructor(e,n=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const o=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,u=e.strideWidth,c=e.dilationHeight,h=e.dilationWidth,d=e.filterHeight,f=e.filterWidth,p=Math.floor(e.inChannels/4)*4,m=e.inChannels%4,v=e.dataFormat==="channelsLast",g=v?1:2,w=v?2:3,b=v?3:1;let x="",S="";s&&(r?x=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?x=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:x=`
          float activation(float x) {
            ${s}
          }
        `,S="result = activation(result);");const N=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${x}

      const ivec2 strides = ivec2(${l}, ${u});
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${b}];

        ivec2 xRCCorner =
            ivec2(coords[${g}], coords[${w}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${d}; wR++) {
          int xR = xRCorner + wR * ${c};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${f}; wC++) {
            int xC = xCCorner + wC * ${h};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${p}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${v}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${m===1}) {

              if (${v}) {
                dotProd +=
                    getX(batch, xR, xC, ${p}) *
                    getW(wR, wC, ${p}, d2);
              } else {
                dotProd +=
                    getX(batch, ${p}, xR, xC) *
                    getW(wR, wC, ${p}, d2);
              }

            } else if (${m===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2)
              );

              if (${v}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${m===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2),
                getW(wR, wC, ${p} + 2, d2)
              );

              if (${v}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1),
                  getX(batch, xR, xC, ${p} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC),
                  getX(batch, ${p} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${N}
        ${S}
        setOutput(result);
      }
    `}}class PTe{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const n=e.padInfo.front,s=e.padInfo.top,r=e.padInfo.left,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,h=e.filterDepth,d=e.filterHeight,f=e.filterWidth,p=Math.floor(e.inChannels/4)*4,m=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${i}, ${o}, ${a});
      const ivec3 pads = ivec3(${n}, ${s}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${h}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${d}; wR++) {
            int xR = xRCorner + wR * ${u};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f}; wC++) {
              int xC = xCCorner + wC * ${c};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${p}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${m===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${p}) *
                  getW(wF, wR, wC, ${p}, d2);
              } else if (${m===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${m===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1),
                  getX(batch, xF, xR, xC, ${p} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2),
                  getW(wF, wR, wC, ${p} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class IH{constructor(e,n=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Is(this.outputShape.length);const o=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,u=e.filterHeight,c=e.filterWidth,h=c;let d=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let v=0;v<c;v++)d+=`
           vec4 xTexelC${v*2};
           int xTexelC${v*2}Ready;
           vec4 xTexelC${v*2+1};
           int xTexelC${v*2+1}Ready;
           vec4 xC${v};`;d+=`
     for (int r = 0; r < ${u}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let v=0;v<c;v++)d+=`
           xTexelC${v*2} = vec4(0.0);
           xTexelC${v*2}Ready = 0;
           xTexelC${v*2+1} = vec4(0.0);
           xTexelC${v*2+1}Ready = 0;
           xC${v} = vec4(0.0);`;d+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let v=0;v<(h+1)/2;v++){const g=v*2;if(d+=`
           xC = xCCorner + ${g*l};
           `,a===1){if(g<c&&(o%2===1?(d+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${g}Ready == 0) {
                   xTexelC${g} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${g}.zw = vec2(0.0);
                   }
                   xTexelC${g}Ready = 1;
                 }
               `,l===1&&g>0?d+=`
                 xC${g} = vec4(xTexelC${g-2}.zw, xTexelC${g}.xy);
                 `:d+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${g} = vec4(previous.zw, xTexelC${g}.xy);
                   } else {
                     xC${g} = vec4(0.0, 0.0, xTexelC${g}.xy);
                   }
                   `):d+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${g}Ready == 0) {
                   xTexelC${g} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${g}.zw = vec2(0.0);
                   }
                   xTexelC${g}Ready = 1;
                 }

                 xC${g} = xTexelC${g};
                 `,g+1<c)){const w=o%2===0?zx(l):l;l%2===0&&o%2===1||l%2!==0&&o%2!==1?(d+=`
                   xCOffset = xC + imod(pads[1], 2) + ${w};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${g+1}Ready == 0) {
                     xTexelC${g+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${g+1}.zw = vec2(0.0);
                     }
                     xTexelC${g+1}Ready = 1;
                   }
                   `,l>1?d+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${g+1} = vec4(previous.zw, xTexelC${g+1}.xy);
                     } else {
                      xC${g+1} = vec4(0.0, 0.0, xTexelC${g+1}.xy);
                     }
                     `:d+=`
                     xC${g+1} = vec4(xTexelC${g}.zw, xTexelC${g+1}.xy);
                     `):w===1?d+=`
                     xC${g+1} = xTexelC${g};
                     `:d+=`
                     xCOffset = xC + ${w};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${g+1}Ready == 0) {
                       xTexelC${g+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${g+1}.zw = vec2(0.0);
                       }
                       xTexelC${g+1}Ready = 1;
                     }

                     xC${g+1} = xTexelC${g+1};
                     `}}else g<c&&(o%2===1?(d+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${g}Ready == 0) {
                   xTexelC${g} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${g}.zw = vec2(0.0);
                   }
                   xTexelC${g}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${g+1}Ready == 0) {
                   xTexelC${g+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${g+1}.zw = vec2(0.0);
                   }
                   xTexelC${g+1}Ready = 1;
                 }

                 xC${g} = vec4(xTexelC${g}.zw, xTexelC${g+1}.zw);
               `,g+1<c&&(d+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${g+1} = vec4(xTexelC${g+1}.xy, final.xy);
                 `)):(d+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${g}Ready == 0) {
                   xTexelC${g} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${g}.zw = vec2(0.0);
                   }
                   xTexelC${g}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${g+1}Ready == 0) {
                   xTexelC${g+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${g+1}.zw = vec2(0.);
                   }
                   xTexelC${g+1}Ready = 1;
                 }

                 xC${g} = vec4(
                   xTexelC${g}.xy, xTexelC${g+1}.xy);
               `,g+1<c&&(d+=`
                   xC${g+1} = vec4(xTexelC${g}.zw, xTexelC${g+1}.zw);
                 `)));g<c&&(d+=`
             wTexel = getW(r, ${g}, d1, d2);
             dotProd += xC${g}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${g}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,g+1<c&&(d+=`
               wTexel = getW(r, ${g+1}, d1, d2);
               dotProd += xC${g+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${g+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}d+=`
     }
   `,d+=`
     }
   `,d+=`
     }
   `;let f="",p="";s&&(r?f=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:i?f=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:f=`vec4 activation(vec4 x) {
           ${s}
         }`,p="result = activation(result);");const m=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${f}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${d}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${m}
         ${p}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class FTe{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=Is(this.outputShape.length);const{dataFormat:s}=n,r=zs(),i=s==="channelsLast",o=i?1:2,a=i?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let u="";for(let c=0;c<=1;c++)for(let h=0;h<=1;h++)u+=`
          blockIndex = rc.z + ${h};
          pos = rc.y + ${c};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${o}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${i}) {
                  innerDims = vec2(d1, ch);
                  result[${c*2+h}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${c*2+h}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${u}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xw(t,e){const n=t.length;return n>=3?e?[...t.slice(0,-3),t[n-3]*t[n-2],t[n-1]]:[...t.slice(0,-3),t[n-3],t[n-2]*t[n-1]]:!e&&n===1&&t[0]>1?[t[0],1]:null}function _H({x:t,filter:e,convInfo:n,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const l=t.shape,u=s.texData.get(t.dataId),c=n.inChannels,h=l[0]*l[1]*l[2],d=n.outChannels,f=n.dataFormat==="channelsLast",p=!1,m=!1;let v;const g=[];if(i!=null){const x=Xw(i.shape,f);x!=null&&(i=xe({inputs:{x:i},backend:s,attrs:{shape:x}}),g.push(i))}if(r!=null){const x=Xw(r.shape,f);x!=null&&(r=xe({inputs:{x:r},backend:s,attrs:{shape:x}}),g.push(r))}if(!((h===1||d===1)&&c>yH)&&u.isPacked&&f&&u.texture!=null&&l[2]%2!==0&&st(u.shape.slice(-3),l.slice(-3))){const x=l[0]*l[1]*(l[2]+1),S={dataId:t.dataId,shape:[1,x,n.inChannels],dtype:t.dtype},N=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,O(Om(u.shape,S.shape),()=>`packed reshape ${u.shape} to ${S.shape} isn't free`);const I=xe({inputs:{x:e},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}});g.push(I);const C=Kw({a:S,b:I,backend:s,transposeA:p,transposeB:m,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o}),_=s.texData.get(C.dataId);O(_.isPacked,()=>"batchMatMul result is expected to be packed"),u.shape=N,_.shape=n.outShape,v=xr({inputs:{x:C},backend:s}),v.shape=n.outShape,g.push(C)}else{const x=n.outHeight*n.outWidth,S=xe({inputs:{x:t},backend:s,attrs:{shape:f?[n.batchSize,x,n.inChannels]:[n.batchSize,n.inChannels,x]}}),N=xe({inputs:{x:e},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}}),I=Kw({a:f?S:N,b:f?N:S,transposeA:!f,transposeB:m,backend:s,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o});v=xe({inputs:{x:I},backend:s,attrs:{shape:n.outShape}}),g.push(S),g.push(N),g.push(I)}for(const x of g)s.disposeIntermediateTensorInfo(x);return v}function TH({x:t,filter:e,convInfo:n,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:l,filterHeight:u,inChannels:c,outWidth:h,outHeight:d,dataFormat:f}=n,p=f==="channelsLast",m=l*u*c,v=d*h,g=[n.batchSize,m,v],w=!0,b=!1,x=[];if(i!=null){const z=Xw(i.shape,p);z!=null&&(i=xe({inputs:{x:i},backend:s,attrs:{shape:z}}),x.push(i))}if(r!=null){const z=Xw(r.shape,p);z!=null&&(r=xe({inputs:{x:r},backend:s,attrs:{shape:z}}),x.push(r))}const S=xe({inputs:{x:e},backend:s,attrs:{shape:[1,m,re(e.shape)/m]}});x.push(S);const N=new FTe(g,n),I=[t.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],C=s.runWebGLProgram(N,[t],"float32",I),_=xe({inputs:{x:C},backend:s,attrs:{shape:g}});x.push(C),x.push(_);const k=r!=null,A=i!=null,D=a==="leakyrelu",R=a?Pm(a,!0):null,W=new gH(p?_.shape:S.shape,p?S.shape:_.shape,p?[n.batchSize,v,n.outChannels]:[n.batchSize,n.outChannels,v],w,b,k,R,A,D),B=p?[_,S]:[S,_];if(r&&B.push(r),A&&B.push(i),D){const z=s.makeTensorInfo([],"float32",xa(o,"float32"));B.push(z),x.push(z)}const M=s.runWebGLProgram(W,B,"float32"),X=xe({inputs:{x:M},backend:s,attrs:{shape:n.outShape}});x.push(M);for(const z of x)s.disposeIntermediateTensorInfo(z);return X}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LTe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:u,dimRoundingMode:c}=s,h=Sa(l),d=Yn(r.shape,i.shape,o,u,a,c,!1,h);let f;if(d.filterHeight===1&&d.filterWidth===1&&d.dilationHeight===1&&d.dilationWidth===1&&d.strideHeight===1&&d.strideWidth===1&&(d.padInfo.type==="SAME"||d.padInfo.type==="VALID"))f=_H({x:r,filter:i,convInfo:d,backend:n});else if(d.strideWidth<=2&&h==="channelsLast"&&Z().getBool("WEBGL_EXP_CONV")){const m=new IH(d),v=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];f=n.runWebGLProgram(m,[r,i],"float32",v)}else if(Z().getBool("WEBGL_CONV_IM2COL"))f=TH({x:r,filter:i,convInfo:d,backend:n});else{const m=new CH(d);f=n.runWebGLProgram(m,[r,i],"float32")}const p=xe({inputs:{x:f},backend:n,attrs:{shape:d.outShape}});return n.disposeIntermediateTensorInfo(f),p}const MTe={kernelName:mg,backendName:"webgl",kernelFunc:LTe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zTe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class BTe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dataFormat==="channelsLast",a=n-1-e.padInfo.top,l=s-1-e.padInfo.left,u=o?1:2,c=o?2:3,h=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${h}];

        ivec2 dyCorner = ivec2(coords[${u}], coords[${c}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${o}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class VTe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideDepth,s=e.strideHeight,r=e.strideWidth,i=e.padInfo.front,o=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${n} - ${i};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${o};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class UTe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterDepth,s=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=n-1-e.padInfo.front,u=s-1-e.padInfo.top,c=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${u}, ${c});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${n}; wF++) {
          float dyF = float(dyFCorner + wF) / ${i}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${n} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WTe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:c}=s,h=Sa(l),d=Yn(r.shape,c,o,1,a,u,!1,h),f=new zTe(d);return n.runWebGLProgram(f,[r,i],"float32")}const jTe={kernelName:Kx,backendName:"webgl",kernelFunc:WTe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GTe{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=Is(this.outputShape.length);const n=e.filterHeight,s=e.filterWidth,r=n-1-e.padInfo.top,i=s-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HTe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:u,dimRoundingMode:c}=s,h=Sa(u),d=Yn(o,i.shape,a,1,l,c,!1,h);if(Z().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&h==="channelsLast"){const f=[[d.strideHeight,d.strideWidth]],p=new GTe(d);return n.runWebGLProgram(p,[r,i],"float32",f)}else{const f=new BTe(d);return n.runWebGLProgram(f,[r,i],"float32")}}const qTe={kernelName:gg,backendName:"webgl",kernelFunc:HTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KTe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s,u=ql(r.shape,i.shape,o,l,a),c=new PTe(u);return n.runWebGLProgram(c,[r,i],"float32")}const XTe={kernelName:yg,backendName:"webgl",kernelFunc:KTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YTe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,pad:a,filterShape:l}=s,u=ql(r.shape,l,o,1,a),c=new VTe(u);return n.runWebGLProgram(c,[r,i],"float32")}const QTe={kernelName:Xx,backendName:"webgl",kernelFunc:YTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JTe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{pad:o,strides:a,inputShape:l}=s,u=ql(l,i.shape,a,1,o),c=new UTe(u);return n.runWebGLProgram(c,[r,i],"float32")}const ZTe={kernelName:Yx,backendName:"webgl",kernelFunc:JTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eke=$f+`
  return cos(x);
`,tke=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${Fc}
  return result;
`,nke=mt({opSnippet:eke,packedOpSnippet:tke}),ske={kernelName:Id,backendName:"webgl",kernelFunc:nke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rke=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,ike=mt({opSnippet:rke}),oke={kernelName:_d,backendName:"webgl",kernelFunc:ike};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ake{constructor(e,n,s,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,a,l,u]=e,[c]=n,[h,d]=s;this.outputShape=[c,h,d,u];const f=r==="bilinear"?1:0,[p,m]=[`${a-1}.0`,`${l-1}.0`],[v,g,w]=h>1?[`${(a-1)/(h-1)}`,"(y2-y1) * height_ratio",`y1*${p} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${p}`],[b,x,S]=d>1?[`${(l-1)/(d-1)}`,"(x2-x1) * width_ratio",`x1*${m} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${m}`];this.userCode=`
      const float height_ratio = float(${v});
      const float width_ratio = float(${b});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${o}) {
          return;
        }

        float height_scale = ${g};
        float width_scale = ${x};

        float in_y = ${w};
        if( in_y < 0.0 || in_y > ${p} ) {
          setOutput(float(${i}));
          return;
        }
        float in_x = ${S};
        if( in_x < 0.0 || in_x > ${m} ) {
          setOutput(float(${i}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${f} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lke=t=>{const{inputs:e,backend:n,attrs:s}=t,{image:r,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:u}=s,c=new ake(r.shape,i.shape,a,l,u);return n.runWebGLProgram(c,[r,i,o],"float32")},uke={kernelName:Jx,backendName:"webgl",kernelFunc:lke};var Lm;(function(t){t.Prod="*",t.Sum="+"})(Lm||(Lm={}));class CF{constructor(e,n,s,r){this.op=e,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const i=this.outputShape.length,o=this.op===Lm.Prod?"1.0":"0.0",a=s?o:`getX(${IF(i,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let u="",c="";s?(u=r?`end != ${l-1}`:"end != 0",c=r?"end + 1":"end - 1"):(u=r?`end + pow2 < ${l}`:"end >= pow2",c=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${At(i)} coords = getOutputCoords();
        int end = ${_F(i,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${u}) {
          int idx = ${c};
          ${_F(i,"coords",this.op)} = idx;
          val ${this.op}= getX(${IF(i,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function IF(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.x, ${e}.y`;if(t===3)return`${e}.x, ${e}.y, ${e}.z`;if(t===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}function _F(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.y`;if(t===3)return`${e}.z`;if(t===4)return`${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kH(t,e,n,s,r,i){const o=e.shape.length,a=on([s],o);let l=e;a!=null&&(l=Fs({inputs:{x:e},backend:n,attrs:{perm:a}}));const u=bn(1,o)[0];if(u!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const c=l.shape[u];let h=xr({inputs:{x:l},backend:n});for(let d=0;d<=Math.ceil(Math.log2(c))-1;d++){const f=new CF(t,l.shape,!1,i),p=[[d]],m=h;h=n.runWebGLProgram(f,[h],h.dtype,p),n.disposeIntermediateTensorInfo(m)}if(r){const d=new CF(t,l.shape,r,i),f=h;h=n.runWebGLProgram(d,[h],h.dtype),n.disposeIntermediateTensorInfo(f)}if(a!=null){const d=Kl(a),f=Fs({inputs:{x:h},backend:n,attrs:{perm:d}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(l),f}return h}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cke(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;return kH(Lm.Prod,r,n,i,o,a)}const hke={kernelName:Qx,backendName:"webgl",kernelFunc:cke};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dke(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;return kH(Lm.Sum,r,n,i,o,a)}const fke={kernelName:vg,backendName:"webgl",kernelFunc:dke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pke(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:i}=e,{size:o,binaryOutput:a}=s;if(r.shape.length===1){const l=n.readSync(r.dataId),u=n.readSync(i.dataId),c=iH(l,u,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,c)}else if(r.shape.length===2){const l=n.bufferSync(r),u=n.bufferSync(i),c=yCe(l,u,o,a);return n.makeTensorInfo(c.shape,i.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const mke={kernelName:Zx,backendName:"webgl",kernelFunc:pke};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gke{constructor(e,n,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=n,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${n};
      int offset_h = imod(h, ${n});
      int in_w = w / ${n};
      int offset_w = imod(w, ${n});
      int offset_d = (offset_h * ${n} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yke(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockSize:i,dataFormat:o}=s,a=r.shape[0],l=o==="NHWC"?r.shape[1]:r.shape[2],u=o==="NHWC"?r.shape[2]:r.shape[3],c=o==="NHWC"?r.shape[3]:r.shape[1],h=l*i,d=u*i,f=c/(i*i),p=o==="NHWC"?[a,h,d,f]:[a,f,h,d],m=new gke(p,i,o);return n.runWebGLProgram(m,[r],r.dtype)}const vke={kernelName:eb,backendName:"webgl",kernelFunc:yke};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class EH{constructor(e,n=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Is(this.outputShape.length);const o=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let u="",c="";s&&(r?u=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?u=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:u=`
          float activation(float x) {
            ${s}
          }
        `,c="result = activation(result);");const h=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${u}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${o}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${h}
        ${c}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NH{constructor(e,n=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Is(this.outputShape.length);const o=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,u=e.dilationWidth,c=e.filterHeight,h=e.filterWidth,d=h;let f=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let g=0;g<h;g++)f+=`
          vec4 xTexelC${g*2};
          int xTexelC${g*2}Ready;
          vec4 xTexelC${g*2+1};
          int xTexelC${g*2+1}Ready;
          vec4 xC${g};`;f+=`
    for (int r = 0; r < ${c}; r++) {
      `;for(let g=0;g<h;g++)f+=`
          xTexelC${g*2} = vec4(0.0);
          xTexelC${g*2}Ready = 0;
          xTexelC${g*2+1} = vec4(0.0);
          xTexelC${g*2+1}Ready = 0;
          xC${g} = vec4(0.0);`;f+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let g=0;g<(d+1)/2;g++){const w=g*2;if(f+=`
          xC = xCCorner + ${w*u};
          `,l===1){if(w<h&&(a%2===1?(f+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }
              `,u===1&&w>0?f+=`
                xC${w} = vec4(xTexelC${w-2}.zw, xTexelC${w}.xy);
                `:f+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${w} = vec4(previous.zw, xTexelC${w}.xy);
                  } else {
                    xC${w} = vec4(0.0, 0.0, xTexelC${w}.xy);
                  }
                  `):f+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                xC${w} = xTexelC${w};
                `,w+1<h)){const b=a%2===0?zx(u):u;u%2===0&&a%2===1||u%2!==0&&a%2!==1?(f+=`
                  xCOffset = xC + imod(pads[1], 2) + ${b};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                    xTexelC${w+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${w+1}.zw = vec2(0.0);
                    }
                    xTexelC${w+1}Ready = 1;
                  }
                  `,u>1?f+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${w+1} = vec4(previous.zw, xTexelC${w+1}.xy);
                    } else {
                     xC${w+1} = vec4(0.0, 0.0, xTexelC${w+1}.xy);
                    }
                    `:f+=`
                    xC${w+1} = vec4(xTexelC${w}.zw, xTexelC${w+1}.xy);
                    `):b===1?f+=`
                    xC${w+1} = xTexelC${w};
                    `:f+=`
                    xCOffset = xC + ${b};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                      xTexelC${w+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${w+1}.zw = vec2(0.0);
                      }
                      xTexelC${w+1}Ready = 1;
                    }

                    xC${w+1} = xTexelC${w+1};
                    `}}else w<h&&(a%2===1?(f+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${w+1}Ready == 0) {
                  xTexelC${w+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${w+1}.zw = vec2(0.0);
                  }
                  xTexelC${w+1}Ready = 1;
                }

                xC${w} = vec4(xTexelC${w}.zw, xTexelC${w+1}.zw);
              `,w+1<h&&(f+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${w+1} = vec4(xTexelC${w+1}.xy, final.xy);
                `)):(f+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                  xTexelC${w+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w+1}.zw = vec2(0.);
                  }
                  xTexelC${w+1}Ready = 1;
                }

                xC${w} = vec4(
                  xTexelC${w}.xy, xTexelC${w+1}.xy);
              `,w+1<h&&(f+=`
                  xC${w+1} = vec4(xTexelC${w}.zw, xTexelC${w+1}.zw);
                `)));w<h&&(f+=`
            wTexel = getW(r, ${w}, d1, q);
            dotProd += xC${w} * vec4(wTexel.xz, wTexel.xz);
          `,w+1<h&&(f+=`
              wTexel = getW(r, ${w+1}, d1, q);
              dotProd += xC${w+1} * vec4(wTexel.xz, wTexel.xz);
            `))}f+=`
    }
  `,f+=`
      }
    `;let p="",m="";s&&(r?p=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?p=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:p=`vec4 activation(vec4 x) {
          ${s}
        }`,m="result = activation(result);");const v=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${p}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${f}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${v}
        ${m}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wke(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:u}=s;let c=l;c==null&&(c=[1,1]),O(hs(o,c),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const h=Yn(r.shape,i.shape,o,c,a,u,!0);let d;Z().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels===1?d=new NH(h):d=new EH(h);const f=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return n.runWebGLProgram(d,[r,i],"float32",f)}const xke={kernelName:wg,backendName:"webgl",kernelFunc:wke};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bke{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${o} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Ske{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=n-1-e.padInfo.top,a=s-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cke(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,filterShape:c}=s,h=Yn(r.shape,c,o,a,l,u,!0),d=new bke(h);return n.runWebGLProgram(d,[r,i],"float32")}const Ike={kernelName:tb,backendName:"webgl",kernelFunc:Cke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ke(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,inputShape:c}=s,h=Yn(c,i.shape,o,a,l,u,!0),d=new Ske(h);return n.runWebGLProgram(d,[r,i],"float32")}const Tke={kernelName:nb,backendName:"webgl",kernelFunc:_ke};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kke{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eke(t){const{inputs:e,backend:n}=t,{x:s}=e,r=[...s.shape,...s.shape],i=re(s.shape),o=xe({inputs:{x:s},backend:n,attrs:{shape:[i]}}),a=new kke(i),l=n.runWebGLProgram(a,[o],o.dtype),u=xe({inputs:{x:l},backend:n,attrs:{shape:r}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(l),u}const Nke={kernelName:sb,backendName:"webgl",kernelFunc:Eke};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $ke{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:n,inWidth:s,padInfo:r,strideHeight:i,strideWidth:o,filterHeight:a,filterWidth:l,dilationHeight:u,dilationWidth:c}=e,{top:h,left:d}=r;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${o});
      const ivec2 pads = ivec2(${h}, ${d});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${u};

          if (hIn >= 0 && hIn < ${n}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${c};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rke(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s,u=uy(r.shape,i.shape,o,a,"NHWC",l);let c;const h=new $ke(u);c=n.runWebGLProgram(h,[r,i],"float32");const d=xe({inputs:{x:c},backend:n,attrs:{shape:u.outShape}});return n.disposeIntermediateTensorInfo(c),d}const Ake={kernelName:xg,backendName:"webgl",kernelFunc:Rke};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dke(t){const{inputs:e,backend:n,attrs:s}=t,{equation:r}=s,i=e,{allDims:o,summedDims:a,idDims:l}=qN(r,i.length);XN(o.length,l,i);const{path:u,steps:c}=YN(a,l),h=c.length;let d=null,f=o.length;const p=[];for(let m=0;m<h;++m){for(const v of c[m]){const{permutationIndices:g,expandDims:w}=KN(f,l[v]);let b;QN(g)?b=i[v]:(b=Fs({inputs:{x:i[v]},backend:n,attrs:{perm:g}}),p.push(b));const x=b.shape.slice();for(let S=0;S<w.length;++S)x.splice(w[S],0,1);st(b.shape,x)||(b=xe({inputs:{x:b},backend:n,attrs:{shape:x}}),p.push(b)),d===null?d=b:(d=pR({inputs:{a:b,b:d},backend:n}),p.push(d))}m<h-1&&(u[m]>=0&&(d=aS({inputs:{x:d},backend:n,attrs:{axis:u[m]-(o.length-f),keepDims:!1}}),p.push(d)),f--)}for(const m of p)m!==d&&n.disposeIntermediateTensorInfo(m);return d}const Oke={kernelName:ib,backendName:"webgl",kernelFunc:Dke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pke="return (x >= 0.0) ? x : (exp(x) - 1.0);",Fke=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Lke=mt({opSnippet:Pke,packedOpSnippet:Fke}),Mke={kernelName:kd,backendName:"webgl",kernelFunc:Lke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zke="return (b >= 0.0) ? a : a * (b + 1.0);",Bke=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,Vke=t=>{const{inputs:e,backend:n}=t,{dy:s,y:r}=e,i=Z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Nf(Bke,s.shape,r.shape):new cc(zke,s.shape,r.shape);return n.runWebGLProgram(i,[s,r],s.dtype)},Uke={kernelName:ob,backendName:"webgl",kernelFunc:Vke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wke=`
  return vec4(equal(a, b));
`,jke="return float(a == b);",Gke=ps({opSnippet:jke,packedOpSnippet:Wke,dtype:"bool",cpuKernelImpl:SCe}),Hke={kernelName:bg,backendName:"webgl",kernelFunc:Gke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qke=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${BN};
  float a1 = ${VN};
  float a2 = ${UN};
  float a3 = ${WN};
  float a4 = ${jN};
  float a5 = ${GN};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,Kke=mt({opSnippet:qke}),Xke={kernelName:Ed,backendName:"webgl",kernelFunc:Kke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yke=$f+`
  return exp(x);
`,Qke=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,$H=mt({opSnippet:Yke,packedOpSnippet:Qke,cpuKernelImpl:CCe,dtype:"float32"}),Jke={kernelName:Nd,backendName:"webgl",kernelFunc:$H};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W_(t){const{inputs:e,attrs:n,backend:s}=t,{dim:r}=n,{input:i}=e,o=i.shape.length,a=i.shape.slice();let l=r;return r<0&&(O(-(o+1)<=r,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+r+1),a.splice(l,0,1),xe({inputs:{x:i},backend:s,attrs:{shape:a}})}const Zke={kernelName:Sg,backendName:"webgl",kernelFunc:W_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TF="return exp(x) - 1.0;",eEe=mt({opSnippet:TF,packedOpSnippet:TF,cpuKernelImpl:ICe}),tEe={kernelName:$d,backendName:"webgl",kernelFunc:eEe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kF{constructor(e,n,s){this.variableNames=["real","imag"];const r=n[1];this.outputShape=n;const i=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=s?`${r}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${i};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${o};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RH(t,e,n){const s=n.texData.get(t.dataId),r=re(t.shape),i=t.shape[t.shape.length-1],o=r/i,a=xe({inputs:{x:t},backend:n,attrs:{shape:[o,i]}}),l=a.shape,u=new kF("real",l,e),c=new kF("imag",l,e),h=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:l},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:l}],d=n.runWebGLProgram(u,h,"float32"),f=n.runWebGLProgram(c,h,"float32"),p=eu({inputs:{real:d,imag:f},backend:n});n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f);const m=xe({inputs:{x:p},backend:n,attrs:{shape:t.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(p),m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nEe(t){const{inputs:e,backend:n}=t,{input:s}=e;return RH(s,!1,n)}const sEe={kernelName:ab,backendName:"webgl",kernelFunc:nEe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rEe{constructor(e,n){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gy(t){const{backend:e,attrs:n}=t,{shape:s,value:r}=n;let{dtype:i}=n;if(i=i||xc(r),i==="string"){const o=cn(i,re(s));return o.fill(r),e.makeTensorInfo(s,i,o)}else{const o=new rEe(s,r),a=[[r]];return e.runWebGLProgram(o,[],i,a)}}const iEe={kernelName:lb,backendName:"webgl",kernelFunc:Gy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oEe{constructor(e){this.variableNames=["Image"],this.outputShape=[];const n=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${n} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${n}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aEe={kernelName:ub,backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{image:n}=t,s=e,r=new oEe(n.shape);return s.runWebGLProgram(r,[n],n.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EF="return floor(x);",lEe=mt({opSnippet:EF,packedOpSnippet:EF,cpuKernelImpl:_Ce}),uEe={kernelName:Rd,backendName:"webgl",kernelFunc:lEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cEe=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,hEe=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,dEe=ps({opSnippet:cEe,packedOpSnippet:hEe,dtype:"int32"}),fEe={kernelName:Ad,backendName:"webgl",kernelFunc:dEe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pEe{constructor(e){this.variableNames=["A"];const n=zs(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${s}.0);

        vec4 values = ${n.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mEe{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const n=zs(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${s}.0);
            vec4 values = ${n.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gEe={kernelName:_w,backendName:"webgl",kernelFunc:yEe};let Yc,CC=Z().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function yEe(t){const{inputs:e,backend:n,attrs:s}=t;let{pixels:r}=e;const{numChannels:i}=s,o=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[l,u]=o?[r.videoWidth,r.videoHeight]:[r.width,r.height],c=[u,l],h=[u,l,i];if(a||o){const m=Z().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Yc==null||m!==CC)&&(CC=m,Yc=document.createElement("canvas").getContext("2d",{willReadFrequently:CC})),Yc.canvas.width=l,Yc.canvas.height=u,Yc.drawImage(r,0,0,l,u),r=Yc.canvas}const d=n.makeTensorInfo(c,"int32");n.texData.get(d.dataId).usage=Dr.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(d.dataId),r);const f=Z().getBool("WEBGL_PACK")?new mEe(h):new pEe(h),p=n.runWebGLProgram(f,[d],"int32");return n.disposeData(d.dataId),p}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vEe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d,activation:f,leakyreluAlpha:p}=s,m=Sa(c),v=Yn(r.shape,i.shape,l,h,u,d,!1,m);let g;const w=[],b=o!=null,x=a!=null,S=f==="leakyrelu",N=()=>{const C=[r,i],_=(k,A)=>{if(A==="NCHW"&&k.shape.length===1&&k.shape[0]!==1){const D=xe({inputs:{x:k},backend:n,attrs:{shape:[k.shape[0],1,1]}});return w.push(D),D}return k};if(b&&C.push(_(o,c)),x&&C.push(_(a,c)),S){const k=n.makeTensorInfo([],"float32",xa(p,"float32"));C.push(k),w.push(k)}return C};if(v.filterHeight===1&&v.filterWidth===1&&v.dilationHeight===1&&v.dilationWidth===1&&v.strideHeight===1&&v.strideWidth===1&&(v.padInfo.type==="SAME"||v.padInfo.type==="VALID"))g=_H({x:r,filter:i,convInfo:v,backend:n,bias:o,activation:f,preluActivationWeights:a,leakyreluAlpha:p});else if(v.strideWidth<=2&&m==="channelsLast"&&Z().getBool("WEBGL_EXP_CONV")){const C=f?Pm(f,!0):null,_=new IH(v,b,C,x,S),k=[[v.padInfo.top,v.padInfo.left],[v.strideHeight,v.strideWidth],[v.dilationHeight,v.dilationWidth],[v.inHeight,v.inWidth]],A=N();g=n.runWebGLProgram(_,A,"float32",k)}else if(Z().getBool("WEBGL_CONV_IM2COL"))g=TH({x:r,filter:i,convInfo:v,backend:n,bias:o,activation:f,preluActivationWeights:a,leakyreluAlpha:p});else{const C=f?Pm(f,!1):null,_=new CH(v,b,C,x,S),k=N();g=n.runWebGLProgram(_,k,"float32")}const I=xe({inputs:{x:g},backend:n,attrs:{shape:v.outShape}});return w.push(g),w.forEach(C=>n.disposeIntermediateTensorInfo(C)),I}const wEe={kernelName:xm,backendName:"webgl",kernelFunc:vEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xEe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dilations:c,dimRoundingMode:h,activation:d,leakyreluAlpha:f}=s,p=[];let m=c;m==null&&(m=[1,1]),O(hs(l,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${m}'`);const v=Yn(r.shape,i.shape,l,m,u,h,!0),g=Z().getBool("WEBGL_PACK_DEPTHWISECONV")&&v.strideWidth<=2&&v.outChannels/v.inChannels===1,w=d?Pm(d,g):null,b=[r,i],x=o!=null,S=a!=null,N=d==="leakyrelu";if(x&&b.push(o),S&&b.push(a),N){const k=n.makeTensorInfo([],"float32",xa(f,"float32"));b.push(k),p.push(k)}let I;g?I=new NH(v,x,w,S,N):I=new EH(v,x,w,S,N);const C=[[v.padInfo.top,v.padInfo.left],[v.strideHeight,v.strideWidth],[v.dilationHeight,v.dilationWidth],[v.inHeight,v.inWidth]],_=n.runWebGLProgram(I,b,"float32",C);return p.forEach(k=>n.disposeIntermediateTensorInfo(k)),_}const bEe={kernelName:bm,backendName:"webgl",kernelFunc:xEe};class SEe{constructor(e,n,s,r){this.sliceDim=e,this.strides=n,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=s;const i=At(s.length);let o=`
    int index;`;for(let a=0;a<this.sliceDim;a++)o+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${i} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${o}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CEe(t){const{inputs:e,backend:n}=t,{params:s,indices:r}=e,i=r.shape,o=i[i.length-1],a=re(s.shape),[l,u,c,h]=A1(s,r),d=xe({inputs:{x:r},backend:n,attrs:{shape:[u,o]}}),f=xe({inputs:{x:s},backend:n,attrs:{shape:[re(s.shape)/c,c]}});if(n.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const g=n.readSync(r.dataId),w=n.bufferSync(s),b=TCe(g,w,s.dtype,u,o,c,h,s.shape,a);return n.makeTensorInfo(l,s.dtype,b.values)}const p=new SEe(o,h,[u,c],s.shape),m=n.runWebGLProgram(p,[f,d],f.dtype),v=xe({inputs:{x:m},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),v}const IEe={kernelName:cb,backendName:"webgl",kernelFunc:CEe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _Ee{constructor(e,n){this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;const s=At(this.rank),r=TEe(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function TEe(t,e){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<t.length;r++)r===2?s.push("index"):s.push(`${n[r]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AH(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,indices:i}=e,{axis:o,batchDims:a}=s,l=Ze(o,r.shape)[0];if(Z().get("DEBUG")){const w=n.readSync(i.dataId),b=r.shape[l];for(let x=0;x<w.length;++x){const S=w[x];O(S<=b-1&&S>=0,()=>`GatherV2: the index value ${S} is not in [0, ${b-1}]`)}}const u=ZN(r,i,l,a),c=re(i.shape),h=[],d=xe({inputs:{x:r},backend:n,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),f=xe({inputs:{x:i},backend:n,attrs:{shape:[u.batchSize,c/u.batchSize]}});h.push(d),h.push(f);const p=[u.batchSize,u.outerSize,c/u.batchSize,u.sliceSize];if(n.shouldExecuteOnCPU([r,i])||r.dtype==="string"){const w=n.bufferSync(f),b=n.bufferSync(d),x=kCe(b,w,p);return h.forEach(S=>n.disposeIntermediateTensorInfo(S)),n.makeTensorInfo(u.outputShape,x.dtype,x.values)}const m=new _Ee(d.shape,p),v=n.runWebGLProgram(m,[d,f],d.dtype);h.push(v);const g=xe({inputs:{x:v},backend:n,attrs:{shape:u.outputShape}});return h.forEach(w=>n.disposeIntermediateTensorInfo(w)),g}const kEe={kernelName:Ig,backendName:"webgl",kernelFunc:AH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EEe="return float(a > b);",NEe=`
  return vec4(greaterThan(a, b));
`,$Ee=ps({opSnippet:EEe,packedOpSnippet:NEe,cpuKernelImpl:ECe,dtype:"bool"}),REe={kernelName:_g,backendName:"webgl",kernelFunc:$Ee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AEe="return float(a >= b);",DEe=`
  return vec4(greaterThanEqual(a, b));
`,OEe=ps({opSnippet:AEe,packedOpSnippet:DEe,dtype:"bool",cpuKernelImpl:NCe}),PEe={kernelName:Dd,backendName:"webgl",kernelFunc:OEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FEe(t){const{inputs:e,backend:n}=t,{input:s}=e;return RH(s,!0,n)}const LEe={kernelName:hb,backendName:"webgl",kernelFunc:FEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MEe="return float(!isnan(x) && !isinf(x));",zEe=mt({opSnippet:MEe,dtype:"bool"}),BEe={kernelName:Pd,backendName:"webgl",kernelFunc:zEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VEe="return float(isinf(x));",UEe=mt({opSnippet:VEe,dtype:"bool"}),WEe={kernelName:Fd,backendName:"webgl",kernelFunc:UEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jEe="return float(isnan(x));",GEe=mt({opSnippet:jEe,dtype:"bool"}),HEe={kernelName:Ld,backendName:"webgl",kernelFunc:GEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qEe="return float(a < b);",KEe=`
  return vec4(lessThan(a, b));
`,XEe=ps({opSnippet:qEe,packedOpSnippet:KEe,cpuKernelImpl:$Ce,dtype:"bool"}),YEe={kernelName:kg,backendName:"webgl",kernelFunc:XEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QEe="return float(a <= b);",JEe=`
  return vec4(lessThanEqual(a, b));
`,ZEe=ps({opSnippet:QEe,packedOpSnippet:JEe,cpuKernelImpl:RCe,dtype:"bool"}),eNe={kernelName:Eg,backendName:"webgl",kernelFunc:ZEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tNe(t){const{backend:e,attrs:n}=t,{start:s,stop:r,num:i}=n,o=ACe(s,r,i);return e.makeTensorInfo([o.length],"float32",o)}const nNe={kernelName:fb,backendName:"webgl",kernelFunc:tNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sNe=$f+`
  return x < 0.0 ? 0./0. : log(x);
`,rNe=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,iNe=mt({opSnippet:sNe,packedOpSnippet:rNe,cpuKernelImpl:DCe}),oNe={kernelName:Md,backendName:"webgl",kernelFunc:iNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aNe=$f+`
  return log(1.0 + x);
`,lNe=mt({opSnippet:aNe}),uNe={kernelName:zd,backendName:"webgl",kernelFunc:lNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cNe="return float(a >= 1.0 && b >= 1.0);",hNe=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,dNe=ps({opSnippet:cNe,packedOpSnippet:hNe,dtype:"bool"}),fNe={kernelName:Ng,backendName:"webgl",kernelFunc:dNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pNe="return float(!(x >= 1.0));",mNe=mt({opSnippet:pNe}),gNe={kernelName:$g,backendName:"webgl",kernelFunc:mNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yNe="return float(a >= 1.0 || b >= 1.0);",vNe=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,wNe=ps({opSnippet:yNe,packedOpSnippet:vNe,dtype:"bool"}),xNe={kernelName:Rg,backendName:"webgl",kernelFunc:wNe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bNe{constructor(e,n,s,r,i){this.variableNames=["x"],this.outputShape=[];const o=n,a=e[3]-1;this.outputShape=e;let l;const u=`float(${s}) + float(${r}) * sum`;i===.5?l=`inversesqrt(${u})`:i===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${o}; j <= ${o}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SNe{constructor(e,n,s,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=n,a=e[3]-1;this.outputShape=e;let l;const u=`float(${s}) + float(${r}) * sum`;i===.5?l=`inversesqrt(${u})`:i===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${o};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${o}; j <= ${o}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CNe=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=s,u=Z().getBool("WEBGL_PACK_NORMALIZATION")?new SNe(r.shape,i,o,a,l):new bNe(r.shape,i,o,a,l);return n.runWebGLProgram(u,[r],r.dtype)},INe={kernelName:Ag,backendName:"webgl",kernelFunc:CNe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _Ne{constructor(e,n,s,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=n,this.bias=s,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${n})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${n} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${i})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${i});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TNe=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:u,beta:c}=s,h=new _Ne(r.shape,a,l,u,c);return n.runWebGLProgram(h,[r,i,o],r.dtype)},kNe={kernelName:pb,backendName:"webgl",kernelFunc:TNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ENe(t,e,n,s){const r=re(e),o=re(t.shape)/r,a=xe({inputs:{x:t},attrs:{shape:[o,r]},backend:s}),l=Lc(a,t.dtype,"max",s),u=xe({inputs:{x:l},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DH(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reductionIndices:i,keepDims:o}=s,a=r.shape.length,l=Ze(i,r.shape);let u=l;const c=on(u,a),h=c!=null,d=n.shouldExecuteOnCPU([r]);let f=r;if(h){if(d){const b=n.texData.get(f.dataId).values,x=new Array(a);for(let I=0;I<x.length;I++)x[I]=r.shape[c[I]];const S=dR(b,r.shape,r.dtype,c,x);f=n.makeTensorInfo(x,r.dtype);const N=n.texData.get(f.dataId);N.values=S}else f=oS(r,c,n);u=bn(u.length,a)}ds("max",u,a);const[p,m]=Qn(f.shape,u);let v=p;o&&(v=xn(p,l));let g;if(d){const b=n.texData.get(f.dataId).values,x=OCe(b,re(m),v,r.dtype);g=n.makeTensorInfo(v,r.dtype);const S=n.texData.get(g.dataId);S.values=x}else g=ENe(f,m,v,n);return h&&n.disposeIntermediateTensorInfo(f),g}const NNe={kernelName:Dg,backendName:"webgl",kernelFunc:DH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Ne=fR+`
  return max(a, b);
`,RNe=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Fc+`
  return result;
`,ANe=ps({opSnippet:$Ne,packedOpSnippet:RNe,cpuKernelImpl:PCe}),DNe={kernelName:Bd,backendName:"webgl",kernelFunc:ANe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ONe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;If(r,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;O(hs(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const c=hi(r.shape,i,o,u,a,l);if(c.filterWidth===1&&c.filterHeight===1&&st(c.inShape,c.outShape))return xr({inputs:{x:r},backend:n});const h=new Fm(c,"max",!1);return n.runWebGLProgram(h,[r],r.dtype)}const PNe={kernelName:Og,backendName:"webgl",kernelFunc:ONe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FNe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:i,strides:o,pad:a,dataFormat:l,dimRoundingMode:u}=s,c=[1,1,1],h=ba(r.shape,i,o,c,a,u,l),d=new mR(h,"max",!1);return n.runWebGLProgram(d,[r],r.dtype)}const LNe={kernelName:Pg,backendName:"webgl",kernelFunc:FNe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class MNe{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideHeight,s=e.strideWidth,r=e.dilationHeight,i=e.effectiveFilterHeight,o=e.effectiveFilterWidth,a=i-1-e.padInfo.top,l=o-1-e.padInfo.left,u=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${i};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${n}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${o}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${u} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${o} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class zNe{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideDepth,s=e.strideHeight,r=e.strideWidth,i=e.dilationDepth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,h=l-1-e.padInfo.front,d=u-1-e.padInfo.top,f=c-1-e.padInfo.left,p=l*u*c-1;this.userCode=`
      const ivec3 pads = ivec3(${h}, ${d}, ${f});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${i}) {
          float dyD = float(dyDCorner + wD) / ${n}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${u};
              wR += ${o}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${c};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${p} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${u} * ${c} +
                  wR * ${c} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BNe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,o=i,{filterSize:a,strides:l,pad:u,dimRoundingMode:c}=s,h=[1,1,1],d=ba(o.shape,a,l,h,u,c),f=new mR(d,"max",!0),p=n.runWebGLProgram(f,[o],o.dtype),m=new zNe(d),v=n.runWebGLProgram(m,[r,p],o.dtype);return n.disposeIntermediateTensorInfo(p),v}const VNe={kernelName:gb,backendName:"webgl",kernelFunc:BNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UNe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i,output:o}=e,a=i;If([i,o],"maxPoolGrad");const{filterSize:l,strides:u,pad:c,dimRoundingMode:h}=s,d=hi(a.shape,l,u,1,c,h),f=!0,p=new Fm(d,"max",f),m=n.runWebGLProgram(p,[a],a.dtype),v=new MNe(d),g=n.runWebGLProgram(v,[r,m],a.dtype);return n.disposeIntermediateTensorInfo(m),g}const WNe={kernelName:mb,backendName:"webgl",kernelFunc:UNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jNe(t,e,n,s){let r=new Fm(n,"max",!1);const i=s.runWebGLProgram(r,[t],"float32");r=new Fm(n,"max",!0,!0,e);const o=s.runWebGLProgram(r,[t],"float32");return[i,o]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GNe={kernelName:yb,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{filterSize:r,strides:i,pad:o,includeBatchInIndex:a}=e,l=n;O(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const u=[1,1];O(hs(i,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const c=hi(s.shape,r,i,u,o),[h,d]=jNe(s,a,c,l);return[h,d]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HNe(t,e,n,s){const r=re(e),o=re(t.shape)/r,a=xe({inputs:{x:t},attrs:{shape:[o,r]},backend:s}),l=Lc(a,"float32","mean",s),u=xe({inputs:{x:l},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qNe={kernelName:Fg,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{keepDims:r,axis:i}=e,o=n,a=s.shape.length,l=Ze(i,s.shape);let u=l;const c=on(u,a),h=c!=null,d=o.shouldExecuteOnCPU([s]),f=[];let p=s;if(h){if(d){const x=o.texData.get(p.dataId).values,S=new Array(a);for(let C=0;C<S.length;C++)S[C]=s.shape[c[C]];const N=dR(x,s.shape,s.dtype,c,S);p=o.makeTensorInfo(S,s.dtype);const I=o.texData.get(p.dataId);I.values=N}else p=oS(s,c,o);f.push(p),u=bn(u.length,a)}ds("sum",u,a);const[m,v]=Qn(p.shape,u);let g=m;r&&(g=xn(m,l));const w=HNe(p,v,g,o);for(const b of f)o.disposeIntermediateTensorInfo(b);return w}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KNe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=Ze(i,r.shape);let u=l;const c=on(u,a);let h=r;c!=null&&(h=Fs({inputs:{x:r},backend:n,attrs:{perm:c}}),u=bn(u.length,r.shape.length)),ds("min",u,a);const[d,f]=Qn(h.shape,u),p=re(f),m=xe({inputs:{x:h},backend:n,attrs:{shape:[-1,p]}}),v=Lc(m,m.dtype,"min",n);let g;if(o){const w=xn(d,l);g=xe({inputs:{x:v},backend:n,attrs:{shape:w}})}else g=xe({inputs:{x:v},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),c!=null&&n.disposeIntermediateTensorInfo(h),g}const XNe={kernelName:Lg,backendName:"webgl",kernelFunc:KNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YNe=fR+`
  return min(a, b);
`,QNe=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Fc+`
  return result;
`,JNe=ps({opSnippet:YNe,packedOpSnippet:QNe,cpuKernelImpl:FCe}),ZNe={kernelName:Vd,backendName:"webgl",kernelFunc:JNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class e2e{constructor(e,n,s){this.variableNames=["x"],this.outputShape=n.map((c,h)=>c[0]+e[h]+c[1]);const r=e.length,i=At(r),o=n.map(c=>c[0]).join(","),a=n.map((c,h)=>c[0]+e[h]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),u=s==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${u};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${u};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${u};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${u};
          }
        }
        ${i} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class t2e{constructor(e,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((p,m)=>p[0]+e[m]+p[1]);const r=e.length,i=At(r),o=n.map(p=>p[0]).join(","),a=n.map((p,m)=>p[0]+e[m]).join(","),l=Ds("rc",r),u=Ds("source",r),c=`${l[r-1]} < ${this.outputShape[r-1]}`,h=r===1?"source":`vec2(${u.slice(-2).join()})`,d=s==="reflect"?0:1;let f="";if(r===1){const p=`
        ${i} source = rc;
        if (source < start) {
          source = start * 2 - source - ${d};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${d};
        }
        source -= start;
      `;f=`
        ${i} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${u.join()}), ${h});
        ${l[r-1]} += 1;
        if(${c}) {
          ${p}
          result[1] = getChannel(getX(${u.join()}), ${h});
        }
      `}else{const p=`
        ${i} source = rc;
        ${i} lt = ${i}(lessThan(source, start));
        ${i} gte = ${i}(greaterThanEqual(source, end));
        ${i} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${d}) +
                gte * ((end - 1) * 2 - source + ${d});
        source -= start;
      `;f=`
        ${i} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${u.join()}), ${h});
        ${l[r-1]} += 1;
        if(${c}) {
          ${p}
          result[1] = getChannel(getX(${u.join()}), ${h});
        }
        rc = outputLoc;
        ${l[r-2]} += 1;
        if(${l[r-2]} < ${this.outputShape[r-2]}) {
          ${p}
          result[2] = getChannel(getX(${u.join()}), ${h});
          ${l[r-1]} += 1;
          if(${c}) {
            ${p}
            result[3] = getChannel(getX(${u.join()}), ${h});
          }
        }
      `}this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${f}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n2e=({inputs:t,backend:e,attrs:n})=>{const{x:s}=t,{paddings:r,mode:i}=n,o=Z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new t2e(s.shape,r,i):new e2e(s.shape,r,i);return e.runWebGLProgram(o,[s],s.dtype)},s2e={kernelName:Mg,backendName:"webgl",kernelFunc:n2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r2e=`if (b == 0.0) return NAN;
  return mod(a, b);`,i2e=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Fc+`
  return result;
`,o2e=ps({opSnippet:r2e,packedOpSnippet:i2e}),a2e={kernelName:Ud,backendName:"webgl",kernelFunc:o2e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class l2e{constructor(e,n,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${n-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${n-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u2e=`
if (a == b) {
  return 1.0;
};
return a / b;`,c2e=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,OH=ps({opSnippet:u2e,packedOpSnippet:c2e,checkOutOfBounds:!0}),h2e={kernelName:Td,backendName:"webgl",kernelFunc:OH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NF="return a - b;",PH=ps({opSnippet:NF,packedOpSnippet:NF,supportsComplex:!0,cpuKernelImpl:sIe}),d2e={kernelName:rf,backendName:"webgl",kernelFunc:PH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FH(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{dim:i}=s,o=Ze([i],r.shape),a=DH({inputs:{x:r},backend:n,attrs:{reductionIndices:o,keepDims:!1}}),l=xn(a.shape,o),u=xe({inputs:{x:a},backend:n,attrs:{shape:l}}),c=PH({inputs:{a:r,b:u},backend:n}),h=$H({inputs:{x:c},backend:n}),d=aS({inputs:{x:h},backend:n,attrs:{axis:o,keepDims:!1}}),f=xe({inputs:{x:d},backend:n,attrs:{shape:l}}),p=OH({inputs:{a:h,b:f},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),p}const f2e={kernelName:ny,backendName:"webgl",kernelFunc:FH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p2e(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{numSamples:i,seed:o,normalized:a}=s,l=a?r:FH({inputs:{logits:r},backend:n,attrs:{dim:r.shape.length-1}}),u=l.shape[0],c=l.shape[1],h=new l2e(u,c,i),d=[[o]],f=n.runWebGLProgram(h,[l],"int32",d);return a||n.disposeIntermediateTensorInfo(l),f}const m2e={kernelName:vb,backendName:"webgl",kernelFunc:p2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g2e=fi+`
  return -x;
`,y2e=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function v2e(t){const{inputs:e,backend:n}=t,{x:s}=e;if(n.shouldExecuteOnCPU([s])){const i=n.texData.get(s.dataId),[o,a]=MCe(i.values,s.shape,s.dtype);return n.makeTensorInfo(a,s.dtype,o)}let r;return Z().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new sl(s.shape,y2e):r=new lo(s.shape,g2e),n.runWebGLProgram(r,[s],s.dtype)}const w2e={kernelName:zg,backendName:"webgl",kernelFunc:v2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x2e=E1;function b2e(t){Nr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=s,u=n.readSync(r.dataId),c=n.readSync(i.dataId),{selectedIndices:h}=x2e(u,c,o,a,l);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}const S2e={kernelName:wb,backendName:"webgl",kernelFunc:b2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C2e=N1;function I2e(t){Nr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=s,c=n.readSync(r.dataId),h=n.readSync(i.dataId),{selectedIndices:d,validOutputs:f}=C2e(c,h,o,a,l,u);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}const _2e={kernelName:xb,backendName:"webgl",kernelFunc:I2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T2e=$1;function k2e(t){Nr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s,c=n.readSync(r.dataId),h=n.readSync(i.dataId),d=o,f=a,p=l,m=u,{selectedIndices:v,selectedScores:g}=T2e(c,h,d,f,p,m);return[n.makeTensorInfo([v.length],"int32",new Int32Array(v)),n.makeTensorInfo([g.length],"float32",new Float32Array(g))]}const E2e={kernelName:bb,backendName:"webgl",kernelFunc:k2e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class N2e{constructor(e,n,s,r){this.variableNames=["indices"],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $2e=t=>{const{inputs:e,backend:n,attrs:s}=t,{indices:r}=e,{dtype:i,depth:o,onValue:a,offValue:l}=s,u=re(r.shape),c=new N2e(u,o,a,l),h=xe({inputs:{x:r},backend:n,attrs:{shape:[u]}}),d=n.runWebGLProgram(c,[h],i);n.disposeIntermediateTensorInfo(h);const f=[...r.shape,o],p=xe({inputs:{x:d},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(d),p},R2e={kernelName:Ug,backendName:"webgl",kernelFunc:$2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yw(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="complex64"){const r=jy({inputs:{input:s},backend:n}),i=Yw({inputs:{x:r},backend:n}),o=lS({inputs:{input:s},backend:n}),a=Yw({inputs:{x:o},backend:n}),l=eu({inputs:{real:i,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return Gy({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:n})}const A2e={kernelName:oy,backendName:"webgl",kernelFunc:Yw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LH(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=jy({inputs:{input:s},backend:n}),i=LH({inputs:{x:r},backend:n}),o=lS({inputs:{input:s},backend:n}),a=Yw({inputs:{x:o},backend:n}),l=eu({inputs:{real:i,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return Gy({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:n})}const D2e={kernelName:Vg,backendName:"webgl",kernelFunc:LH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O2e(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s;if(e.length===1)return W_({inputs:{input:e[0]},backend:n,attrs:{dim:r}});const i=e[0].shape,o=e[0].dtype;e.forEach(c=>{cs(i,c.shape,"All tensors passed to stack must have matching shapes"),O(o===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(c=>{const h=W_({inputs:{input:c},backend:n,attrs:{dim:r}});return a.push(h),h}),u=SH({inputs:l,backend:n,attrs:{axis:r}});return a.forEach(c=>n.disposeIntermediateTensorInfo(c)),u}const P2e={kernelName:Wg,backendName:"webgl",kernelFunc:O2e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class F2e{constructor(e,n,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((u,c)=>u[0]+e[c]+u[1]);const r=e.length,i=At(r),o=n.map(u=>u[0]).join(","),a=n.map((u,c)=>u[0]+e[c]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${i} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class L2e{constructor(e,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((m,v)=>m[0]+e[v]+m[1]);const r=e.length,i=At(r),o=n.map(m=>m[0]).join(","),a=n.map((m,v)=>m[0]+e[v]).join(","),l=Ds("rc",r),u=Ds("source",r),c=`${l[r-1]} < ${this.outputShape[r-1]}`,h=r===1?"source":`vec2(${u.slice(-2).join()})`,d=[`${i} rc = outputLoc;`,`${l[r-1]} += 1;
       if(${c}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${l[r-2]} += 1;
       if(${l[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${l[r-1]} += 1;
         if(${c}) {`],f=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let p="";for(let m=0,v=r===1?2:4;m<v;m++)p+=`
        ${d[m]}
        if (${f}) {
          result[${m}] = float(value);
        } else {
          ${i} source = rc - start;
          result[${m}] = getChannel(getX(${u.join()}), ${h});
        }
      `;p+=r===1?"} ":"}}",this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MH=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{paddings:i,constantValue:o}=s;if(re(r.shape)===0){const u=i.map((c,h)=>c[0]+r.shape[h]+c[1]);return Gy({backend:n,attrs:{shape:u,value:o,dtype:r.dtype}})}const a=Z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new L2e(r.shape,i,o):new F2e(r.shape,i,o),l=[[o]];return n.runWebGLProgram(a,[r],r.dtype,l)},M2e={kernelName:jg,backendName:"webgl",kernelFunc:MH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z2e=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,B2e=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Fc+`
  return result;
`,V2e=ps({opSnippet:z2e,packedOpSnippet:B2e}),U2e={kernelName:jd,backendName:"webgl",kernelFunc:V2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W2e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=[],u=Ze(i,r.shape);let c=u;const h=on(c,a);let d=r;h!=null&&(d=Fs({inputs:{x:r},backend:n,attrs:{perm:h}}),c=bn(c.length,a),l.push(d)),ds("prod",c,a);let f;if(n.shouldExecuteOnCPU([d])){const p=n.texData.get(d.dataId).values,{outVals:m,outShape:v,outDtype:g}=BCe(d.shape,d.dtype,p,c);f=n.makeTensorInfo(v,g,m)}else{const[p,m]=Qn(d.shape,c),v=re(m),g=xe({inputs:{x:d},backend:n,attrs:{shape:[-1,v]}}),w=qb(r.dtype),b=Lc(g,w,"prod",n);f=xe({inputs:{x:b},backend:n,attrs:{shape:p}}),l.push(g),l.push(b)}if(o){l.push(f);const p=xn(f.shape,u);f=xe({inputs:{x:f},backend:n,attrs:{shape:p}})}return l.forEach(p=>n.disposeIntermediateTensorInfo(p)),f}const j2e={kernelName:Hg,backendName:"webgl",kernelFunc:W2e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G2e(t){const{inputs:e,backend:n,attrs:s}=t,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=e,{outputRaggedRank:a}=s,l=r.map(g=>n.readSync(g.dataId)),u=r.map(g=>g.shape),c=n.readSync(i.dataId),h=n.readSync(o.dataId),[d,f,p]=VCe(l,u,c,i.shape,i.dtype,h,o.shape,a),m=d.map(g=>n.makeTensorInfo([g.length],"int32",g)),v=n.makeTensorInfo(p,i.dtype,f);return m.concat([v])}const H2e={kernelName:Sb,backendName:"webgl",kernelFunc:G2e};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q2e(t){const{inputs:e,backend:n}=t,{starts:s,limits:r,deltas:i}=e,o=n.readSync(s.dataId),a=n.readSync(r.dataId),l=n.readSync(i.dataId),[u,c]=UCe(o,s.shape,s.dtype,a,r.shape,l,i.shape),h=n.makeTensorInfo([u.length],"int32",u),d=n.makeTensorInfo([c.length],s.dtype,c);return[h,d]}const K2e={kernelName:Cb,backendName:"webgl",kernelFunc:q2e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X2e(t){const{inputs:e,backend:n,attrs:s}=t,{shape:r,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,u=n.readSync(r.dataId),c=n.readSync(i.dataId),h=n.readSync(o.dataId),d=a.map(v=>n.readSync(v.dataId)),f=a.map(v=>v.shape),[p,m]=WCe(u,r.shape,c,i.shape,i.dtype,h,o.shape,d,f,l);return n.makeTensorInfo(p,i.dtype,m)}const Y2e={kernelName:Ib,backendName:"webgl",kernelFunc:X2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zH=t=>{const{backend:e,attrs:n}=t,{start:s,stop:r,step:i,dtype:o}=n,a=jCe(s,r,i,o);return e.makeTensorInfo([a.length],o,a)},Q2e={kernelName:_b,backendName:"webgl",kernelFunc:zH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J2e="return 1.0 / x;",Z2e=mt({opSnippet:J2e}),e$e={kernelName:Gd,backendName:"webgl",kernelFunc:Z2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t$e=fi+`
  return (x < 0.0) ? 0.0 : x;
`,n$e=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,s$e=mt({opSnippet:t$e,packedOpSnippet:n$e}),r$e={kernelName:Hd,backendName:"webgl",kernelFunc:s$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i$e=fi+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,o$e=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,a$e=mt({opSnippet:i$e,packedOpSnippet:o$e}),l$e={kernelName:qd,backendName:"webgl",kernelFunc:a$e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class u$e{constructor(e,n,s,r,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,n,s,u];const c=[r&&n>1?a-1:a,r&&s>1?l-1:l],h=[r&&n>1?n-1:n,r&&s>1?s-1:s];let d;i?d="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":d="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/h[0]},
          ${c[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${d};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class c$e{constructor(e,n,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,n,s,u];const c=[r&&n>1?a-1:a,r&&s>1?l-1:l],h=[r&&n>1?n-1:n,r&&s>1?s-1:s];let d;i?d="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":d="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/h[0]},
          ${c[1]/h[1]},
          ${c[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${d};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h$e(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s,[l,u]=a,c=Z().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new c$e(r.shape,l,u,i,o):new u$e(r.shape,l,u,i,o);return n.runWebGLProgram(c,[r],"float32")}const d$e={kernelName:Xg,backendName:"webgl",kernelFunc:h$e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class f$e{constructor(e,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,r,i]=n,[,o,a]=e,l=[s&&o>1?r-1:r,s&&a>1?i-1:i],u=[s&&o>1?o-1:o,s&&a>1?a-1:a],c=l[0]/u[0],h=l[1]/u[1],d=1/c,f=1/h,p=Math.ceil(d)*2+2,m=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${c});
        const float widthScale = float(${h});

        const float invHeightScale = float(${d});
        const float invWidthScale = float(${f});

        const int winHeight = int(${p});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p$e(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:i}=e,{alignCorners:o}=s,a=new f$e(i.shape,r.shape,o);return n.runWebGLProgram(a,[i],i.dtype)}const m$e={kernelName:Eb,backendName:"webgl",kernelFunc:p$e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class g$e{constructor(e,n,s,r,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,n,s,u];const c=[r&&n>1?a-1:a,r&&s>1?l-1:l],h=[r&&n>1?n-1:n,r&&s>1?s-1:s],d=r?"0.5":"0.0";let f;i?f="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/h[0]},
          ${c[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${d})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class y$e{constructor(e,n,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,n,s,u];const c=[r&&n>1?a-1:a,r&&s>1?l-1:l],h=[r&&n>1?n-1:n,r&&s>1?s-1:s],d=r?"0.5":"0.0";let f;i?f="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/h[0]},
          ${c[1]/h[1]},
          ${c[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${d})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v$e(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s,[l,u]=a,c=Z().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new y$e(r.shape,l,u,i,o):new g$e(r.shape,l,u,i,o);return n.runWebGLProgram(c,[r],r.dtype)}const w$e={kernelName:Kg,backendName:"webgl",kernelFunc:v$e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class x$e{constructor(e,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,r,i]=n,[,o,a]=e,l=[s&&o>1?r-1:r,s&&a>1?i-1:i],u=[s&&o>1?o-1:o,s&&a>1?a-1:a],c=l[0]/u[0],h=l[1]/u[1],d=1/c,f=1/h,p=Math.ceil(d)*2+2,m=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${c});
        const float widthScale = float(${h});

        const float invHeightScale = float(${d});
        const float invWidthScale = float(${f});

        const int winHeight = int(${p});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${u[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${u[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${i}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b$e(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:i}=e,{alignCorners:o}=s,a=new x$e(i.shape,r.shape,o);return n.runWebGLProgram(a,[i],i.dtype)}const S$e={kernelName:kb,backendName:"webgl",kernelFunc:b$e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class C$e{constructor(e,n){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const r=a=>n.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,i=e.map((a,l)=>r(l)).join(","),o=At(s);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class I$e{constructor(e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const r=Ds("rc",s),i=`${r[s-1]} + 1 < ${this.outputShape[s-1]}`,o=`${r[s-2]} + 1 < ${this.outputShape[s-2]}`,a=At(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${i}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(r.slice())};
          if(${i}){
            result.g = ${u(r.slice())};
          }
          if(${o}) {
            result.b = ${c(r.slice())};
            if(${i}) {
              result.a = ${h(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(p){return d(p)}function u(p){return p[s-1]="("+p[s-1]+" + 1)",d(p)}function c(p){return p[s-2]="("+p[s-2]+" + 1)",d(p)}function h(p){return p[s-1]="("+p[s-1]+" + 1)",p[s-2]="("+p[s-2]+" + 1)",d(p)}function d(p){const m=e.map((w,b)=>f(b,p)),v=m.join(","),g=m.slice(-2).join(",");return`getChannel(getX(${v}), vec2(${g}))`}function f(p,m){return n.indexOf(p)!==-1&&e[p]!==1?`${e[p]} - ${m[p]} - 1`:`${m[p]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _$e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dims:i}=s,o=r.shape.length,a=Ze(i,r.shape);if(o===0)return xr({inputs:{x:r},backend:n});const l=Z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new I$e(r.shape,a):new C$e(r.shape,a);return n.runWebGLProgram(l,[r],r.dtype)}const T$e={kernelName:Yg,backendName:"webgl",kernelFunc:_$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class k$e{constructor(e,n){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],r=e[2];this.outputShape=e;let i="";typeof n=="number"?i=`float outputValue = ${n.toFixed(2)};`:i=`
        vec3 fill = vec3(${n.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${i}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E$e={kernelName:Gb,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,{radians:r,fillValue:i,center:o}=e,a=n,l=new k$e(s.shape,i),[u,c]=LN(o,s.shape[1],s.shape[2]),h=[[u,c,Math.sin(r),Math.cos(r)]];return a.runWebGLProgram(l,[s],s.dtype,h)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N$e=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,$$e=mt({opSnippet:N$e}),R$e={kernelName:Kd,backendName:"webgl",kernelFunc:$$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A$e="return inversesqrt(x);",D$e=mt({opSnippet:A$e,cpuKernelImpl:GCe}),O$e={kernelName:Xd,backendName:"webgl",kernelFunc:D$e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gR{constructor(e,n,s,r,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const u=At(i.length),c=At(o.length);let h="";s===1?h="i":s===2&&(h="i, j");const d=`getIndices(${h})`;let f="";r===1?f="i":r===2&&(f="i, coords[1]");const p=`getUpdates(${f})`;let m="";l&&(m="coords[0], coords[1]");const v=`getDefaultValue(${m})`,g=n>1?"strides[j]":"strides";this.userCode=`
        ${u} strides = ${u}(${i});

        void main() {
          ${c} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${n}; j++) {
              int index = round(${d});
              flattenedIndex += index * ${g};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${p};
              found = true;
            }
          }
          setOutput(mix(${v}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class P$e{constructor(e,n,s,r,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;const u=At(i.length),c=At(o.length);let h="";s===1?h="i":s===2&&(h="i, j");const d=`getIndices(${h})`;let f="";r===1?f="i":r===2&&(f="i, coords[1]");const p=`getUpdates(${f})`;let m="";l&&(m="coords[0], coords[1]");const v=`getDefaultValue(${m})`,g=n>1?"strides[j]":"strides",w=n>1?"strides[j + 1]":"strides";this.userCode=`
        ${u} strides = ${u}(${i});

        void main() {
          ${c} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${n}; j+=2) {
              ivec4 index = round(${d});
              flattenedIndex += index.xz * ${g};
              if (j + 1 < ${n}) {
                flattenedIndex += index.yw * ${w};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${p};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${v}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F$e(t){const{inputs:e,backend:n,attrs:s}=t,{indices:r,updates:i}=e,{shape:o}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:c,outputSize:h}=Jl(i,r,o),d=[h/u,u];if(h===0)return n.makeTensorInfo(o,r.dtype);const f=xe({inputs:{x:r},backend:n,attrs:{shape:[l,a]}}),p=xe({inputs:{x:i},backend:n,attrs:{shape:[l,u]}}),m=n.makeTensorInfo([],"float32",new Float32Array([0]));let v;Z().getBool("WEBGL_PACK")?v=new P$e(l,a,f.shape.length,p.shape.length,c,d):v=new gR(l,a,f.shape.length,p.shape.length,c,d);const g=n.runWebGLProgram(v,[p,f,m],p.dtype),w=xe({inputs:{x:g},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(m),w}const L$e={kernelName:Nb,backendName:"webgl",kernelFunc:F$e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class M$e{constructor(e,n,s,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const i="while (left < right) {",o=`for (int i = 0; i < ${Math.ceil(Math.log2(n+1))}; ++i) { if (left >= right) break;`,a=Z().getNumber("WEBGL_VERSION")===2?i:o,l=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z$e(t){const{inputs:e,backend:n,attrs:s}=t,{sortedSequence:r,values:i}=e,{side:o}=s,a=new M$e(r.shape[0],r.shape[1],i.shape[1],o),l=[[r.shape[1]]];return n.runWebGLProgram(a,[r,i],"int32",l)}const B$e={kernelName:Rb,backendName:"webgl",kernelFunc:z$e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class V$e{constructor(e,n,s){this.variableNames=["c","a","b"],this.outputShape=n;let r,i;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)i="resRC",r="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],u=[];for(let c=0;c<n.length;c++)u.push(`${a[c]}`),c<e&&l.push(`${a[c]}`);r=l.join(),i=u.join()}const o=At(s);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${i}));
        } else {
          setOutput(getB(${i}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U$e(t){const{inputs:e,backend:n}=t,{condition:s,t:r,e:i}=e,o=new V$e(s.shape.length,r.shape,r.shape.length);return n.runWebGLProgram(o,[s,r,i],Xs(r.dtype,i.dtype))}const W$e={kernelName:Qg,backendName:"webgl",kernelFunc:U$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j$e=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${P1};
  float scale = ${F1};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,G$e=mt({opSnippet:j$e}),H$e={kernelName:Yd,backendName:"webgl",kernelFunc:G$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q$e=$f+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,K$e=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,X$e=mt({opSnippet:q$e,packedOpSnippet:K$e,cpuKernelImpl:qCe}),Y$e={kernelName:ef,backendName:"webgl",kernelFunc:X$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q$e=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,J$e=mt({opSnippet:Q$e}),Z$e={kernelName:Zd,backendName:"webgl",kernelFunc:J$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eRe=$f+`
  return sin(x);
`,tRe=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${Fc}
  return result;
`,nRe=mt({opSnippet:eRe,packedOpSnippet:tRe}),sRe={kernelName:Qd,backendName:"webgl",kernelFunc:nRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rRe=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,iRe=mt({opSnippet:rRe}),oRe={kernelName:Jd,backendName:"webgl",kernelFunc:iRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aRe=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,lRe=mt({opSnippet:aRe}),uRe={kernelName:tf,backendName:"webgl",kernelFunc:lRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cRe=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:i,paddings:o}=s;O(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((g,w)=>g*w),l=[[0,0]];l.push(...o);for(let g=1+i.length;g<r.shape.length;++g)l.push([0,0]);const u=[],c=MH({inputs:{x:r},backend:n,attrs:{paddings:l,constantValue:0}}),h=ky(c.shape,i,a,!1),d=Ey(h.length,i.length,!1),f=Ny(c.shape,i,a,!1),p=xe({inputs:{x:c},backend:n,attrs:{shape:h}}),m=Fs({inputs:{x:p},backend:n,attrs:{perm:d}}),v=xe({inputs:{x:m},backend:n,attrs:{shape:f}});return u.push(c),u.push(p),u.push(m),u.forEach(g=>n.disposeIntermediateTensorInfo(g)),v},hRe={kernelName:ey,backendName:"webgl",kernelFunc:cRe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dRe(t){const{inputs:e,backend:n}=t,{indices:s,values:r,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=n.readSync(s.dataId),l=n.readSync(r.dataId),u=n.readSync(i.dataId),c=n.readSync(o.dataId)[0],[h,d,f,p,m]=XCe(a,s.shape,s.dtype,l,r.dtype,u,c);return[n.makeTensorInfo(d,s.dtype,h),n.makeTensorInfo([d[0]],r.dtype,f),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(v=>Number(v)))),n.makeTensorInfo([m.length],s.dtype,new Int32Array(m))]}const fRe={kernelName:Ab,backendName:"webgl",kernelFunc:dRe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pRe(t){const{inputs:e,backend:n}=t,{inputIndices:s,inputShape:r,newShape:i}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(n.readSync(r.dataId)),a=n.readSync(s.dataId),l=Array.from(n.readSync(i.dataId)),[u,c,h]=YCe(a,s.shape,s.dtype,o,l);return[n.makeTensorInfo(c,s.dtype,u),n.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}const mRe={kernelName:Db,backendName:"webgl",kernelFunc:pRe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gRe(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${i.shape}`);const o=n.readSync(s.dataId),a=n.readSync(r.dataId),l=n.readSync(i.dataId),[u,c]=aH(o,s.shape,s.dtype,a,l,!0);return n.makeTensorInfo(c,s.dtype,u)}const yRe={kernelName:Ob,backendName:"webgl",kernelFunc:gRe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vRe(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${i.shape}`);const o=n.readSync(s.dataId),a=n.readSync(r.dataId),l=n.readSync(i.dataId),[u,c]=aH(o,s.shape,s.dtype,a,l);return n.makeTensorInfo(c,s.dtype,u)}const wRe={kernelName:Pb,backendName:"webgl",kernelFunc:vRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xRe(t){const{inputs:e,backend:n,attrs:s}=t,{sparseIndices:r,sparseValues:i,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:c,strides:h,outputSize:d}=Jl(i,r,a),f=!1;if(i.dtype==="string"){const g=n.bufferSync(r),w=n.bufferSync(i),b=ca(n.readSync(o.dataId)[0]),x=HCe(g,w,a,d,c,u,l,h,b,f);return n.makeTensorInfo(a,x.dtype,x.values)}const p=new gR(u,l,r.shape.length,i.shape.length,h,[d,1],f),m=n.runWebGLProgram(p,[i,r,o],i.dtype),v=xe({inputs:{x:m},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(m),v}const bRe={kernelName:Fb,backendName:"webgl",kernelFunc:xRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SRe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{numOrSizeSplits:i,axis:o}=s,a=Ze(o,r.shape)[0],l=JN(r,i,a),u=r.shape.length,c=new Array(u).fill(0),h=r.shape.slice();return l.map(d=>{const f=[...h];f[a]=d;const p=Rf({inputs:{x:r},backend:n,attrs:{begin:c,size:f}});return c[a]+=d,p})}const CRe={kernelName:ty,backendName:"webgl",kernelFunc:SRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $F="return sqrt(x);",IRe=mt({opSnippet:$F,packedOpSnippet:$F,cpuKernelImpl:QCe}),_Re={kernelName:nf,backendName:"webgl",kernelFunc:IRe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TRe="return x * x;",kRe=mt({opSnippet:TRe}),ERe={kernelName:Lb,backendName:"webgl",kernelFunc:kRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RF="return (a - b) * (a - b);",NRe=ps({opSnippet:RF,packedOpSnippet:RF}),$Re={kernelName:sf,backendName:"webgl",kernelFunc:NRe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RRe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const i=n.readSync(r.dataId),o=ma(i),a=JCe(o,"string",s);return n.makeTensorInfo(r.shape,"string",a)}const ARe={kernelName:sy,backendName:"webgl",kernelFunc:RRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DRe({inputs:t,attrs:e,backend:n}){const{x:s}=t,r=fi+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,i=new lo(s.shape,r);return n.runWebGLProgram(i,[s],s.dtype)}const ORe={kernelName:uf,backendName:"webgl",kernelFunc:DRe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PRe{constructor(e,n,s){this.variableNames=["x"],this.outputShape=s;const r=s.length,i=At(s.length),o=At(s.length);let a="";if(r===1)a="coords * strides + begin";else{let l=0;a=s.map((u,c)=>(l++,s.length===1?`coords * strides[${c}] + begin[${c}]`:`coords[${l-1}] * strides[${c}] + begin[${c}]`)).join(",")}this.userCode=`
      ${i} begin = ${i}(${e});
      ${i} strides = ${i}(${n});

      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FRe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:u,ellipsisMask:c,newAxisMask:h,shrinkAxisMask:d}=s,{finalShapeSparse:f,finalShape:p,isIdentity:m,sliceDim0:v,isSimpleSlice:g,begin:w,end:b,strides:x}=DN(r.shape,i,o,a,l,u,c,h,d);let S;if(m)S=xe({inputs:{x:r},backend:n,attrs:{shape:p}});else if(v||g){O(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const I=$N(w,b,x),C=Rf({inputs:{x:r},backend:n,attrs:{begin:w,size:I}});S=xe({inputs:{x:C},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(C)}else if(n.shouldExecuteOnCPU([r])){const C=n.readSync(r.dataId),_=Xe(r.shape,r.dtype,C),k=ZCe(f,_,x,w);S=n.makeTensorInfo(p,r.dtype,k.values)}else{const C=new PRe(w,x,f);S=n.runWebGLProgram(C,[r],r.dtype)}const N=xe({inputs:{x:S},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(S),N}const LRe={kernelName:Mb,backendName:"webgl",kernelFunc:FRe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MRe(t){const{inputs:e,backend:n,attrs:s}=t,{separator:r,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:c,dataSplits:h}=e,d=n.readSync(c.dataId),f=n.readSync(h.dataId),[p,m]=eIe(d,f,r,i,o,a,l,u);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(h.shape,"int32",m)]}const zRe={kernelName:zb,backendName:"webgl",kernelFunc:MRe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BRe(t){const{inputs:e,backend:n,attrs:s}=t,{skipEmpty:r}=s,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.readSync(i.dataId),l=n.readSync(o.dataId)[0],[u,c,h]=tIe(a,l,r),d=c.length;return[n.makeTensorInfo([d,2],"int32",u),n.makeTensorInfo([d],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(h))]}const VRe={kernelName:Bb,backendName:"webgl",kernelFunc:BRe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function URe(t){const{inputs:e,backend:n,attrs:s}=t,{numBuckets:r}=s,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=n.readSync(i.dataId),a=nIe(o,r);return n.makeTensorInfo(i.shape,"int32",a)}const WRe={kernelName:Vb,backendName:"webgl",kernelFunc:URe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jRe="return tan(x);",GRe=mt({opSnippet:jRe}),HRe={kernelName:of,backendName:"webgl",kernelFunc:GRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qRe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,KRe=mt({opSnippet:qRe}),XRe={kernelName:af,backendName:"webgl",kernelFunc:KRe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YRe(t){const{inputs:e,backend:n,attrs:s}=t,{tensor:r,indices:i,updates:o}=e,{sliceRank:a,numUpdates:l,sliceSize:u,strides:c,outputSize:h}=Jl(o,i,r.shape),d=[h/u,u];if(h===0)return n.makeTensorInfo(r.shape,i.dtype);const f=xe({inputs:{x:i},backend:n,attrs:{shape:[l,a]}}),p=xe({inputs:{x:o},backend:n,attrs:{shape:[l,u]}}),m=xe({inputs:{x:r},backend:n,attrs:{shape:d}}),v=new gR(l,a,f.shape.length,p.shape.length,c,d,!1,!0),g=n.runWebGLProgram(v,[p,f,m],m.dtype),w=xe({inputs:{x:g},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),w}const QRe={kernelName:$b,backendName:"webgl",kernelFunc:YRe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JRe{constructor(e,n){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[o]*n[o];this.outputShape=s,this.rank=s.length;const r=At(this.rank),i=ZRe(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${i}));
      }
    `}}function ZRe(t){const e=t.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${t[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let r=0;r<t.length;r++)s.push(`imod(${n[r]}, ${t[r]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BH(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reps:i}=s;if(r.dtype==="string"||r.shape.length>5){const l=n.readSync(r.dataId),u=r.dtype==="string"?l.map(d=>ca(d)):l,c=Xe(r.shape,r.dtype,u),h=rIe(c,i);return n.makeTensorInfo(h.shape,h.dtype,h.values)}const o=new JRe(r.shape,i);return n.runWebGLProgram(o,[r],r.dtype)}const eAe={kernelName:lf,backendName:"webgl",kernelFunc:BH};class tAe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class nAe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function au(t,e){e!==null&&t.disposeIntermediateTensorInfo(e)}function AF(t){let e=1;for(;e<t;)e*=2;return e}function sAe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{k:i,sorted:o}=s,a=Z().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=Z().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),u=r.shape,c=u[u.length-1];if(n.shouldExecuteOnCPU([r])||c<a||i>l){const k=n.readSync(r.dataId),[A,D]=iIe(k,u,r.dtype,i,o);return[n.makeTensorInfo(A.shape,A.dtype,A.values),n.makeTensorInfo(D.shape,D.dtype,D.values)]}if(i===0)return u[u.length-1]=0,[n.makeTensorInfo(u,r.dtype,[]),n.makeTensorInfo(u,"int32",[])];if(c===1)return[r,Gy({attrs:{shape:u,dtype:"int32",value:0},backend:n})];const h=n.texData.get(r.dataId),d=h!==null&&h.isPacked,f=d?n.unpackTensor(r):r,m=re(u)/c,v=xe({inputs:{x:f},attrs:{shape:[m,c]},backend:n});d&&au(n,f);const g=AF(i),w=AF(c);let b=null;const x=()=>b===null?[v,v]:[v,b],S=(k,A,D)=>{const R=x(),W=new tAe(D),M=[[c],[b===null?1:0],[Number.NEGATIVE_INFINITY],[k],[A]],X=b;b=n.runWebGLProgram(W,R,"int32",M),au(n,X)};for(let k=1;k<g;k*=2){const A=k*2;for(let D=k;D>=1;D/=2)S(A,D,[m,w])}for(let k=w;k>g;k/=2){const A=x(),D=new nAe([m,k/2]),W=[[c],[b===null?1:0],[g]],B=b;b=n.runWebGLProgram(D,A,"int32",W),au(n,B);const M=g/2,X=M*2;for(let z=M;z>=1;z/=2)S(X,z,b.shape)}let N=b;b=Rf({inputs:{x:b},backend:n,attrs:{begin:0,size:[m,i]}}),au(n,N);let I=AH({inputs:{x:v,indices:b},backend:n,attrs:{axis:1,batchDims:1}});au(n,v);const C=u.slice(0,-1);C.push(i),N=b,b=xe({inputs:{x:b},attrs:{shape:C},backend:n}),au(n,N);const _=I;return I=xe({inputs:{x:I},attrs:{shape:C},backend:n}),au(n,_),[I,b]}const rAe={kernelName:Ub,backendName:"webgl",kernelFunc:sAe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iAe{constructor(e,n,s,r,i,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const a=s==="nearest"?1:2;let l;switch(r){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${n}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${i});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${i});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${n}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oAe(t){const{inputs:e,backend:n,attrs:s}=t,{image:r,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:u}=s,[c,h,d,f]=r.shape,[p,m]=u??[h,d],v=[c,p,m,f],g=new iAe(h,d,o,a,l,v);return n.runWebGLProgram(g,[r,i],"float32")}const aAe={kernelName:Wb,backendName:"webgl",kernelFunc:oAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lAe(t){const{inputs:e,attrs:n,backend:s}=t,{axis:r}=n,{x:i}=e;If(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=s.readSync(i.dataId),{outputValues:a,outputShape:l,indices:u}=oIe(o,r,i.shape,i.dtype);return[s.makeTensorInfo(l,i.dtype,a),s.makeTensorInfo([u.length],"int32",u)]}const uAe={kernelName:jb,backendName:"webgl",kernelFunc:lAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cAe(t){const{inputs:e,backend:n,attrs:s}=t,{value:r}=e;let{axis:i}=s;i<0&&(i+=r.shape.length);const o=r,a=o.shape.length,l=r.shape[i],u=new Array(a-1);let c=0;for(let m=0;m<a;m++)m!==i&&(u[c++]=o.shape[m]);const h=[],d=new Array(a).fill(0),f=o.shape.slice();f[i]=1;const p=new Array(l);for(let m=0;m<p.length;m++){d[i]=m;const v=Rf({inputs:{x:o},backend:n,attrs:{begin:d,size:f}}),g=xe({inputs:{x:v},backend:n,attrs:{shape:u}});p[m]=g,h.push(v)}return h.forEach(m=>n.disposeIntermediateTensorInfo(m)),p}const hAe={kernelName:ry,backendName:"webgl",kernelFunc:cAe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dAe{constructor(e,n){this.variableNames=["x","segmentIds"];const s=e.windowSize,r=e.batchSize,i=e.inSize,o=e.numSegments,a=o*Math.ceil(i/s);this.outputShape=[r,a];const l="0.0",u="sumValue",c=Math.floor(s/4)*4,h=s%4,d=`
        sumValue += dot(values, segFilter);
    `;let f="";i%s>0&&(f=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `);let p="";i%s>0&&(p=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${f}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${p}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${o})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${o})));

        float sumValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${d}
        }

        int inIdx = inOffset + ${c};
        if (${h===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${d}
        } else if (${h===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${d}
        } else if (${h===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${d}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fAe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,segmentIds:i}=e,{numSegments:o}=s,a=r.shape.length,l=[];let u=0;const c=on([u],a);let h=r;c!=null&&(h=Fs({inputs:{x:r},backend:n,attrs:{perm:c}}),l.push(h),u=bn(1,a)[0]);const d=pU(h.shape,u,o),f=re([h.shape[u]]),p=xe({inputs:{x:h},backend:n,attrs:{shape:[-1,f]}});l.push(p);const m=qb(r.dtype),v=(x,S,N,I,C)=>{const _=x.shape[0],k=x.shape[1],A=fU(k,C),D={windowSize:A,inSize:k,batchSize:_,numSegments:C},R=new dAe(D,S),W=n.compileAndRun(R,[x,N],I);if(l.push(W),W.shape[1]===C)return W;const B=zH({backend:n,attrs:{start:0,stop:C,step:1,dtype:"float32"}}),M=BH({inputs:{x:B},backend:n,attrs:{reps:[k/A]}});return l.push(B),l.push(M),v(W,S,M,I,C)},g=v(p,"unsortedSegmentSum",i,m,o),w=xe({inputs:{x:g},backend:n,attrs:{shape:d}});let b=w;if(c!=null){l.push(w);const x=Kl(c);b=Fs({inputs:{x:b},backend:n,attrs:{perm:x}})}return l.forEach(x=>n.disposeIntermediateTensorInfo(x)),b}const pAe={kernelName:iy,backendName:"webgl",kernelFunc:fAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mAe=[JIe,e_e,s_e,o_e,l_e,h_e,f_e,m_e,w_e,b_e,I_e,k_e,$_e,O_e,L_e,z_e,V_e,G_e,q_e,X_e,Z_e,oTe,lTe,dTe,pTe,xTe,STe,TTe,PIe,NTe,OTe,MTe,jTe,qTe,XTe,QTe,ZTe,ske,oke,uke,hke,fke,mke,vke,xke,Ike,Tke,Nke,Ake,Oke,Mke,Uke,Hke,Xke,Jke,Zke,tEe,sEe,iEe,aEe,uEe,fEe,gEe,wEe,bEe,IEe,kEe,REe,PEe,OIe,LEe,ATe,BEe,WEe,HEe,LIe,YEe,eNe,nNe,oNe,uNe,fNe,gNe,xNe,INe,kNe,NNe,DNe,PNe,LNe,VNe,WNe,GNe,qNe,XNe,ZNe,s2e,a2e,m2e,BIe,w2e,S2e,_2e,E2e,gTe,R2e,D2e,P2e,M2e,U2e,zIe,j2e,H2e,K2e,Y2e,Q2e,yTe,h2e,e$e,r$e,l$e,UIe,d$e,m$e,w$e,S$e,T$e,E$e,R$e,O$e,L$e,B$e,W$e,H$e,Y$e,Z$e,sRe,oRe,rTe,f2e,uRe,hRe,fRe,mRe,yRe,wRe,bRe,CRe,_Re,ERe,$Re,ARe,ORe,LRe,zRe,VRe,WRe,d2e,XIe,HRe,XRe,QRe,eAe,rAe,aAe,YIe,uAe,hAe,pAe,A2e];for(const t of mAe)Hb(t);/** @license See the LICENSE file. */const gAe="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yAe={"tfjs-core":jV,"tfjs-backend-cpu":Xj,"tfjs-backend-webgl":cH,"tfjs-data":ZW,"tfjs-layers":X1,"tfjs-converter":PW,tfjs:gAe},vAe=Object.freeze(Object.defineProperty({__proto__:null,Abs:rg,Acos:pd,Acosh:md,AdadeltaOptimizer:xN,AdagradOptimizer:bN,AdamOptimizer:SN,AdamaxOptimizer:CN,Add:Sc,AddN:ig,All:Vx,Any:Ux,ArgMax:og,ArgMin:ag,Asin:gd,Asinh:yd,Atan:vd,Atan2:xd,Atanh:wd,AvgPool:lg,AvgPool3D:ug,AvgPool3DGrad:jx,AvgPoolGrad:Wx,BatchMatMul:cg,BatchToSpaceND:hg,Bincount:Gx,BitwiseAnd:dg,BroadcastArgs:Hx,BroadcastTo:z4,Callback:$W,CallbackList:DU,Cast:bd,Ceil:Sd,ClipByValue:Cd,Complex:qx,ComplexAbs:fg,Concat:pg,Conv2D:mg,Conv2DBackpropFilter:Kx,Conv2DBackpropInput:gg,Conv3D:yg,Conv3DBackpropFilterV2:Xx,Conv3DBackpropInputV2:Yx,Cos:Id,Cosh:_d,CropAndResize:Jx,Cumprod:Qx,Cumsum:vg,CustomCallback:PU,DataStorage:jk,DenseBincount:Zx,DepthToSpace:eb,DepthwiseConv2dNative:wg,DepthwiseConv2dNativeBackpropFilter:tb,DepthwiseConv2dNativeBackpropInput:nb,Diag:sb,Dilation2D:xg,Dilation2DBackpropFilter:Iw,Dilation2DBackpropInput:Cw,Draw:rb,get ENV(){return Xk},EarlyStopping:RW,Einsum:ib,Elu:kd,EluGrad:ob,Environment:L4,Equal:bg,Erf:Ed,Exp:Nd,ExpandDims:Sg,Expm1:$d,FFT:ab,Fill:lb,FlipLeftRight:ub,Floor:Rd,FloorDiv:Ad,FromPixels:_w,FusedBatchNorm:Cg,FusedConv2D:xm,FusedDepthwiseConv2D:bm,GPGPUContext:wv,GatherNd:cb,GatherV2:Ig,GraphModel:$$,Greater:_g,GreaterEqual:Dd,History:OU,IFFT:hb,Identity:Od,Imag:db,InputSpec:Nn,IsFinite:Pd,IsInf:Fd,IsNan:Ld,KernelBackend:Mx,LRN:Ag,LRNGrad:pb,LayerVariable:NU,LayersModel:ta,LeakyRelu:Tg,Less:kg,LessEqual:Eg,LinSpace:fb,Log:Md,Log1p:zd,LogSoftmax:B4,LogicalAnd:Ng,LogicalNot:$g,LogicalOr:Rg,LogicalXor:Aee,LowerBound:Dee,MathBackendCPU:zy,MathBackendWebGL:Wy,MatrixBandPart:Oee,Max:Dg,MaxPool:Og,MaxPool3D:Pg,MaxPool3DGrad:gb,MaxPoolGrad:mb,MaxPoolWithArgmax:yb,Maximum:Bd,Mean:Fg,Min:Lg,Minimum:Vd,MirrorPad:Mg,Mod:Ud,MomentumOptimizer:IN,Multinomial:vb,Multiply:Wd,Neg:zg,NonMaxSuppressionV3:wb,NonMaxSuppressionV4:xb,NonMaxSuppressionV5:bb,NotEqual:Bg,OP_SCOPE_SUFFIX:tE,OneHot:Ug,OnesLike:Vg,Optimizer:Ta,OptimizerConstructors:GV,Pack:Wg,PadV2:jg,Pool:Pee,Pow:jd,Prelu:Gg,Prod:Hg,RMSPropOptimizer:_N,RNN:Qi,RaggedGather:Sb,RaggedRange:Cb,RaggedTensorToTensor:Ib,Range:_b,get Rank(){return QI},Real:Tb,RealDiv:Td,Reciprocal:Gd,get Reduction(){return As},Relu:Hd,Relu6:qd,Reshape:qg,ResizeBilinear:Xg,ResizeBilinearGrad:Eb,ResizeNearestNeighbor:Kg,ResizeNearestNeighborGrad:kb,Reverse:Yg,RotateWithOffset:Gb,Round:Kd,Rsqrt:Xd,SGDOptimizer:R1,ScatterNd:Nb,SearchSorted:Rb,Select:Qg,Selu:Yd,Sequential:rc,Sigmoid:ef,Sign:Zd,Sin:Qd,Sinh:Jd,Slice:Jg,Softmax:ny,Softplus:tf,SpaceToBatchND:ey,SparseFillEmptyRows:Ab,SparseReshape:Db,SparseSegmentMean:Ob,SparseSegmentSum:Pb,SparseToDense:Fb,SplitV:ty,Sqrt:nf,Square:Lb,SquaredDifference:sf,StaticRegexReplace:sy,Step:uf,StridedSlice:Mb,StringNGrams:zb,StringSplit:Bb,StringToHashBucketFast:Vb,Sub:rf,Sum:Zg,SymbolicTensor:ji,Tan:of,Tanh:af,Tensor:pt,TensorBuffer:$n,TensorScatterUpdate:$b,Tile:lf,TopK:Ub,Transform:Wb,Transpose:Au,Unique:jb,Unpack:ry,UnsortedSegmentSum:iy,UpperBound:Fee,Variable:Im,ZerosLike:oy,_FusedMatMul:wm,abs:Tn,acos:uE,acosh:cE,add:he,addN:xB,all:Yb,any:Tm,argMax:Qu,argMin:hE,asin:dE,asinh:fE,atan:pE,atan2:mE,atanh:gE,avgPool:cy,avgPool3d:vE,backend:sE,backend_util:gU,basicLSTMCell:bB,batchNorm:cf,batchNorm2d:wE,batchNorm3d:xE,batchNorm4d:bE,batchToSpaceND:hy,bincount:SE,bitwiseAnd:SB,booleanMaskAsync:aV,broadcastArgs:CB,broadcastTo:Du,broadcast_util:fse,browser:Ele,buffer:Xe,callbacks:Gpe,cast:ge,ceil:CE,clipByValue:Qs,clone:yo,complex:da,concat:wn,concat1d:IE,concat2d:_E,concat3d:TE,concat4d:kE,constraints:$he,conv1d:Qb,conv2d:fa,conv2dTranspose:Jb,conv3d:NE,conv3dTranspose:$E,copyRegisteredKernels:Bee,cos:dy,cosh:Zb,cosineWindow:C1,cumprod:Nm,cumsum:e1,customGrad:Io,data:yye,denseBincount:Nw,deprecationWarn:yte,depthToSpace:RE,depthwiseConv2d:hf,deregisterOp:Kpe,device_util:hte,diag:_B,dilation2d:AE,disableDeprecationWarnings:gte,dispose:je,disposeVariables:vte,div:Re,divNoNan:DE,dot:OE,dropout:mN,einsum:gu,elu:df,enableDebugMode:mte,enableProdMode:pte,enclosingPowerOfTwo:gN,engine:xi,ensureShape:TB,env:Z,equal:yr,erf:t1,euclideanNorm:FE,exp:Js,expandDims:ss,expm1:LE,eye:n1,fft:_y,fill:Ic,findBackend:Ite,findBackendFactory:_te,floor:pf,floorDiv:Xb,forceHalfFloat:hH,fused:gV,gather:mf,gatherND:hV,gather_util:Nle,getBackend:oB,getGradient:KI,getKernel:Cm,getKernelsForBackend:Tw,gpgpu_util:pCe,grad:Yse,grads:Qse,greater:Ms,greaterEqual:Ca,ifft:Xh,imag:fy,image:ri,inTopKAsync:dV,initializers:Hhe,input:XU,io:EN,irfft:y1,isFinite:ME,isInf:zE,isNaN:BE,keep:On,kernel_impls:Mle,layers:bpe,leakyRelu:py,less:Gh,lessEqual:Xl,linalg:wN,linspace:NB,loadGraphModel:wge,loadGraphModelSync:xge,loadLayersModel:Fde,localResponseNormalization:VE,log:vr,log1p:my,logSigmoid:UE,logSoftmax:r1,logSumExp:gy,logicalAnd:ci,logicalNot:yy,logicalOr:i1,logicalXor:WE,losses:CV,lowerBound:RB,matMul:Je,math:wle,max:Lr,maxPool:vy,maxPool3d:jE,maxPoolWithArgmax:AB,maximum:Eo,mean:nn,memory:s_,meshgrid:DB,metrics:Mpe,min:jh,minimum:Al,mirrorPad:GE,mod:HE,model:zde,models:zpe,moments:wy,movingAverage:lV,mul:G,multiRNNCell:OB,multinomial:PB,neg:Bt,nextFrame:ON,norm:ff,notEqual:ec,oneHot:Hh,ones:js,onesLike:wr,op:U,outerProduct:FB,pad:Ia,pad1d:LB,pad2d:MB,pad3d:zB,pad4d:BB,pool:qE,pow:Co,prelu:by,print:lE,prod:KE,profile:wte,raggedGather:VB,raggedRange:UB,raggedTensorToTensor:WB,rand:jB,randomGamma:KB,randomNormal:l1,randomStandardNormal:XB,randomUniform:Yl,randomUniformInt:YB,range:tc,ready:Ste,real:qh,reciprocal:iN,registerBackend:nE,registerCallbackConstructor:Vde,registerGradient:V4,registerKernel:Hb,registerOp:qpe,regularizers:Wpe,relu:Xi,relu6:u1,removeBackend:Cte,reshape:H,reverse:zr,reverse1d:QB,reverse2d:JB,reverse3d:ZB,reverse4d:eV,rfft:Ty,round:c1,rsqrt:h1,scalar:Le,scatterND:uV,scatter_util:Jie,searchSorted:o1,selu:d1,separableConv2d:f1,sequential:Bde,serialization:Zae,setBackend:bte,setPlatform:Tte,setWebGLContext:fG,setdiff1dAsync:tV,shared:Kj,sigmoid:Fi,sign:oN,signal:SV,sin:p1,sinh:m1,slice:lt,slice1d:Sy,slice2d:g1,slice3d:Cy,slice4d:Kh,slice_util:WV,softmax:Iy,softplus:_c,spaceToBatchND:xy,sparse:IV,sparseToDense:cV,spectral:bV,split:qs,sqrt:Kn,square:$t,squaredDifference:v1,squeeze:Ql,stack:Ps,step:kc,stridedSlice:aN,string:_V,sub:_e,sum:Te,sumOutType:qb,tan:lN,tanh:Rl,tensor:gr,tensor1d:os,tensor2d:yl,tensor3d:uN,tensor4d:nV,tensor5d:sV,tensor6d:rV,tensorScatterUpdate:iV,tensor_util:ote,test_util:hie,tidy:J,tile:Ar,time:xte,topk:hN,train:fu,transpose:ot,truncatedNormal:x1,unique:dN,unregisterGradient:zee,unregisterKernel:Mee,unsortedSegmentSum:b1,unstack:Br,upcastType:Xs,upperBound:oV,util:Kee,valueAndGrad:Jse,valueAndGrads:Zse,variable:fN,variableGrads:$B,version:yAe,version_converter:PW,version_core:jV,version_cpu:Xj,version_layers:X1,version_webgl:cH,webgl:DIe,webgl_util:xSe,where:Hn,whereAsync:pN,zeros:En,zerosLike:ct},Symbol.toStringTag,{value:"Module"})),Mm=j_(vAe);var hc={};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(hc,"__esModule",{value:!0});hc.cropTensor=hc.capture=void 0;var Eu=Mm;function wAe(t,e){return Eu.tidy(function(){var n=Eu.browser.fromPixels(t),s=VH(n,e),r=s.expandDims(0);return r.toFloat().div(Eu.scalar(127)).sub(Eu.scalar(1))})}hc.capture=wAe;function VH(t,e,n){var s=Math.min(t.shape[0],t.shape[1]),r=t.shape[0]/2,i=r-s/2,o=t.shape[1]/2,a=o-s/2;if(e&&!n){var l=t.slice([i,a,0],[s,s,3]);l=l.reshape([s*s,1,3]);var u=[.2989,.587,.114];return l=Eu.mul(l,u),l=l.reshape([s,s,3]),l=Eu.sum(l,-1),l=Eu.expandDims(l,-1),l}return t.slice([i,a,0],[s,s,3])}hc.cropTensor=VH;var Ri={};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(Ri,"__esModule",{value:!0});Ri.cropTo=Ri.resizeMinTo=Ri.resizeMaxTo=Ri.resize=void 0;var uS=function(){return document.createElement("canvas")};function yR(t,e,n){n===void 0&&(n=uS()),n.width=t.width*e,n.height=t.height*e;var s=n.getContext("2d");return s.drawImage(t,0,0,n.width,n.height),n}Ri.resize=yR;function xAe(t,e,n){n===void 0&&(n=uS());var s=Math.max(t.width,t.height);return yR(t,e/s,n)}Ri.resizeMaxTo=xAe;function bAe(t,e,n){n===void 0&&(n=uS());var s=Math.min(t.width,t.height);return yR(t,e/s,n)}Ri.resizeMinTo=bAe;function SAe(t,e,n,s){n===void 0&&(n=!1),s===void 0&&(s=uS());var r=t.width,i=t.height;t instanceof HTMLVideoElement&&(r=t.videoWidth,i=t.videoHeight);var o=Math.min(r,i),a=e/o,l=Math.ceil(r*a),u=Math.ceil(i*a),c=l-e,h=u-e;s.width=s.height=e;var d=s.getContext("2d");return d.drawImage(t,~~(c/2)*-1,~~(h/2)*-1,l,u),n&&(d.scale(-1,1),d.drawImage(s,e*-1,0)),s}Ri.cropTo=SAe;var Hy={};/** @license See the LICENSE file. */Object.defineProperty(Hy,"__esModule",{value:!0});Hy.version=void 0;var CAe="0.8.4-alpha2";Hy.version=CAe;(function(t){/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var e=qe&&qe.__awaiter||function(I,C,_,k){function A(D){return D instanceof _?D:new _(function(R){R(D)})}return new(_||(_=Promise))(function(D,R){function W(X){try{M(k.next(X))}catch(z){R(z)}}function B(X){try{M(k.throw(X))}catch(z){R(z)}}function M(X){X.done?D(X.value):A(X.value).then(W,B)}M((k=k.apply(I,C||[])).next())})},n=qe&&qe.__generator||function(I,C){var _={label:0,sent:function(){if(D[0]&1)throw D[1];return D[1]},trys:[],ops:[]},k,A,D,R;return R={next:W(0),throw:W(1),return:W(2)},typeof Symbol=="function"&&(R[Symbol.iterator]=function(){return this}),R;function W(M){return function(X){return B([M,X])}}function B(M){if(k)throw new TypeError("Generator is already executing.");for(;_;)try{if(k=1,A&&(D=M[0]&2?A.return:M[0]?A.throw||((D=A.return)&&D.call(A),0):A.next)&&!(D=D.call(A,M[1])).done)return D;switch(A=0,D&&(M=[M[0]&2,D.value]),M[0]){case 0:case 1:D=M;break;case 4:return _.label++,{value:M[1],done:!1};case 5:_.label++,A=M[1],M=[0];continue;case 7:M=_.ops.pop(),_.trys.pop();continue;default:if(D=_.trys,!(D=D.length>0&&D[D.length-1])&&(M[0]===6||M[0]===2)){_=0;continue}if(M[0]===3&&(!D||M[1]>D[0]&&M[1]<D[3])){_.label=M[1];break}if(M[0]===6&&_.label<D[1]){_.label=D[1],D=M;break}if(D&&_.label<D[2]){_.label=D[2],_.ops.push(M);break}D[2]&&_.ops.pop(),_.trys.pop();continue}M=C.call(I,_)}catch(X){M=[6,X],A=0}finally{k=D=0}if(M[0]&5)throw M[1];return{value:M[0]?M[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.loadFromFiles=t.load=t.loadTruncatedMobileNet=t.CustomMobileNet=t.getTopKClasses=t.IMAGE_SIZE=void 0;var s=Mm,r=Mm,i=hc,o=Ri,a=Hy,l=1,u="conv_pw_13_relu",c="out_relu",h=.25,d=.35;t.IMAGE_SIZE=224;var f=function(I){return I.packageVersion=I.packageVersion||a.version,I.packageName=I.packageName||"@teachablemachine/image",I.timeStamp=I.timeStamp||new Date().toISOString(),I.userMetadata=I.userMetadata||{},I.modelName=I.modelName||"untitled",I.labels=I.labels||[],I.imageSize=I.imageSize||t.IMAGE_SIZE,I},p=function(I){return!!I&&Array.isArray(I.labels)},m=function(I,C){if(I===1){if(C!==.25&&C!==.5&&C!==.75&&C!==1)return console.warn("Invalid alpha. Options are: 0.25, 0.50, 0.75 or 1.00."),console.log("Loading model with alpha: ",h.toFixed(2)),h}else if(C!==.35&&C!==.5&&C!==.75&&C!==1)return console.warn("Invalid alpha. Options are: 0.35, 0.50, 0.75 or 1.00."),console.log("Loading model with alpha: ",d.toFixed(2)),d;return C},v=function(I){if(I=I||{},I.checkpointUrl&&I.trainingLayer)return(I.alpha||I.version)&&console.warn("Checkpoint URL passed to modelOptions, alpha options are ignored"),[I.checkpointUrl,I.trainingLayer];if(I.version=I.version||l,I.version===1){I.alpha=I.alpha||h,I.alpha=m(I.version,I.alpha),console.log("Loading mobilenet "+I.version+" and alpha "+I.alpha);var C=I.alpha.toFixed(2);return C==="1.00"&&(C="1.0"),["https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v1_"+C+"_"+t.IMAGE_SIZE+"/model.json",u]}else{if(I.version===2)return I.alpha=I.alpha||d,I.alpha=m(I.version,I.alpha),console.log("Loading mobilenet "+I.version+" and alpha "+I.alpha),["https://storage.googleapis.com/teachable-machine-models/mobilenet_v2_weights_tf_dim_ordering_tf_kernels_"+I.alpha.toFixed(2)+"_"+t.IMAGE_SIZE+"_no_top/model.json",c];throw new Error("MobileNet V"+I.version+" doesn't exist")}},g=function(I){return e(void 0,void 0,void 0,function(){var C,_;return n(this,function(k){switch(k.label){case 0:return typeof I!="string"?[3,3]:[4,fetch(I)];case 1:return _=k.sent(),[4,_.json()];case 2:return C=k.sent(),[3,4];case 3:if(p(I))C=I;else throw new Error("Invalid Metadata provided");k.label=4;case 4:return[2,f(C)]}})})};function w(I,C,_){return _===void 0&&(_=3),e(this,void 0,void 0,function(){var k;return n(this,function(A){switch(A.label){case 0:return[4,C.data()];case 1:return k=A.sent(),[2,s.tidy(function(){_=Math.min(_,k.length);for(var D=[],R=0;R<k.length;R++)D.push({value:k[R],index:R});D.sort(function(X,z){return z.value-X.value});for(var W=new Float32Array(_),B=new Int32Array(_),R=0;R<_;R++)W[R]=D[R].value,B[R]=D[R].index;for(var M=[],R=0;R<B.length;R++)M.push({className:I[B[R]],probability:W[R]});return M})]}})})}t.getTopKClasses=w;var b=function(){function I(C,_){this.model=C,this._metadata=f(_)}return Object.defineProperty(I,"EXPECTED_IMAGE_SIZE",{get:function(){return t.IMAGE_SIZE},enumerable:!1,configurable:!0}),I.prototype.getMetadata=function(){return this._metadata},I.prototype.getTotalClasses=function(){var C=this.model.output,_=C.shape[1];return _},I.prototype.getClassLabels=function(){return this._metadata.labels},I.prototype.predictTopK=function(C,_,k){return _===void 0&&(_=10),k===void 0&&(k=!1),e(this,void 0,void 0,function(){var A,D,R,W=this;return n(this,function(B){switch(B.label){case 0:return A=o.cropTo(C,this._metadata.imageSize,k),D=s.tidy(function(){var M=i.capture(A,W._metadata.grayscale);return W.model.predict(M)}),[4,w(this._metadata.labels,D,_)];case 1:return R=B.sent(),r.dispose(D),[2,R]}})})},I.prototype.predict=function(C,_){return _===void 0&&(_=!1),e(this,void 0,void 0,function(){var k,A,D,R,W,B=this;return n(this,function(M){switch(M.label){case 0:return k=o.cropTo(C,this._metadata.imageSize,_),A=s.tidy(function(){var X=i.capture(k,B._metadata.grayscale);return B.model.predict(X)}),[4,A.data()];case 1:for(D=M.sent(),R=[],W=0;W<D.length;W++)R.push({className:this._metadata.labels[W],probability:D[W]});return r.dispose(A),[2,R]}})})},I.prototype.dispose=function(){this.truncatedModel.dispose()},I}();t.CustomMobileNet=b;function x(I){return e(this,void 0,void 0,function(){var C,_,k,A,D,R,W,D,R,W;return n(this,function(B){switch(B.label){case 0:return C=v(I),_=C[0],k=C[1],[4,s.loadLayersModel(_)];case 1:return A=B.sent(),I&&I.version===1?(D=A.getLayer(k),R=s.model({inputs:A.inputs,outputs:D.output}),W=s.sequential(),W.add(R),W.add(s.layers.flatten()),[2,W]):(D=A.getLayer(k),R=s.model({inputs:A.inputs,outputs:D.output}),W=s.sequential(),W.add(R),W.add(s.layers.globalAveragePooling2d({})),[2,W])}})})}t.loadTruncatedMobileNet=x;function S(I,C){return e(this,void 0,void 0,function(){var _,k,A;return n(this,function(D){switch(D.label){case 0:return[4,s.loadLayersModel(I)];case 1:return _=D.sent(),C?[4,g(C)]:[3,3];case 2:return A=D.sent(),[3,4];case 3:A=null,D.label=4;case 4:return k=A,[2,new b(_,k)]}})})}t.load=S;function N(I,C,_){return e(this,void 0,void 0,function(){var k,A,D,R;return n(this,function(W){switch(W.label){case 0:return[4,s.loadLayersModel(s.io.browserFiles([I,C]))];case 1:return k=W.sent(),[4,new Response(_).json()];case 2:return A=W.sent(),_?[4,g(A)]:[3,4];case 3:return R=W.sent(),[3,5];case 4:R=null,W.label=5;case 5:return D=R,[2,new b(k,D)]}})})}t.loadFromFiles=N})(Wk);var nd={},vR={exports:{}};vR.exports;(function(t){(function(e,n,s){function r(l){var u=this,c=a();u.next=function(){var h=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=h-(u.c=h|0)},u.c=1,u.s0=c(" "),u.s1=c(" "),u.s2=c(" "),u.s0-=c(l),u.s0<0&&(u.s0+=1),u.s1-=c(l),u.s1<0&&(u.s1+=1),u.s2-=c(l),u.s2<0&&(u.s2+=1),c=null}function i(l,u){return u.c=l.c,u.s0=l.s0,u.s1=l.s1,u.s2=l.s2,u}function o(l,u){var c=new r(l),h=u&&u.state,d=c.next;return d.int32=function(){return c.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,h&&(typeof h=="object"&&i(h,c),d.state=function(){return i(c,{})}),d}function a(){var l=4022871197,u=function(c){c=c.toString();for(var h=0;h<c.length;h++){l+=c.charCodeAt(h);var d=.02519603282416938*l;l=d>>>0,d-=l,d*=l,l=d>>>0,d-=l,l+=d*4294967296}return(l>>>0)*23283064365386963e-26};return u}n&&n.exports?n.exports=o:this.alea=o})(qe,t)})(vR);var IAe=vR.exports,wR={exports:{}};wR.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var h=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^h^h>>>8},a===(a|0)?l.x=a:u+=a;for(var c=0;c<u.length+64;c++)l.x^=u.charCodeAt(c)|0,l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function o(a,l){var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:this.xor128=o})(qe,t)})(wR);var _Ae=wR.exports,xR={exports:{}};xR.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.next=function(){var h=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(h^h<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:u+=a;for(var c=0;c<u.length+64;c++)l.x^=u.charCodeAt(c)|0,c==u.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function o(a,l){var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:this.xorwow=o})(qe,t)})(xR);var TAe=xR.exports,bR={exports:{}};bR.exports;(function(t){(function(e,n,s){function r(a){var l=this;l.next=function(){var c=l.x,h=l.i,d,f;return d=c[h],d^=d>>>7,f=d^d<<24,d=c[h+1&7],f^=d^d>>>10,d=c[h+3&7],f^=d^d>>>3,d=c[h+4&7],f^=d^d<<7,d=c[h+7&7],d=d^d<<13,f^=d^d<<9,c[h]=f,l.i=h+1&7,f};function u(c,h){var d,f=[];if(h===(h|0))f[0]=h;else for(h=""+h,d=0;d<h.length;++d)f[d&7]=f[d&7]<<15^h.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?f[7]=-1:f[d],c.x=f,c.i=0,d=256;d>0;--d)c.next()}u(l,a)}function i(a,l){return l.x=a.x.slice(),l.i=a.i,l}function o(a,l){a==null&&(a=+new Date);var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(c.x&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:this.xorshift7=o})(qe,t)})(bR);var kAe=bR.exports,SR={exports:{}};SR.exports;(function(t){(function(e,n,s){function r(a){var l=this;l.next=function(){var c=l.w,h=l.X,d=l.i,f,p;return l.w=c=c+1640531527|0,p=h[d+34&127],f=h[d=d+1&127],p^=p<<13,f^=f<<17,p^=p>>>15,f^=f>>>12,p=h[d]=p^f,l.i=d,p+(c^c>>>16)|0};function u(c,h){var d,f,p,m,v,g=[],w=128;for(h===(h|0)?(f=h,h=null):(h=h+"\0",f=0,w=Math.max(w,h.length)),p=0,m=-32;m<w;++m)h&&(f^=h.charCodeAt((m+32)%h.length)),m===0&&(v=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,m>=0&&(v=v+1640531527|0,d=g[m&127]^=f+v,p=d==0?p+1:0);for(p>=128&&(g[(h&&h.length||0)&127]=-1),p=127,m=4*128;m>0;--m)f=g[p+34&127],d=g[p=p+1&127],f^=f<<13,d^=d<<17,f^=f>>>15,d^=d>>>12,g[p]=f^d;c.w=v,c.X=g,c.i=p}u(l,a)}function i(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function o(a,l){a==null&&(a=+new Date);var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(c.X&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:this.xor4096=o})(qe,t)})(SR);var EAe=SR.exports,CR={exports:{}};CR.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.next=function(){var h=l.b,d=l.c,f=l.d,p=l.a;return h=h<<25^h>>>7^d,d=d-f|0,f=f<<24^f>>>8^p,p=p-h|0,l.b=h=h<<20^h>>>12^d,l.c=d=d-f|0,l.d=f<<16^d>>>16^p,l.a=p-h|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):u+=a;for(var c=0;c<u.length+20;c++)l.b^=u.charCodeAt(c)|0,l.next()}function i(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function o(a,l){var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,f=(u.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:this.tychei=o})(qe,t)})(CR);var NAe=CR.exports,UH={exports:{}};(function(t){(function(e,n){var s=(0,eval)("this"),r=256,i=6,o=52,a="random",l=n.pow(r,i),u=n.pow(2,o),c=u*2,h=r-1,d;function f(x,S,N){var I=[];S=S==!0?{entropy:!0}:S||{};var C=g(v(S.entropy?[x,b(e)]:x??w(),3),I),_=new p(I),k=function(){for(var A=_.g(i),D=l,R=0;A<u;)A=(A+R)*r,D*=r,R=_.g(1);for(;A>=c;)A/=2,D/=2,R>>>=1;return(A+R)/D};return k.int32=function(){return _.g(4)|0},k.quick=function(){return _.g(4)/4294967296},k.double=k,g(b(_.S),e),(S.pass||N||function(A,D,R,W){return W&&(W.S&&m(W,_),A.state=function(){return m(_,{})}),R?(n[a]=A,D):A})(k,C,"global"in S?S.global:this==n,S.state)}n["seed"+a]=f;function p(x){var S,N=x.length,I=this,C=0,_=I.i=I.j=0,k=I.S=[];for(N||(x=[N++]);C<r;)k[C]=C++;for(C=0;C<r;C++)k[C]=k[_=h&_+x[C%N]+(S=k[C])],k[_]=S;(I.g=function(A){for(var D,R=0,W=I.i,B=I.j,M=I.S;A--;)D=M[W=h&W+1],R=R*r+M[h&(M[W]=M[B=h&B+D])+(M[B]=D)];return I.i=W,I.j=B,R})(r)}function m(x,S){return S.i=x.i,S.j=x.j,S.S=x.S.slice(),S}function v(x,S){var N=[],I=typeof x,C;if(S&&I=="object")for(C in x)try{N.push(v(x[C],S-1))}catch{}return N.length?N:I=="string"?x:x+"\0"}function g(x,S){for(var N=x+"",I,C=0;C<N.length;)S[h&C]=h&(I^=S[h&C]*19)+N.charCodeAt(C++);return b(S)}function w(){try{var x;return d&&(x=d.randomBytes)?x=x(r):(x=new Uint8Array(r),(s.crypto||s.msCrypto).getRandomValues(x)),b(x)}catch{var S=s.navigator,N=S&&S.plugins;return[+new Date,s,N,s.screen,b(e)]}}function b(x){return String.fromCharCode.apply(0,x)}if(g(n.random(),e),t.exports){t.exports=f;try{d=a1}catch{}}})([],Math)})(UH);var $Ae=UH.exports,RAe=IAe,AAe=_Ae,DAe=TAe,OAe=kAe,PAe=EAe,FAe=NAe,Mc=$Ae;Mc.alea=RAe;Mc.xor128=AAe;Mc.xorwow=DAe;Mc.xorshift7=OAe;Mc.xor4096=PAe;Mc.tychei=FAe;var LAe=Mc;/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var MAe=qe&&qe.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,r){s.__proto__=r}||function(s,r){for(var i in r)r.hasOwnProperty(i)&&(s[i]=r[i])},t(e,n)};return function(e,n){t(e,n);function s(){this.constructor=e}e.prototype=n===null?Object.create(n):(s.prototype=n.prototype,new s)}}(),Lo=qe&&qe.__awaiter||function(t,e,n,s){function r(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(c){try{u(s.next(c))}catch(h){o(h)}}function l(c){try{u(s.throw(c))}catch(h){o(h)}}function u(c){c.done?i(c.value):r(c.value).then(a,l)}u((s=s.apply(t,e||[])).next())})},Mo=qe&&qe.__generator||function(t,e){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},s,r,i,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(c){return l([u,c])}}function l(u){if(s)throw new TypeError("Generator is already executing.");for(;n;)try{if(s=1,r&&(i=u[0]&2?r.return:u[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,u[1])).done)return i;switch(r=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,r=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){n.label=u[1];break}if(u[0]===6&&n.label<i[1]){n.label=i[1],i=u;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(u);break}i[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(c){u=[6,c],r=0}finally{s=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};Object.defineProperty(nd,"__esModule",{value:!0});nd.createTeachable=nd.TeachableMobileNet=void 0;var ys=Mm,zAe=Mm,BAe=hc,WH=Wk,VAe=LAe,UAe=.15,WAe=function(t){return typeof t.dataId=="object"&&typeof t.shape=="object"};function jAe(t,e){var n=new Array(e).fill(0);return n[t]=1,n}function IC(t,e){for(var n,s=t.length,r=t.slice(),i=s-1;i>0;i-=1){var o=void 0;e?o=Math.floor(e()*(i+1)):o=Math.floor(Math.random()*(i+1)),n=[r[o],r[i]],r[i]=n[0],r[o]=n[1]}return r}var jH=function(t){MAe(e,t);function e(n,s){var r=t.call(this,ys.sequential(),s)||this;return r.totalSamples=0,r.examples=[],r.truncatedModel=n,r}return Object.defineProperty(e.prototype,"asSequentialModel",{get:function(){return this.model},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isTrained",{get:function(){return!!this.model&&this.model.layers&&this.model.layers.length>2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isPrepared",{get:function(){return!!this.trainDataset},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"numClasses",{get:function(){return this._metadata.labels.length},enumerable:!1,configurable:!0}),e.prototype.addExample=function(n,s){return Lo(this,void 0,void 0,function(){var r,i,o;return Mo(this,function(a){return r=WAe(s)?s:BAe.capture(s,this._metadata.grayscale),i=this.truncatedModel.predict(r),o=i.dataSync(),r.dispose(),i.dispose(),this.examples[n].push(o),this.totalSamples++,[2]})})},e.prototype.predict=function(n,s){return s===void 0&&(s=!1),Lo(this,void 0,void 0,function(){return Mo(this,function(r){if(!this.model)throw new Error("Model has not been trained yet, called train() first");return[2,t.prototype.predict.call(this,n,s)]})})},e.prototype.predictTopK=function(n,s,r){return s===void 0&&(s=10),r===void 0&&(r=!1),Lo(this,void 0,void 0,function(){return Mo(this,function(i){if(!this.model)throw new Error("Model has not been trained yet, called train() first");return[2,t.prototype.predictTopK.call(this,n,s,r)]})})},e.prototype.prepare=function(){for(var n in this.examples)if(n.length===0)throw new Error("Add some examples before training");var s=this.convertToTfDataset();this.trainDataset=s.trainDataset,this.validationDataset=s.validationDataset},e.prototype.convertToTfDataset=function(){for(var n=0;n<this.examples.length;n++)this.examples[n]=IC(this.examples[n],this.seed);for(var s=[],r=[],i=function(h){var d=jAe(h,o.numClasses),f=o.examples[h].length,p=Math.ceil(UAe*f),m=f-p,v=o.examples[h].slice(0,m).map(function(w){return{data:w,label:d}}),g=o.examples[h].slice(m).map(function(w){return{data:w,label:d}});s=s.concat(v),r=r.concat(g)},o=this,n=0;n<this.examples.length;n++)i(n);s=IC(s,this.seed),r=IC(r,this.seed);var a=ys.data.array(s.map(function(h){return h.data})),l=ys.data.array(r.map(function(h){return h.data})),u=ys.data.array(s.map(function(h){return h.label})),c=ys.data.array(r.map(function(h){return h.label}));return{trainDataset:ys.data.zip({xs:a,ys:u}),validationDataset:ys.data.zip({xs:l,ys:c})}},e.prototype.save=function(n,s){return Lo(this,void 0,void 0,function(){return Mo(this,function(r){return[2,this.model.save(n,s)]})})},e.prototype.train=function(n,s){return s===void 0&&(s={}),Lo(this,void 0,void 0,function(){var r,i,o,a,l,u,c,h,d,f=this;return Mo(this,function(p){switch(p.label){case 0:if(r=s.onTrainEnd||function(){},s.onTrainEnd=function(m){f.__stopTrainingResolve&&(f.__stopTrainingResolve(),f.__stopTrainingResolve=null),r(m)},this.isPrepared||this.prepare(),i=this.getLabels().length,zAe.util.assert(i===this.numClasses,function(){return"Can not train, has "+i+" labels and "+f.numClasses+" classes"}),o=this.truncatedModel.outputs[0].shape.slice(1),a=ys.util.sizeFromShape(o),this.seed?l=ys.initializers.varianceScaling({seed:3.14}):l=ys.initializers.varianceScaling({}),this.trainingModel=ys.sequential({layers:[ys.layers.dense({inputShape:[a],units:n.denseUnits,activation:"relu",kernelInitializer:l,useBias:!0}),ys.layers.dense({kernelInitializer:l,useBias:!1,activation:"softmax",units:this.numClasses})]}),u=ys.train.adam(n.learningRate),this.trainingModel.compile({optimizer:u,loss:"categoricalCrossentropy",metrics:["accuracy"]}),!(n.batchSize>0))throw new Error("Batch size is 0 or NaN. Please choose a non-zero fraction");return c=this.trainDataset.batch(n.batchSize),h=this.validationDataset.batch(n.batchSize),[4,this.trainingModel.fitDataset(c,{epochs:n.epochs,validationData:h,callbacks:s})];case 1:return p.sent(),d=ys.sequential(),d.add(this.truncatedModel),d.add(this.trainingModel),this.model=d,u.dispose(),[2,this.model]}})})},e.prototype.prepareDataset=function(){for(var n=0;n<this.numClasses;n++)this.examples[n]=[]},e.prototype.setLabel=function(n,s){this._metadata.labels[n]=s},e.prototype.setLabels=function(n){this._metadata.labels=n,this.prepareDataset()},e.prototype.getLabel=function(n){return this._metadata.labels[n]},e.prototype.getLabels=function(){return this._metadata.labels},e.prototype.setName=function(n){this._metadata.modelName=n},e.prototype.getName=function(){return this._metadata.modelName},e.prototype.stopTraining=function(){var n=this,s=new Promise(function(r,i){n.trainingModel.stopTraining=!0,n.__stopTrainingResolve=r});return s},e.prototype.dispose=function(){this.trainingModel.dispose(),t.prototype.dispose.call(this)},e.prototype.calculateAccuracyPerClass=function(){return Lo(this,void 0,void 0,function(){var n,s,r,i,o,a,l,u,c,h,b,d,f,p,m,v,g,w,b,x=this;return Mo(this,function(S){switch(S.label){case 0:return n=this.validationDataset.mapAsync(function(N){return Lo(x,void 0,void 0,function(){return Mo(this,function(I){return[2,N.xs]})})}),s=this.validationDataset.mapAsync(function(N){return Lo(x,void 0,void 0,function(){return Mo(this,function(I){return[2,N.ys]})})}),r=Math.min(s.size,32),i=Math.ceil(s.size/r),o=n.batch(r),a=s.batch(r),[4,o.iterator()];case 1:return l=S.sent(),[4,a.iterator()];case 2:u=S.sent(),c=[],h=[],b=0,S.label=3;case 3:return b<i?[4,l.next()]:[3,7];case 4:return d=S.sent(),f=this.trainingModel.predict(d.value),p=f.argMax(1),c.push(p),[4,u.next()];case 5:m=S.sent(),v=m.value.argMax(1),h.push(v),d.value.dispose(),f.dispose(),m.value.dispose(),S.label=6;case 6:return b++,[3,3];case 7:if(g=ys.concat(h),w=ys.concat(c),i!==1)for(b=0;b<c.length;b++)c[b].dispose(),h[b].dispose();return[2,{reference:g,predictions:w}]}})})},e.prototype.setSeed=function(n){this.seed=VAe(n)},e}(WH.CustomMobileNet);nd.TeachableMobileNet=jH;function GAe(t,e){return Lo(this,void 0,void 0,function(){var n;return Mo(this,function(s){switch(s.label){case 0:return[4,WH.loadTruncatedMobileNet(e)];case 1:return n=s.sent(),[2,new jH(n,t)]}})})}nd.createTeachable=GAe;var cS={};function bv(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?bv=function(n){return typeof n}:bv=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},bv(t)}function IR(t,e,n){var s=n.value;if(typeof s!="function")throw new TypeError("@boundMethod decorator can only be applied to methods not: ".concat(bv(s)));var r=!1;return{configurable:!0,get:function(){if(r||this===t.prototype||this.hasOwnProperty(e)||typeof s!="function")return s;var o=s.bind(this);return r=!0,Object.defineProperty(this,e,{configurable:!0,get:function(){return o},set:function(l){s=l,delete this[e]}}),r=!1,o},set:function(o){s=o}}}function GH(t){var e;return typeof Reflect<"u"&&typeof Reflect.ownKeys=="function"?e=Reflect.ownKeys(t.prototype):(e=Object.getOwnPropertyNames(t.prototype),typeof Object.getOwnPropertySymbols=="function"&&(e=e.concat(Object.getOwnPropertySymbols(t.prototype)))),e.forEach(function(n){if(n!=="constructor"){var s=Object.getOwnPropertyDescriptor(t.prototype,n);typeof s.value=="function"&&Object.defineProperty(t.prototype,n,IR(t,n,s))}}),t}function HAe(){return arguments.length===1?GH.apply(void 0,arguments):IR.apply(void 0,arguments)}const qAe=Object.freeze(Object.defineProperty({__proto__:null,boundClass:GH,boundMethod:IR,default:HAe},Symbol.toStringTag,{value:"Module"})),KAe=j_(qAe);/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var La=qe&&qe.__decorate||function(t,e,n,s){var r=arguments.length,i=r<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,n):s,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(t,e,n,s);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(i=(r<3?o(i):r>3?o(e,n,i):o(e,n))||i);return r>3&&i&&Object.defineProperty(e,n,i),i},XAe=qe&&qe.__awaiter||function(t,e,n,s){function r(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(c){try{u(s.next(c))}catch(h){o(h)}}function l(c){try{u(s.throw(c))}catch(h){o(h)}}function u(c){c.done?i(c.value):r(c.value).then(a,l)}u((s=s.apply(t,e||[])).next())})},YAe=qe&&qe.__generator||function(t,e){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},s,r,i,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(c){return l([u,c])}}function l(u){if(s)throw new TypeError("Generator is already executing.");for(;n;)try{if(s=1,r&&(i=u[0]&2?r.return:u[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,u[1])).done)return i;switch(r=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,r=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){n.label=u[1];break}if(u[0]===6&&n.label<i[1]){n.label=i[1],i=u;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(u);break}i[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(c){u=[6,c],r=0}finally{s=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};Object.defineProperty(cS,"__esModule",{value:!0});cS.Webcam=void 0;var Ma=KAe,QAe=Ri,_C={facingMode:"user",frameRate:24},JAe=function(t){return t.facingMode=t.facingMode||_C.facingMode,t.frameRate=t.frameRate||_C.frameRate,t.aspectRatio=t.aspectRatio||_C.aspectRatio,t},ZAe=function(){function t(e,n,s){e===void 0&&(e=400),n===void 0&&(n=400),s===void 0&&(s=!1),this.width=e,this.height=n,this.flip=s}return t.prototype.getWebcam=function(e){if(e===void 0&&(e={}),!window.navigator.mediaDevices||!window.navigator.mediaDevices.getUserMedia)return Promise.reject("Your browser does not support WebRTC. Please try another one.");e.width=640;var n=JAe(e),s=document.createElement("video");return window.navigator.mediaDevices.getUserMedia({video:n}).then(function(r){return s.srcObject=r,s.addEventListener("loadedmetadata",function(i){var o=s.videoWidth,a=s.videoHeight;s.width=o,s.height=a}),s},function(){return Promise.reject("Could not open your camera. You may have denied access.")})},t.prototype.setup=function(e){return e===void 0&&(e={}),XAe(this,void 0,void 0,function(){var n;return YAe(this,function(s){switch(s.label){case 0:return this.webcam?[3,2]:(n=this,[4,this.getWebcam(e)]);case 1:n.webcam=s.sent(),this.canvas||(this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height),s.label=2;case 2:return[2]}})})},t.prototype.play=function(){var e=this.webcam.play();return e},t.prototype.pause=function(){this.webcam.pause()},t.prototype.stop=function(){this.stopStreamedVideo(this.webcam)},t.prototype.update=function(){this.renderCameraToCanvas()},t.prototype.stopStreamedVideo=function(e){var n=e.srcObject,s=n.getTracks();s.forEach(function(r){r.stop()}),e.srcObject=null},t.prototype.renderCameraToCanvas=function(){if(this.canvas&&this.webcam){var e=this.canvas.getContext("2d");if(this.webcam.videoWidth!==0){var n=QAe.cropTo(this.webcam,this.width,this.flip);e.drawImage(n,0,0)}}},La([Ma.default],t.prototype,"getWebcam",null),La([Ma.default],t.prototype,"setup",null),La([Ma.default],t.prototype,"play",null),La([Ma.default],t.prototype,"pause",null),La([Ma.default],t.prototype,"stop",null),La([Ma.default],t.prototype,"update",null),La([Ma.default],t.prototype,"stopStreamedVideo",null),La([Ma.default],t.prototype,"renderCameraToCanvas",null),t}();cS.Webcam=ZAe;(function(t){/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(t,"__esModule",{value:!0});var e=Wk;Object.defineProperty(t,"IMAGE_SIZE",{enumerable:!0,get:function(){return e.IMAGE_SIZE}}),Object.defineProperty(t,"CustomMobileNet",{enumerable:!0,get:function(){return e.CustomMobileNet}}),Object.defineProperty(t,"load",{enumerable:!0,get:function(){return e.load}}),Object.defineProperty(t,"loadFromFiles",{enumerable:!0,get:function(){return e.loadFromFiles}}),Object.defineProperty(t,"loadTruncatedMobileNet",{enumerable:!0,get:function(){return e.loadTruncatedMobileNet}});var n=nd;Object.defineProperty(t,"TeachableMobileNet",{enumerable:!0,get:function(){return n.TeachableMobileNet}}),Object.defineProperty(t,"createTeachable",{enumerable:!0,get:function(){return n.createTeachable}});var s=cS;Object.defineProperty(t,"Webcam",{enumerable:!0,get:function(){return s.Webcam}});var r=Hy;Object.defineProperty(t,"version",{enumerable:!0,get:function(){return r.version}})})(E4);const eDe=()=>{const[t,e]=ne.useState(null),[n,s]=ne.useState(!1),r=ne.useRef(null),i="/models/";let o;const a=async()=>{try{s(!0),console.log("Loading model..."),o=await E4.load(i+"model.json",i+"metadata.json"),console.log("Model loaded successfully!"),s(!1)}catch(u){console.error("Error loading model:",u),s(!1)}},l=async u=>{const c=u.target.files[0];if(!c)return;const h=URL.createObjectURL(c);r.current.src=h,console.log("Image uploaded: ",c.name),o||await a();try{const d=await o.predict(r.current);console.log("Prediction result: ",d);const f=d.reduce((p,m)=>p.probability>m.probability?p:m);console.log("Highest prediction: ",f),e(f.className)}catch(d){console.error("Error during prediction: ",d)}};return ne.useEffect(()=>{a()},[]),j.jsx("div",{className:"freshcheck-page",children:j.jsxs("div",{className:"fresh-container",children:[j.jsx("h1",{children:"Fruit Freshness Checker"}),j.jsx("input",{type:"file",accept:"image/*",onChange:l}),j.jsx("img",{ref:r,alt:"Uploaded",style:{maxWidth:"300px",marginTop:"20px"}}),n&&j.jsx("p",{children:"Loading model..."}),t&&j.jsxs("p",{children:["Prediction: ",j.jsx("strong",{children:t})]})]})})},Qc=({children:t})=>Ix().currentUser?t:j.jsx(o8,{to:"/"});function tDe(){const t=R8([{path:"/",element:j.jsx(gee,{})},{path:"/signup",element:j.jsx(yee,{})},{path:"/main",element:j.jsx(Qc,{children:j.jsx(hee,{})})},{path:"/check",element:j.jsx(Qc,{children:j.jsx(eDe,{})})},{path:"/retrive",element:j.jsx(Qc,{children:j.jsx(vee,{})})},{path:"/Features",element:j.jsx(Qc,{children:j.jsx(dee,{})})},{path:"/additems",element:j.jsx(Qc,{children:j.jsx(fee,{})})},{path:"/display",element:j.jsx(Qc,{children:j.jsx(pee,{})})},{path:"*",element:j.jsx("h1",{children:"Page Not Found"})}]);return j.jsx(W8,{router:t})}qM(document.getElementById("root")).render(j.jsx(ne.StrictMode,{children:j.jsx(tDe,{})}));
